<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span. { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
<title>: The Lack of Female Protagonists in Children’s Movies</title>

<meta property="description" itemprop="description" content="Some time ago, I read a very interesting post from Giora Simchoni who used machine learning to estimate how many children&#39;s books have a central female character. Based on a Goodread list, he showed that for every book with a central female character, there are between 1.1 and 1.3 books written with a male protagonist. I couldn&#39;t help thinking that his analysis should be replicated on children&#39;s movies."/>

<link rel="canonical" href="felixluginbuhl.com/blog/posts/2017-12-11-movies/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2017-12-11"/>
<meta property="article:created" itemprop="dateCreated" content="2017-12-11"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content=": The Lack of Female Protagonists in Children’s Movies"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Some time ago, I read a very interesting post from Giora Simchoni who used machine learning to estimate how many children&#39;s books have a central female character. Based on a Goodread list, he showed that for every book with a central female character, there are between 1.1 and 1.3 books written with a male protagonist. I couldn&#39;t help thinking that his analysis should be replicated on children&#39;s movies."/>
<meta property="og:url" content="felixluginbuhl.com/blog/posts/2017-12-11-movies/"/>
<meta property="og:image" content="felixluginbuhl.com/blog/posts/2017-12-11-movies/img/chart_childrensmovies_2.png"/>
<meta property="og:image:width" content="672"/>
<meta property="og:image:height" content="480"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content=""/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content=": The Lack of Female Protagonists in Children’s Movies"/>
<meta property="twitter:description" content="Some time ago, I read a very interesting post from Giora Simchoni who used machine learning to estimate how many children&#39;s books have a central female character. Based on a Goodread list, he showed that for every book with a central female character, there are between 1.1 and 1.3 books written with a male protagonist. I couldn&#39;t help thinking that his analysis should be replicated on children&#39;s movies."/>
<meta property="twitter:url" content="felixluginbuhl.com/blog/posts/2017-12-11-movies/"/>
<meta property="twitter:image" content="felixluginbuhl.com/blog/posts/2017-12-11-movies/img/chart_childrensmovies_2.png"/>
<meta property="twitter:image:width" content="672"/>
<meta property="twitter:image:height" content="480"/>
<meta property="twitter:creator" content="@FelixLuginbuhl"/>

<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","date","preview","twitter","output","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["The Lack of Female Protagonists in Children’s Movies"]},{"type":"character","attributes":{},"value":["Some time ago, I read a very interesting post from Giora Simchoni who used machine learning to estimate how many children's books have a central female character. Based on a Goodread list, he showed that for every book with a central female character, there are between 1.1 and 1.3 books written with a male protagonist. I couldn't help thinking that his analysis should be replicated on children's movies."]},{"type":"character","attributes":{},"value":["2017-12-11"]},{"type":"character","attributes":{},"value":["img/chart_childrensmovies_2.png"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["creator"]}},"value":[{"type":"character","attributes":{},"value":["@FelixLuginbuhl"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["toc","highlight","self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["kate"]},{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"character","attributes":{},"value":["felixluginbuhl.com/blog/posts/2017-12-11-movies/"]},{"type":"character","attributes":{},"value":["felixluginbuhl.com/blog/posts/2017-12-11-movies/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["2017-12-11-movies_files/anchor-4.2.2/anchor.min.js","2017-12-11-movies_files/bowser-1.9.3/bowser.min.js","2017-12-11-movies_files/distill-2.2.21/template.v2.js","2017-12-11-movies_files/jquery-1.11.3/jquery.min.js","2017-12-11-movies_files/webcomponents-2.0.0/webcomponents.js","img/chart_childrensmovies_1.png","img/chart_childrensmovies_2.png","img/chart_childrensmovies_3.png"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

</style>

<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
            .filter(function(item) { return !!item.description; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description}
                </div>
                <div class="search-item-preview">
                  <img src="${suggestion.preview ? offsetURL(suggestion.preview) : ''}"</img>
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">@import url('https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono&display=swap');

/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    "Open Sans", sans-serif;
  --mono-font:       "Open Sans", monospace;
  --body-font:       "Open Sans", sans-serif;
  --navbar-font:     "Open Sans", sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

.categories li > a:hover {
    color: #5e72e4;
    border-bottom: 1px #5e72e4;
}

p a:hover  {
    color: #5e72e4;
}

/* Change bullets */
ul > li::marker {
  font-size: 1.125em;
  color: #5e72e4;
}
</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
	font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
/* only text inside of <p> tags */
d-article > p {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}

/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
	font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
	font-size: var(--aside-size, 12px);
	color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
	font-size: var(--fig-cap-size, 13px);
	color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
	font-size: var(--heading-size, 0.6rem);
	color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
	font-size: var(--body-size, 0.8rem);
	color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
	color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
	font-size: var(--heading-size, 18px);
}

.d-contents nav a {
	font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
	color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
	color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
	color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
	font-size: var(--title-size, 18px);
	font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a {
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a:hover {
	color: var(--hover-color, white);
}

.distill-site-header {
	font-size: var(--text-size, 15px);
	color: var(--text-color, rgba(255, 255, 255, 0.8));
	background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
	font-size: var(--text-size, 15px);
	color: var(--text-color, rgba(255, 255, 255, 0.8));
	background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
	color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-158089797-1"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-158089797-1');
</script>
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"The Lack of Female Protagonists in Children’s Movies","description":"Some time ago, I read a very interesting post from Giora Simchoni who used machine learning to estimate how many children's books have a central female character. Based on a Goodread list, he showed that for every book with a central female character, there are between 1.1 and 1.3 books written with a male protagonist. I couldn't help thinking that his analysis should be replicated on children's movies.","authors":[],"publishedDate":"2017-12-11T00:00:00.000+01:00"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="../../index.html" class="title"></a>
<a href="https://www.felixluginbuhl.com" class="nav-image">
<img src="../../img/banner-logo-white.png"/>
</a>
<a href="https://www.felixluginbuhl.com">Home</a>
<a href="https://www.felixluginbuhl.com/blog">Blog</a>
<a href="https://www.felixluginbuhl.com/about">About</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>The Lack of Female Protagonists in Children’s Movies</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>Some time ago, I read a very interesting post from Giora Simchoni who used machine learning to estimate how many children’s books have a central female character. Based on a Goodread list, he showed that for every book with a central female character, there are between 1.1 and 1.3 books written with a male protagonist. I couldn’t help thinking that his analysis should be replicated on children’s movies.</p></p>
</div>


<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#scraping-100-years-of-childrens-movies">Scraping 100 years of Children’s Movies</a></li>
<li><a href="#mimicking-gioras-code">Mimicking Giora’s Code</a></li>
<li><a href="#preparing-the-machine">Preparing the Machine</a></li>
<li><a href="#machine-learning-with-xgboost">Machine Learning with {xgboost}</a></li>
<li><a href="#two-different-answers">Two different answers</a></li>
<li><a href="#fin">FIN</a></li>
</ul>
</nav>
</div>
<p>So that’s what we will do in this blog post, using <a href="https://en.wikipedia.org/w/index.php?title=List_of_children%27s_films&amp;oldid=810426354">this</a> Wikipedia article that listed 100 years of children’s movies. We will see that reusing someone else code cannot be done without adapting it to the specific features of our own dataset. It’s why, in addition to the multiclass classification made by Giora, we will perform a binary logistic classification. Finally, we will visualize the predictions of our models in order to know if the central character gender ratio is changing over the years<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<p>Since we will reuse most of Giora’s code, you really should read <a href="http://giorasimchoni.com/2017/09/24/2017-09-24-where-my-girls-at/">his post</a> first. You read it? Good, let’s move one!</p>
<h2 id="scraping-100-years-of-childrens-movies">Scraping 100 years of Children’s Movies</h2>
<p>Let’s begin by scraping all the children’s movies links of our Wikipedia article using {rvest}.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(rvest)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># Permanent link for reproducibility</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>baseUrl &lt;-<span class="st"> &quot;https://en.wikipedia.org/w/index.php?title=List_of_children%27s_films&amp;oldid=810426354&quot;</span></span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a>urls &lt;-<span class="st"> </span>baseUrl <span class="op">%&gt;%</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="st">  </span><span class="kw">read_html</span>() <span class="op">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="st">  </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="st">  </span><span class="kw">keep</span>(<span class="kw">startsWith</span>(., <span class="st">&quot;/wiki/&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="st">  </span><span class="kw">discard</span>(<span class="kw">str_detect</span>(., <span class="st">&quot;Children%27s_film&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="st">  </span><span class="kw">discard</span>(<span class="kw">startsWith</span>(., <span class="st">&quot;/wiki/Wikipedia:&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="st">  </span><span class="kw">discard</span>(<span class="kw">startsWith</span>(., <span class="st">&quot;/wiki/User&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="st">  </span><span class="kw">discard</span>(<span class="kw">startsWith</span>(., <span class="st">&quot;/wiki/Help:&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="st">  </span><span class="kw">discard</span>(<span class="kw">startsWith</span>(., <span class="st">&quot;/wiki/Talk:&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="st">  </span><span class="kw">discard</span>(<span class="kw">startsWith</span>(., <span class="st">&quot;/wiki/Special:&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="st">  </span><span class="kw">discard</span>(<span class="kw">startsWith</span>(., <span class="st">&quot;/wiki/Portal:&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="st">  </span><span class="kw">discard</span>(<span class="kw">startsWith</span>(., <span class="st">&quot;/wiki/Category:&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="st">  </span><span class="kw">discard</span>(<span class="kw">startsWith</span>(., <span class="st">&quot;/wiki/List_of_&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="st">  </span>.[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1698</span><span class="op">:</span><span class="dv">1725</span>)] <span class="co"># remove infobox links</span></span>
<span id="cb1-22"><a href="#cb1-22"></a></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="kw">as_tibble</span>(urls)</span></code></pre></div>
<pre><code>## # A tibble: 1,697 x 1
##                                    value
##                                    &lt;chr&gt;
##  1       /wiki/The_Blue_Bird_(1918_film)
##  2           /wiki/Pollyanna_(1920_film)
##  3           /wiki/Peter_Pan_(1924_film)
##  4    /wiki/A_Kiss_for_Cinderella_(film)
##  5        /wiki/Wizard_of_Oz_(1925_film)
##  6 /wiki/The_Adventures_of_Prince_Achmed
##  7 /wiki/Alice_in_Wonderland_(1933_film)
##  8    /wiki/Babes_in_Toyland_(1934_film)
##  9                /wiki/Curly_Top_(film)
## 10                /wiki/The_New_Gulliver
## # ... with 1,687 more rows</code></pre>
<p>We almost got 1700 wikilinks!</p>
<p>Now, we want to scrape specific data from each link. To do that, we will write a function that reads a link of the <code>urls</code> vector and returns a list of 7 components, i.e. <code>title</code>, <code>years</code>, <code>actors</code>, <code>directors</code>, <code>country</code>, <code>language</code> and <code>description</code>.</p>
<p>Click on ‘Show code’ to see this looong function.</p>
<details>
<p><summary><span class="btn btn--inverse">Show code</span></summary></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>moviesData &lt;-<span class="st"> </span><span class="cf">function</span>(urls) {</span>
<span id="cb3-2"><a href="#cb3-2"></a>  </span>
<span id="cb3-3"><a href="#cb3-3"></a>  html &lt;-<span class="st"> </span><span class="kw">tryCatch</span>(<span class="kw">read_html</span>(<span class="kw">str_c</span>(<span class="st">&quot;https://en.wikipedia.org&quot;</span>, urls)),</span>
<span id="cb3-4"><a href="#cb3-4"></a>                   <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="ot">NULL</span>)</span>
<span id="cb3-5"><a href="#cb3-5"></a>  </span>
<span id="cb3-6"><a href="#cb3-6"></a>  infobox &lt;-<span class="st"> </span><span class="kw">tryCatch</span>(</span>
<span id="cb3-7"><a href="#cb3-7"></a>    html <span class="op">%&gt;%</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="st">      </span><span class="kw">html_node</span>(<span class="st">&quot;.infobox&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="st">      </span><span class="kw">html_children</span>() <span class="op">%&gt;%</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="st">      </span><span class="kw">html_text</span>(),</span>
<span id="cb3-11"><a href="#cb3-11"></a>    <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="ot">NA</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>  )</span>
<span id="cb3-13"><a href="#cb3-13"></a>  </span>
<span id="cb3-14"><a href="#cb3-14"></a>  title &lt;-<span class="st"> </span><span class="kw">tryCatch</span>(</span>
<span id="cb3-15"><a href="#cb3-15"></a>    html <span class="op">%&gt;%</span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="st">      </span><span class="kw">html_nodes</span>(<span class="st">&quot;.summary&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="st">      </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="st">      </span><span class="kw">first</span>(), <span class="co"># avoid title duplication</span></span>
<span id="cb3-19"><a href="#cb3-19"></a>    <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="ot">NA</span></span>
<span id="cb3-20"><a href="#cb3-20"></a>  )</span>
<span id="cb3-21"><a href="#cb3-21"></a>  </span>
<span id="cb3-22"><a href="#cb3-22"></a>  year &lt;-<span class="st"> </span><span class="kw">tryCatch</span>(</span>
<span id="cb3-23"><a href="#cb3-23"></a>    html <span class="op">%&gt;%</span></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="st">      </span><span class="kw">html_nodes</span>(<span class="st">&quot;.published&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb3-25"><a href="#cb3-25"></a><span class="st">      </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="st">      </span><span class="kw">str_extract</span>(<span class="st">&quot;[0-9]{4}&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb3-27"><a href="#cb3-27"></a><span class="st">      </span><span class="kw">unique</span>() <span class="op">%&gt;%</span></span>
<span id="cb3-28"><a href="#cb3-28"></a><span class="st">      </span><span class="kw">first</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># avoid title duplication</span></span>
<span id="cb3-29"><a href="#cb3-29"></a><span class="st">      </span><span class="kw">as.numeric</span>(),</span>
<span id="cb3-30"><a href="#cb3-30"></a>    <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="ot">NA</span></span>
<span id="cb3-31"><a href="#cb3-31"></a>  )</span>
<span id="cb3-32"><a href="#cb3-32"></a>  </span>
<span id="cb3-33"><a href="#cb3-33"></a>  <span class="cf">if</span>(<span class="kw">is.na</span>(year)) {</span>
<span id="cb3-34"><a href="#cb3-34"></a>    infoboxRow &lt;-<span class="st"> </span>infobox <span class="op">%&gt;%</span></span>
<span id="cb3-35"><a href="#cb3-35"></a><span class="st">      </span><span class="kw">str_detect</span>(<span class="st">&quot;Release&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb3-36"><a href="#cb3-36"></a><span class="st">      </span><span class="kw">which</span>()</span>
<span id="cb3-37"><a href="#cb3-37"></a>    </span>
<span id="cb3-38"><a href="#cb3-38"></a>    year &lt;-<span class="st"> </span>infobox[[infoboxRow[<span class="dv">1</span>]]] <span class="op">%&gt;%</span></span>
<span id="cb3-39"><a href="#cb3-39"></a><span class="st">      </span><span class="kw">str_extract</span>(<span class="st">&quot;[0-9]{4}&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb3-40"><a href="#cb3-40"></a><span class="st">      </span><span class="kw">unique</span>() <span class="op">%&gt;%</span></span>
<span id="cb3-41"><a href="#cb3-41"></a><span class="st">      </span><span class="kw">first</span>() <span class="op">%&gt;%</span></span>
<span id="cb3-42"><a href="#cb3-42"></a><span class="st">      </span><span class="kw">as.numeric</span>()</span>
<span id="cb3-43"><a href="#cb3-43"></a>  }</span>
<span id="cb3-44"><a href="#cb3-44"></a>  </span>
<span id="cb3-45"><a href="#cb3-45"></a>  getActors &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb3-46"><a href="#cb3-46"></a>    infoboxRow &lt;-<span class="st"> </span>infobox <span class="op">%&gt;%</span></span>
<span id="cb3-47"><a href="#cb3-47"></a><span class="st">      </span><span class="kw">str_detect</span>(<span class="st">&quot;Starring&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb3-48"><a href="#cb3-48"></a><span class="st">      </span><span class="kw">which</span>()</span>
<span id="cb3-49"><a href="#cb3-49"></a>    actorsNames &lt;-<span class="st"> </span>infobox[[infoboxRow[<span class="dv">1</span>]]] <span class="op">%&gt;%</span></span>
<span id="cb3-50"><a href="#cb3-50"></a><span class="st">      </span><span class="kw">gsub</span>(<span class="st">&quot;^Starring&quot;</span>, <span class="st">&quot;&quot;</span>, .) <span class="op">%&gt;%</span></span>
<span id="cb3-51"><a href="#cb3-51"></a><span class="st">      </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>, .) <span class="op">%&gt;%</span></span>
<span id="cb3-52"><a href="#cb3-52"></a><span class="st">      </span><span class="kw">gsub</span>(<span class="st">&quot;([a-z])([A-Z])&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1 </span><span class="ch">\\</span><span class="st">2&quot;</span>, .)</span>
<span id="cb3-53"><a href="#cb3-53"></a>  }</span>
<span id="cb3-54"><a href="#cb3-54"></a>  </span>
<span id="cb3-55"><a href="#cb3-55"></a>  actors &lt;-<span class="st"> </span><span class="kw">tryCatch</span>(</span>
<span id="cb3-56"><a href="#cb3-56"></a>    <span class="kw">getActors</span>(),</span>
<span id="cb3-57"><a href="#cb3-57"></a>    <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="ot">NA</span></span>
<span id="cb3-58"><a href="#cb3-58"></a>  )</span>
<span id="cb3-59"><a href="#cb3-59"></a>  </span>
<span id="cb3-60"><a href="#cb3-60"></a>  <span class="cf">if</span>(<span class="kw">identical</span>(actors, <span class="st">&quot;see below&quot;</span>) <span class="op">|</span><span class="st"> </span></span>
<span id="cb3-61"><a href="#cb3-61"></a><span class="st">     </span><span class="kw">identical</span>(actors, <span class="st">&quot;See below&quot;</span>) <span class="op">|</span><span class="st"> </span></span>
<span id="cb3-62"><a href="#cb3-62"></a><span class="st">     </span><span class="kw">identical</span>(actors, <span class="st">&quot;See voices&quot;</span>)) {</span>
<span id="cb3-63"><a href="#cb3-63"></a>    actors &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb3-64"><a href="#cb3-64"></a>  }</span>
<span id="cb3-65"><a href="#cb3-65"></a>  </span>
<span id="cb3-66"><a href="#cb3-66"></a>  getDirectors &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb3-67"><a href="#cb3-67"></a>    infoboxRow &lt;-<span class="st"> </span>infobox <span class="op">%&gt;%</span></span>
<span id="cb3-68"><a href="#cb3-68"></a><span class="st">      </span><span class="kw">str_detect</span>(<span class="st">&quot;Directed by&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb3-69"><a href="#cb3-69"></a><span class="st">      </span><span class="kw">which</span>()</span>
<span id="cb3-70"><a href="#cb3-70"></a>    directorNames &lt;-<span class="st"> </span>infobox[[infoboxRow[<span class="dv">1</span>]]] <span class="op">%&gt;%</span></span>
<span id="cb3-71"><a href="#cb3-71"></a><span class="st">      </span><span class="kw">gsub</span>(<span class="st">&quot;Directed by&quot;</span>, <span class="st">&quot;&quot;</span>, .) <span class="op">%&gt;%</span></span>
<span id="cb3-72"><a href="#cb3-72"></a><span class="st">      </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>, .) <span class="op">%&gt;%</span></span>
<span id="cb3-73"><a href="#cb3-73"></a><span class="st">      </span><span class="kw">gsub</span>(<span class="st">&quot;([a-z])([A-Z])&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1 </span><span class="ch">\\</span><span class="st">2&quot;</span>, .) <span class="op">%&gt;%</span></span>
<span id="cb3-74"><a href="#cb3-74"></a><span class="st">      </span><span class="kw">unlist</span>()</span>
<span id="cb3-75"><a href="#cb3-75"></a>  }</span>
<span id="cb3-76"><a href="#cb3-76"></a>  </span>
<span id="cb3-77"><a href="#cb3-77"></a>  directors &lt;-<span class="st"> </span><span class="kw">tryCatch</span>(</span>
<span id="cb3-78"><a href="#cb3-78"></a>    <span class="kw">getDirectors</span>(),</span>
<span id="cb3-79"><a href="#cb3-79"></a>    <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="ot">NA</span></span>
<span id="cb3-80"><a href="#cb3-80"></a>  )</span>
<span id="cb3-81"><a href="#cb3-81"></a>  </span>
<span id="cb3-82"><a href="#cb3-82"></a>  getCountry &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb3-83"><a href="#cb3-83"></a>    infoboxRow &lt;-<span class="st"> </span>infobox <span class="op">%&gt;%</span></span>
<span id="cb3-84"><a href="#cb3-84"></a><span class="st">      </span><span class="kw">str_detect</span>(<span class="st">&quot;Country&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb3-85"><a href="#cb3-85"></a><span class="st">      </span><span class="kw">which</span>()</span>
<span id="cb3-86"><a href="#cb3-86"></a>    countryNames &lt;-<span class="st"> </span>infobox[[infoboxRow[<span class="dv">1</span>]]] <span class="op">%&gt;%</span></span>
<span id="cb3-87"><a href="#cb3-87"></a><span class="st">      </span><span class="kw">gsub</span>(<span class="st">&quot;Country&quot;</span>, <span class="st">&quot;&quot;</span>, .) <span class="op">%&gt;%</span></span>
<span id="cb3-88"><a href="#cb3-88"></a><span class="st">      </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>, .) <span class="op">%&gt;%</span></span>
<span id="cb3-89"><a href="#cb3-89"></a><span class="st">      </span><span class="kw">gsub</span>(<span class="st">&quot;([a-z])([A-Z])&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1 </span><span class="ch">\\</span><span class="st">2&quot;</span>, .)</span>
<span id="cb3-90"><a href="#cb3-90"></a>  }</span>
<span id="cb3-91"><a href="#cb3-91"></a>  </span>
<span id="cb3-92"><a href="#cb3-92"></a>  country &lt;-<span class="st"> </span><span class="kw">tryCatch</span>(</span>
<span id="cb3-93"><a href="#cb3-93"></a>    <span class="kw">getCountry</span>(),</span>
<span id="cb3-94"><a href="#cb3-94"></a>    <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="ot">NA</span></span>
<span id="cb3-95"><a href="#cb3-95"></a>  )</span>
<span id="cb3-96"><a href="#cb3-96"></a>  </span>
<span id="cb3-97"><a href="#cb3-97"></a>  getLanguage &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb3-98"><a href="#cb3-98"></a>    infoboxRow &lt;-<span class="st"> </span>infobox <span class="op">%&gt;%</span></span>
<span id="cb3-99"><a href="#cb3-99"></a><span class="st">      </span><span class="kw">str_detect</span>(<span class="st">&quot;Language&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb3-100"><a href="#cb3-100"></a><span class="st">      </span><span class="kw">which</span>()</span>
<span id="cb3-101"><a href="#cb3-101"></a>    movieLangage &lt;-<span class="st"> </span>infobox[[infoboxRow[<span class="dv">1</span>]]] <span class="op">%&gt;%</span></span>
<span id="cb3-102"><a href="#cb3-102"></a><span class="st">      </span><span class="kw">gsub</span>(<span class="st">&quot;Language&quot;</span>, <span class="st">&quot;&quot;</span>, .) <span class="op">%&gt;%</span></span>
<span id="cb3-103"><a href="#cb3-103"></a><span class="st">      </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>, .) <span class="op">%&gt;%</span></span>
<span id="cb3-104"><a href="#cb3-104"></a><span class="st">      </span><span class="kw">gsub</span>(<span class="st">&quot;([a-z])([A-Z])&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1 </span><span class="ch">\\</span><span class="st">2&quot;</span>, .) <span class="op">%&gt;%</span></span>
<span id="cb3-105"><a href="#cb3-105"></a><span class="st">      </span><span class="kw">unlist</span>()</span>
<span id="cb3-106"><a href="#cb3-106"></a>  }</span>
<span id="cb3-107"><a href="#cb3-107"></a>  </span>
<span id="cb3-108"><a href="#cb3-108"></a>  language &lt;-<span class="st"> </span><span class="kw">tryCatch</span>(</span>
<span id="cb3-109"><a href="#cb3-109"></a>    <span class="kw">getLanguage</span>(),</span>
<span id="cb3-110"><a href="#cb3-110"></a>    <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="ot">NA</span></span>
<span id="cb3-111"><a href="#cb3-111"></a>  )</span>
<span id="cb3-112"><a href="#cb3-112"></a>  </span>
<span id="cb3-113"><a href="#cb3-113"></a>  article &lt;-<span class="st"> </span><span class="kw">tryCatch</span>(</span>
<span id="cb3-114"><a href="#cb3-114"></a>    html <span class="op">%&gt;%</span></span>
<span id="cb3-115"><a href="#cb3-115"></a><span class="st">      </span><span class="kw">html_nodes</span>(<span class="st">&quot;.mw-body&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb3-116"><a href="#cb3-116"></a><span class="st">      </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span></span>
<span id="cb3-117"><a href="#cb3-117"></a><span class="st">      </span><span class="kw">str_split</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb3-118"><a href="#cb3-118"></a><span class="st">      </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span></span>
<span id="cb3-119"><a href="#cb3-119"></a><span class="st">      </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>, .),</span>
<span id="cb3-120"><a href="#cb3-120"></a>    <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="ot">NA</span></span>
<span id="cb3-121"><a href="#cb3-121"></a>  )</span>
<span id="cb3-122"><a href="#cb3-122"></a>  </span>
<span id="cb3-123"><a href="#cb3-123"></a>  article &lt;-<span class="st"> </span><span class="kw">tryCatch</span>(</span>
<span id="cb3-124"><a href="#cb3-124"></a>    article &lt;-<span class="st"> </span>article[article <span class="op">!=</span><span class="st"> &quot;&quot;</span>], <span class="co"># remove empty lines</span></span>
<span id="cb3-125"><a href="#cb3-125"></a>    <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="ot">NA</span></span>
<span id="cb3-126"><a href="#cb3-126"></a>  )</span>
<span id="cb3-127"><a href="#cb3-127"></a>  </span>
<span id="cb3-128"><a href="#cb3-128"></a>  getDescription &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb3-129"><a href="#cb3-129"></a>    descriptionRow &lt;&lt;-<span class="st"> </span>article <span class="op">%&gt;%</span></span>
<span id="cb3-130"><a href="#cb3-130"></a><span class="st">      </span><span class="kw">str_detect</span>(<span class="st">&quot;^Plot&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb3-131"><a href="#cb3-131"></a><span class="st">      </span><span class="kw">which</span>() <span class="op">%&gt;%</span></span>
<span id="cb3-132"><a href="#cb3-132"></a><span class="st">      </span><span class="kw">sum</span>(<span class="op">+</span><span class="dv">1</span>) <span class="co"># row number after plot title</span></span>
<span id="cb3-133"><a href="#cb3-133"></a>    movieDescription &lt;&lt;-<span class="st"> </span>article[[descriptionRow[<span class="dv">1</span>]]] <span class="op">%&gt;%</span></span>
<span id="cb3-134"><a href="#cb3-134"></a><span class="st">      </span><span class="kw">gsub</span>(<span class="st">&quot;Language&quot;</span>, <span class="st">&quot;&quot;</span>, .) <span class="op">%&gt;%</span></span>
<span id="cb3-135"><a href="#cb3-135"></a><span class="st">      </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot;&quot;</span>, .) <span class="op">%&gt;%</span></span>
<span id="cb3-136"><a href="#cb3-136"></a><span class="st">      </span><span class="kw">gsub</span>(<span class="st">&quot;([a-z])([A-Z])&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1 </span><span class="ch">\\</span><span class="st">2&quot;</span>, .) <span class="op">%&gt;%</span></span>
<span id="cb3-137"><a href="#cb3-137"></a><span class="st">      </span><span class="kw">unlist</span>()</span>
<span id="cb3-138"><a href="#cb3-138"></a>  }</span>
<span id="cb3-139"><a href="#cb3-139"></a>  </span>
<span id="cb3-140"><a href="#cb3-140"></a>  description &lt;-<span class="st"> </span><span class="kw">tryCatch</span>(</span>
<span id="cb3-141"><a href="#cb3-141"></a>    <span class="kw">getDescription</span>(),</span>
<span id="cb3-142"><a href="#cb3-142"></a>    <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="ot">NA</span></span>
<span id="cb3-143"><a href="#cb3-143"></a>  )</span>
<span id="cb3-144"><a href="#cb3-144"></a>  </span>
<span id="cb3-145"><a href="#cb3-145"></a>  <span class="co"># Remove Wikipedia warning about the plot</span></span>
<span id="cb3-146"><a href="#cb3-146"></a>  <span class="cf">if</span>(<span class="kw">startsWith</span>(description, <span class="st">&quot;This article&quot;</span>) <span class="op">|</span><span class="st"> </span></span>
<span id="cb3-147"><a href="#cb3-147"></a><span class="st">     </span><span class="kw">startsWith</span>(description, <span class="st">&quot;This section&quot;</span>) <span class="op">|</span><span class="st"> </span></span>
<span id="cb3-148"><a href="#cb3-148"></a><span class="st">     </span><span class="kw">startsWith</span>(description, <span class="st">&quot;This film&#39;s plot summary&quot;</span>)) {</span>
<span id="cb3-149"><a href="#cb3-149"></a>    descriptionRow &lt;-<span class="st"> </span><span class="kw">sum</span>(descriptionRow <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb3-150"><a href="#cb3-150"></a>    description &lt;-<span class="st"> </span>article[[descriptionRow[<span class="dv">1</span>]]]</span>
<span id="cb3-151"><a href="#cb3-151"></a>  }</span>
<span id="cb3-152"><a href="#cb3-152"></a>  </span>
<span id="cb3-153"><a href="#cb3-153"></a>  <span class="co"># if the description has less than 70 characters, skipping the row</span></span>
<span id="cb3-154"><a href="#cb3-154"></a>  <span class="cf">if</span>(<span class="kw">nchar</span>(description) <span class="op">&lt;</span><span class="st"> </span><span class="dv">70</span>) {</span>
<span id="cb3-155"><a href="#cb3-155"></a>    descriptionRow &lt;-<span class="st"> </span><span class="kw">sum</span>(descriptionRow <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="co"># skip to next row</span></span>
<span id="cb3-156"><a href="#cb3-156"></a>    description &lt;-<span class="st"> </span>article[[descriptionRow[<span class="dv">1</span>]]]</span>
<span id="cb3-157"><a href="#cb3-157"></a>  }</span>
<span id="cb3-158"><a href="#cb3-158"></a>  </span>
<span id="cb3-159"><a href="#cb3-159"></a>  <span class="co"># Skipping row another time, just to be sure</span></span>
<span id="cb3-160"><a href="#cb3-160"></a>  <span class="cf">if</span>(<span class="kw">nchar</span>(description) <span class="op">&lt;</span><span class="st"> </span><span class="dv">70</span>) {</span>
<span id="cb3-161"><a href="#cb3-161"></a>    descriptionRow &lt;-<span class="st"> </span><span class="kw">sum</span>(descriptionRow <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="co"># skip to next row</span></span>
<span id="cb3-162"><a href="#cb3-162"></a>    description &lt;-<span class="st"> </span>article[[descriptionRow[<span class="dv">1</span>]]]</span>
<span id="cb3-163"><a href="#cb3-163"></a>  }</span>
<span id="cb3-164"><a href="#cb3-164"></a>  </span>
<span id="cb3-165"><a href="#cb3-165"></a>  <span class="co"># if descriptionRow is before the 5th, it&#39;s not a plot</span></span>
<span id="cb3-166"><a href="#cb3-166"></a>  <span class="cf">if</span>(descriptionRow <span class="op">&lt;</span><span class="st"> </span><span class="dv">5</span>) {</span>
<span id="cb3-167"><a href="#cb3-167"></a>    description &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb3-168"><a href="#cb3-168"></a>  }</span>
<span id="cb3-169"><a href="#cb3-169"></a>  </span>
<span id="cb3-170"><a href="#cb3-170"></a>  <span class="kw">return</span>(<span class="kw">list</span>(</span>
<span id="cb3-171"><a href="#cb3-171"></a>    <span class="dt">title =</span> title,</span>
<span id="cb3-172"><a href="#cb3-172"></a>    <span class="dt">year =</span> year,</span>
<span id="cb3-173"><a href="#cb3-173"></a>    <span class="dt">actors =</span> actors,</span>
<span id="cb3-174"><a href="#cb3-174"></a>    <span class="dt">directors =</span> directors,</span>
<span id="cb3-175"><a href="#cb3-175"></a>    <span class="dt">country =</span> country,</span>
<span id="cb3-176"><a href="#cb3-176"></a>    <span class="dt">language =</span> language,</span>
<span id="cb3-177"><a href="#cb3-177"></a>    <span class="dt">description =</span> description</span>
<span id="cb3-178"><a href="#cb3-178"></a>  ))</span>
<span id="cb3-179"><a href="#cb3-179"></a>}</span></code></pre></div>
</details>
<p>As you can see inside the function, we scraped the data from the Wikipedia body article and, when getting a missing value, we tried to get the data from its infobox (when existing). We used some “tricks” to avoid getting the warning messages or image description into the <code>description</code> variable.</p>
<p>Note that the function takes only the first paragraph of the article plot section. This is not really a problem as it often describes the main character as he/she appears first or gives a general summary of the movie.</p>
<p>Okay, let’s try our function on the first link.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">str</span>(<span class="kw">moviesData</span>(urls[<span class="dv">1</span>]))</span></code></pre></div>
<pre><code>## List of 7
##  $ title      : chr &quot;The Blue Bird&quot;
##  $ year       : num 1918
##  $ actors     : chr &quot;Tula Belle Robin Macdougall&quot;
##  $ directors  : chr &quot;Maurice Tourneur&quot;
##  $ country    : chr &quot;United States&quot;
##  $ language   : chr &quot;Silent (English intertitles)&quot;
##  $ description: chr &quot;When poor old widow Berlingot asks Tyltyl and Mytyl, the young son and daughter of her more prosperous neighbors, for the loan &quot;| __truncated__</code></pre>
<p>In order to scrape the 1700 wikilinks and build a single dataset of 7 variables, we will use an elegant code written by Giora in <a href="http://giorasimchoni.com/2017/10/08/2017-10-08-sign-of-the-times/">another post</a> of his blog.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>movies &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="dt">title =</span> <span class="kw">character</span>(<span class="dv">0</span>),</span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="dt">year =</span> <span class="kw">integer</span>(<span class="dv">0</span>),</span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="dt">actors =</span> <span class="kw">character</span>(<span class="dv">0</span>),</span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="dt">directors =</span> <span class="kw">character</span>(<span class="dv">0</span>),</span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="dt">country =</span> <span class="kw">character</span>(<span class="dv">0</span>),</span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="dt">language =</span> <span class="kw">character</span>(<span class="dv">0</span>),</span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="dt">description =</span> <span class="kw">character</span>(<span class="dv">0</span>)</span>
<span id="cb6-9"><a href="#cb6-9"></a>  )</span>
<span id="cb6-10"><a href="#cb6-10"></a></span>
<span id="cb6-11"><a href="#cb6-11"></a>getMoviesData &lt;-<span class="st"> </span><span class="cf">function</span>(i) {</span>
<span id="cb6-12"><a href="#cb6-12"></a>  <span class="kw">cat</span>(i, <span class="st">&quot; &quot;</span>)</span>
<span id="cb6-13"><a href="#cb6-13"></a>  movie &lt;-<span class="st"> </span><span class="kw">tryCatch</span>(</span>
<span id="cb6-14"><a href="#cb6-14"></a>    <span class="kw">read_html</span>(<span class="kw">str_c</span>(<span class="st">&quot;https://en.wikipedia.org&quot;</span>, urls[i])) <span class="op">%&gt;%</span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="st">      </span><span class="kw">moviesData</span>(),</span>
<span id="cb6-16"><a href="#cb6-16"></a>    <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="ot">NULL</span></span>
<span id="cb6-17"><a href="#cb6-17"></a>  )</span>
<span id="cb6-18"><a href="#cb6-18"></a>  movies &lt;&lt;-<span class="st"> </span><span class="kw">rbind.data.frame</span>(movies, movie, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb6-19"><a href="#cb6-19"></a>}</span>
<span id="cb6-20"><a href="#cb6-20"></a></span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="kw">walk</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(urls), getMoviesData)</span></code></pre></div>
<pre><code>## 1  2  3  4  5  6  7  8  9  10  11  12  13  14  15  16  # etc.</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">glimpse</span>(movies)</span></code></pre></div>
<pre><code>## Observations: 1,644
## Variables: 7
## $ title       &lt;chr&gt; &quot;The Blue Bird&quot;, &quot;Pollyanna&quot;, &quot;Peter Pan&quot;, &quot;A Kiss...
## $ year        &lt;dbl&gt; 1918, 1920, 1924, 1925, 1925, 1926, 1933, 1934, 19...
## $ actors      &lt;chr&gt; &quot;Tula Belle Robin Macdougall&quot;, &quot;Mary Pickford&quot;, &quot;B...
## $ directors   &lt;chr&gt; &quot;Maurice Tourneur&quot;, &quot;Paul Powell&quot;, &quot;Herbert Brenon...
## $ country     &lt;chr&gt; &quot;United States&quot;, &quot;United States&quot;, &quot;United States&quot;,...
## $ language    &lt;chr&gt; &quot;Silent (English intertitles)&quot;, &quot;Silent film Engli...
## $ description &lt;chr&gt; &quot;When poor old widow Berlingot asks Tyltyl and Myt...</code></pre>
<p>Nice! But how good our function performed?</p>
<p>Let’s have a look on the pourcentage of missing values by variable.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># movies &lt;- read.csv(&quot;movies.csv&quot;, stringsAsFactors = FALSE)</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="kw">round</span>(<span class="dv">100</span><span class="op">*</span><span class="kw">colMeans</span>(<span class="kw">is.na</span>(movies)), <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##       title        year      actors   directors     country    language 
##        0.67        2.92        8.52        2.25        5.05       12.77 
## description 
##       10.16</code></pre>
<p>And what about the NAs repartition into the dataset?</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">library</span>(Amelia)</span>
<span id="cb12-2"><a href="#cb12-2"></a></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="kw">missmap</span>(movies, <span class="dt">main =</span> <span class="kw">paste0</span>(<span class="st">&quot;Visualising missing data (n=&quot;</span>, <span class="kw">nrow</span>(movies),<span class="st">&quot;)&quot;</span>))</span></code></pre></div>
<p><img src="img/chart_childrensmovies_1.png" /></p>
<p>We will remove some missing values from our dataset. One hard choice is to take away all the NAs of the <code>description</code> variable, as we will lose 10% of our movies. However, we can think that a movie without a description of the plot probably isn’t that important or influental. And, above all, the accuracy of our predictive model will be greatly improved.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Removing some duplicated movies</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>movies &lt;-<span class="st"> </span>movies[<span class="op">!</span><span class="kw">duplicated</span>(movies[,<span class="kw">c</span>(<span class="st">&quot;title&quot;</span>, <span class="st">&quot;year&quot;</span>)]),]</span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="co"># Removing NAs titles</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>movies &lt;-<span class="st"> </span>movies[<span class="op">!</span><span class="kw">is.na</span>(movies<span class="op">$</span>title),]</span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="co"># Removing NAs description</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>movies &lt;-<span class="st"> </span>movies[<span class="op">!</span><span class="kw">is.na</span>(movies<span class="op">$</span>description),]</span>
<span id="cb13-7"><a href="#cb13-7"></a></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="kw">dim</span>(movies)</span></code></pre></div>
<pre><code>## [1] 1452    7</code></pre>
<p>We now have a dataset of 1452 children’s movies.</p>
<p>On last thing before moving on. The Wikipedia article warns us that it “<em>deals primarily with the United States and do not represent a worldwide view of the subject</em>”. Let’s check that.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>movies<span class="op">$</span>country <span class="op">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="st">  </span><span class="kw">str_detect</span>(<span class="st">&quot;United States|US&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="st">  </span><span class="kw">sum</span>(., <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 1115</code></pre>
<p>Yes, 77 % of the children’s movies are US-related.</p>
<h2 id="mimicking-gioras-code">Mimicking Giora’s Code</h2>
<p>Following Giora’s post, we have to manually tag a sample of our children’s movies dataset according to the gender of the central character, where <code>0</code> is “Female”, <code>1</code> is “Male”, and <code>2</code> is “Other” (meaning it is hard to decide which gender is central). I did it for the first 140 movies, which represents 10% of the <code>movies</code> dataset<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>classFirst140 &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, </span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, </span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, </span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, </span>
<span id="cb17-6"><a href="#cb17-6"></a>  <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, </span>
<span id="cb17-7"><a href="#cb17-7"></a>  <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, </span>
<span id="cb17-8"><a href="#cb17-8"></a>  <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span></span>
<span id="cb17-9"><a href="#cb17-9"></a>)</span>
<span id="cb17-10"><a href="#cb17-10"></a>movies<span class="op">$</span>class &lt;-<span class="st"> </span><span class="kw">c</span>(classFirst140, <span class="kw">rep</span>(<span class="ot">NA</span>, <span class="kw">nrow</span>(movies) <span class="op">-</span><span class="st"> </span><span class="dv">140</span>))</span>
<span id="cb17-11"><a href="#cb17-11"></a><span class="kw">write.csv</span>(movies, <span class="st">&quot;movies.csv&quot;</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</span>
<span id="cb17-12"><a href="#cb17-12"></a></span>
<span id="cb17-13"><a href="#cb17-13"></a><span class="kw">paste</span>(<span class="st">&quot;Year of the last movie coded:&quot;</span>, movies<span class="op">$</span>year[<span class="dv">140</span>])</span></code></pre></div>
<pre><code>## [1] &quot;Year of the last movie coded: 1966&quot;</code></pre>
<p>Just as Giora, coding the <em>first</em> movies is problematic. Since it’s not a random sample, its representativity of the other movies is questionable. Is it even more the case in our study, as all the movies are old. The game here is code reproducibility. We will try to “compensate” that afterwards.</p>
<p>What is the gender distribution of the first 140 movies according to my judgement?</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>movies <span class="op">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="st">  </span><span class="kw">select</span>(class) <span class="op">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="st">  </span><span class="kw">count</span>(class) <span class="op">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total =</span> <span class="kw">sum</span>(n), <span class="dt">p =</span> n <span class="op">/</span><span class="st"> </span>total)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   class     n total          p
##   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;      &lt;dbl&gt;
## 1     0    35  1452 0.02410468
## 2     1    89  1452 0.06129477
## 3     2    16  1452 0.01101928
## 4    NA  1312  1452 0.90358127</code></pre>
<p>As the “Other” class belongs both to the “Male” and “Female” classes, the ratio is <code>(89 + 16)/(35 + 16) = 2.06</code>. In other words, for every children’s movie with a female central character, two are centered around a male character.</p>
<h2 id="preparing-the-machine">Preparing the Machine</h2>
<p>Since we want to make gender prediction, knowing if the first name of a character is “male” or “female” is informative. Giora scraped 1000 male and 1000 female names from the <a href="https://www.babble.com/pregnancy/1000-most-popular-boy-names/">Babble</a> website.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>boys &lt;-<span class="st"> &quot;https://www.babble.com/pregnancy/1000-most-popular-boy-names/&quot;</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>boysNames &lt;-<span class="st"> </span><span class="kw">read_html</span>(boys) <span class="op">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;li&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="st">  </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="st">  </span>.[<span class="dv">22</span><span class="op">:</span><span class="dv">1021</span>]</span>
<span id="cb21-6"><a href="#cb21-6"></a></span>
<span id="cb21-7"><a href="#cb21-7"></a>girls &lt;-<span class="st"> &quot;https://www.babble.com/pregnancy/1000-most-popular-girl-names/&quot;</span></span>
<span id="cb21-8"><a href="#cb21-8"></a>girlsNames &lt;-<span class="st"> </span><span class="kw">read_html</span>(girls) <span class="op">%&gt;%</span></span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;li&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="st">  </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span></span>
<span id="cb21-11"><a href="#cb21-11"></a><span class="st">  </span>.[<span class="dv">22</span><span class="op">:</span><span class="dv">1021</span>]</span>
<span id="cb21-12"><a href="#cb21-12"></a></span>
<span id="cb21-13"><a href="#cb21-13"></a>boysGirlsNames &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">cbind</span>(boysNames, girlsNames))</span></code></pre></div>
<p>Giora used boy and girl names in order to know if the author and the title contains a “Male” or “Female” name. For our case study, it can be done for the directors and actors names. Potential predicators for the “Other” class are features like a title containing the word “the” or a high level of plural words.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">library</span>(magrittr)</span>
<span id="cb22-2"><a href="#cb22-2"></a></span>
<span id="cb22-3"><a href="#cb22-3"></a>getNBoysGirlsNames &lt;-<span class="st"> </span><span class="cf">function</span>(s, boys, firstToken) {</span>
<span id="cb22-4"><a href="#cb22-4"></a>  namesPattern &lt;-<span class="st"> </span><span class="cf">if</span> (boys) {</span>
<span id="cb22-5"><a href="#cb22-5"></a>    <span class="kw">str_c</span>(boysGirlsNames<span class="op">$</span>boysNames, <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">b|</span><span class="ch">\\</span><span class="st">b&quot;</span>)</span>
<span id="cb22-6"><a href="#cb22-6"></a>  } <span class="cf">else</span> {</span>
<span id="cb22-7"><a href="#cb22-7"></a>    <span class="kw">str_c</span>(boysGirlsNames<span class="op">$</span>girlsNames, <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">b|</span><span class="ch">\\</span><span class="st">b&quot;</span>)</span>
<span id="cb22-8"><a href="#cb22-8"></a>  }</span>
<span id="cb22-9"><a href="#cb22-9"></a>  s2 &lt;-<span class="st"> </span><span class="cf">if</span> (firstToken) {</span>
<span id="cb22-10"><a href="#cb22-10"></a>    <span class="kw">str_split</span>(s, <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>]</span>
<span id="cb22-11"><a href="#cb22-11"></a>  } <span class="cf">else</span> {</span>
<span id="cb22-12"><a href="#cb22-12"></a>    s</span>
<span id="cb22-13"><a href="#cb22-13"></a>  }</span>
<span id="cb22-14"><a href="#cb22-14"></a>  <span class="kw">str_count</span>(s2, namesPattern)</span>
<span id="cb22-15"><a href="#cb22-15"></a>}</span>
<span id="cb22-16"><a href="#cb22-16"></a></span>
<span id="cb22-17"><a href="#cb22-17"></a>getNPluralWords &lt;-<span class="st"> </span><span class="cf">function</span>(s) {</span>
<span id="cb22-18"><a href="#cb22-18"></a>  <span class="kw">sum</span>(<span class="kw">str_detect</span>(<span class="kw">str_split</span>(s, <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]], <span class="st">&quot;[A-Za-z]+s$&quot;</span>))</span>
<span id="cb22-19"><a href="#cb22-19"></a>}</span>
<span id="cb22-20"><a href="#cb22-20"></a></span>
<span id="cb22-21"><a href="#cb22-21"></a>isStringStartsWithThe &lt;-<span class="st"> </span><span class="cf">function</span>(s) {</span>
<span id="cb22-22"><a href="#cb22-22"></a>  <span class="kw">as.numeric</span>(<span class="kw">startsWith</span>(s, <span class="st">&quot;The&quot;</span>))</span>
<span id="cb22-23"><a href="#cb22-23"></a>}</span>
<span id="cb22-24"><a href="#cb22-24"></a></span>
<span id="cb22-25"><a href="#cb22-25"></a>movies &lt;-<span class="st"> </span>movies <span class="op">%&gt;%</span></span>
<span id="cb22-26"><a href="#cb22-26"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">i_nBoysInBookDesc =</span> <span class="kw">map_dbl</span>(description, getNBoysGirlsNames, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>),</span>
<span id="cb22-27"><a href="#cb22-27"></a>         <span class="dt">i_nGirlsInBookDesc =</span> <span class="kw">map_dbl</span>(description, getNBoysGirlsNames, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>),</span>
<span id="cb22-28"><a href="#cb22-28"></a>         <span class="dt">i_nBoysInBookTitle =</span> <span class="kw">map_dbl</span>(title, getNBoysGirlsNames, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>),</span>
<span id="cb22-29"><a href="#cb22-29"></a>         <span class="dt">i_nGirlsInBookTitle =</span> <span class="kw">map_dbl</span>(title, getNBoysGirlsNames, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>),</span>
<span id="cb22-30"><a href="#cb22-30"></a>         <span class="dt">i_gapBoysGirlsBookDesc =</span> i_nBoysInBookDesc <span class="op">-</span><span class="st"> </span>i_nGirlsInBookDesc,</span>
<span id="cb22-31"><a href="#cb22-31"></a>         <span class="dt">i_gapBoysGirlsTitle =</span> i_nBoysInBookTitle <span class="op">-</span><span class="st"> </span>i_nGirlsInBookTitle,</span>
<span id="cb22-32"><a href="#cb22-32"></a>         <span class="dt">i_lengthTitle =</span> <span class="kw">map_dbl</span>(title, nchar),</span>
<span id="cb22-33"><a href="#cb22-33"></a>         <span class="dt">i_lengthBookDesc =</span> <span class="kw">map_dbl</span>(description, nchar),</span>
<span id="cb22-34"><a href="#cb22-34"></a>         <span class="dt">i_nPluralWordsInBookTitle =</span> <span class="kw">map_dbl</span>(title, getNPluralWords),</span>
<span id="cb22-35"><a href="#cb22-35"></a>         <span class="dt">i_titleStartsWithThe =</span> <span class="kw">map_dbl</span>(title, isStringStartsWithThe))</span></code></pre></div>
<p>For our case study, other predictors can be built. Since the central character is often listed first in the Wikipedia articles, let’s see if the first name is a boy or a girl name. We can also sum up the gender-related pronoms of the movie description in variables.</p>
<ul>
<li>Is the first name of the first actor listed “male” or “female”?</li>
<li>Is the first name of the first director listed “male” or “female”?</li>
<li>How many “he” and “him” in the description?</li>
<li>How many “she” and “her” in the description?</li>
<li>How many “they” and “them” in the description?</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>movies<span class="op">$</span>actorFirstName &lt;-<span class="st"> </span>movies<span class="op">$</span>actors <span class="op">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="st">  </span><span class="kw">sub</span>(<span class="st">&quot; .*&quot;</span>, <span class="st">&quot;&quot;</span>,.)</span>
<span id="cb23-3"><a href="#cb23-3"></a></span>
<span id="cb23-4"><a href="#cb23-4"></a>movies<span class="op">$</span>directorFirstName &lt;-<span class="st"> </span>movies<span class="op">$</span>directors <span class="op">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="st">  </span><span class="kw">sub</span>(<span class="st">&quot; .*&quot;</span>, <span class="st">&quot;&quot;</span>,.)</span>
<span id="cb23-6"><a href="#cb23-6"></a></span>
<span id="cb23-7"><a href="#cb23-7"></a>getNHeHim &lt;-<span class="st"> </span><span class="cf">function</span>(s) {</span>
<span id="cb23-8"><a href="#cb23-8"></a>  nHe &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">str_detect</span>(<span class="kw">str_split</span>(s, <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]], <span class="st">&quot;</span><span class="ch">\\</span><span class="st">bhe</span><span class="ch">\\</span><span class="st">b&quot;</span>))</span>
<span id="cb23-9"><a href="#cb23-9"></a>  nHim &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">str_detect</span>(<span class="kw">str_split</span>(s, <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]], <span class="st">&quot;</span><span class="ch">\\</span><span class="st">bhim</span><span class="ch">\\</span><span class="st">b&quot;</span>))</span>
<span id="cb23-10"><a href="#cb23-10"></a>  nHeHim &lt;-<span class="st"> </span>nHe <span class="op">+</span><span class="st"> </span>nHim</span>
<span id="cb23-11"><a href="#cb23-11"></a>}</span>
<span id="cb23-12"><a href="#cb23-12"></a></span>
<span id="cb23-13"><a href="#cb23-13"></a>getNSheHer &lt;-<span class="st"> </span><span class="cf">function</span>(s) {</span>
<span id="cb23-14"><a href="#cb23-14"></a>  nShe &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">str_detect</span>(<span class="kw">str_split</span>(s, <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]], <span class="st">&quot;</span><span class="ch">\\</span><span class="st">bshe</span><span class="ch">\\</span><span class="st">b&quot;</span>))</span>
<span id="cb23-15"><a href="#cb23-15"></a>  nHer &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">str_detect</span>(<span class="kw">str_split</span>(s, <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]], <span class="st">&quot;</span><span class="ch">\\</span><span class="st">bher</span><span class="ch">\\</span><span class="st">b&quot;</span>))</span>
<span id="cb23-16"><a href="#cb23-16"></a>  nSheHer &lt;-<span class="st"> </span>nShe <span class="op">+</span><span class="st"> </span>nHer</span>
<span id="cb23-17"><a href="#cb23-17"></a>}</span>
<span id="cb23-18"><a href="#cb23-18"></a></span>
<span id="cb23-19"><a href="#cb23-19"></a>getNTheyTheir &lt;-<span class="st"> </span><span class="cf">function</span>(s) {</span>
<span id="cb23-20"><a href="#cb23-20"></a>  nThey &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">str_detect</span>(<span class="kw">str_split</span>(s, <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]], <span class="st">&quot;</span><span class="ch">\\</span><span class="st">bthey</span><span class="ch">\\</span><span class="st">b&quot;</span>))</span>
<span id="cb23-21"><a href="#cb23-21"></a>  nTheir &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">str_detect</span>(<span class="kw">str_split</span>(s, <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]], <span class="st">&quot;</span><span class="ch">\\</span><span class="st">btheir</span><span class="ch">\\</span><span class="st">b&quot;</span>))</span>
<span id="cb23-22"><a href="#cb23-22"></a>  nTheyTheir &lt;-<span class="st"> </span>nThey <span class="op">+</span><span class="st"> </span>nTheir</span>
<span id="cb23-23"><a href="#cb23-23"></a>}</span>
<span id="cb23-24"><a href="#cb23-24"></a></span>
<span id="cb23-25"><a href="#cb23-25"></a>movies &lt;-<span class="st"> </span>movies <span class="op">%&gt;%</span></span>
<span id="cb23-26"><a href="#cb23-26"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">i_BoyActorFirstName =</span> <span class="kw">map_dbl</span>(actors, getNBoysGirlsNames, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>),</span>
<span id="cb23-27"><a href="#cb23-27"></a>         <span class="dt">i_GirlActorFirstName =</span> <span class="kw">map_dbl</span>(actors, getNBoysGirlsNames, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>),</span>
<span id="cb23-28"><a href="#cb23-28"></a>         <span class="dt">i_BoyDirectorFirstName =</span> <span class="kw">map_dbl</span>(directors, getNBoysGirlsNames, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>),</span>
<span id="cb23-29"><a href="#cb23-29"></a>         <span class="dt">i_GirlDirectorFirstName =</span> <span class="kw">map_dbl</span>(directors, getNBoysGirlsNames, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>),</span>
<span id="cb23-30"><a href="#cb23-30"></a>         <span class="dt">i_NHeHis =</span> <span class="kw">map_dbl</span>(description, getNHeHim),</span>
<span id="cb23-31"><a href="#cb23-31"></a>         <span class="dt">i_NSheHer =</span> <span class="kw">map_dbl</span>(description, getNSheHer),</span>
<span id="cb23-32"><a href="#cb23-32"></a>         <span class="dt">i_NTheyTheir =</span> <span class="kw">map_dbl</span>(description, getNTheyTheir))</span>
<span id="cb23-33"><a href="#cb23-33"></a></span>
<span id="cb23-34"><a href="#cb23-34"></a>movies <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">nchar</span>(description) <span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span>)</span></code></pre></div>
<p>Like Giora, we can create a <code>type</code> variable in preparation of the machine learning stage, by splitting the dataset in three categories (i.e. “train”, “test”, and “other”).</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>nTagged &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">table</span>(movies<span class="op">$</span>class))</span>
<span id="cb24-2"><a href="#cb24-2"></a>trainFrac &lt;-<span class="st"> </span><span class="fl">0.8</span> <span class="co"># Giora used 0.9</span></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="kw">set.seed</span>(<span class="dv">2</span>) <span class="co"># added for reproducibility </span></span>
<span id="cb24-4"><a href="#cb24-4"></a>trainSample &lt;-<span class="st"> </span><span class="kw">sample</span>(nTagged, <span class="kw">floor</span>(nTagged <span class="op">*</span><span class="st"> </span>trainFrac))</span>
<span id="cb24-5"><a href="#cb24-5"></a>movies <span class="op">%&lt;&gt;%</span></span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="kw">row_number</span>(),</span>
<span id="cb24-7"><a href="#cb24-7"></a>         <span class="dt">type =</span> <span class="kw">ifelse</span>(<span class="kw">row_number</span>() <span class="op">%in%</span><span class="st"> </span>trainSample, <span class="st">&quot;train&quot;</span>,</span>
<span id="cb24-8"><a href="#cb24-8"></a>                       <span class="kw">ifelse</span>(<span class="kw">row_number</span>() <span class="op">%in%</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span>nTagged, <span class="st">&quot;test&quot;</span>, <span class="st">&quot;other&quot;</span>)))</span></code></pre></div>
<p>Lastly, it is time to work on the <code>description</code> variable.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="kw">library</span>(tidytext)</span>
<span id="cb25-2"><a href="#cb25-2"></a></span>
<span id="cb25-3"><a href="#cb25-3"></a>dataForModeling &lt;-<span class="st"> </span>movies <span class="op">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="st">  </span><span class="kw">unnest_tokens</span>(word, description, <span class="dt">drop =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="st">  </span><span class="kw">count</span>(id, word, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="st">  </span><span class="co">#don&#39;t anti_join stop_words because &#39;her&#39; and &#39;him&#39; are there!</span></span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="st">  </span><span class="kw">cast_dtm</span>(id, word, n, <span class="dt">weighting =</span> tm<span class="op">::</span>weightTf) <span class="op">%&gt;%</span></span>
<span id="cb25-8"><a href="#cb25-8"></a><span class="st">  </span>tm<span class="op">::</span><span class="kw">removeSparseTerms</span>(<span class="fl">0.997</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># from 0.999</span></span>
<span id="cb25-9"><a href="#cb25-9"></a><span class="st">  </span><span class="kw">as.matrix</span>() <span class="op">%&gt;%</span></span>
<span id="cb25-10"><a href="#cb25-10"></a><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb25-11"><a href="#cb25-11"></a><span class="st">  </span><span class="kw">rownames_to_column</span>(<span class="st">&quot;id&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb25-12"><a href="#cb25-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="kw">as.numeric</span>(id)) <span class="op">%&gt;%</span></span>
<span id="cb25-13"><a href="#cb25-13"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">class1 =</span> class, <span class="dt">type1 =</span> type) <span class="op">%&gt;%</span></span>
<span id="cb25-14"><a href="#cb25-14"></a><span class="st">  </span><span class="kw">inner_join</span>(movies <span class="op">%&gt;%</span></span>
<span id="cb25-15"><a href="#cb25-15"></a><span class="st">               </span><span class="kw">select</span>(id, <span class="kw">starts_with</span>(<span class="st">&quot;i_&quot;</span>), class, type), <span class="st">&quot;id&quot;</span>)</span>
<span id="cb25-16"><a href="#cb25-16"></a></span>
<span id="cb25-17"><a href="#cb25-17"></a>nonWordColIdx &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">which</span>(<span class="kw">str_detect</span>(<span class="kw">colnames</span>(dataForModeling), <span class="st">&quot;i_&quot;</span>)),</span>
<span id="cb25-18"><a href="#cb25-18"></a>                   <span class="kw">ncol</span>(dataForModeling) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb25-19"><a href="#cb25-19"></a>                   <span class="kw">ncol</span>(dataForModeling))</span>
<span id="cb25-20"><a href="#cb25-20"></a>bkDescWords &lt;-<span class="st"> </span><span class="kw">colnames</span>(dataForModeling)[<span class="op">-</span>nonWordColIdx]</span>
<span id="cb25-21"><a href="#cb25-21"></a><span class="kw">colnames</span>(dataForModeling)[<span class="op">-</span>nonWordColIdx] &lt;-<span class="st"> </span><span class="kw">str_c</span>(<span class="st">&quot;word&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(bkDescWords))</span>
<span id="cb25-22"><a href="#cb25-22"></a></span>
<span id="cb25-23"><a href="#cb25-23"></a><span class="kw">dim</span>(dataForModeling)</span></code></pre></div>
<pre><code>## [1] 1437 3417</code></pre>
<p>As you saw, the <code>description</code> variable has been <a href="https://en.wikipedia.org/wiki/Lexical_analysis#Tokenization">tokenized</a> and transformed in a sparse <a href="https://en.wikipedia.org/wiki/Document-term_matrix">document-term Matrix</a> that keeps only the tokens appearing in at least 4 different movie descriptions<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p>
<p>Using the <code>type</code> column made earlier, let’s split the data into training and testing datasets.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>train &lt;-<span class="st"> </span>dataForModeling <span class="op">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="st">  </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;train&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>type)</span>
<span id="cb27-4"><a href="#cb27-4"></a></span>
<span id="cb27-5"><a href="#cb27-5"></a>test &lt;-<span class="st"> </span>dataForModeling <span class="op">%&gt;%</span></span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="st">  </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;test&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb27-7"><a href="#cb27-7"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>type)</span></code></pre></div>
<h2 id="machine-learning-with-xgboost">Machine Learning with {xgboost}</h2>
<p>Following Giora, we will use <a href="https://en.wikipedia.org/wiki/Gradient_boosting">Gradient-Boosted-Trees</a> to perform a multiclass logistic classification with {xgboost}. Then, we will see which features of the model are the most important.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw">library</span>(xgboost)</span>
<span id="cb28-2"><a href="#cb28-2"></a></span>
<span id="cb28-3"><a href="#cb28-3"></a>train_matrix &lt;-<span class="st"> </span><span class="kw">xgb.DMatrix</span>(<span class="dt">data =</span> <span class="kw">as.matrix</span>(train[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">ncol</span>(train))]), <span class="dt">label =</span> train<span class="op">$</span>class)</span>
<span id="cb28-4"><a href="#cb28-4"></a>test_matrix &lt;-<span class="st"> </span><span class="kw">xgb.DMatrix</span>(<span class="dt">data =</span> <span class="kw">as.matrix</span>(test[, <span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">ncol</span>(test))]), <span class="dt">label =</span> test<span class="op">$</span>class)</span>
<span id="cb28-5"><a href="#cb28-5"></a></span>
<span id="cb28-6"><a href="#cb28-6"></a>nClasses &lt;-<span class="st"> </span><span class="dv">3</span></span>
<span id="cb28-7"><a href="#cb28-7"></a>xgb_params &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;objective&quot;</span> =<span class="st"> &quot;multi:softprob&quot;</span>,</span>
<span id="cb28-8"><a href="#cb28-8"></a>                   <span class="st">&quot;eval_metric&quot;</span> =<span class="st"> &quot;mlogloss&quot;</span>,</span>
<span id="cb28-9"><a href="#cb28-9"></a>                   <span class="st">&quot;num_class&quot;</span> =<span class="st"> </span>nClasses)</span>
<span id="cb28-10"><a href="#cb28-10"></a>nround    &lt;-<span class="st"> </span><span class="dv">50</span></span>
<span id="cb28-11"><a href="#cb28-11"></a></span>
<span id="cb28-12"><a href="#cb28-12"></a>xgboostModel &lt;-<span class="st"> </span><span class="kw">xgb.train</span>(<span class="dt">params =</span> xgb_params, <span class="dt">data =</span> train_matrix, <span class="dt">nrounds =</span> nround)</span>
<span id="cb28-13"><a href="#cb28-13"></a></span>
<span id="cb28-14"><a href="#cb28-14"></a>names &lt;-<span class="st">  </span><span class="kw">colnames</span>(train[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">ncol</span>(train))])</span>
<span id="cb28-15"><a href="#cb28-15"></a>importance_matrix &lt;-<span class="st"> </span><span class="kw">xgb.importance</span>(<span class="dt">feature_names =</span> names, <span class="dt">model =</span> xgboostModel)</span>
<span id="cb28-16"><a href="#cb28-16"></a><span class="kw">head</span>(importance_matrix, <span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb28-17"><a href="#cb28-17"></a><span class="st">  </span><span class="kw">left_join</span>(<span class="kw">tibble</span>(<span class="dt">Feature =</span> <span class="kw">colnames</span>(dataForModeling)[<span class="op">-</span>nonWordColIdx], <span class="dt">word =</span> bkDescWords), <span class="st">&quot;Feature&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb28-18"><a href="#cb28-18"></a><span class="st">  </span><span class="kw">select</span>(word, Feature, Gain)</span></code></pre></div>
<pre><code>##     word       Feature       Gain
## 1   &lt;NA&gt;     i_NSheHer 0.19262235
## 2    her         word4 0.12580363
## 3    his         word6 0.05849402
## 4     mc       word259 0.03820735
## 5   &lt;NA&gt;      i_NHeHis 0.03196201
## 6     in        word25 0.02862314
## 7   &lt;NA&gt; i_lengthTitle 0.02562286
## 8    has       word149 0.02338283
## 9  queen       word172 0.02255995
## 10 mills      word2510 0.02245347</code></pre>
<p>Just as Giora’s case study, “her” and “his” are the most important splits used to build the XGBoost trees. It is now time to make a confusion matrix in order to estimate the performance of our model.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>test_pred &lt;-<span class="st"> </span><span class="kw">predict</span>(xgboostModel, <span class="dt">newdata =</span> test_matrix)</span>
<span id="cb30-2"><a href="#cb30-2"></a></span>
<span id="cb30-3"><a href="#cb30-3"></a>labelNumToChar &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</span>
<span id="cb30-4"><a href="#cb30-4"></a>  <span class="kw">ifelse</span>(n <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;Female&quot;</span>,</span>
<span id="cb30-5"><a href="#cb30-5"></a>         <span class="kw">ifelse</span>(n <span class="op">==</span><span class="st"> </span><span class="dv">2</span>, <span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Other&quot;</span>))</span>
<span id="cb30-6"><a href="#cb30-6"></a>}</span>
<span id="cb30-7"><a href="#cb30-7"></a></span>
<span id="cb30-8"><a href="#cb30-8"></a>test_prediction &lt;-<span class="st"> </span><span class="kw">matrix</span>(test_pred, <span class="dt">nrow =</span> nClasses,</span>
<span id="cb30-9"><a href="#cb30-9"></a>                          <span class="dt">ncol=</span><span class="kw">length</span>(test_pred)<span class="op">/</span>nClasses) <span class="op">%&gt;%</span></span>
<span id="cb30-10"><a href="#cb30-10"></a><span class="st">  </span><span class="kw">t</span>() <span class="op">%&gt;%</span></span>
<span id="cb30-11"><a href="#cb30-11"></a><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb30-12"><a href="#cb30-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">labelN =</span> test<span class="op">$</span>class <span class="op">+</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb30-13"><a href="#cb30-13"></a>         <span class="dt">predN =</span> <span class="kw">max.col</span>(., <span class="st">&quot;last&quot;</span>),</span>
<span id="cb30-14"><a href="#cb30-14"></a>         <span class="dt">maxProb =</span> <span class="kw">pmap_dbl</span>(<span class="kw">list</span>(X1, X2, X3), max),</span>
<span id="cb30-15"><a href="#cb30-15"></a>         <span class="dt">predN_strict =</span> <span class="kw">ifelse</span>(maxProb <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.75</span>, predN, <span class="dv">3</span>),</span>
<span id="cb30-16"><a href="#cb30-16"></a>         <span class="dt">label =</span> <span class="kw">map_chr</span>(labelN, labelNumToChar),</span>
<span id="cb30-17"><a href="#cb30-17"></a>         <span class="dt">pred =</span> <span class="kw">map_chr</span>(predN, labelNumToChar))</span>
<span id="cb30-18"><a href="#cb30-18"></a></span>
<span id="cb30-19"><a href="#cb30-19"></a>caret<span class="op">::</span><span class="kw">confusionMatrix</span>(test_prediction<span class="op">$</span>pred,</span>
<span id="cb30-20"><a href="#cb30-20"></a>                       test_prediction<span class="op">$</span>label)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction Female Male Other
##     Female      4    1     1
##     Male        0   16     5
##     Other       1    0     0
## 
## Overall Statistics
##                                           
##                Accuracy : 0.7143          
##                  95% CI : (0.5133, 0.8678)
##     No Information Rate : 0.6071          
##     P-Value [Acc &gt; NIR] : 0.1670          
##                                           
##                   Kappa : 0.4271          
##  Mcnemar&#39;s Test P-Value : 0.1116          
## 
## Statistics by Class:
## 
##                      Class: Female Class: Male Class: Other
## Sensitivity                 0.8000      0.9412      0.00000
## Specificity                 0.9130      0.5455      0.95455
## Pos Pred Value              0.6667      0.7619      0.00000
## Neg Pred Value              0.9545      0.8571      0.77778
## Prevalence                  0.1786      0.6071      0.21429
## Detection Rate              0.1429      0.5714      0.00000
## Detection Prevalence        0.2143      0.7500      0.03571
## Balanced Accuracy           0.8565      0.7433      0.47727</code></pre>
<p>The classification model has a accuracy of 71%. Althought our model is quite good at classifying the “Female” and “Male” classes, it fails to predict the “Other” class. How can it be explained?</p>
<p>One can think that the first 140 movies we manually coded where strongly “genderized”, i.e. the movies up until 1960 were centered mainly on a single character. Indeed, we only tagged 16 movies as “Other”. The sample could be too small for the machine to “learn” how to recognize it.</p>
<p>Another explanation could be that when a man and a woman are both the main characters of a movie, the man often takes more space in the movie and therefore its description. Indeed, <a href="https://pudding.cool/2017/03/film-dialogue/">an recent study</a> showed that men speak generally more than women in the movies, especially in the old ones.</p>
<p>We learned from the confusion matrix that most of the “Other” tend to be “Male”. A quick look at the description of the movies tagged as “Other” confirms that men are more present in the text. So let’s simply recode all the <code>2</code> as <code>1</code> and rerun all the script that led us to this stage of the analysis in order to try a binary logistic classification.</p>
<details>
<p><summary><span class="btn btn--inverse">Show code</span></summary></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>movies_<span class="dv">2</span> &lt;-<span class="st"> </span>movies</span>
<span id="cb32-2"><a href="#cb32-2"></a></span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="co"># Recoding all 2 to 1</span></span>
<span id="cb32-4"><a href="#cb32-4"></a>movies_<span class="dv">2</span><span class="op">$</span>class[movies_<span class="dv">2</span><span class="op">$</span>class <span class="op">==</span><span class="st"> </span><span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="co"># then running the exact same code with the new &quot;movies_2&quot; dataset</span></span>
<span id="cb32-6"><a href="#cb32-6"></a><span class="kw">set.seed</span>(<span class="dv">22</span>) <span class="co"># changing random sample (previously set.seed(2))</span></span>
<span id="cb32-7"><a href="#cb32-7"></a></span>
<span id="cb32-8"><a href="#cb32-8"></a>movies_<span class="dv">2</span><span class="op">$</span>actorFirstName &lt;-<span class="st"> </span>movies_<span class="dv">2</span><span class="op">$</span>actors <span class="op">%&gt;%</span></span>
<span id="cb32-9"><a href="#cb32-9"></a><span class="st">  </span><span class="kw">sub</span>(<span class="st">&quot; .*&quot;</span>, <span class="st">&quot;&quot;</span>,.)</span>
<span id="cb32-10"><a href="#cb32-10"></a></span>
<span id="cb32-11"><a href="#cb32-11"></a>movies_<span class="dv">2</span><span class="op">$</span>directorFirstName &lt;-<span class="st"> </span>movies_<span class="dv">2</span><span class="op">$</span>directors <span class="op">%&gt;%</span></span>
<span id="cb32-12"><a href="#cb32-12"></a><span class="st">  </span><span class="kw">sub</span>(<span class="st">&quot; .*&quot;</span>, <span class="st">&quot;&quot;</span>,.)</span>
<span id="cb32-13"><a href="#cb32-13"></a></span>
<span id="cb32-14"><a href="#cb32-14"></a>movies_<span class="dv">2</span> &lt;-<span class="st"> </span>movies_<span class="dv">2</span> <span class="op">%&gt;%</span></span>
<span id="cb32-15"><a href="#cb32-15"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">i_nBoysInBookDesc =</span> <span class="kw">map_dbl</span>(description, getNBoysGirlsNames, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>),</span>
<span id="cb32-16"><a href="#cb32-16"></a>         <span class="dt">i_nGirlsInBookDesc =</span> <span class="kw">map_dbl</span>(description, getNBoysGirlsNames, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>),</span>
<span id="cb32-17"><a href="#cb32-17"></a>         <span class="dt">i_nBoysInBookTitle =</span> <span class="kw">map_dbl</span>(title, getNBoysGirlsNames, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>),</span>
<span id="cb32-18"><a href="#cb32-18"></a>         <span class="dt">i_nGirlsInBookTitle =</span> <span class="kw">map_dbl</span>(title, getNBoysGirlsNames, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>),</span>
<span id="cb32-19"><a href="#cb32-19"></a>         <span class="dt">i_gapBoysGirlsBookDesc =</span> i_nBoysInBookDesc <span class="op">-</span><span class="st"> </span>i_nGirlsInBookDesc,</span>
<span id="cb32-20"><a href="#cb32-20"></a>         <span class="dt">i_gapBoysGirlsTitle =</span> i_nBoysInBookTitle <span class="op">-</span><span class="st"> </span>i_nGirlsInBookTitle,</span>
<span id="cb32-21"><a href="#cb32-21"></a>         <span class="dt">i_lengthTitle =</span> <span class="kw">map_dbl</span>(title, nchar),</span>
<span id="cb32-22"><a href="#cb32-22"></a>         <span class="dt">i_lengthBookDesc =</span> <span class="kw">map_dbl</span>(description, nchar),</span>
<span id="cb32-23"><a href="#cb32-23"></a>         <span class="dt">i_nPluralWordsInBookTitle =</span> <span class="kw">map_dbl</span>(title, getNPluralWords),</span>
<span id="cb32-24"><a href="#cb32-24"></a>         <span class="dt">i_titleStartsWithThe =</span> <span class="kw">map_dbl</span>(title, isStringStartsWithThe))</span>
<span id="cb32-25"><a href="#cb32-25"></a></span>
<span id="cb32-26"><a href="#cb32-26"></a>movies_<span class="dv">2</span> <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">nchar</span>(description) <span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span>)</span>
<span id="cb32-27"><a href="#cb32-27"></a></span>
<span id="cb32-28"><a href="#cb32-28"></a>nTagged &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">table</span>(movies_<span class="dv">2</span><span class="op">$</span>class))</span>
<span id="cb32-29"><a href="#cb32-29"></a>trainFrac &lt;-<span class="st"> </span><span class="fl">0.8</span> <span class="co"># Giora used 0.9</span></span>
<span id="cb32-30"><a href="#cb32-30"></a><span class="kw">set.seed</span>(<span class="dv">2</span>) <span class="co"># added for reproducibility </span></span>
<span id="cb32-31"><a href="#cb32-31"></a>trainSample &lt;-<span class="st"> </span><span class="kw">sample</span>(nTagged, <span class="kw">floor</span>(nTagged <span class="op">*</span><span class="st"> </span>trainFrac))</span>
<span id="cb32-32"><a href="#cb32-32"></a>movies_<span class="dv">2</span> <span class="op">%&lt;&gt;%</span></span>
<span id="cb32-33"><a href="#cb32-33"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="kw">row_number</span>(),</span>
<span id="cb32-34"><a href="#cb32-34"></a>         <span class="dt">type =</span> <span class="kw">ifelse</span>(<span class="kw">row_number</span>() <span class="op">%in%</span><span class="st"> </span>trainSample, <span class="st">&quot;train&quot;</span>,</span>
<span id="cb32-35"><a href="#cb32-35"></a>                       <span class="kw">ifelse</span>(<span class="kw">row_number</span>() <span class="op">%in%</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span>nTagged, <span class="st">&quot;test&quot;</span>, <span class="st">&quot;other&quot;</span>)))</span>
<span id="cb32-36"><a href="#cb32-36"></a></span>
<span id="cb32-37"><a href="#cb32-37"></a><span class="kw">library</span>(tidytext)</span>
<span id="cb32-38"><a href="#cb32-38"></a></span>
<span id="cb32-39"><a href="#cb32-39"></a>dataForModeling_<span class="dv">2</span> &lt;-<span class="st"> </span>movies_<span class="dv">2</span> <span class="op">%&gt;%</span></span>
<span id="cb32-40"><a href="#cb32-40"></a><span class="st">  </span><span class="kw">unnest_tokens</span>(word, description, <span class="dt">drop =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></span>
<span id="cb32-41"><a href="#cb32-41"></a><span class="st">  </span><span class="kw">count</span>(id, word, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb32-42"><a href="#cb32-42"></a><span class="st">  </span><span class="co">#don&#39;t anti_join stop_words because &#39;her&#39; and &#39;him&#39; are there!</span></span>
<span id="cb32-43"><a href="#cb32-43"></a><span class="st">  </span><span class="kw">cast_dtm</span>(id, word, n, <span class="dt">weighting =</span> tm<span class="op">::</span>weightTf) <span class="op">%&gt;%</span></span>
<span id="cb32-44"><a href="#cb32-44"></a><span class="st">  </span>tm<span class="op">::</span><span class="kw">removeSparseTerms</span>(<span class="fl">0.997</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># from 0.999</span></span>
<span id="cb32-45"><a href="#cb32-45"></a><span class="st">  </span><span class="kw">as.matrix</span>() <span class="op">%&gt;%</span></span>
<span id="cb32-46"><a href="#cb32-46"></a><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb32-47"><a href="#cb32-47"></a><span class="st">  </span><span class="kw">rownames_to_column</span>(<span class="st">&quot;id&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb32-48"><a href="#cb32-48"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="kw">as.numeric</span>(id)) <span class="op">%&gt;%</span></span>
<span id="cb32-49"><a href="#cb32-49"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">class1 =</span> class, <span class="dt">type1 =</span> type) <span class="op">%&gt;%</span></span>
<span id="cb32-50"><a href="#cb32-50"></a><span class="st">  </span><span class="kw">inner_join</span>(movies_<span class="dv">2</span> <span class="op">%&gt;%</span></span>
<span id="cb32-51"><a href="#cb32-51"></a><span class="st">               </span><span class="kw">select</span>(id, <span class="kw">starts_with</span>(<span class="st">&quot;i_&quot;</span>), class, type), <span class="st">&quot;id&quot;</span>)</span>
<span id="cb32-52"><a href="#cb32-52"></a></span>
<span id="cb32-53"><a href="#cb32-53"></a>nonWordColIdx_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">which</span>(<span class="kw">str_detect</span>(<span class="kw">colnames</span>(dataForModeling_<span class="dv">2</span>), <span class="st">&quot;i_&quot;</span>)),</span>
<span id="cb32-54"><a href="#cb32-54"></a>                   <span class="kw">ncol</span>(dataForModeling_<span class="dv">2</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb32-55"><a href="#cb32-55"></a>                   <span class="kw">ncol</span>(dataForModeling_<span class="dv">2</span>))</span>
<span id="cb32-56"><a href="#cb32-56"></a>bkDescWords &lt;-<span class="st"> </span><span class="kw">colnames</span>(dataForModeling_<span class="dv">2</span>)[<span class="op">-</span>nonWordColIdx_<span class="dv">2</span>]</span>
<span id="cb32-57"><a href="#cb32-57"></a><span class="kw">colnames</span>(dataForModeling_<span class="dv">2</span>)[<span class="op">-</span>nonWordColIdx_<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">str_c</span>(<span class="st">&quot;word&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(bkDescWords))</span>
<span id="cb32-58"><a href="#cb32-58"></a></span>
<span id="cb32-59"><a href="#cb32-59"></a><span class="kw">dim</span>(dataForModeling_<span class="dv">2</span>)</span>
<span id="cb32-60"><a href="#cb32-60"></a></span>
<span id="cb32-61"><a href="#cb32-61"></a>train_<span class="dv">2</span> &lt;-<span class="st"> </span>dataForModeling_<span class="dv">2</span> <span class="op">%&gt;%</span></span>
<span id="cb32-62"><a href="#cb32-62"></a><span class="st">  </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;train&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb32-63"><a href="#cb32-63"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>type)</span>
<span id="cb32-64"><a href="#cb32-64"></a></span>
<span id="cb32-65"><a href="#cb32-65"></a>test_<span class="dv">2</span> &lt;-<span class="st"> </span>dataForModeling_<span class="dv">2</span> <span class="op">%&gt;%</span></span>
<span id="cb32-66"><a href="#cb32-66"></a><span class="st">  </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;test&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb32-67"><a href="#cb32-67"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>type)</span>
<span id="cb32-68"><a href="#cb32-68"></a></span>
<span id="cb32-69"><a href="#cb32-69"></a><span class="kw">library</span>(xgboost)</span>
<span id="cb32-70"><a href="#cb32-70"></a></span>
<span id="cb32-71"><a href="#cb32-71"></a>train_matrix_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">xgb.DMatrix</span>(<span class="dt">data =</span> <span class="kw">as.matrix</span>(train_<span class="dv">2</span>[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">ncol</span>(train_<span class="dv">2</span>))]), <span class="dt">label =</span> train_<span class="dv">2</span><span class="op">$</span>class)</span>
<span id="cb32-72"><a href="#cb32-72"></a></span>
<span id="cb32-73"><a href="#cb32-73"></a>test_matrix_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">xgb.DMatrix</span>(<span class="dt">data =</span> <span class="kw">as.matrix</span>(test_<span class="dv">2</span>[, <span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">ncol</span>(test_<span class="dv">2</span>))]), <span class="dt">label =</span> test_<span class="dv">2</span><span class="op">$</span>class)</span>
<span id="cb32-74"><a href="#cb32-74"></a></span>
<span id="cb32-75"><a href="#cb32-75"></a>xgb_params_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;objective&quot;</span> =<span class="st"> &quot;binary:logistic&quot;</span>) <span class="co"># binary classification</span></span>
<span id="cb32-76"><a href="#cb32-76"></a>nround &lt;-<span class="st"> </span><span class="dv">50</span></span>
<span id="cb32-77"><a href="#cb32-77"></a></span>
<span id="cb32-78"><a href="#cb32-78"></a>xgboostModel_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">xgb.train</span>(<span class="dt">params =</span> xgb_params_<span class="dv">2</span>, <span class="dt">data =</span> train_matrix_<span class="dv">2</span>, <span class="dt">nrounds =</span> nround)</span>
<span id="cb32-79"><a href="#cb32-79"></a></span>
<span id="cb32-80"><a href="#cb32-80"></a>test_pred_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">predict</span>(xgboostModel_<span class="dv">2</span>, <span class="dt">newdata =</span> test_matrix_<span class="dv">2</span>)</span>
<span id="cb32-81"><a href="#cb32-81"></a></span>
<span id="cb32-82"><a href="#cb32-82"></a>names_<span class="dv">2</span> &lt;-<span class="st">  </span><span class="kw">colnames</span>(train_<span class="dv">2</span>[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">ncol</span>(train_<span class="dv">2</span>))])</span>
<span id="cb32-83"><a href="#cb32-83"></a>importance_matrix_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">xgb.importance</span>(<span class="dt">feature_names =</span> names_<span class="dv">2</span>, <span class="dt">model =</span> xgboostModel_<span class="dv">2</span>)</span>
<span id="cb32-84"><a href="#cb32-84"></a><span class="kw">head</span>(importance_matrix_<span class="dv">2</span>, <span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb32-85"><a href="#cb32-85"></a><span class="st">  </span><span class="kw">left_join</span>(<span class="kw">tibble</span>(<span class="dt">Feature =</span> <span class="kw">colnames</span>(dataForModeling_<span class="dv">2</span>)[<span class="op">-</span>nonWordColIdx], <span class="dt">word =</span> bkDescWords), <span class="st">&quot;Feature&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb32-86"><a href="#cb32-86"></a><span class="st">  </span><span class="kw">select</span>(word, Feature, Gain)</span></code></pre></div>
<pre><code>##      word              Feature       Gain
## 1    &lt;NA&gt;            i_NSheHer 0.43346371
## 2    &lt;NA&gt; i_GirlActorFirstName 0.13024149
## 3     his                word6 0.08187319
## 4    &lt;NA&gt;        i_lengthTitle 0.03491770
## 5  temple             word1018 0.03331005
## 6     war              word798 0.02801142
## 7    many             word1329 0.02762914
## 8    with               word57 0.02702849
## 9      at              word187 0.02599865
## 10    old              word144 0.02562534</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># Making a confusion matrix is much easier with a binary classification</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>pred_class_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">ifelse</span>(test_pred_<span class="dv">2</span> <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.75</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="co"># 0.75 as compensation of &quot;Male&quot; overrating</span></span>
<span id="cb34-3"><a href="#cb34-3"></a></span>
<span id="cb34-4"><a href="#cb34-4"></a>labelNumToChar_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</span>
<span id="cb34-5"><a href="#cb34-5"></a>  <span class="kw">ifelse</span>(n <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>)</span>
<span id="cb34-6"><a href="#cb34-6"></a>}</span>
<span id="cb34-7"><a href="#cb34-7"></a></span>
<span id="cb34-8"><a href="#cb34-8"></a>test_prediction_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">matrix</span>(test_<span class="dv">2</span><span class="op">$</span>class, <span class="dt">nrow =</span> <span class="dv">1</span>, </span>
<span id="cb34-9"><a href="#cb34-9"></a>                           <span class="dt">ncol =</span> <span class="kw">length</span>(test_<span class="dv">2</span><span class="op">$</span>class)) <span class="op">%&gt;%</span></span>
<span id="cb34-10"><a href="#cb34-10"></a><span class="st">  </span><span class="kw">t</span>() <span class="op">%&gt;%</span></span>
<span id="cb34-11"><a href="#cb34-11"></a><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb34-12"><a href="#cb34-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predN =</span> test_pred_<span class="dv">2</span>,</span>
<span id="cb34-13"><a href="#cb34-13"></a>         <span class="dt">label =</span> <span class="kw">map_chr</span>(test_<span class="dv">2</span><span class="op">$</span>class, labelNumToChar_<span class="dv">2</span>),</span>
<span id="cb34-14"><a href="#cb34-14"></a>         <span class="dt">label =</span> <span class="kw">factor</span>(label),</span>
<span id="cb34-15"><a href="#cb34-15"></a>         <span class="dt">pred =</span> <span class="kw">map_chr</span>(pred_class_<span class="dv">2</span>, labelNumToChar_<span class="dv">2</span>),</span>
<span id="cb34-16"><a href="#cb34-16"></a>         <span class="dt">pred =</span> <span class="kw">factor</span>(pred))</span>
<span id="cb34-17"><a href="#cb34-17"></a></span>
<span id="cb34-18"><a href="#cb34-18"></a>caret<span class="op">::</span><span class="kw">confusionMatrix</span>(test_prediction_<span class="dv">2</span><span class="op">$</span>pred,</span>
<span id="cb34-19"><a href="#cb34-19"></a>                       test_prediction_<span class="dv">2</span><span class="op">$</span>label)</span></code></pre></div>
</details>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction Female Male
##     Female      7    2
##     Male        3   16
##                                           
##                Accuracy : 0.8214          
##                  95% CI : (0.6311, 0.9394)
##     No Information Rate : 0.6429          
##     P-Value [Acc &gt; NIR] : 0.03326         
##                                           
##                   Kappa : 0.6023          
##  Mcnemar&#39;s Test P-Value : 1.00000         
##                                           
##             Sensitivity : 0.7000          
##             Specificity : 0.8889          
##          Pos Pred Value : 0.7778          
##          Neg Pred Value : 0.8421          
##              Prevalence : 0.3571          
##          Detection Rate : 0.2500          
##    Detection Prevalence : 0.3214          
##       Balanced Accuracy : 0.7944          
##                                           
##        &#39;Positive&#39; Class : Female          
## </code></pre>
<p>Our predictive model performed much better, with an accuracy of 82%. But it tends to classify the movies more as “Male” than as “Female”. This is a direct result of our recoding decision. We need to keep that in mind for later on. We also notice that the most important features used to build the decision trees are quite similar to the ones of the previous model.</p>
<h2 id="two-different-answers">Two different answers</h2>
<p>It’s finally time to visualize the distribution of the gender ratio over the years. We will use almost the same script for the two models and compare their predictions.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>train_matrix &lt;-<span class="st"> </span><span class="kw">xgb.DMatrix</span>(<span class="dt">data =</span> <span class="kw">as.matrix</span>(<span class="kw">rbind</span>(train, test)[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">ncol</span>(train))]),</span>
<span id="cb36-2"><a href="#cb36-2"></a>                            <span class="dt">label =</span> <span class="kw">c</span>(train<span class="op">$</span>class, test<span class="op">$</span>class))</span>
<span id="cb36-3"><a href="#cb36-3"></a>xgboostModelAll &lt;-<span class="st"> </span><span class="kw">xgb.train</span>(<span class="dt">params =</span> xgb_params,</span>
<span id="cb36-4"><a href="#cb36-4"></a>                             <span class="dt">data =</span> train_matrix,</span>
<span id="cb36-5"><a href="#cb36-5"></a>                             <span class="dt">nrounds =</span> nround)</span>
<span id="cb36-6"><a href="#cb36-6"></a></span>
<span id="cb36-7"><a href="#cb36-7"></a>unknown &lt;-<span class="st"> </span>dataForModeling <span class="op">%&gt;%</span></span>
<span id="cb36-8"><a href="#cb36-8"></a><span class="st">  </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;other&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb36-9"><a href="#cb36-9"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>type)</span>
<span id="cb36-10"><a href="#cb36-10"></a></span>
<span id="cb36-11"><a href="#cb36-11"></a>unknown_matrix &lt;-<span class="st"> </span><span class="kw">xgb.DMatrix</span>(<span class="dt">data =</span> <span class="kw">as.matrix</span>(unknown[, <span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">ncol</span>(unknown))]))</span>
<span id="cb36-12"><a href="#cb36-12"></a></span>
<span id="cb36-13"><a href="#cb36-13"></a>unknown_pred &lt;-<span class="st"> </span><span class="kw">predict</span>(xgboostModelAll, <span class="dt">newdata =</span> unknown_matrix)</span>
<span id="cb36-14"><a href="#cb36-14"></a></span>
<span id="cb36-15"><a href="#cb36-15"></a>unknown_prediction &lt;-<span class="st"> </span><span class="kw">matrix</span>(unknown_pred, <span class="dt">nrow =</span> nClasses,</span>
<span id="cb36-16"><a href="#cb36-16"></a>                             <span class="dt">ncol=</span><span class="kw">length</span>(unknown_pred)<span class="op">/</span>nClasses) <span class="op">%&gt;%</span></span>
<span id="cb36-17"><a href="#cb36-17"></a><span class="st">  </span><span class="kw">t</span>() <span class="op">%&gt;%</span></span>
<span id="cb36-18"><a href="#cb36-18"></a><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></span>
<span id="cb36-19"><a href="#cb36-19"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">predN =</span> <span class="kw">max.col</span>(., <span class="st">&quot;last&quot;</span>),</span>
<span id="cb36-20"><a href="#cb36-20"></a>         <span class="dt">maxProb =</span> <span class="kw">pmap_dbl</span>(<span class="kw">list</span>(X1, X2, X3), max),</span>
<span id="cb36-21"><a href="#cb36-21"></a>         <span class="dt">predN_strict =</span> <span class="kw">ifelse</span>(maxProb <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.75</span>, predN, <span class="dv">3</span>),</span>
<span id="cb36-22"><a href="#cb36-22"></a>         <span class="dt">pred =</span> <span class="kw">map_chr</span>(predN, labelNumToChar))</span>
<span id="cb36-23"><a href="#cb36-23"></a></span>
<span id="cb36-24"><a href="#cb36-24"></a>First139Labels &lt;-<span class="st"> </span>movies <span class="op">%&gt;%</span></span>
<span id="cb36-25"><a href="#cb36-25"></a><span class="st">  </span><span class="kw">filter</span>(type <span class="op">!=</span><span class="st"> &quot;other&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb36-26"><a href="#cb36-26"></a><span class="st">  </span><span class="kw">select</span>(class) <span class="op">%&gt;%</span></span>
<span id="cb36-27"><a href="#cb36-27"></a><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">label =</span> <span class="kw">map_chr</span>(class, labelNumToChar)) <span class="op">%&gt;%</span></span>
<span id="cb36-28"><a href="#cb36-28"></a><span class="st">  </span><span class="kw">unlist</span>()</span>
<span id="cb36-29"><a href="#cb36-29"></a></span>
<span id="cb36-30"><a href="#cb36-30"></a>movieClasses &lt;-<span class="st"> </span><span class="kw">c</span>(unknown_prediction<span class="op">$</span>pred, First139Labels)</span>
<span id="cb36-31"><a href="#cb36-31"></a><span class="kw">table</span>(movieClasses) <span class="co"># overall gender ratio</span></span></code></pre></div>
<pre><code>## movieClasses
## Female   Male  Other 
##    401    981     55</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>movies <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">class =</span> movieClasses)</span>
<span id="cb38-2"><a href="#cb38-2"></a></span>
<span id="cb38-3"><a href="#cb38-3"></a><span class="kw">library</span>(hrbrthemes)</span>
<span id="cb38-4"><a href="#cb38-4"></a>movies <span class="op">%&gt;%</span></span>
<span id="cb38-5"><a href="#cb38-5"></a><span class="st">  </span><span class="kw">group_by</span>(year, class) <span class="op">%&gt;%</span></span>
<span id="cb38-6"><a href="#cb38-6"></a><span class="st">  </span><span class="kw">count</span>(class) <span class="op">%&gt;%</span></span>
<span id="cb38-7"><a href="#cb38-7"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> n, <span class="dt">color =</span> class)) <span class="op">+</span></span>
<span id="cb38-8"><a href="#cb38-8"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb38-9"><a href="#cb38-9"></a><span class="st">  </span><span class="kw">scale_color_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Gender&quot;</span>) <span class="op">+</span></span>
<span id="cb38-10"><a href="#cb38-10"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;number of movies&quot;</span>,</span>
<span id="cb38-11"><a href="#cb38-11"></a>       <span class="dt">title =</span> <span class="st">&quot;Gender centrality in children&#39;s movies&quot;</span>,</span>
<span id="cb38-12"><a href="#cb38-12"></a>       <span class="dt">caption =</span> <span class="st">&quot;Model accuracy: 0.72 | Data source: Wikipedia&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb38-13"><a href="#cb38-13"></a><span class="st">  </span><span class="kw">theme_ipsum</span>() </span></code></pre></div>
<p><img src="img/chart_childrensmovies_2.png" /></p>
<p>Why is the number of “Female” and “Other” suddenly higher than “Male” since 2013? Are the children’s movies more feminists then they were a few years ago? Let’s see if this pattern also appears in our binary classification model.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>train_matrix_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">xgb.DMatrix</span>(<span class="dt">data =</span> <span class="kw">as.matrix</span>(<span class="kw">rbind</span>(train_<span class="dv">2</span>, test_<span class="dv">2</span>)[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">ncol</span>(train_<span class="dv">2</span>))]),</span>
<span id="cb39-2"><a href="#cb39-2"></a>                            <span class="dt">label =</span> <span class="kw">c</span>(train_<span class="dv">2</span><span class="op">$</span>class, test_<span class="dv">2</span><span class="op">$</span>class))</span>
<span id="cb39-3"><a href="#cb39-3"></a>xgboostModelAll_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">xgb.train</span>(<span class="dt">params =</span> xgb_params_<span class="dv">2</span>,</span>
<span id="cb39-4"><a href="#cb39-4"></a>                             <span class="dt">data =</span> train_matrix_<span class="dv">2</span>,</span>
<span id="cb39-5"><a href="#cb39-5"></a>                             <span class="dt">nrounds =</span> nround)</span>
<span id="cb39-6"><a href="#cb39-6"></a></span>
<span id="cb39-7"><a href="#cb39-7"></a>unknown_<span class="dv">2</span> &lt;-<span class="st"> </span>dataForModeling_<span class="dv">2</span> <span class="op">%&gt;%</span></span>
<span id="cb39-8"><a href="#cb39-8"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>type)</span>
<span id="cb39-9"><a href="#cb39-9"></a></span>
<span id="cb39-10"><a href="#cb39-10"></a>unknown_matrix_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">xgb.DMatrix</span>(<span class="dt">data =</span> <span class="kw">as.matrix</span>(unknown_<span class="dv">2</span>[, <span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">ncol</span>(unknown_<span class="dv">2</span>))]))</span>
<span id="cb39-11"><a href="#cb39-11"></a></span>
<span id="cb39-12"><a href="#cb39-12"></a>unknown_pred_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">predict</span>(xgboostModelAll_<span class="dv">2</span>, <span class="dt">newdata =</span> unknown_matrix_<span class="dv">2</span>)</span>
<span id="cb39-13"><a href="#cb39-13"></a></span>
<span id="cb39-14"><a href="#cb39-14"></a>movies_<span class="dv">2</span> <span class="op">%&lt;&gt;%</span><span class="st"> </span></span>
<span id="cb39-15"><a href="#cb39-15"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">class =</span> <span class="kw">ifelse</span>(unknown_pred_<span class="dv">2</span> <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.75</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb39-16"><a href="#cb39-16"></a>         <span class="dt">class_2 =</span> <span class="kw">map_chr</span>(class, labelNumToChar_<span class="dv">2</span>))</span>
<span id="cb39-17"><a href="#cb39-17"></a></span>
<span id="cb39-18"><a href="#cb39-18"></a>movies_<span class="dv">2</span> <span class="op">%&gt;%</span></span>
<span id="cb39-19"><a href="#cb39-19"></a><span class="st">  </span><span class="kw">group_by</span>(year, class_<span class="dv">2</span>) <span class="op">%&gt;%</span></span>
<span id="cb39-20"><a href="#cb39-20"></a><span class="st">  </span><span class="kw">count</span>(class_<span class="dv">2</span>) <span class="op">%&gt;%</span></span>
<span id="cb39-21"><a href="#cb39-21"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> n, <span class="dt">color =</span> class_<span class="dv">2</span>)) <span class="op">+</span></span>
<span id="cb39-22"><a href="#cb39-22"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb39-23"><a href="#cb39-23"></a><span class="st">  </span><span class="kw">scale_color_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Gender&quot;</span>) <span class="op">+</span></span>
<span id="cb39-24"><a href="#cb39-24"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;number of movies&quot;</span>,</span>
<span id="cb39-25"><a href="#cb39-25"></a>       <span class="dt">title =</span> <span class="st">&quot;Central Character Gender in Children&#39;s Movies&quot;</span>,</span>
<span id="cb39-26"><a href="#cb39-26"></a>       <span class="dt">caption =</span> <span class="st">&quot;Model accuracy: 0.82 | Data source: Wikipedia&quot;</span>) <span class="op">+</span></span>
<span id="cb39-27"><a href="#cb39-27"></a><span class="st">  </span><span class="kw">theme_ipsum</span>()</span></code></pre></div>
<p><img src="img/chart_childrensmovies_3.png" /></p>
<p>Apparently no. However, as said before, our second model overclassifies the “Male” category. The reality is probably in between the two models: there are more central female characters but still far away from gender equality<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
<h2 id="fin">FIN</h2>
<p>Predicting the gender of central characters in children’s movie isn’t an easy task, especially when using almost 100-years old movies. The predictions could have been different if I had chosen to code the last 140 movies of our dataset.</p>
<p>Anyway, this was without doubt the longer post I’ve published on my blog… and the first using machine learning! I’ve learned a lot and had so much fun.</p>
<p>Thank you Giora!</p>
<h4>
Thanks for reading!
</h4>
<ul>
<li>For updates of recent blog posts, follow me on <a href="https://twitter.com/FelixLuginbuhl">Twitter</a>.</li>
<li>For reproducing my data analysis, go on my <a href="https://github.com/lgnbhl/blogposts">Github repo</a> or my <a href="https://mybinder.org/v2/gh/lgnbhl/blogposts/master?urlpath=rstudio">RStudio server</a>.</li>
<li>Curious about what I can do for your organisation? Have a look my <a href="https://felixluginbuhl.com">services</a>.</li>
</ul>
<div class="sourceCode" id="cb40"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>Giora could have implemented that very easily, but chose not to because he wanted to respond to a specific question, as explained in his concluding remarks.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>In his post, Giora coded 200 movies (equivalent to 5.4% of this dataset).<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>Giora explains in more detail what his code does in <a href="http://giorasimchoni.com/2017/09/24/2017-09-24-where-my-girls-at/">his post</a>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p>To know for sure if the trend is reversing, we could simply code manually the <code>class</code> variable since 2013. If anyone has the motivation to do this task, I would be pleased to know your finding.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<div class="article-footer">
  <p class="social_footer">
    <span class="disqus-comments">
      <i class="fas fa-comments"></i>
      &nbsp;
      <span class="disqus-comment-count" data-disqus-identifier="posts/2017-12-11-movies/">Comment on this article</span>
    </span>
    <span class="article-sharing">
      Share: &nbsp;
      <a href="https://twitter.com/share?text=The%20Lack%20of%20Female%20Protagonists%20in%20Children%E2%80%99s%20Movies&amp;url=felixluginbuhl.com%2Fblog%2Fposts%2F2017-12-11-movies%2F">
        <i class="fab fa-twitter"></i>
      </a>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=felixluginbuhl.com%2Fblog%2Fposts%2F2017-12-11-movies%2F&amp;title=The%20Lack%20of%20Female%20Protagonists%20in%20Children%E2%80%99s%20Movies">
        <i class="fab fa-linkedin"></i>
      </a>
    </span>
  </p>
  <script id="dsq-count-scr" src="https://lgnbhl.disqus.com/count.js" async></script>
  <div id="disqus_thread" class="hidden"></div>
  <script>
var disqus_config = function () {
  this.page.url = 'felixluginbuhl.com/blog/posts/2017-12-11-movies/';
  this.page.identifier = 'posts/2017-12-11-movies/';
};
(function() {
  var d = document, s = d.createElement('script');
  s.src = 'https://lgnbhl.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
</script>
</div>
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<div class="distill-site-nav distill-site-footer">
  <p>
    <a href="https://felixluginbuhl.com/" rel="noreferrer noopener" class="col-4 mx-auto text-center">
      <img src="../../img/banner-logo-white.png" alt="FÃ©lix LuginbÃ¼hl | Data Analytics" width="170" style="opacity:0.4;filter:alpha(opacity=40);"/>
    </a>
  </p>
  <p>Copyright Â© 2020 FÃ©lix LuginbÃ¼hl. All rights reserved.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->


</body>

</html>
