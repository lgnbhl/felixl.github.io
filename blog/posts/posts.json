[
  {
    "path": "posts/2019-12-16-leaflet-map/",
    "title": "Most Recurring Word on each Country's Wikipedia Page",
    "description": "A friend recently offered me a fun book: \"Brilliant maps. An atlas for curious minds\". Full of beautiful maps, one was showing the most frequent word of each country’s English Wikipedia page. Let's try to reproduce it using R.",
    "author": [],
    "date": "2019-12-16",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nScraping 193 Wikipedia pages\r\nGetting the most recurring words\r\nAn interactive world map\r\n\r\nAn different version of the infographic is available on the website of the book, which could give a general idea of how the map looks like in the book:\r\n\r\nThe authors specify in a footnote that they excluded “country”, linking words, demonyms and “government”. Surprisingly the most recurring word of the English Wikipedia page are often either revealing or funny. For example, the most recurring word of the English Wikipedia page of the USA is, according to the infographic, “war”. For China, it would be “dynasty”, Australia “new” and Russia “soviet”.\r\nIn this article, we will:\r\nscrape 193 Wikipedia articles and clean the data in a tidy way;\r\nexplore the top recurrings words and make new methodological choices;\r\nrecreate the infographic as an interactive world map using Leaflet.\r\nAs always my analysis is fully reproducible, so you can get my R code from my Github repository or my online RStudio Cloud session.\r\nScraping 193 Wikipedia pages\r\nFirstly, we need a list of all Wikipedia pages we want to scrap. The Wikipedia page of the 193 United Nations states membres will do the trick.\r\nlibrary(tidyverse)\r\nlibrary(rvest)\r\n\r\nwikilink_permalink <- \"https://en.wikipedia.org/w/index.php?title=Member_states_of_the_United_Nations&oldid=926737595\"\r\n\r\n# Extract wikitable\r\nwikitable <- wikilink_permalink %>%\r\n  read_html() %>%\r\n  html_nodes(\"table\") %>%\r\n  .[[2]]\r\n\r\n# Get wikilinks of all UN members\r\nwikilinks <- wikitable %>%\r\n  html_nodes(\"a\") %>%\r\n  html_attr(\"href\") %>%\r\n  keep(startsWith(., \"/wiki/\")) %>%\r\n  discard(endsWith(., \"and_the_United_Nations\")) %>%\r\n  str_remove(\"/wiki/Viet_Nam\") %>% # duplicate with \"/wiki/Vietnam\"\r\n  str_remove(\"/wiki/The_Gambia\") %>% # duplicate with \"/wiki/Gambia\"\r\n  str_remove(\"/wiki/United_Nations_Assistance_Mission_in_Afghanistan\") %>%\r\n  str_remove(\"/wiki/United_Nations_Assistance_Mission_in_Afghanistan\") %>%\r\n  str_remove(\"/wiki/Costa_Rica_in_the_United_Nations\") %>%\r\n  str_remove(\"/wiki/Flag\") %>%\r\n  str_replace(\"S%C3%A3o_Tom%C3%A9_and_Pr%C3%ADncipe\", \"Sao_Tome_and_Principe\") %>%\r\n  na_if(\"\") %>%\r\n  unique() %>%\r\n  na.omit() %>%\r\n  paste0(\"https://en.wikipedia.org\", .)\r\n\r\ntable <- wikitable %>%\r\n  html_table() %>%\r\n  as_tibble() %>%\r\n  mutate(\r\n    wikilinks = wikilinks,\r\n    page_name = str_remove(wikilinks, \".*/\")\r\n  ) %>%\r\n  janitor::clean_names() %>%\r\n  mutate_all(funs(str_remove_all(., \"\\\\[note [0-9]+]|\\\\[[0-9]+]\"))) %>%\r\n  select(member_state = member_state_7_13_14, wikilinks, page_name)\r\n\r\ntable\r\n## # A tibble: 193 x 3\r\n##    member_state       wikilinks                                 page_name       \r\n##    <chr>              <chr>                                     <chr>           \r\n##  1 Afghanistan        https://en.wikipedia.org/wiki/Afghanistan Afghanistan     \r\n##  2 Albania            https://en.wikipedia.org/wiki/Albania     Albania         \r\n##  3 Algeria            https://en.wikipedia.org/wiki/Algeria     Algeria         \r\n##  4 Andorra            https://en.wikipedia.org/wiki/Andorra     Andorra         \r\n##  5 Angola             https://en.wikipedia.org/wiki/Angola      Angola          \r\n##  6 Antigua and Barbu… https://en.wikipedia.org/wiki/Antigua_an… Antigua_and_Bar…\r\n##  7 Argentina          https://en.wikipedia.org/wiki/Argentina   Argentina       \r\n##  8 Armenia            https://en.wikipedia.org/wiki/Armenia     Armenia         \r\n##  9 Australia          https://en.wikipedia.org/wiki/Australia   Australia       \r\n## 10 Austria            https://en.wikipedia.org/wiki/Austria     Austria         \r\n## # … with 183 more rows\r\nNow let’s use the official Wikipedia API available through the {WikipediR} R package to smoothly download all the related Wikipedia pages and add them into our dataset.\r\nlibrary(WikipediR)\r\nlibrary(purrr)\r\nlibrary(tidyr)\r\n\r\ntable_txt <- table %>%\r\n  mutate(txt = map(page_name, ~ WikipediR::page_content(\"en\", \"wikipedia\",\r\n    page_name = .x\r\n  )$parse$text$`*`[[1]])) %>%\r\n  mutate(\r\n    txt = map(txt, unlist),\r\n    txt = map(txt, read_html),\r\n    txt = map(txt, html_text)\r\n  ) %>%\r\n  unnest_longer(txt)\r\n\r\n# write_csv(table_txt, \"data/table_txt.csv\")\r\nglimpse(table_txt)\r\n## Observations: 193\r\n## Variables: 4\r\n## $ member_state <chr> \"Afghanistan\", \"Albania\", \"Algeria\", \"Andorra\", \"Angola\"…\r\n## $ wikilinks    <chr> \"https://en.wikipedia.org/wiki/Afghanistan\", \"https://en…\r\n## $ page_name    <chr> \"Afghanistan\", \"Albania\", \"Algeria\", \"Andorra\", \"Angola\"…\r\n## $ txt          <chr> \"A landlocked south-central Asian country\\nFor the Japan…\r\nNice! We have all the data we need.\r\nGetting the most recurring words\r\nWe want now to clean the data and extract the most recurring word of each Wikipedia page. We will follow the methodology by removing “country”, linking words, demonyms and “government”.\r\nLet’s get the demonyms of the countries.\r\nwiki_demonyms <- \"https://en.wikipedia.org/wiki/List_of_adjectival_and_demonymic_forms_for_countries_and_nations\"\r\n\r\ntable_demonyms <- wiki_demonyms %>%\r\n  read_html() %>%\r\n  html_nodes(\"table\") %>%\r\n  .[[1]] %>%\r\n  html_table() %>%\r\n  as_tibble() %>%\r\n  mutate_all(funs(str_remove_all(., \"\\\\[.]|[(.)]\"))) %>%\r\n  mutate_all(funs(str_to_lower)) %>%\r\n  janitor::clean_names()\r\n\r\ntable_demonyms <- table_demonyms %>%\r\n  mutate(\r\n    adjectivals = str_trim(adjectivals),\r\n    demonyms = str_trim(demonyms),\r\n    adjectivals_unnested = str_split(adjectivals, \", | or | \"),\r\n    demonyms_unnested = str_split(demonyms, \", | or |/| \")\r\n  ) %>%\r\n  unnest_longer(adjectivals_unnested) %>%\r\n  unnest_longer(demonyms_unnested)\r\n\r\ntable_demonyms\r\n## # A tibble: 726 x 5\r\n##    country_entity_n… adjectivals   demonyms   adjectivals_unne… demonyms_unnest…\r\n##    <chr>             <chr>         <chr>      <chr>             <chr>           \r\n##  1 abkhazia          abkhaz, abkh… abkhazians abkhaz            abkhazians      \r\n##  2 abkhazia          abkhaz, abkh… abkhazians abkhazian         abkhazians      \r\n##  3 afghanistan       afghan        afghans    afghan            afghans         \r\n##  4 åland islands     åland island  åland isl… åland             åland           \r\n##  5 åland islands     åland island  åland isl… åland             islanders       \r\n##  6 åland islands     åland island  åland isl… island            åland           \r\n##  7 åland islands     åland island  åland isl… island            islanders       \r\n##  8 albania           albanian      albanians  albanian          albanians       \r\n##  9 algeria           algerian      algerians  algerian          algerians       \r\n## 10 american samoa    american sam… american … american          american        \r\n## # … with 716 more rows\r\nNow we can clean the dataset following the methodology of the authors, i.e. removing “country”, linking words, demonyms and “government”.\r\nlibrary(tidytext)\r\n\r\ntable_tidy <- table_txt %>%\r\n  tidytext::unnest_tokens(word, txt) %>%\r\n  anti_join(tidytext::get_stopwords(\"en\"), by = \"word\") %>%\r\n  anti_join(table_txt %>%\r\n    mutate(word = str_to_lower(member_state)), by = \"word\") %>%\r\n  anti_join(table_txt %>%\r\n    unnest_tokens(word, member_state), by = \"word\") %>%\r\n  filter(!word %in% table_demonyms$country_entity_name) %>%\r\n  filter(!word %in% paste0(table_demonyms$country_entity_name, \"'s\")) %>%\r\n  filter(!word %in% table_demonyms$adjectivals_unnested) %>%\r\n  filter(!word %in% table_demonyms$demonyms_unnested) %>%\r\n  filter(!word %in% c(\"country\", \"government\"))\r\n\r\ntable_tidy\r\n## # A tibble: 2,326,428 x 4\r\n##    member_state wikilinks                               page_name  word         \r\n##    <chr>        <chr>                                   <chr>      <chr>        \r\n##  1 Afghanistan  https://en.wikipedia.org/wiki/Afghanis… Afghanist… landlocked   \r\n##  2 Afghanistan  https://en.wikipedia.org/wiki/Afghanis… Afghanist… asian        \r\n##  3 Afghanistan  https://en.wikipedia.org/wiki/Afghanis… Afghanist… manga        \r\n##  4 Afghanistan  https://en.wikipedia.org/wiki/Afghanis… Afghanist… see          \r\n##  5 Afghanistan  https://en.wikipedia.org/wiki/Afghanis… Afghanist… afghanis     \r\n##  6 Afghanistan  https://en.wikipedia.org/wiki/Afghanis… Afghanist… tan          \r\n##  7 Afghanistan  https://en.wikipedia.org/wiki/Afghanis… Afghanist… afghanistan.…\r\n##  8 Afghanistan  https://en.wikipedia.org/wiki/Afghanis… Afghanist… parser       \r\n##  9 Afghanistan  https://en.wikipedia.org/wiki/Afghanis… Afghanist… output       \r\n## 10 Afghanistan  https://en.wikipedia.org/wiki/Afghanis… Afghanist… nobold       \r\n## # … with 2,326,418 more rows\r\nThe results shows that additional stopwords should be added, such as removing numbers, month names, and other additional words. I don’t think we can really call this cleaning step “cheating”, considering the result of this data analysis. Let’s do this.\r\ntable_tidy2 <- table_tidy %>%\r\n  filter(!word %in% str_to_lower(month.name)) %>%\r\n  filter(!word %in% c(0:2030)) %>%\r\n  filter(!word %in% letters) %>%\r\n  filter(!word %in% c(\r\n    \"u.s\", \"uk\", \"uae\", \"drc\", \"de\", \"en\", \"also\",\r\n    \"retrieved\", \"archived\", \"original\", \"pdf\", \"edit\", \"isbn\", \"p\", \"pp\",\r\n    \"output\", \"redirect\", \"page\", \"parser\", \"mw\", \"wayback\", \"main\",\r\n    \"st\", \"al\", \"la\", \"per\", \"percent\", \"cent\", \"05\", \"cs1\", \"one\", \"two\",\r\n    \"perú\", \"d'andorra\", \"china's\", \"syria\", \"brasil\", \"citation\"\r\n  ))\r\nLet’s have a look at our most recurring words.\r\ntop1words <- table_tidy2 %>%\r\n  count(member_state, word, sort = TRUE) %>%\r\n  group_by(member_state) %>%\r\n  top_n(1) %>%\r\n  distinct(member_state, .keep_all = TRUE) %>%\r\n  arrange(desc(member_state, n))\r\n\r\ntop1words\r\n## # A tibble: 193 x 3\r\n## # Groups:   member_state [193]\r\n##    member_state                                         word           n\r\n##    <chr>                                                <chr>      <int>\r\n##  1 Zimbabwe                                             news          67\r\n##  2 Zambia                                               rhodesia      40\r\n##  3 Yemen                                                sana'a        87\r\n##  4 Viet Nam                                             journal       95\r\n##  5 Vanuatu                                              pacific       30\r\n##  6 Uzbekistan                                           soviet        47\r\n##  7 Uruguay                                              montevideo    51\r\n##  8 United States of America                             war          131\r\n##  9 United Republic of Tanzania                          zanzibar      58\r\n## 10 United Kingdom of Great Britain and Northern Ireland world        127\r\n## # … with 183 more rows\r\nYes, the most recurring word of the United States of America’s Wikipedia page is “war” indeed.\r\nBut to which extend the word “war” is more recurring than other words?\r\ntable_tidy2 %>%\r\n  filter(member_state == \"United States of America\") %>%\r\n  count(word, sort = TRUE)\r\n## # A tibble: 6,883 x 2\r\n##    word           n\r\n##    <chr>      <int>\r\n##  1 war          131\r\n##  2 world        130\r\n##  3 history      106\r\n##  4 federal      102\r\n##  5 population   100\r\n##  6 press         97\r\n##  7 york          77\r\n##  8 national      76\r\n##  9 university    75\r\n## 10 first         63\r\n## # … with 6,873 more rows\r\nJust one more occurence than the word “world”.\r\nLet’s have a closer look at all the top 10 recurring words by country.\r\ntop10words <- table_tidy2 %>%\r\n  count(member_state, word, sort = T) %>%\r\n  group_by(member_state) %>%\r\n  top_n(10) %>%\r\n  arrange(member_state)\r\n\r\nDT::datatable(\r\n  top10words,\r\n  options = list(pageLength = 10, dom = \"ftpi\"),\r\n  rownames = FALSE,\r\n  caption = \"Top 10 recurring words on each country's English Wikipedia page\"\r\n)\r\n\r\n\r\nWhat are the most recurring words in all our tops?\r\ntable_tidy2 %>%\r\n  count(member_state, word) %>%\r\n  group_by(member_state) %>%\r\n  top_n(10) %>%\r\n  ungroup() %>%\r\n  count(word, sort = TRUE)\r\n## # A tibble: 645 x 2\r\n##    word              n\r\n##    <chr>         <int>\r\n##  1 world           174\r\n##  2 population      138\r\n##  3 national        126\r\n##  4 international    76\r\n##  5 first            53\r\n##  6 war              53\r\n##  7 president        51\r\n##  8 century          35\r\n##  9 article          33\r\n## 10 university       32\r\n## # … with 635 more rows\r\nThe words “world”, “population” and “national” seem good candidates to be removed as stopwords. Let’s try to remove them!\r\ntop1words_new <- table_tidy2 %>%\r\n  filter(!word %in% c(\"world\", \"world's\", \"population\", \"national\")) %>%\r\n  count(member_state, word, sort = TRUE) %>%\r\n  group_by(member_state) %>%\r\n  top_n(1) %>%\r\n  ungroup() %>%\r\n  distinct(member_state, .keep_all = TRUE) %>%\r\n  arrange(desc(member_state))\r\n\r\ntop1words_new %>%\r\n  count(word, sort = TRUE)\r\n## # A tibble: 133 x 2\r\n##    word          n\r\n##    <chr>     <int>\r\n##  1 caribbean     9\r\n##  2 pacific       9\r\n##  3 soviet        8\r\n##  4 president     7\r\n##  5 war           7\r\n##  6 century       6\r\n##  7 europe        4\r\n##  8 federal       3\r\n##  9 military      3\r\n## 10 atoll         2\r\n## # … with 123 more rows\r\nSeven countries have “war” as the most recurring word. Which are they?\r\ntop1words_new %>%\r\n  filter(word == \"war\") %>%\r\n  arrange(desc(n))\r\n## # A tibble: 7 x 3\r\n##   member_state                     word      n\r\n##   <chr>                            <chr> <int>\r\n## 1 Afghanistan                      war     138\r\n## 2 United States of America         war     131\r\n## 3 Syrian Arab Republic             war      68\r\n## 4 Spain                            war      60\r\n## 5 Democratic Republic of the Congo war      55\r\n## 6 Libya                            war      46\r\n## 7 Paraguay                         war      39\r\nQuite interesting!\r\nFinally, let’s make our own map based on this new dataset.\r\nAn interactive world map\r\nAs it is a blog article, let’s make our world map interactive.\r\nlibrary(countrycode)\r\nlibrary(leaflet)\r\nlibrary(rnaturalearth)\r\nlibrary(rnaturalearthdata)\r\nlibrary(htmltools)\r\n\r\nworld <- ne_countries(scale = \"small\", returnclass = \"sf\") %>%\r\n  filter(continent != \"Antarctica\") %>%\r\n  mutate(\r\n    name = recode(name, \"Greenland\" = \"Denmark\"),\r\n    iso_a3 = recode(iso_a3, \"GRL\" = \"DNK\")\r\n  ) %>%\r\n  select(name, iso_a3, geometry)\r\n\r\ntop1words_new$iso3c <- countrycode(top1words_new$member_state, \"country.name\", \"iso3c\")\r\n\r\nworld <- world %>%\r\n  inner_join(top1words_new, by = c(\"iso_a3\" = \"iso3c\"))\r\n\r\nlabels <- sprintf(\r\n  \"<strong>%s<\/strong><br/>%s\",\r\n  world$name, world$word\r\n) %>% lapply(htmltools::HTML)\r\n\r\n# reference: https://stackoverflow.com/a/52226825\r\ntag.map.title <- tags$style(HTML(\"\r\n  .leaflet-control.map-title { \r\n    transform: translate(-50%,20%);\r\n    position: fixed !important;\r\n    left: 50%;\r\n    text-align: center;\r\n    padding-left: 10px; \r\n    padding-right: 10px; \r\n    background: rgba(255,255,255,0.75);\r\n    font-weight: bold;\r\n    font-size: 22px;\r\n  }\r\n\"))\r\n\r\ntitle <- tags$div(\r\n  tag.map.title, HTML(\"Most Recurring Word on each Country's Wikipedia Page\")\r\n)\r\n\r\nleaflet(world) %>%\r\n  addPolygons(\r\n    weight = 1,\r\n    fillOpacity = 0.3,\r\n    highlight = highlightOptions(\r\n      weight = 2,\r\n      fillOpacity = 1\r\n    ),\r\n    label = labels,\r\n    labelOptions = labelOptions(\r\n      textsize = \"15px\"\r\n    )\r\n  ) %>%\r\n  addControl(title, position = \"topleft\", className = \"map-title\")\r\n\r\n\r\nHover your mouse on the world map and discover the most recurring words of each country’s English Wikipedia page. Yes, they are quite different from the old version of Brilliant Maps.\r\n\r\nThanks for reading!\r\n\r\nFor updates of recent blog posts, follow me on Twitter.\r\nFor reproducing my data analysis, go on my Github repo or my RStudio server.\r\nCurious about what I can do for your organisation? Have a look my services.\r\n\r\n\r\n\r\n",
    "preview": "posts/2019-12-16-leaflet-map/img/screenshot_worldmap_leaflet.png",
    "last_modified": "2020-12-04T23:46:49+01:00",
    "input_file": {},
    "preview_width": 1279,
    "preview_height": 680
  },
  {
    "path": "posts/2019-11-07-swiss-data/",
    "title": "Introducing my new R package {BFS}",
    "description": "The Swiss Federal Statistical Office, or BFS from “Bundesamt für Statistik” in German, provides a rich public database. As Swiss citizen and R enthousiast, I wanted to easily access its datasets directly from R. So I created the BFS package.",
    "author": [],
    "date": "2019-11-07",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nGetting the data\r\nExploring the data\r\nMapping time!\r\n\r\nIn this article, I will show how to use my BFS package package to easily search and download datasets from the Swiss Federal Statistical Office. We will then quickly explore a dataset and plot a map of Swiss municipalities, the lowest level of administrative division in Switzerland.\r\n\r\nAs always the code is fully reproducible, so you can get it from my Github account or on my online RStudio Cloud session.\r\nGetting the data\r\nTo use my BFS package, we should begin by downloading information related to all available datasets of the Swiss Federal Statistical Office Catalogue. We can get the BFS metadata in German (“de”), French (“fr”), Italian (“it”) and English (“en”)1.\r\n# install/load needed R packages\r\nif (!require(\"pacman\")) install.packages(\"pacman\")\r\npacman::p_load(tidyverse, scales, colorspace, plotly, RSwissMaps, BFS)\r\n\r\n# setting light theme\r\ntheme_set(theme_light())\r\n\r\n# Get BFS metadata in German\r\nmeta_de <- bfs_get_metadata(language = \"de\")\r\nmeta_de\r\n## # A tibble: 676 x 5\r\n##    title          observation_period   published url           url_px      \r\n##    <chr>          <chr>                <chr>     <chr>         <chr>       \r\n##  1 Ausländische … Dargestellter Zeitr… 07.11.20… https://www.… https://www…\r\n##  2 Ausländische … Dargestellter Zeitr… 07.11.20… https://www.… https://www…\r\n##  3 Ausländische … Dargestellter Zeitr… 07.11.20… https://www.… https://www…\r\n##  4 Ausländische … Dargestellter Zeitr… 07.11.20… https://www.… https://www…\r\n##  5 Ausländische … Dargestellter Zeitr… 07.11.20… https://www.… https://www…\r\n##  6 Ausländische … Dargestellter Zeitr… 07.11.20… https://www.… https://www…\r\n##  7 Ausländische … Dargestellter Zeitr… 07.11.20… https://www.… https://www…\r\n##  8 Ausländische … Dargestellter Zeitr… 07.11.20… https://www.… https://www…\r\n##  9 Hotellerie: A… Dargestellter Zeitr… 04.11.20… https://www.… https://www…\r\n## 10 Hotellerie: A… Dargestellter Zeitr… 04.11.20… https://www.… https://www…\r\n## # … with 666 more rows\r\nWe currently have access to 676 BFS datasets.\r\nThe challenge today is to plot a detailed map of Switzerland containing all 2’212 Swiss municipalites, or “gemeinde” in German. How many current BFS datasets contain the word “gemeinde” in their title? Let’s find out using the bfs_search() function.\r\nmeta_de_gemeinde <- bfs_search(data = meta_de, pattern = \"gemeinde\")\r\nmeta_de_gemeinde\r\n## # A tibble: 34 x 5\r\n##    title          observation_period   published url           url_px      \r\n##    <chr>          <chr>                <chr>     <chr>         <chr>       \r\n##  1 Ausländische … Dargestellter Zeitr… 07.11.20… https://www.… https://www…\r\n##  2 Hotellerie: A… Dargestellter Zeitr… 04.11.20… https://www.… https://www…\r\n##  3 Hotellerie: A… Dargestellter Zeitr… 04.11.20… https://www.… https://www…\r\n##  4 Nationalratsw… Dargestellter Zeitr… 19.09.20… https://www.… https://www…\r\n##  5 Arbeitsstätte… Dargestellter Zeitr… 22.08.20… https://www.… https://www…\r\n##  6 Kinoinfrastru… Dargestellter Zeitr… 14.03.20… https://www.… https://www…\r\n##  7 Volksabstimmu… Dargestellter Zeitr… 04.03.20… https://www.… https://www…\r\n##  8 Öffentliche B… Dargestellter Zeitr… 20.12.20… https://www.… https://www…\r\n##  9 Gründung, Sch… Dargestellter Zeitr… 10.12.20… https://www.… https://www…\r\n## 10 Neu gegründet… Dargestellter Zeitr… 05.10.20… https://www.… https://www…\r\n## # … with 24 more rows\r\nWe got 34 different datasets related to Swiss municipalities. I am interested by the one related to the cross-border worker (“Ausländische Grenzgänger/innen” in German) at the first row. Let’s download it using the bfs_get_dataset() function.\r\n# browseURL(meta_de_gemeinde$url[1]) # open related webpage\r\nmeta_de_gemeinde$title[1] # print title\r\n## [1] \"Ausländische Grenzgänger/innen nach Geschlecht und Arbeitsgemeinde\"\r\ndf_title <- \"Ausländische Grenzgänger/innen nach Geschlecht und Arbeitsgemeinde\"\r\nmeta_de_gemeinde1 <- bfs_search(data = meta_de_gemeinde, pattern = df_title)\r\ndata_bfs <- bfs_get_dataset(meta_de_gemeinde1$url_px[1])\r\ndata_bfs\r\n## # A tibble: 638,970 x 4\r\n##    quartal arbeitsgemeinde geschlecht           value\r\n##    <fct>   <fct>           <fct>                <dbl>\r\n##  1 1996Q1  Schweiz         Geschlecht - Total 143526.\r\n##  2 1996Q2  Schweiz         Geschlecht - Total 142744.\r\n##  3 1996Q3  Schweiz         Geschlecht - Total 141538.\r\n##  4 1996Q4  Schweiz         Geschlecht - Total 139210.\r\n##  5 1997Q1  Schweiz         Geschlecht - Total 137687.\r\n##  6 1997Q2  Schweiz         Geschlecht - Total 135740.\r\n##  7 1997Q3  Schweiz         Geschlecht - Total 136010.\r\n##  8 1997Q4  Schweiz         Geschlecht - Total 134580.\r\n##  9 1998Q1  Schweiz         Geschlecht - Total 134379.\r\n## 10 1998Q2  Schweiz         Geschlecht - Total 134552.\r\n## # … with 638,960 more rows\r\nNote that the developing version of BFS leverage the new pins package to save all the downloaded Swiss datasets in the same cache folder, accessible using the bfs_open_dir() function.\r\nThat’s all for my new BFS package.\r\nExploring the data\r\nUsing the Tidyverse workflow, we can now performe a quick exploratory data analysis.\r\nLet’s begin with a glimpse at the data.\r\nglimpse(data_bfs)\r\n## Observations: 638,970\r\n## Variables: 4\r\n## $ quartal         <fct> 1996Q1, 1996Q2, 1996Q3, 1996Q4, 1997Q1, 1997Q2, …\r\n## $ arbeitsgemeinde <fct> Schweiz, Schweiz, Schweiz, Schweiz, Schweiz, Sch…\r\n## $ geschlecht      <fct> Geschlecht - Total, Geschlecht - Total, Geschlec…\r\n## $ value           <dbl> 143526.0, 142744.5, 141537.9, 139210.4, 137686.8…\r\nThe dataset contains information about the number of cross-border workers by quarter (quartal), Swiss municipality (arbeitsgemeinde) and gender (geschlecht).\r\nNotice that value is a pondered value: each worker get a weighted point between 0-1 according to the number of hours of works he/she is doing (see more here). It is therefore more appropriate to speak about “cross-border work” as the value of two men working half time in a Swiss municipality is equal to a full time cross-border working woman.\r\nI am curious to learn more about the gender ratio of cross-border work by municipality and its evolution over the years. Let’s build a new gender_ratio variable.\r\ndata_bfs_ratio <- data_bfs %>%\r\n  tidyr::pivot_wider(names_from = \"geschlecht\", values_from = \"value\") %>%\r\n  rename(quarter = quartal, \r\n         municipality = arbeitsgemeinde,\r\n         man = Mann, woman = Frau, \r\n         gender_total = `Geschlecht - Total`) %>%\r\n  mutate(municipality = str_remove_all(municipality, \"\\\\.|^\\\\- \")) %>% # cleaning\r\n  mutate(gender_ratio = man / gender_total * 100) %>%\r\n  arrange(desc(quarter))\r\n\r\ndata_bfs_ratio\r\n## # A tibble: 212,990 x 6\r\n##    quarter municipality      gender_total        man     woman gender_ratio\r\n##    <fct>   <chr>                    <dbl>      <dbl>     <dbl>        <dbl>\r\n##  1 2019Q3  Schweiz              325291.   209406.      1.16e+5         64.4\r\n##  2 2019Q3  Zürich                10342.     7557.      2.78e+3         73.1\r\n##  3 2019Q3  Aeugst am Albis           0         0       0.             NaN  \r\n##  4 2019Q3  Affoltern am Alb…        19.3      14.5     4.75e+0         75.4\r\n##  5 2019Q3  Bonstetten                1.74      0.874   8.62e-1         50.4\r\n##  6 2019Q3  Hausen am Albis           0         0       0.             NaN  \r\n##  7 2019Q3  Hedingen                 42.1      41.5     5.99e-1         98.6\r\n##  8 2019Q3  Kappel am Albis           0         0       0.             NaN  \r\n##  9 2019Q3  Knonau                    0         0       0.             NaN  \r\n## 10 2019Q3  Maschwanden               0         0       0.             NaN  \r\n## # … with 212,980 more rows\r\nWe see that the gender ratio of cross-border workers for the 2nd quarter of 2019 in Switzerland is 64.2% (but 73% in Zürich).\r\nDoes it mean we have strong cantonal gender disparities in terms of cross-border work?\r\n# Create table to join later to bfs_data\r\n# ref: https://en.wikipedia.org/wiki/Data_codes_for_Switzerland#Cantons\r\ncantons <- tibble::tribble(\r\n  ~canton, ~code, ~id_can,\r\n  \"Aargau\", \"AG\", 19,\r\n  \"Appenzell Innerrhoden\", \"AI\", 15,\r\n  \"Appenzell Ausserrhoden\", \"AR\", 16,\r\n  \"Bern\", \"BE\", 2,\r\n  \"Basel-Landschaft\", \"BL\", 13,\r\n  \"Basel-Stadt\", \"BS\", 12,\r\n  \"Fribourg\", \"FR\", 10,\r\n  \"Genève\", \"GE\", 25,\r\n  \"Glarus\", \"GL\", 8,\r\n  \"Graubünden\", \"GR\", 18,\r\n  \"Jura\", \"JU\", 26,\r\n  \"Luzern\", \"LU\", 3,\r\n  \"Neuchâtel\", \"NE\", 24,\r\n  \"Nidwalden\", \"NW\", 7,\r\n  \"Obwalden\", \"OW\", 6,\r\n  \"St Gallen\", \"SG\", 17,\r\n  \"Schaffhausen\", \"SH\", 14,\r\n  \"Solothurn\", \"SO\", 11,\r\n  \"Schwyz\", \"SZ\", 5,\r\n  \"Thurgau\", \"TG\", 20,\r\n  \"Ticino\", \"TI\", 21,\r\n  \"Uri\", \"UR\", 4,\r\n  \"Vaud\", \"VD\", 22,\r\n  \"Valais\", \"VS\", 23,\r\n  \"Zug\", \"ZG\", 9,\r\n  \"Zürich\", \"ZH\", 1,\r\n)\r\n\r\ndata_bfs_ratio_annualized <- data_bfs_ratio %>%\r\n  mutate(year = str_extract(quarter, \"^.{4}\"),\r\n         year = as.numeric(year)) %>%\r\n  group_by(municipality, year) %>%\r\n  summarise(gender_ratio_annualized = mean(gender_ratio, na.rm = TRUE)) %>%\r\n  ungroup() %>%\r\n  mutate(gender_per = gender_ratio_annualized/100)\r\n\r\ndata_bfs_ratio_annualized %>%\r\n  inner_join(cantons, by = c(\"municipality\" = \"canton\")) %>% # join table\r\n  ggplot(aes(x = year, y = gender_per, color = code)) +\r\n  geom_line() +\r\n  geom_line(data = filter(data_bfs_ratio_annualized, municipality == \"Schweiz\"),\r\n             color = \"red2\", linetype = \"dashed\", size = 1) +\r\n  scale_y_continuous(label = percent) +\r\n  annotate(\"text\", x = 2016, y = 0.54, size = 3.5, label = \"National gender ratio\") +\r\n  geom_segment(aes(x = 2016, y = 0.551, xend = 2016, yend = 0.635), \r\n               color = \"black\", size = 0.2, \r\n               arrow = arrow(length = unit(0.2, \"cm\"))) +\r\n  labs(title = \"Proportion of Men in Cross-Border Workforce\",\r\n       subtitle = \"Switzerland, 1995-2019\",\r\n       color = \"Canton\",\r\n       x = \"\", y = \"\",\r\n       caption = \"quarter annualized - Data source: BFS\")\r\n\r\nIt looks like we have different gender ratio levels according to the Swiss canton. However, it is hard to see clearly and to categorise the cantons by group.\r\nLet’s make a time serie clustering to get the categories. I will reuse some code of the excellent blogpost of Bruno Rodrigues to perform a time-series k-means clustering.\r\nset.seed(1111)\r\n\r\n# Only since 2007 as missing values before for some cantons\r\ndata_bfs_wide <- data_bfs_ratio_annualized %>%\r\n  inner_join(cantons, by = c(\"municipality\" = \"canton\")) %>% # join table\r\n  filter(year > 2006) %>%\r\n  select(municipality, year, gender_ratio_annualized) %>%\r\n  pivot_wider(names_from = year, values_from = gender_ratio_annualized)\r\n\r\nwss <- map_dbl(1:6, ~{kmeans(select(data_bfs_wide, -municipality), .)$tot.withinss})\r\n\r\nelbow_df <- as.data.frame(cbind(\"n_clust\" = 1:6, \"wss\" = wss))\r\n\r\nggplot(elbow_df) +\r\n  geom_line(aes(y = wss, x = n_clust))\r\n\r\nThe optimal number of categories seems to be four. Let’s cluser our times series in four different groups.\r\nclusters <- kmeans(select(data_bfs_wide, -municipality), centers = 4)\r\n\r\ngg_plot <- data_bfs_wide %>% \r\n  mutate(cluster = clusters$cluster) %>%\r\n  pivot_longer(cols = c(-municipality, -cluster), \r\n               names_to = \"year\", \r\n               values_to = \"gender ratio\") %>%\r\n  mutate(cluster = as.factor(cluster)) %>%\r\n  rename(canton = municipality) %>%\r\n  ggplot() +\r\n  geom_line(aes(y = `gender ratio`, x = year, \r\n                group = canton, colour = cluster), \r\n            show.legend = FALSE) +\r\n  facet_wrap(~cluster, nrow = 1) +\r\n  scale_color_brewer(palette = \"Set2\") +\r\n  scale_x_discrete(breaks = seq(2007, 2019, by = 3)) +\r\n  guides(color = FALSE) +\r\n  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +\r\n  labs(title = \"Proportion of Men in Cross-Border Workforce in Swiss Cantons\",\r\n       x = \"\")\r\n\r\nplotly::ggplotly(gg_plot) %>%\r\n  hide_legend()\r\n\r\n\r\nPut your mouse over the interactive plot above. You can discover the canton’s name and related gender ratio for each time serie of the four clusters. Note that we have only kept data from 2007 as we had missing values for the previous years in some cantons.\r\nThat’s all for the exploration of the cantonal level. What about the municipal level?\r\nMapping time!\r\nLet’s plot the gender ratio of cross-bording work by Swiss municipality for the last year available, i.e. 2019.\r\nWith the great RSwissMaps package of David Zumbach, it is possible to create a map of Swizterland with only a few lines of code.\r\n# the BFS id of all municipalities are inside the RSwissMaps\r\n# the data inside RSwissMaps is taken from year 2016\r\nbfs_id_mun <- RSwissMaps::mun.template(year = 2016)\r\n\r\ndata_bfs_2018 <- data_bfs_ratio_annualized %>%\r\n  left_join(bfs_id_mun, by = c(\"municipality\" = \"name\")) %>%\r\n  filter(year == 2019)\r\n\r\nmun.plot(data_bfs_2018$bfs_nr, \r\n         data_bfs_2018$gender_per, \r\n         year = 2016) +\r\n  scale_fill_viridis_c(labels = percent, direction = -1) +\r\n  theme(legend.position = \"right\") +\r\n  labs(title = \"Proportion of Men in Cross-Border Workforce in Switzerland\",\r\n       subtitle = \"More women in green-yellow, 2019\",\r\n       fill = \"\",\r\n       caption = \"Quarterly annualized - Data Source: BFS\")\r\n\r\nData shows that central Swiss municipalites also have some cross-bording workers. If cross-bording work is mainly done by men, a few Swiss municipalities have more women working as cross-bording worker.\r\nLet me know what you think about my new BFS package and feel free to contribute or make a pull request here.\r\n\r\nThanks for reading!\r\n\r\nFor updates of recent blog posts, follow me on Twitter.\r\nFor reproducing my data analysis, go on my Github repo or my RStudio server.\r\nCurious about what I can do for your organisation? Have a look my services.\r\n\r\nEnglish and Italian have less datasets available.↩︎\r\n",
    "preview": "posts/2019-11-07-swiss-data/img/swiss-data_map-1.png",
    "last_modified": "2020-12-05T10:30:36+01:00",
    "input_file": {},
    "preview_width": 672,
    "preview_height": 480
  },
  {
    "path": "posts/2019-04-07-shdi/",
    "title": "The Evolution of Regional Inequalities Around the World",
    "description": "Last month \"Nature\" published a paper introducing new data on regional human development across the globe. I couldn't resist to have a look at this new database and try some exploratory analysis.",
    "author": [],
    "date": "2019-04-07",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nWhat does HDI stand for?\r\nInteractive world maps\r\nSliders\r\nColumnWorld map\r\n\r\nRegional disparities within continents over time\r\nZoom on selected countries\r\n\r\nThe Subnational Human Development Index (SHDI) Database contains data on 1625 regions of 161 countries, covering all regions and development levels of the world. It provides their Human Development Index with related indicators. But first, let’s remind ourself what is the Human Development Index (HDI).\r\nWhat does HDI stand for?\r\nAs explained by the UNDP, the Human Development Index (HDI) is a summary measure of average achievement in key dimensions of human development: a long and healthy life, being knowledgeable and have a decent standard of living. In other words, it is people and their capabilites that should be the criteria for assessing the development of a country, not economic growth alone.\r\nAs one (good) image worths thousands of words, just have a look at the picture below that shows how the Human Development Index is constructed.\r\n\r\nTo learn more about how the autors constructed this new database (and its limitations), you can read the paper written by Jeroen Smits and Iñaki Permanyer.\r\nOkay. Let’s directly dive into the exploratory data analysis!\r\nInteractive world maps\r\nI wanted to begin by creating an interactive world map of the human development disparities around the world. As all the variables looked interesting to map, I thought: would it be great to choose any indicator and year of the dataset, so we can visualize more than one hundred maps? With Shiny we can:1\r\nShow code\r\n# Fixing encoding for future issue\r\nSys.setlocale(\"LC_ALL\",\"C\")\r\n\r\n# loading required R packages\r\nif (!require(\"pacman\")) install.packages(\"pacman\")\r\npacman::p_load(tidyverse, sf, tmap, srvyr, plotly, gganimate, quantreg, countrycode, hrbrthemes, knitr)\r\n# downloading data\r\nurl_shdi <- \"https://globaldatalab.org/assets/2019/03/SHDI-Complete%20SD1.csv\"\r\nurl_labels <- \"https://globaldatalab.org/assets/2019/03/SHDI-SD1-Vardescription.csv\"\r\nurl_shp <- \"https://globaldatalab.org/assets/2018/07/GDL-SHDI-SHP-2.zip\"\r\nurl_code <- \"https://globaldatalab.org/assets/2018/06/GDL-Codes.xlsx\"\r\n\r\ndir.create(\"input\")\r\ndir.create(\"output\")\r\ndownload.file(url_shdi, destfile = \"input/shdi.csv\")\r\ndownload.file(url_labels, destfile = \"input/labels.csv\")\r\ndownload.file(url_shp, destfile = \"input/gdl.zip\")\r\nrm(url_shdi, url_labels, url_shp)\r\nunzip(zipfile = \"input/gdl.zip\", exdir = \"input/GDL\")\r\nfile.remove(\"input/gdl.zip\")\r\ndf <- read_csv(\"input/shdi.csv\")\r\nshp <- st_read(\"input/GDL/GDL-SHDI-SHP-2.shp\")\r\n\r\ndata <- shp %>%\r\n  #  full_join doesn't work with sf objects, left_join instead\r\n  left_join(df) # some NAs generated, in particular in Middle East countries\r\n# below is the RMD file used to build the Flexdashboard Shiny app.\r\n---\r\ntitle: \"The Subnational Human Development Database\"\r\nresource_files:\r\n- input/shdi.csv\r\n- input/GDL/\r\nruntime: shiny\r\noutput: \r\n  flexdashboard::flex_dashboard:\r\n    social: menu\r\n    theme: flatly\r\n---\r\n\r\n``` r\r\nlibrary(shiny)\r\nlibrary(readr)\r\nlibrary(dplyr)\r\nlibrary(sf)\r\nlibrary(tmap)\r\n\r\ndf <- read_csv(\"input/shdi.csv\")\r\nshp <- st_read(\"input/GDL/\")\r\n\r\ndata <- shp %>%\r\n  left_join(df)\r\nSliders\r\nchoicesSHDI = c(\"Sub-national HDI\" = \"shdi\",  \"Health index\" = \"healthindex\", \"Income index\" = \"incindex\", \"Educational index\" = \"edindex\", \"Life expectancy\" = \"lifexp\", \"Log GNI per capital\" = \"lgnic\", \"Expected years schooling\" = \"esch\", \"Mean years schooling\" = \"msch\")\r\n      \r\nselectInput(\"index\", label = \"Indicator:\", choices = choicesSHDI)\r\n\r\nselectInput(\"year\", label = \"Year:\",\r\n            choices = c(min(df$year, na.rm = T):max(df$year, na.rm = T)), \r\n            selected = max(df$year, na.rm = T))\r\n\r\n# extra space\r\ntags$br() \r\ntags$br() \r\ntags$br()\r\nColumn\r\nWorld map\r\nrenderPlot({\r\n  data %>%\r\n    filter(year == input$year) %>%\r\n    tm_shape() +\r\n    tm_polygons(input$index, id = \"region\", palette = \"RdYlBu\", title = \"Index\",\r\n                n = 10, # groups are automatically adjusted\r\n                border.col = \"black\", border.alpha = 0.5) +\r\n    tm_basemap(leaflet::providers$CartoDB.PositronNoLabels, group = \"CartoDB basemap\") +\r\n    tm_tiles(leaflet::providers$CartoDB.PositronOnlyLabels, group = \"CartoDB labels\") +\r\n    tm_layout(title = paste(names(which(choicesSHDI == input$index)), \",\", input$year),\r\n              title.position = c(\"center\", \"top\")) +\r\n    tm_credits(text = \"Félix Luginbühl - Data source: globaldatalab.org\")\r\n})\r\n\r\n\r\nIf you want to play with this simple Web app in full screen, click here.\r\nRegional disparities within continents over time\r\nExploring the dataset reminded me the famous (and funny) presentation of Hans Rosling:\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nI want to compare the evolution over the years of regional HDI relatively to the national HDI by continent, using a graphic inspired by the first one presented by Hans Rosling.\r\nShow code\r\ndf_continent <- df %>%\r\n  full_join(df %>% # add national HDI variable\r\n              filter(level == \"National\") %>%\r\n              select(iso_code, year, hdi_national = shdi),\r\n            by = c(\"iso_code\", \"year\")) %>%\r\n  mutate(continent = countrycode(iso_code, \"iso3c\", \"continent\")) %>% # add continent variable\r\n  mutate(continent = ifelse(country == \"Kosovo\", \"Europe\", continent)) %>% # fix Kosovo\r\n  filter(level != \"National\")\r\n\r\ngg_continent <- df_continent %>%\r\n  ggplot(aes(hdi_national, shdi, frame = year, size = pop, colour = continent)) +\r\n  geom_point(aes(text = paste(\"country:\", country, \"\\nregion:\", region)), alpha = 0.5) +\r\n  scale_colour_brewer(palette = \"Set1\") +\r\n  scale_size(range = c(2, 8)) +\r\n  expand_limits(x = 0, y = 0) +\r\n  geom_abline(intercept = 0 , slope = 1, alpha = 0.6, linetype = \"longdash\") +\r\n  guides(size = \"none\") +\r\n  theme_ipsum(caption_face = \"plain\") +\r\n  labs(title = \"Regional Human Development Disparities\",\r\n       subtitle = \"Regions by continent, year: {frame_time}\", \r\n       x = \"National HDI\", y = \"Regional HDI\",\r\n       caption = \"Félix Luginbühl (@lgnbhl) - Data source: globaldatalab.org\")\r\n\r\nggplotly(gg_continent) %>%\r\n  animation_opts(1500, easing = \"elastic\", redraw = FALSE)\r\n\r\n\r\nClick on the Play button to launch the animation. You can zoom inside the plot using the cursor.\r\nHere how to read the visualization:\r\nEach point is a region.\r\nThe size of each point/region is related to its population.\r\nThe regions below the dashed line have a lower level of human development that their national HDI (regions above the line have human development level higher than the national median).\r\nThe more disparate the points are, the more regional disparities there is within countries and continents.\r\nSadly we can observe important inequalities in terms of human development around the world.\r\nLet’s have a closer look at the subnational HDI disparities within continents using a classic statistical dispersition measures: the interquartile range (IQR). The IQR is equal to the difference between 75th and 25th percentiles, or between the first quartile (25% of the population) and the third quartile (75% of the population).\r\nAn important note here. The interquartile range of each country be computed by weighting each regional HDI by its population and scaled. If weighting the regions is essential, I decided not to scale the data (it is a complexe task and I don’t want to spend a reasonable amount of time on this analysis) and because the authors explained that the amount of scaling [in the database] is relatively small (i.e. near the ‘no-scaling’ value of one). The following graphics should therefore be taken with some cautions, as the median SHDI by country weighted by the population computed in the code below is not always equal to the national HDI (as it should be).\r\nKeeping this note of caution in mind, what are the interquartile ranges by year in Africa?\r\nShow code\r\ndf_weighted <- df %>%\r\n  filter(level != \"National\") %>% # remove national level\r\n  srvyr::as_survey_design(weights = pop) %>% # weighting regions by its population\r\n  group_by(year, country, iso_code) %>%\r\n  summarise(quantile = srvyr::survey_quantile(shdi, c(0.25, 0.5, 0.75))) %>%\r\n  ungroup() %>%\r\n  as_tibble() %>%\r\n  mutate(interquartile = round(quantile_q75 - quantile_q25, 3)) %>%\r\n  mutate(continent = countrycode(iso_code, \"iso3c\", \"continent\")) %>%\r\n  mutate(continent = ifelse(country == \"Kosovo\", \"Europe\", continent)) # fix Kosovo\r\n\r\nwrite_csv(df_weighted, path = \"output/df_weighted.csv\")\r\n\r\ngg_weighted_africa <- df_weighted %>%\r\n  filter(continent == \"Africa\") %>%\r\n  mutate(IQR = interquartile*100) %>% #percentile\r\n  ggplot() +\r\n  geom_line(aes(x = year, y = IQR, color = country)) +\r\n  hrbrthemes::theme_ipsum(caption_face = \"plain\") +\r\n  labs(y = \"IQR weighted by pop\",\r\n       title = \"Difference 75th-25th Percentiles in Human Development, Africa\")\r\n\r\nplotly::ggplotly(gg_weighted_africa)\r\n\r\n\r\nIn 2017, Cameroon has an HDI interquartile range of 0.196 (equal to 19.6 percentile). It means that the first quartile of its population has a HDI lower than 19.6 percentile than the third quarter of its population. In other words, it reflects high disparities of HDI amoung its regions. In the contrary, Libya has the lowest HDI disparities within its main regions according to our dataset.\r\nWhat about the evolution of European regional HDI disparities since 1990?\r\nShow code\r\ngg_weighted_europe <- df_weighted %>%\r\n  filter(continent == \"Europe\") %>%\r\n  mutate(IQR = interquartile*100) %>% #percentile\r\n  ggplot(aes(x = year, y = IQR, color = country)) +\r\n  geom_line() +\r\n  hrbrthemes::theme_ipsum(caption_face = \"plain\") +\r\n  labs(y = \"IQR weighted by pop\",\r\n       title = \"Difference 75th-25th Percentiles in Human Development, Europe\")\r\n\r\nplotly::ggplotly(gg_weighted_europe)\r\n\r\n\r\nZoom on selected countries\r\nNow let’s have a closer look at the sub-national disparities within selected countries. We will select the countries having the highest regional HDI ever (and having more than 4 different regions within the dataset) and visualize the evolution of regional disparities over the years using boxplot.\r\nHave a look at the Wikipedia article on the boxplot if you don’t remember how to interprete them. Basically, the bigger the box is, the more regional disparities there are in a country2.\r\nShow code\r\n# Top 10 highest differences between shdi within countries, all time\r\n## Keep in mind that we have missing data for some Middle east countries\r\ntop10_highest_diff <- df %>%\r\n  group_by(country, year) %>%\r\n  filter(n_distinct(shdi) > 4) %>% # at least 4 different subnational regions within country\r\n  mutate(shdi_diff = max(shdi) - min(shdi)) %>%\r\n  distinct(country, iso_code, year, shdi_diff) %>%\r\n  arrange(desc(shdi_diff)) %>% \r\n  group_by(country) %>% \r\n  distinct(country, .keep_all = TRUE) %>%\r\n  ungroup() %>%\r\n  slice(1:10) %>%\r\n  .$country\r\n\r\nanimated_boxplots <- function(selected_countries){\r\n  gg <- df %>%\r\n    filter(level != \"National\") %>%\r\n    transform(country = forcats::fct_reorder(country, shdi)) %>%\r\n    filter(country %in% selected_countries) %>%\r\n    ggplot(aes(country, shdi)) + \r\n    geom_boxplot(aes(weight = pop, frame = year)) + \r\n    #geom_point(data = df %>%\r\n                 #filter(country %in% selected_countries,\r\n                        #level == \"National\"),\r\n               #aes(factor(country), shdi, frame = year,\r\n                   #color = \"National HDI\"), size = 3, shape = 17) +\r\n    scale_color_brewer(palette = \"Set1\") +\r\n    coord_flip() +\r\n    hrbrthemes::theme_ipsum(caption_face = \"plain\") +\r\n    labs(x = \"\", y = \"Regional HDI\",\r\n         caption = \"Félix Luginbühl (@lgnbhl) - Data source: globaldatalab.org\")\r\n  \r\n  ggplotly(gg) %>%\r\n   animation_opts(1000, easing = \"elastic\")\r\n}\r\n\r\nanimated_boxplots(top10_highest_diff) %>%\r\n  layout(title = \"Top 10 Highest Subnational HDI Differences (weighted by pop)\")\r\n\r\n\r\nWhat about the ten countries having the highest national HDI in 2017?\r\nShow code\r\ntop10_HDI <- df %>%\r\n  filter(level == \"National\",\r\n         year == 2017) %>%\r\n  arrange(desc(shdi)) %>%\r\n  slice(1:10) %>%\r\n  .$country\r\n\r\nanimated_boxplots(top10_HDI) %>%\r\n  layout(title = \"Regional Disparities Within Top HDI Countries (weighted by pop)\")\r\n\r\n\r\nEven the countries that have the best human development grades seem to have strong regional disparities. Ireland made an impressive move up in the HDI ranking. Switzerland and Sweden have notable low regional disparities over the years.\r\nWe only scratch the surface of the insights we can get from the Subnational Human Development Index Database. I hope you found this quick exploratory data analysis instructive. Don’t hesitate to write me below or on LinkedIn if you have any question/comment.\r\n\r\nThanks for reading!\r\n\r\nFor updates of recent blog posts, follow me on Twitter.\r\nFor reproducing my data analysis, go on my Github repo or my RStudio server.\r\nCurious about what I can do for your organisation? Have a look my services.\r\n\r\nAs interactivity is computation heavy, I removed it for the app. Note also that some countries are missing (mainly in the Middle East) due to missing values in the dataset.↩︎\r\nNote again than as our data is note scaled, the shdi mean weighted by the population of each country isn’t always equal to the official HDI calculated by the UNDP. Note also that the box represents the interquartile range (IQR).↩︎\r\n",
    "preview": "posts/2019-04-07-shdi/img/screenshot_shdi-app.png",
    "last_modified": "2020-12-05T10:32:19+01:00",
    "input_file": {},
    "preview_width": 1179,
    "preview_height": 499
  },
  {
    "path": "posts/2018-10-06-pokemon/",
    "title": "Is There Gender Equality in the Pokémon Universe?",
    "description": "Last week I came accross the funny dataset of the current Reddit's Data Is Beautiful DataViz monthly challenge: \"Information on All 802 Pokemon\" and discovered with surprize a `percentage_male` variable. So I decided to dig further into this gender dimension of the Pokémon universe.",
    "author": [],
    "date": "2018-10-06",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nCatch ’Em All\r\nVisualize ’Em all\r\n\r\nWith more than 13 millions of subscribers, Reddit’s Data Is Beautiful is one of the main online forum on data visualization. Last week I came accross the funny dataset of the current DataViz monthly challenge: Information on All 802 Pokemon. Having a quick look at the data, I discovered with surprize a percentage_male variable. I wasn’t aware that Pokémon have genders. So I decided to dig further into this gender dimension of the Pokémon universe.\r\n\r\nI learnt that since the 2nd generation, Pokémon could either be male or female. For example, when a little Pikachu get out of its egg, he has 50% percent of being male (and 50% of being female). Some Pokémons have more chances to be male, some to be female and some have no genders (as I always thought). Take Squirtle for example. According to the dataset, he has 88.1% of chances to be male. Squirtle is therefore a male Pokémon.\r\nThis surprise led me to ask a simple question: is there gender equality in the Pokémon universe?\r\nCatch ’Em All\r\nFirstly, let’s get the data and classify the Pokémon according to their more probable gender.\r\nShow code\r\nlibrary(tidyverse)\r\nlibrary(DT)\r\n\r\npokemon <- read_csv(\"input/pokemon.csv\") #data from https://www.kaggle.com/rounakbanik/pokemon\r\n\r\npokemon_gender <- pokemon %>%\r\n  select(percentage_male, generation, name) %>%\r\n  mutate(gender = case_when(percentage_male == 0.0 ~ \"Pokémon more likely to be FEMALE\",\r\n                            percentage_male == 11.2 ~ \"Pokémon more likely to be FEMALE\",\r\n                            percentage_male == 24.6 ~ \"Pokémon more likely to be FEMALE\",\r\n                            percentage_male == 50.0 ~ \"Pokémon with equal likelihood of being FEMALE OR MALE\",\r\n                            percentage_male == 75.4 ~ \"Pokémon more likely to be MALE\",\r\n                            percentage_male == 88.1 ~ \"Pokémon more likely to be MALE\",\r\n                            percentage_male == 100.0 ~ \"Pokémon more likely to be MALE\"),\r\n         gender = replace_na(gender, \"Pokémon with NO GENDER\"), #NA is for genderless\r\n         generation = case_when(generation == 1 ~ \"from Generation I\",\r\n                                generation == 2 ~ \"from Generation II\",\r\n                                generation == 3 ~ \"from Generation III\",\r\n                                generation == 4 ~ \"from Generation IV\",\r\n                                generation == 5 ~ \"from Generation V\",\r\n                                generation == 6 ~ \"from Generation VI\",\r\n                                generation == 7 ~ \"from Generation VII\")) %>%\r\n  count(gender, generation, name) #mutate(n = 1) would also work\r\n\r\ndatatable(select(pokemon_gender, name, generation, gender), rownames = FALSE, \r\n          options = list(pageLength = 5, dom = 'ftpi'))\r\n\r\n\r\nVisualize ’Em all\r\nA simple treemap allows us to visualize our hierarchical dataset.\r\nShow code\r\nlibrary(treemap)\r\n\r\npokemon_tm <- treemap(pokemon_gender,\r\n                      index = c(\"gender\", \"generation\", \"name\"),\r\n                      vSize = \"n\",\r\n                      palette = \"Pastel1\",\r\n                      title = \"Pokémon Genders over the Generations\")\r\n\r\nLooks like gender imbalance to me. The Pokémon more likely to be FEMALE cell is less than half the size of the Pokémon more likely to be MALE cell.\r\nThe sunburstR package, a htmlwidget to create d3.js sequence sunbursts, allows us to better explore the Pokémon gender repartition over the generations.\r\nWe get a simple but effective interactive visualization, which I published online using flexdashboard. Note that some modification have to be made manually inside the HTML output.\r\nClick on the image to open the interactive page.\r\nShow code\r\nlibrary(sunburstR)\r\nlibrary(d3r)\r\nlibrary(htmlwidgets)\r\n\r\npokemon_tm_nest <- d3_nest(\r\n  pokemon_tm$tm[,c(\"gender\", \"generation\", \"name\", \"vSize\", \"color\")],\r\n  value_cols = c(\"vSize\", \"color\")\r\n  )\r\n\r\nsb <- sunburst(\r\n  data = pokemon_tm_nest,\r\n  valueField = \"vSize\",\r\n  legend = list(w = 400),\r\n  legendOrder = c(\"Pokémon more likely to be FEMALE\", \r\n                  \"Pokémon more likely to be MALE\", \r\n                  \"Pokémon with equal likelihood of being FEMALE OR MALE\",\r\n                  \"Pokémon with NO GENDER\"),\r\n  count = TRUE,\r\n  sumNodes = FALSE,\r\n  colors = htmlwidgets::JS(\"function(d){return d3.select(this).datum().data.color;}\"),\r\n  withD3 = TRUE)\r\n\r\nsb <- htmlwidgets::onRender(sb,\r\n  #ref: https://github.com/timelyportfolio/sunburstR/issues/15\r\n  \"function(el,x){\r\n  // have legend as default\r\n    d3.select(el).select('.sunburst-togglelegend').property('checked', true);\r\n    d3.select(el).select('.sunburst-legend').style('visibility', '');\r\n  }\"\r\n  )\r\n## code to copy past into the equivalent html output\r\n\r\n// Fade all but the current sequence, and show it in the breadcrumb trail.\r\n  function mouseover(d) {\r\n\r\n    var percentage = (100 * d.value / totalSize).toPrecision(2); // precision 2 - lgnbhl mod\r\n    var percentageString = percentage + \"%\";\r\n    if (percentage < 0.13) { // conditionality added\r\n      percentageString = \"\";\r\n    }\r\n\r\n    var countString = [\r\n        '<span style = \"font-size:.7em\">',\r\n        d3Format.format(\"1.2s\")(d.value) + ' Pokémon on 801', // on 801 Pokémon\r\n        '<\/span>'\r\n      ].join('');\r\n    if (percentage < 0.13) { // conditionality added\r\n      countString = d.data.name;\r\n    }\r\n\r\n\r\nThanks for reading!\r\n\r\nFor updates of recent blog posts, follow me on Twitter.\r\nFor reproducing my data analysis, go on my Github repo or my RStudio server.\r\nCurious about what I can do for your organisation? Have a look my services.\r\n\r\n\r\n\r\n",
    "preview": "posts/2018-10-06-pokemon//dataisbeautiful/pokemon_genders.png",
    "last_modified": "2020-12-05T10:34:03+01:00",
    "input_file": {},
    "preview_width": 1260,
    "preview_height": 670
  },
  {
    "path": "posts/2018-07-27-meetup/",
    "title": "Slides of my Talk at the R Users Meetup Geneva",
    "description": "This July I had the chance to speak at the R Users Meetup Geneva. I shared the learnings of my year-long exploration of the tidyverse through blogging. It was such a pleasure to meet and discuss with other R users as passionnate as I am!",
    "author": [],
    "date": "2018-07-27",
    "categories": [],
    "contents": "\r\n\r\n\r\nSuper happy to see nearly 20 people showing up this evening @GenevaRUsers ! Thanks everybody for coming 👏 and @lgnbhl for the inspiring 💫 talk! pic.twitter.com/Da8fzVcKv1\r\n\r\n— Xavier (@xvrdm) 5 juillet 2018\r\n\r\nI obviously had to make my slides using R. Afer some research, I discovered the revealjs package, which allows to create reveal.js presentations using R Markdown.\r\nI made this presentation writing only two lines of code by slide. Check it out!\r\nShow code\r\n    ---\r\n    title: \"Learning R through blogging: a journey into the tidyverse\"\r\n    author: \"Félix Luginbühl\"\r\n    date: \"Juillet 5, 2018\"\r\n    output: \r\n      revealjs::revealjs_presentation:\r\n        theme: serif\r\n        transition: slide\r\n    ---\r\n    \r\n    ## I was doing an internship at the Embassy of Switzerland in Guatemala {data-background-iframe=\"https://www.openstreetmap.org/export/embed.html?bbox=-113.15917968750001%2C1.0106897682409128%2C-67.89550781250001%2C27.410785702577023&amp;layer=mapnik&amp;marker=14.604847155053898%2C-90.52734375\"}\r\n    \r\n    ## but missing the cultural life of Geneva {data-background-iframe=\"https://www.openstreetmap.org/export/embed.html?bbox=-16.479492187500004%2C35.85343961959182%2C28.7841796875%2C54.901882187385006&amp;layer=mapnik&amp;marker=46.195042108660154%2C6.15234375\"}\r\n    \r\n    ## So I started a blog about R {data-background-iframe=\"http://felixluginbuhl.com\"}\r\n    \r\n    ## to investigate important questions {data-background=#FFFFFF}\r\n    \r\n    ## Is Marvel more successful at the box office than DC Comics? {data-transition=\"default\"}\r\n    \r\n    ![](http://felixluginbuhl.com/img/chart_marvel_3.png)\r\n    \r\n    ## But taking into account inflation {data-transition=\"default\"}\r\n    \r\n    ![](http://felixluginbuhl.com/img/chart_marvel_2.png)\r\n    \r\n    ## Which chapter of 1984 is the darkest? {data-transition=\"default\"}\r\n    \r\n    ![](http://felixluginbuhl.com/img/chart_orwell_4.png)\r\n    \r\n    ## Which countries has James Bond visited? {data-transition=\"default\"}\r\n    \r\n    ![](http://felixluginbuhl.com/img/map_bond_1.png)\r\n    \r\n    ## Which tennis player is the most popular? {data-transition=\"default\"}\r\n    \r\n    ![](http://felixluginbuhl.com/img/chart_big4_2.png)\r\n    \r\n    ## Then I created my first package {data-transition=\"default\"}\r\n    \r\n    ![](http://felixluginbuhl.com/img/screenshot_learner.gif)\r\n    \r\n    ## Which now looks like this\r\n    \r\n    ![](http://felixluginbuhl.com/img/polyglot_dev.gif)\r\n    \r\n    ## And developped a seconde package\r\n    \r\n    ![](https://raw.githubusercontent.com/lgnbhl/lgnbhl.github.io/master/img/Screenshot_bfsdata.png)\r\n    \r\n    ## It was then time to go interactive {data-background=#FFFFFF}\r\n    \r\n    <iframe src=\"http://felixluginbuhl.com/img/js_marvelNetwork.html\" width=\"100%\" height=\"600\"><\/iframe>\r\n    \r\n    ## and making interactive maps {data-background=#FFFFFF}\r\n    \r\n    <iframe src=\"http://felixluginbuhl.com/img/js_leaflet_map.html\" width=\"100%\" height=\"400\"><\/iframe>\r\n    \r\n    ## Then I tested XGBoost {data-background=#FFFFFF}\r\n    \r\n    ![](http://felixluginbuhl.com/img/chart_childrensmovies_3.png)\r\n    \r\n    ## Modeled for exploratory analysis {data-background=#FFFFFF}\r\n    \r\n    <iframe src=\"http://felixluginbuhl.com/img/js_olympics.html\" width=\"100%\" height=\"600\"><\/iframe>\r\n    \r\n    ## Made some forecasting on Swiss data {data-background=#FFFFFF}\r\n    \r\n    ![](http://felixluginbuhl.com/img/chart_swisscom_5.png)\r\n    \r\n    ## And finally competed on Kaggle {data-background=#FFFFFF}\r\n    \r\n    ![](http://felixluginbuhl.com/img/chart_cooking_9.png)\r\n    \r\n    ## In summary {data-transition=\"zoom\"}\r\n    \r\n    ![](https://raw.githubusercontent.com/lgnbhl/lgnbhl.github.io/master/img/blog_wordcloud.png)\r\n    \r\n    ## Thank you for your attention! {data-transition=\"fade\"}\r\n    \r\n    <section style=\"text-align: left;\"><br>\r\n    \r\n    Info Contact:\r\n    \r\n    - Blog: http://felixluginbuhl.com/\r\n    - Github: https://github.com/lgnbhl\r\n    - Twitter: https://twitter.com/lgnbhl\r\n    - Linkedin: https://www.linkedin.com/in/felixluginbuhl\r\n\r\n\r\nFor more information about revealjs, you can read the chapter 8 of R Markdown: The Ultimate Guide.\r\n\r\nThanks for reading!\r\n\r\nFor updates of recent blog posts, follow me on Twitter.\r\nFor reproducing my data analysis, go on my Github repo or my RStudio server.\r\nCurious about what I can do for your organisation? Have a look my services\r\n\r\n\r\n\r\n",
    "preview": "posts/2018-07-27-meetup/img/twitter_image.jpg",
    "last_modified": "2020-12-04T23:24:40+01:00",
    "input_file": {}
  },
  {
    "path": "posts/2018-06-30-cooking/",
    "title": "Can you Guess a Cuisine from its Ingredients?",
    "description": "Cooking is sometimes used as a metaphor for data preparation in machine learning. To practice my skills in machine learning, I decided to look for a dataset related to cooking. I found a Kaggle dataset where the goal of the competition is to predict the category of a dish’s cuisine given a list of its ingredients.",
    "author": [],
    "date": "2018-06-30",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nExploratory Data Analysis\r\nPreparing the Data\r\nFeature Engineering\r\nMachine learning with rpart and xgboost\r\nSubmitting on Kaggle\r\nUsing h2o’s AutoML Algorithm\r\n\r\nExploratory Data Analysis\r\nLet’s begin by reading and joining the datasets downloaded on Kaggle.\r\nShow code\r\nlibrary(tidyverse)\r\nlibrary(jsonlite)\r\n\r\ntrain  <- fromJSON(\"input/train.json\", flatten = TRUE) %>%\r\n  mutate(cuisine = as.factor(cuisine))\r\n\r\ntest <- fromJSON(\"input/test.json\", flatten = TRUE) %>%\r\n  mutate(cuisine = NA, # Add cuisine variable\r\n         cuisine = factor(cuisine, levels = c(levels(train$cuisine)))) #add levels\r\n\r\ntrain_unnested <- train %>%\r\n  tidyr::unnest(ingredients) %>%\r\n  mutate(ingredients = str_replace_all(ingredients, \"-\",\"_\"), # allow dash\r\n         ingredients = str_remove_all(ingredients, \"[^A-Za-z0-9_ ]\"), #keep letters, spaces, dash\r\n         type = \"train\")\r\n\r\ntest_unnested <- test %>%\r\n  tidyr::unnest(ingredients) %>%\r\n  mutate(ingredients = str_replace_all(ingredients, \"-\",\"_\"), # allow dash\r\n         ingredients = str_remove_all(ingredients, \"[^A-Za-z0-9_ ]\"), #keep letters, spaces, dash\r\n         type = \"test\")\r\n\r\ndataset <- full_join(train_unnested, test_unnested) %>%\r\n  as_tibble()\r\n\r\ndataset %>% arrange(id)\r\n## # A tibble: 535,670 x 4\r\n##       id cuisine ingredients                        type \r\n##    <int> <fct>   <chr>                              <chr>\r\n##  1     0 spanish mussels                            train\r\n##  2     0 spanish ground black pepper                train\r\n##  3     0 spanish garlic cloves                      train\r\n##  4     0 spanish saffron threads                    train\r\n##  5     0 spanish olive oil                          train\r\n##  6     0 spanish stewed tomatoes                    train\r\n##  7     0 spanish arborio rice                       train\r\n##  8     0 spanish minced onion                       train\r\n##  9     0 spanish medium shrimp                      train\r\n## 10     0 spanish fat free less sodium chicken broth train\r\n## # ... with 535,660 more rows\r\nNow we will realize some basic visualizations in order to better understand our dataset.\r\nWhat is the repartition of our train dataset in terms of cuisine?\r\nShow code\r\ndataset %>%\r\n  filter(type == \"train\") %>%\r\n  group_by(cuisine) %>%\r\n  summarize(n = n()) %>%\r\n  ggplot(aes(x = cuisine, y = n)) + \r\n  geom_col() +\r\n  coord_flip() +\r\n  ggthemes::theme_economist_white(horizontal = FALSE) +\r\n  theme(plot.background = element_rect(fill = \"#f8f2e4\")) +\r\n  labs(x = \"\", y = \"Number of Recipes\",\r\n       title = \"Twenty cuisines\",\r\n       subtitle = \"What's cooking?\",\r\n       caption = \"Félix Luginbühl (@lgnbhl)\\nData source: Kaggle, Yummly\")\r\n\r\nItalian and Mexican recipes are prevalent. We also notice a class imbalance, which should be taken into account when training the model.\r\nLet’s explore the repartition of the number of ingredients per recipe for each cuisine in the train dataset.\r\nShow code\r\ndataset %>%\r\n  filter(type == \"train\") %>%\r\n  group_by(id, cuisine) %>%\r\n  summarize(n = n()) %>%\r\n  group_by(cuisine) %>%\r\n  ggplot(aes(x = cuisine, y = n)) +\r\n  geom_boxplot() + \r\n  coord_flip() +\r\n  ggthemes::theme_economist_white(horizontal = FALSE) +\r\n  theme(plot.background = element_rect(fill = \"#f8f2e4\")) +\r\n  labs(x = \"\", y = \"Number of ingredients per recipe\",\r\n       title = \"Twenty cuisines\",\r\n       subtitle = \"What's cooking?\",\r\n       caption = \"Félix Luginbühl (@lgnbhl)\\nData source: Kaggle, Yummly\")\r\n\r\nWe see important outliers in each cuisine.\r\nAnother way of comparing the variation of the number of ingredients per recipe by cuisine is to calculate the coefficient of variation (CV)1 of each cuisine.\r\nShow code\r\nlibrary(raster)\r\n\r\ndataset %>%\r\n  filter(type == \"train\") %>%\r\n  group_by(id, cuisine) %>%\r\n  summarise(n = n()) %>%\r\n  group_by(cuisine) %>%\r\n  summarise(mean = mean(n),\r\n            cv = cv(n)) %>%\r\n  arrange(desc(cv))\r\n## # A tibble: 20 x 3\r\n##    cuisine       mean    cv\r\n##    <fct>        <dbl> <dbl>\r\n##  1 brazilian     9.52  58.4\r\n##  2 japanese      9.74  43.6\r\n##  3 british       9.71  42.9\r\n##  4 mexican      10.9   42.8\r\n##  5 french        9.82  42.2\r\n##  6 vietnamese   12.7   41.5\r\n##  7 southern_us   9.63  40.2\r\n##  8 spanish      10.4   39.9\r\n##  9 irish         9.30  39.8\r\n## 10 russian      10.2   39.6\r\n## 11 indian       12.7   39.5\r\n## 12 jamaican     12.2   39.0\r\n## 13 filipino     10     38.6\r\n## 14 italian       9.91  38.4\r\n## 15 moroccan     12.9   37.2\r\n## 16 greek        10.2   36.6\r\n## 17 cajun_creole 12.6   36.6\r\n## 18 thai         12.5   35.2\r\n## 19 korean       11.3   34.4\r\n## 20 chinese      12.0   33.7\r\nWe see that the Brazilian cuisine have much more variation (CV of 58.4%) than the Chinese cuisine (CV of 33.7%) relative to their means.\r\nHow many unique ingredients do we have in the dataset?\r\nShow code\r\ndataset %>%\r\n  distinct(ingredients) %>%\r\n  count()\r\n## # A tibble: 1 x 1\r\n##       n\r\n##   <int>\r\n## 1  7135\r\nThis is a lot of ingredients. We will have to do features reduction.\r\nWhat are the top 100 ingredients of the full dataset?\r\nShow code\r\nlibrary(wordcloud)\r\nset.seed(1234)\r\n\r\ndataset %>%\r\n  count(ingredients, sort = TRUE) %>%\r\n  with(wordcloud(ingredients, n, max.words = 100, scale = c(6, .1), colors = brewer.pal(6, 'Dark2')))\r\n\r\nWhat about the top 10 ingredients by cuisine?\r\nShow code\r\nlibrary(DT)\r\n\r\ntop10 <- train_unnested %>% \r\n  group_by(cuisine) %>%\r\n  count(ingredients, sort = TRUE) %>% \r\n  top_n(10) %>%\r\n  arrange(desc(cuisine))\r\n\r\nDT::datatable(\r\n  top10,\r\n  options = list(pageLength = 5, dom = \"ftpi\"),\r\n  rownames = FALSE,\r\n  caption = \"Top 10 Ingredients by Cuisine\")\r\n\r\n\r\nThis table will lead us, in the feature engineering step, to count the number of ingredients “typical” from different cultural regions.\r\nPreparing the Data\r\nFirst, we want to tidy our dataset. We will use the unnest_tokens function from {tidytext} before extracting the word stems with {SnowballC}.\r\nShow code\r\nlibrary(tidytext)\r\nlibrary(SnowballC)\r\n\r\ndataset_tidy <- dataset %>%\r\n  tidytext::unnest_tokens(word, ingredients, drop = FALSE) %>%\r\n  anti_join(stop_words) %>%\r\n  mutate(wordStem = SnowballC::wordStem(word)) #Stemming\r\n\r\ndataset_tidy %>% arrange(id)\r\n## # A tibble: 994,837 x 6\r\n##       id cuisine ingredients         type  word    wordStem\r\n##    <int> <fct>   <chr>               <chr> <chr>   <chr>   \r\n##  1     0 spanish mussels             train mussels mussel  \r\n##  2     0 spanish ground black pepper train ground  ground  \r\n##  3     0 spanish ground black pepper train black   black   \r\n##  4     0 spanish ground black pepper train pepper  pepper  \r\n##  5     0 spanish garlic cloves       train garlic  garlic  \r\n##  6     0 spanish garlic cloves       train cloves  clove   \r\n##  7     0 spanish saffron threads     train saffron saffron \r\n##  8     0 spanish saffron threads     train threads thread  \r\n##  9     0 spanish olive oil           train olive   oliv    \r\n## 10     0 spanish olive oil           train oil     oil     \r\n## # ... with 994,827 more rows\r\nAs you can see, we have now the ingredient words in the word and the stem word in wordStem. Note that “soy” became “soi” with the stemming.\r\nWe will now build a document-term matrix with the cast_dtm function of {tidytext}. We will performe feature reduction by removing the less frequent words.\r\nShow code\r\nlibrary(tm)\r\n\r\ndataset_dtm <- dataset_tidy %>%\r\n  count(id, wordStem, sort = TRUE) %>%\r\n  cast_dtm(id, wordStem, n, weighting = tm::weightTf) #tm:weightTfIdf also possible\r\n\r\ndataset_dtm <- dataset_dtm %>%\r\n  tm::removeSparseTerms(sparse = 0.999) %>%\r\n  as.matrix() %>%\r\n  as.data.frame() %>%\r\n  rownames_to_column(\"id\") %>%\r\n  mutate(id = as.numeric(id)) %>%\r\n  inner_join(dataset_tidy %>%\r\n               select(id, type, cuisine), by = \"id\") %>%\r\n  mutate(cuisine = as.factor(cuisine)) %>%\r\n  distinct() %>%\r\n  select(cuisine, id, type, everything()) %>%\r\n  as_tibble()\r\n\r\ndataset_dtm %>% arrange(id)\r\n## # A tibble: 49,718 x 803\r\n##    cuisine        id type  ground pepper fresh  seed chicken   dri  sauc\r\n##    <fct>       <dbl> <chr>  <dbl>  <dbl> <dbl> <dbl>   <dbl> <dbl> <dbl>\r\n##  1 spanish        0. train     1.     1.    0.    0.      1.    0.    0.\r\n##  2 mexican        1. train     3.     4.    1.    0.      0.    0.    0.\r\n##  3 french         2. train     0.     1.    0.    0.      1.    0.    0.\r\n##  4 chinese        3. train     0.     1.    1.    0.      0.    0.    1.\r\n##  5 italian        4. train     0.     0.    0.    0.      0.    0.    0.\r\n##  6 <NA>           5. test      1.     0.    0.    0.      0.    1.    1.\r\n##  7 chinese        6. train     0.     0.    0.    0.      0.    0.    1.\r\n##  8 <NA>           7. test      4.     1.    1.    0.      1.    0.    0.\r\n##  9 french         8. train     0.     0.    0.    0.      0.    0.    0.\r\n## 10 southern_us    9. train     0.     1.    0.    0.      0.    2.    0.\r\n## # ... with 49,708 more rows, and 793 more variables\r\nNice! We have a dataset of 803 variables.\r\nFeature Engineering\r\nNow some quick feature engineering. We will add a nIng variable, which give the number of ingredients by recipe. We will also create three variables that count the number of ingredients “typical” from three large regions: Asian, South and North ingredients. The idea comes from this other Kernel.\r\nShow code\r\nsumIng <- dataset_tidy %>%\r\n  group_by(id) %>%\r\n  count(id) %>%\r\n  rename(nIng = n)\r\n\r\ndataset_dtm <- dataset_dtm %>%\r\n  full_join(sumIng, by = \"id\")\r\n\r\ndataset_dtm %>%\r\n  select(cuisine, id, nIng, type, everything()) %>%\r\n  arrange(id)\r\n\r\n#ref: https://www.kaggle.com/alonalevy/cultural-diffusion-by-recipes\r\nnorth_cuisine <- c(\"british\", \"irish\", \"southern_us\", \"russian\", \"french\")\r\nsouth_cuisine <- c(\"brazilian\", \"cajun_creole\", \"greek\", \"indian\", \"italian\", \"jamaican\", \"mexican\", \"moroccan\", \"spanish\")\r\nasian_cuisine <- c(\"filipino\")\r\n\r\ningredients_north <- dataset_tidy %>%\r\n  select(id, cuisine, wordStem) %>%\r\n  filter(cuisine %in% north_cuisine)\r\n\r\ningredients_south <- dataset_tidy %>%\r\n  select(id, cuisine, wordStem) %>%\r\n  filter(cuisine %in% south_cuisine)\r\n\r\ningredients_asian <- dataset_tidy %>%\r\n  select(id, cuisine, wordStem) %>%\r\n  filter(cuisine %in% asian_cuisine)\r\n\r\ncommon_north <- ingredients_north %>%\r\n  anti_join(ingredients_south, by = \"wordStem\") %>%\r\n  anti_join(ingredients_asian, by = \"wordStem\")\r\n\r\ncommon_south <- ingredients_south %>%\r\n  anti_join(ingredients_north, by = \"wordStem\") %>%\r\n  anti_join(ingredients_asian, by = \"wordStem\")\r\n\r\ncommon_asian <- ingredients_asian %>%\r\n  anti_join(ingredients_north, by = \"wordStem\") %>%\r\n  anti_join(ingredients_south, by = \"wordStem\")\r\n\r\n# Now let’s add three variables that count the number of occurrences of\r\n# each of this regional ingredients by recipe.\r\n\r\ndataset_tidy2 <- dataset_tidy %>%\r\n  mutate(north_ing = ifelse(dataset_tidy$wordStem %in% common_north$wordStem, 1, 0)) %>%\r\n  mutate(south_ing = ifelse(dataset_tidy$wordStem %in% common_south$wordStem, 1, 0)) %>%\r\n  mutate(asian_ing = ifelse(dataset_tidy$wordStem %in% common_asian$wordStem, 1, 0)) %>%\r\n  select(cuisine, north_ing, south_ing, asian_ing, everything())\r\n\r\n# count the regional wordSteam by id\r\nnAsian_ingredients <- dataset_tidy2 %>%\r\n  select(id, asian_ing) %>%\r\n  filter(asian_ing == 1) %>%\r\n  count(id) %>%\r\n  rename(nAsian_ing = n)\r\n\r\nnSouth_ingredients <- dataset_tidy2 %>%\r\n  select(id, south_ing) %>%\r\n  filter(south_ing == 1) %>%\r\n  count(id) %>%\r\n  rename(nSouth_ing = n)\r\n\r\nnNorth_ingredients <- dataset_tidy2 %>%\r\n  select(id, north_ing) %>%\r\n  filter(north_ing == 1) %>%\r\n  count(id) %>%\r\n  rename(nNorth_ing = n)\r\n\r\n# We can now join these three variables to our main dataset.\r\ndataset_final <- dataset_dtm %>%\r\n  full_join(nAsian_ingredients, by = \"id\") %>%\r\n  full_join(nSouth_ingredients, by = \"id\") %>%\r\n  full_join(nNorth_ingredients, by = \"id\") %>%\r\n  # replace NA by 0 in the new variables\r\n  mutate_at(vars(c(nAsian_ing, nNorth_ing, nSouth_ing)), funs(replace(., is.na(.), 0)))\r\n\r\nwrite_csv(dataset_final, \"output/dataset_final.csv\") #save dataset\r\n\r\ndataset_final %>%\r\n  select(cuisine, id, nIng, nAsian_ing, nNorth_ing, nSouth_ing, everything()) %>%\r\n  arrange(id)\r\n## # A tibble: 49,718 x 807\r\n##    cuisine        id  nIng nAsian_ing nNorth_ing nSouth_ing type  ground\r\n##    <fct>       <dbl> <int>      <dbl>      <dbl>      <dbl> <chr>  <dbl>\r\n##  1 spanish        0.    25         0.         0.         0. train     1.\r\n##  2 mexican        1.    36         0.         0.         0. train     3.\r\n##  3 french         2.    26         0.         1.         0. train     0.\r\n##  4 chinese        3.    19         0.         0.         0. train     0.\r\n##  5 italian        4.     8         0.         0.         0. train     0.\r\n##  6 <NA>           5.    17         0.         0.         0. test      1.\r\n##  7 chinese        6.     9         0.         0.         0. train     0.\r\n##  8 <NA>           7.    31         0.         0.         1. test      4.\r\n##  9 french         8.    16         0.         0.         0. train     0.\r\n## 10 southern_us    9.    19         0.         0.         0. train     0.\r\n## # ... with 49,708 more rows, and 799 more variables\r\nMachine learning with rpart and xgboost\r\nLet’s begin by building a simple tree. As the game is to work in the tidy way, I tried to find an equivalent of {rpart} in the tidyverse ecosystem. Sadly, {broom} doesn’t work with classification trees and the {broomstick} package, which aims to implement them, is still in development. So we will do this in the traditional way.\r\nShow code\r\n# splitting the `train` dataset using {rsample}\r\nlibrary(rsample)\r\nset.seed(1234)\r\n\r\ntrain_test_split <- dataset_final %>%\r\n  filter(type == \"train\") %>%\r\n  initial_split(prop = 0.8)\r\n\r\n# Retrieve train and test sets\r\ntrain_tbl <- training(train_test_split) %>% select(-type)\r\ntest_tbl  <- testing(train_test_split) %>% select(-type)\r\n\r\nlibrary(rpart)\r\nlibrary(rpart.plot)\r\nset.seed(1234)\r\n\r\ncartModel <- rpart(cuisine ~ ., data = train_tbl, method = \"class\")\r\n\r\nprp(cartModel)\r\n\r\nThe plot reveals the most importants ingredients of the model.\r\nThe accuracy of our classification model is “only” of 42%.\r\nShow code\r\nlibrary(caret)\r\n\r\ncartPredict <- predict(cartModel, newdata = test_tbl, type = \"class\")\r\n\r\ncartCM <- caret::confusionMatrix(cartPredict, test_tbl$cuisine)\r\n\r\nprint(cartCM$overall)\r\n##       Accuracy          Kappa  AccuracyLower  AccuracyUpper   AccuracyNull \r\n##      0.4181544      0.3280825      0.4072832      0.4290856      0.2000251 \r\n## AccuracyPValue  McnemarPValue \r\n##      0.0000000            NaN\r\nWe will try again, but this time with one of the algorithm which dominates Kaggle competitions: XGboost. XGBoost implements gradient boosted decision trees. It is very fast and handle well overfitting.\r\nShow code\r\nlibrary(xgboost)\r\nset.seed(1234)\r\n\r\ntrain_matrix <- xgb.DMatrix(as.matrix(select(train_tbl, -cuisine)), \r\n                            label = as.numeric(train_tbl$cuisine)-1) #feature index starts from 0\r\n\r\n# train our multiclass classification model using softmax\r\n# default parameters, with a maximum depth of 25.\r\nxgbModel <- xgboost(train_matrix, \r\n                    max.depth = 25, \r\n                    nround = 10, \r\n                    objective = \"multi:softmax\", \r\n                    num_class = 20)\r\n\r\n    ## [1]  train-merror:0.221873 \r\n    ## [2]  train-merror:0.178064 \r\n    ## [3]  train-merror:0.150189 \r\n    ## [4]  train-merror:0.127278 \r\n    ## [5]  train-merror:0.108580 \r\n    ## [6]  train-merror:0.093212 \r\n    ## [7]  train-merror:0.078661 \r\n    ## [8]  train-merror:0.067410 \r\n    ## [9]  train-merror:0.057668 \r\n    ## [10] train-merror:0.049151\r\n\r\nxgbPredict <- predict(xgbModel, newdata = as.matrix(select(test_tbl, -cuisine)))\r\n\r\n# change cuisine back to string\r\nxgbPredictText <- levels(test_tbl$cuisine)[xgbPredict + 1]\r\n\r\n# for a tidy confusion matrix, the `conf_mat` function of {yardstick} can also be used.\r\nconfMat <- confusionMatrix(as.factor(xgbPredictText), test_tbl$cuisine)\r\n\r\nconfMat$overall\r\n##       Accuracy          Kappa  AccuracyLower  AccuracyUpper   AccuracyNull \r\n##      0.7607493      0.7318283      0.7512162      0.7700910      0.2000251 \r\n## AccuracyPValue  McnemarPValue \r\n##      0.0000000            NaN\r\nWe can visualize the confusion matrix of the model using {ggplot2}.\r\nShow code\r\n#ref: https://stackoverflow.com/questions/37897252\r\nconfMat$table %>%\r\n  as.data.frame() %>%\r\n  ggplot(aes(x = Prediction, y = Reference)) +\r\n  geom_tile(aes(fill = Freq)) +\r\n  geom_text(aes(label = sprintf(\"%1.0f\", Freq)), vjust = 1) +\r\n  scale_fill_gradient(low = \"blue\", high = \"red\", trans = \"log\") +\r\n  theme_minimal() +\r\n  theme(plot.title = element_text(face = \"bold\", size = 16),\r\n        plot.caption = element_text(colour = \"dimgrey\"),\r\n        axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),\r\n        plot.background = element_rect(fill = \"#f8f2e4\")) +\r\n  labs(title = \"Confusion matrix\",\r\n       subtitle = \"What's cooking?\",\r\n       fill = \"Freq (log)\",\r\n       caption = \"Félix Luginbühl (@lgnbhl)\\nData source: Kaggle, Yummly\")\r\n\r\nThe confusion matrix reveals the class imbalance. What about the sensitivity (true positive rate) results by class?\r\nShow code\r\nconfMat$byClass %>%\r\n  as.data.frame() %>%\r\n  rownames_to_column(\"cuisine\") %>%\r\n  select(cuisine, Sensitivity, Specificity) %>%\r\n  arrange(Sensitivity)\r\n##                cuisine Sensitivity Specificity\r\n## 1       Class: british   0.3221477   0.9932095\r\n## 2       Class: russian   0.3673469   0.9978360 \r\n## 3       Class: spanish   0.3846154   0.9938136   \r\n## 4         Class: irish   0.4472050   0.9947389   \r\n## 5      Class: filipino   0.4936709   0.9955105   \r\n## 6        Class: french   0.5615079   0.9707383    \r\n## 7     Class: brazilian   0.5773196   0.9973272  \r\n## 8    Class: vietnamese   0.5785714   0.9930893   \r\n## 9      Class: japanese   0.6134185   0.9938490    \r\n## 10        Class: greek   0.6923077   0.9940515    \r\n## 11     Class: jamaican   0.7019231   0.9978344    \r\n## 12 Class: cajun_creole   0.7046980   0.9912487    \r\n## 13     Class: moroccan   0.7218543   0.9956427  \r\n## 14       Class: korean   0.7245509   0.9964043   \r\n## 15         Class: thai   0.7370130   0.9905833    \r\n## 16  Class: southern_us   0.7784091   0.9549053    \r\n## 17      Class: chinese   0.8241563   0.9806521    \r\n## 18      Class: italian   0.8818353   0.9410655   \r\n## 19       Class: indian   0.9037801   0.9875203   \r\n## 20      Class: mexican   0.9097331   0.9736527    \r\nThe sensibility metric shows that the British cuisine is correctly identified as such only one third of the time (32%), followed by Russian and Spanish cuisine.\r\nFinally let’s look at the 20 most important features of the model.\r\nShow code\r\nnames <- colnames(select(train_tbl, -cuisine))\r\nimportance_matrix <- xgb.importance(names, model = xgbModel)\r\n\r\nxgb.ggplot.importance(importance_matrix[1:30,]) +\r\n  theme_bw() +\r\n  theme(legend.background = element_blank(),\r\n        legend.key = element_blank(),\r\n        plot.title = element_text(size = 14, face = \"bold\"),\r\n        plot.background = element_rect(fill = \"#f8f2e4\")) +\r\n  labs(title = \"Feature importance\",\r\n       subtitle = \"What's cooking?\",\r\n       caption = \"Félix Luginbühl (@lgnbhl)\\nData source: Kaggle, Yummly\")\r\n\r\nThe most important feature to predict the cuisine is the word tortilla, followed by soi (i.e. soja), parmesan and the number of ingredients in the recipe.\r\nIt would be frustrating to stop here. Let’s submit our work on Kaggle to know how well our model “really” performed.\r\nSubmitting on Kaggle\r\nTo submit our predictions on Kaggle, let’s use the same code as before but with the full training dataset. We will run xggoost, this time with 120 rounds. It will take some time! Let’s calculate how much.\r\nShow code\r\ntraining <- dataset_final %>%\r\n  filter(type == \"train\") %>%\r\n  select(-type)\r\n\r\ntesting <- dataset_final %>%\r\n  filter(type == \"test\") %>%\r\n  select(-type)\r\n\r\ntesting <- testing %>%\r\n  mutate(cuisine = \"NA\") %>%\r\n  mutate(cuisine = factor(cuisine, levels = c(levels(training$cuisine)))) #add levels\r\n\r\nlibrary(xgboost)\r\nset.seed(1234)\r\n\r\ntrain_matrix <- xgb.DMatrix(as.matrix(select(training, -cuisine)), \r\n                            label = as.numeric(training$cuisine)-1)\r\n\r\nstart_time <- Sys.time()\r\n\r\nxgbModel2 <- xgboost(train_matrix, \r\n                    max.depth = 25, \r\n                    nround = 120, \r\n                    objective = \"multi:softmax\", \r\n                    num_class = 20)\r\n\r\nend_time <- Sys.time()\r\ntime_taken <- end_time - start_time\r\n\r\ntime_sec <- difftime(end_time, start_time, units = \"secs\")\r\n\r\nprint(time_taken)\r\n## Time difference of 4.359697 hours\r\nTo build the xgboost model, my computer worked more than 4 hours!\r\nWe can create and submit the CSV file on Kaggle.\r\nShow code\r\n# predict and change cuisine back to string\r\nxgb.submit <- predict(xgbModel2, newdata = as.matrix(select(test_tbl, -cuisine)))\r\nxgb.submit.text <- levels(testing$cuisine)[xgb.submit + 1]\r\n\r\n# submission\r\nsample <- read.csv('input/sample_submission.csv')\r\npredictions <- data_frame(id = as.integer(testing$id), cuisine = as.factor(xgb.submit.text))\r\n\r\nsample %>%\r\n  select(id) %>%\r\n  inner_join(predictions) %>%\r\n  write_csv(\"xgboost_submission.csv\")\r\n\r\nWe have a accuracy score of 0.7871. Nice!\r\nUsing h2o’s AutoML Algorithm\r\nCould we have a better score on Kaggle using the new h2o’s Automatic machine learning function?\r\nLet’s split the training dataset again and run the h2o.automl during the same time of xgboost.\r\nShow code\r\nlibrary(h2o)\r\nh2o.init() # max_mem_size = \"8g\"\r\n\r\ntraining_h2o <- as.h2o(training)\r\n\r\nsplit_h2o <- h2o.splitFrame(training_h2o, 0.8, seed = 1234)\r\n\r\ntrain_h2o <- h2o.assign(split_h2o[[1]], \"train\" ) # 80%\r\nvalid_h2o <- h2o.assign(split_h2o[[2]], \"valid\" ) # 20%\r\n\r\ntarget <- \"cuisine\"\r\npredictors <- setdiff(names(train_h2o), target)\r\n\r\nstart_time_h2o <- Sys.time()\r\n\r\naml <- h2o.automl(x = predictors, \r\n                  y = target, \r\n                  training_frame = train_h2o,\r\n                  leaderboard_frame = valid_h2o,\r\n                  balance_classes = TRUE,\r\n                  max_runtime_secs = as.numeric(time_sec),\r\n                  seed = 1234\r\n                  )\r\n\r\nend_time_h2o <- Sys.time()\r\n\r\ntime_taken_h2o <- end_time_h2o - start_time_h2o\r\n\r\nprint(time_taken_h2o)\r\n## Time difference of 8.775196 hours\r\nOops!\r\nOur function ran twice the time of xgboost (almost 9 hours). It was expected that max_runtime_secs would compute all the running time of the function. But it doesn’t. The time of the computation actually doubled. Good to know for next time!\r\nFinally, let’s extract the leader model, predict the class on the testing dataset and create the CSV file for the Kaggle submission. What is the result on Kaggle of our Stacked Ensemble model?\r\nShow code\r\n# Extract leader model\r\nautoml_leader <- aml@leader\r\n\r\n# Predict on test set\r\ntesting_h2o <- as.h2o(testing)\r\n\r\npred_conversion <- h2o.predict(object = automl_leader, newdata = testing_h2o)\r\n\r\npred_conversion <- as.data.frame(pred_conversion)\r\n\r\npredictions <- testing %>%\r\n  mutate(pred = as.character(as.list(pred_conversion[1]))) %>%\r\n  mutate(pred = as.factor(pred)) %>%\r\n  select(id, pred)\r\n\r\nsample %>%\r\n  select(id) %>%\r\n  inner_join(predictions) %>%\r\n  rename(cuisine = pred) %>%\r\n  mutate(cuisine = as.factor(cuisine)) %>%\r\n  mutate(id = as.integer(id)) %>%\r\n  write_csv(\"h2o_submission.csv\")\r\n\r\nThe accuracy score of our model is 0.79314. It is better than our previous xgboost model (0.7871). However, it is hard to judge in terms of algorithm performance, as h2o’s AutoML ran twice the time of xgboost on my computer.\r\n\r\nThanks for reading!\r\n\r\nFor updates of recent blog posts, follow me on Twitter.\r\nFor reproducing my data analysis, go on my Github repo or my RStudio server.\r\nCurious about what I can do for your organisation? Have a look my services.\r\n\r\nthe sample standard deviation should not be used as the mean of the ingredients by recipes varies according to the cuisine.↩︎\r\n",
    "preview": "posts/2018-06-30-cooking/img/chart_cooking_9.png",
    "last_modified": "2020-12-04T23:24:37+01:00",
    "input_file": {},
    "preview_width": 958,
    "preview_height": 439
  },
  {
    "path": "posts/2018-06-05-mapping/",
    "title": "Reproducing The Economist Most Popular Map of 2017",
    "description": "I am a big fan of The Economist charts, in particular the ones published in the Graphic details blog. According to their Christmas countdown, The Economist most popular map of 2017 were this map (see below). In this article, we will reproduce it with `ggplot2`, `sf` and `leaflet`.",
    "author": [],
    "date": "2018-06-05",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nDownloading the data\r\nMapping with ggplot2 and sf\r\nMaking the world map interactive with Leaflet\r\n\r\n\r\nDownloading the data\r\nIn order to reproduce the map from Economist taken from their Christmas countdown, we will first download the Fragile States Index. The Fragile States Index from the Fund for Peace can be download freely here. Let’s download their data for 2016.\r\nShow code\r\nlibrary(tidyverse)\r\nlibrary(rvest)\r\nlibrary(readxl)\r\n\r\nurl_2016 <- \"http://fundforpeace.org/fsi/wp-content/uploads/data/fsi-2016.xlsx\"\r\ndownload.file(url = url_2016, destfile = \"index_2016.xlsx\")\r\nindex_2016 <- read_excel(path = \"index_2016.xlsx\")\r\n\r\nindex_2016 %>% select(Country, Year, Rank, Total)\r\n## # A tibble: 178 x 4\r\n##    Country                   Year                Rank  Total\r\n##    <chr>                     <dttm>              <chr> <dbl>\r\n##  1 Somalia                   2016-01-01 00:00:00 1st    114.\r\n##  2 South Sudan               2016-01-01 00:00:00 2nd    114.\r\n##  3 Central African Republic  2016-01-01 00:00:00 3rd    112.\r\n##  4 Sudan                     2016-01-01 00:00:00 4th    112.\r\n##  5 Yemen                     2016-01-01 00:00:00 4th    112.\r\n##  6 Syria                     2016-01-01 00:00:00 6th    111.\r\n##  7 Chad                      2016-01-01 00:00:00 7th    110.\r\n##  8 Congo Democratic Republic 2016-01-01 00:00:00 8th    110.\r\n##  9 Afghanistan               2016-01-01 00:00:00 9th    108.\r\n## 10 Haiti                     2016-01-01 00:00:00 10th   105.\r\n## # ... with 168 more rows\r\nNo more code is needed as the data is already tidy.\r\nMapping with ggplot2 and sf\r\nA equivalent palette for the map can be found in the RColorBrewer package.\r\nShow code\r\nlibrary(RColorBrewer)\r\ndisplay.brewer.pal(10,\"RdYlGn\")\r\n\r\nWe need to break the countinuous variable Total into 10 discrete classes. And also check out if the countries have the same names.\r\nShow code\r\nbreaks_map = c(0, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120)\r\nlabels_map = c(\"0-30\", \"30-40\", \"40-50\", \"50-60\", \"60-70\", \"70-80\", \"80-90\", \"90-100\", \"100-110\", \"110-120\")\r\n\r\nindex_2016$Classes <- cut(index_2016$Total, \r\n                          breaks = breaks_map,\r\n                          labels = labels_map)\r\n\r\nworld <- ggplot2::map_data(\"world\") %>%\r\n  filter(region != \"Antarctica\")\r\n\r\ndplyr::setdiff(index_2016$Country, world$region)\r\n##  [1] \"Congo Democratic Republic\" \"Guinea Bissau\"            \r\n##  [3] \"Cote d'Ivoire\"             \"Congo Republic\"           \r\n##  [5] \"Kyrgyz Republic\"           \"Israel and West Bank\"     \r\n##  [7] \"Brunei Darussalam\"         \"Trinidad and Tobago\"      \r\n##  [9] \"Antigua and Barbuda\"       \"Slovak Republic\"          \r\n## [11] \"United States\"             \"United Kingdom\"\r\nNo, they aren’t. Twelve countries have to be renamed before reproducing the map.\r\nShow code\r\nindex_2016 <- index_2016 %>%\r\n  mutate(Country = recode(Country,\r\n    \"United States\" = \"USA\",\r\n    \"United Kingdom\" = \"UK\",\r\n    \"Slovak Republic\" = \"Slovakia\",\r\n    \"Israel and West Bank\" = \"Israel\",\r\n    \"Kyrgyz Republic\" = \"Kyrgyzstan\",\r\n    \"Congo Democratic Republic\" = \"Democratic Republic of the Congo\",\r\n    \"Congo Republic\" = \"Republic of Congo\",\r\n    \"Antigua and Barbuda\" = \"Antigua\",\r\n    \"Trinidad and Tobago\" = \"Trinidad\",\r\n    \"Guinea Bissau\" = \"Guinea-Bissau\",\r\n    \"Cote d'Ivoire\" = \"Ivory Coast\",\r\n    \"Brunei Darussalam\" = \"Brunei\"))\r\n\r\nlibrary(ggthemes)\r\nlibrary(ggalt)\r\n\r\nggplot() +\r\n  geom_map(data = world, map = world,\r\n    aes(x = long, y = lat, map_id = region),\r\n    col = \"lightblue\", fill= \"lightgrey\", size = 0.1) +\r\n  geom_map(data = index_2016, map = world,\r\n    aes(map_id = Country, fill = Classes)) +\r\n  ggalt::coord_proj(\"+proj=wintri\") + # for Winkel Trimple projection\r\n  scale_fill_brewer(NULL, palette = \"RdYlGn\", direction = -1) +\r\n  ggthemes::theme_map() +\r\n  #hrbrthemes::theme_ipsum() +\r\n  theme(plot.title = element_text(face = \"bold\")) +\r\n  labs(title = \"Fragile States Index\",\r\n       subtitle = \"2016 score (120=maximum)\",\r\n       caption = \"Source: Fund for Peace, The Economist\")\r\n\r\nIt doesn’t look that pretty to me. Let’s try again, using the geom_sf function of {ggplot2} (currently in the development version). To replace quicker the country names, we will use this time the {countrycode} package. We will also improve the legend.\r\nShow code\r\n#devtools::install_github(\"tidyverse/ggplot2\")\r\nlibrary(rnaturalearth)\r\nlibrary(countrycode)\r\nlibrary(sf)\r\nlibrary(hrbrthemes)\r\n\r\nearth <- ne_countries(scale = 50, returnclass = \"sf\") %>%\r\n  select(admin, geometry, iso_a2)\r\n\r\nindex_2016$iso2 <- countrycode(index_2016$Country, \"country.name\", \"iso2c\")\r\n\r\ndata_map <- inner_join(earth, index_2016, by = c(\"iso_a2\" = \"iso2\")) %>%\r\n  select(Country, Total, Classes, geometry) %>%\r\n  sf::st_as_sf() # to coerce dataset to an sf object\r\n\r\nlibrary(hrbrthemes)\r\ndata_map %>%\r\n  ggplot() +\r\n  geom_sf(aes(fill = Classes), size = 0.1, color = \"white\") +\r\n  coord_sf(crs = \"+proj=moll\") + #Mollweide projection\r\n  scale_fill_brewer(NULL, \r\n                    palette = \"RdYlGn\", \r\n                    direction = -1,\r\n                    guide = guide_legend(\r\n                      title = \"More to less stable\",\r\n                      title.hjust = 0.5,\r\n                      direction = \"horizontal\",\r\n                      nrow = 1,\r\n                      keyheight = unit(3, units = \"mm\"),\r\n                      keywidth = unit(3, units = \"mm\"),\r\n                      label.position = \"right\",\r\n                      title.position = \"top\")) +\r\n  theme_ipsum() +\r\n  theme(legend.direction = \"horizontal\",\r\n        legend.position = \"bottom\") +\r\n  labs(title = \"Fragile States Index\",\r\n       subtitle = \"2016 score (120=maximum)\",\r\n       caption = \"Félix Luginbühl (@lgnbhl)\\nSource: Fund for Peace, The Economist\")\r\n\r\nMuch better!\r\nThe Economist map use the Winkel Trimple projection. Sadley, the geom_sf function of the current developing version of {ggplot2} still doesn’t have the Winkel projection available. So we used the Mollweide projection instead. If you really want to use the Winkel Trimple projection, you should do it in base R using the {sp} package.\r\nMaking the world map interactive with Leaflet\r\nWith our sf data_map object, it is easy to make the map interactive with {leaflet}.\r\nShow code\r\nlibrary(leaflet)\r\n\r\n#set bin, color and labels\r\nbins <- breaks_map\r\npal <- leaflet::colorBin(\"RdYlGn\", domain = data_map$Total, bins = bins, reverse = TRUE)\r\nlabels <- sprintf(\"<strong>%s<\/strong><br/>%g Index score <sup><\/sup>\", \r\n                  data_map$Country, data_map$Total) %>% \r\n          lapply(htmltools::HTML)\r\n\r\nleaflet_map <- data_map %>% \r\n  leaflet() %>% addTiles() %>%\r\n  addPolygons(\r\n    fillColor = ~pal(data_map$Total), fillOpacity = 0.7,\r\n    color = \"white\", weight = 1, opacity = 1, \r\n    highlight = highlightOptions(weight = 3),\r\n    label = labels,\r\n    labelOptions = labelOptions(\r\n      style = list(\"font-weight\" = \"normal\"),\r\n      textsize = \"15px\", direction = \"auto\")) %>%\r\n  addLegend(\r\n    pal = pal, values = ~Classes, opacity = 0.9, \r\n    title = \"Fragile Index\", position = \"bottomleft\") %>% \r\n  addEasyButton(easyButton(icon = \"fa-globe\", title = \"Zoom to World Level\",\r\n    onClick=JS(\"function(btn, map){ map.setZoom(1);}\")))\r\n\r\n\r\n\r\nThanks for reading!\r\n\r\nFor updates of recent blog posts, follow me on Twitter.\r\nFor reproducing my data analysis, go on my Github repo or my RStudio server.\r\nCurious about what I can do for your organisation? Have a look my services.\r\n\r\n\r\n\r\n",
    "preview": "posts/2018-06-05-mapping/img/economist_map.png",
    "last_modified": "2020-12-04T23:15:59+01:00",
    "input_file": {},
    "preview_width": 640,
    "preview_height": 379
  },
  {
    "path": "posts/2018-05-09-forecasting/",
    "title": "Predicting the Number of Swiss Phone Calls per Hour",
    "description": "I recently heard that one of the major Swiss telecommunications provider, Swisscom AG, decided to share data on a Open Data Portal. As Swiss citizen, I was curious to see if I could put my hands on interesting datasets.",
    "author": [],
    "date": "2018-05-09",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nThe data\r\nTime Series Exploratory Analysis\r\nBuilding Forecasting Models\r\n\r\nIn this article, we will make a time series analysis of the number of phone calls by hour, day and Swiss canton in July 2017 based on the Open Data Portal. We will build forecasting models for each canton to predict the number of phone calls per hour for the first days of August 2017. And we will do all this in a tidy way.\r\nThe data\r\nOn the Swisscom platform, I found three promising datasets: the number of phone calls, SMS and data downloaded per canton in July 2017. Swisscom gives access to its data only for this month.\r\nLet’s begin by downloading the three datasets and have a glimpse of them.\r\nlibrary(tidyverse)\r\n\r\nurl1 <- \"https://opendata.swisscom.com/explore/dataset/number-of-voice-calls-per-canton-201707/download/?format=csv&timezone=Europe/Berlin&use_labels_for_header=true\"\r\nurl2 <- \"https://opendata.swisscom.com/explore/dataset/number-of-sms-sent-per-canton-201707/download/?format=csv&timezone=Europe/Berlin&use_labels_for_header=true\"\r\nurl3 <- \"https://opendata.swisscom.com/explore/dataset/effektiver-datendownload-pro-kanton-und-stunde-en/download/?format=csv&timezone=Europe/Berlin&use_labels_for_header=true\"\r\n\r\ndownload.file(url = url1, destfile = \"swiss_call.csv\")\r\ndownload.file(url = url2, destfile = \"swiss_sms.csv\")\r\ndownload.file(url = url3, destfile = \"swiss_data.csv\")\r\n\r\nswiss_call <- read.csv2(\"swiss_call.csv\")\r\nswiss_sms <- read.csv2(\"swiss_sms.csv\")\r\nswiss_data <- read.csv2(\"swiss_data.csv\")\r\n\r\nglimpse(swiss_call) # 20,115 observations\r\n## Observations: 20,115\r\n## Variables: 3\r\n## $ Kanton                              <fct> AG, AG, AG, AG, AG, AG, AG...\r\n## $ Datum.und.Zeit                      <fct> 2017-07-01T13:00:00+02:00,...\r\n## $ Anzahl.Anrufe.pro.Kanton.und.Stunde <int> 43580, 43866, 44283, 30377...\r\nglimpse(swiss_sms) # 20,115 observations\r\n## Observations: 20,115\r\n## Variables: 3\r\n## $ Kanton                           <fct> SG, SG, SG, SG, SG, SG, SG, S...\r\n## $ Datum.und.Zeit                   <fct> 2017-07-19T16:00:00+02:00, 20...\r\n## $ Anzahl.SMS.pro.Kanton.und.Stunde <int> 14294, 15854, 13806, 8586, 12...\r\nglimpse(swiss_data) # 20,088 observations (27 observations missing)\r\n## Observations: 20,088\r\n## Variables: 4\r\n## $ Kanton                                                  <fct> VD, VD...\r\n## $ Datum.und.Zeit                                          <fct> 2017-0...\r\n## $ Effektiver.Datendownload.pro.Kanton.und.Stunde.in.Bytes <dbl> 2.4063...\r\n## $ Effektiver.Datendownload.pro.Kanton.und.Stunde.in.GB    <fct> 2241.0...\r\nThe three datasets are well structured. We can join them together to build a unique dataset and make some cleaning.\r\nlibrary(lubridate)\r\n\r\nswissData <- swiss_call %>%\r\n  full_join(swiss_sms, by = c(\"Kanton\", \"Datum.und.Zeit\")) %>%\r\n  full_join(swiss_data, by = c(\"Kanton\", \"Datum.und.Zeit\")) %>%\r\n  select(canton = 1, date = 2, nCall = 3, nSMS = 4, nBytes = 5, nGB = 6) %>%\r\n  mutate(date = as_datetime(date),\r\n         nGB = as.numeric(nGB)) %>%\r\n  filter(canton != \"LI\") %>% # remove Liechtenstein\r\n  arrange(date) %>%\r\n  as_tibble()\r\n\r\nprint(swissData)\r\n## # A tibble: 19,370 x 6\r\n##    canton date                nCall  nSMS        nBytes    nGB\r\n##    <fct>  <dttm>              <int> <int>         <dbl>  <dbl>\r\n##  1 AI     2017-06-30 22:00:00    71    19   6528531111. 15350.\r\n##  2 SG     2017-06-30 22:00:00  1861  1462 290464073994.  9032.\r\n##  3 GR     2017-06-30 22:00:00   863   574 140638082495.  3125.\r\n##  4 SH     2017-06-30 22:00:00   147   666  41447348997. 11824.\r\n##  5 SO     2017-06-30 22:00:00   736   504 209639609745.  6569.\r\n##  6 GE     2017-06-30 22:00:00  3335  2219 359004229636. 10809.\r\n##  7 NW     2017-06-30 22:00:00   231   125  24987344359.  7707.\r\n##  8 LU     2017-06-30 22:00:00  1210   620 221333360558.  6921.\r\n##  9 NE     2017-06-30 22:00:00  1817   665 119579881196.  1219.\r\n## 10 JU     2017-06-30 22:00:00   380   362  44149994010. 12394.\r\n## # ... with 19,360 more rows\r\nDid we get missing values when using the full_join function?\r\nround(100*colMeans(is.na(swissData)), 2) # pourcentage of NA by variable\r\n## canton   date  nCall   nSMS nBytes    nGB \r\n##   0.00   0.00   0.00   0.00   0.13   0.13\r\nswissData$date[which(is.na(swissData$nGB))] #which row is NA in nGB\r\n##  [1] \"2017-07-25 14:00:00 UTC\" \"2017-07-25 14:00:00 UTC\"\r\n##  [3] \"2017-07-25 14:00:00 UTC\" \"2017-07-25 14:00:00 UTC\"\r\n##  [5] \"2017-07-25 14:00:00 UTC\" \"2017-07-25 14:00:00 UTC\"\r\n##  [7] \"2017-07-25 14:00:00 UTC\" \"2017-07-25 14:00:00 UTC\"\r\n##  [9] \"2017-07-25 14:00:00 UTC\" \"2017-07-25 14:00:00 UTC\"\r\n## [11] \"2017-07-25 14:00:00 UTC\" \"2017-07-25 14:00:00 UTC\"\r\n## [13] \"2017-07-25 14:00:00 UTC\" \"2017-07-25 14:00:00 UTC\"\r\n## [15] \"2017-07-25 14:00:00 UTC\" \"2017-07-25 14:00:00 UTC\"\r\n## [17] \"2017-07-25 14:00:00 UTC\" \"2017-07-25 14:00:00 UTC\"\r\n## [19] \"2017-07-25 14:00:00 UTC\" \"2017-07-25 14:00:00 UTC\"\r\n## [21] \"2017-07-25 14:00:00 UTC\" \"2017-07-25 14:00:00 UTC\"\r\n## [23] \"2017-07-25 14:00:00 UTC\" \"2017-07-25 14:00:00 UTC\"\r\n## [25] \"2017-07-25 14:00:00 UTC\" \"2017-07-25 14:00:00 UTC\"\r\nSwisscom doesn’t give the data downloaded in each canton at 4pm the 25th of July. Strange.\r\nTime Series Exploratory Analysis\r\nLet’s begin with interactive visualizations of our datasets using {dygraphs}. The {timetk} package lets use easily transform our dataset into a xts object.\r\nlibrary(timetk)\r\nlibrary(dygraphs)\r\n\r\nswissData %>%\r\n  select(canton, date, nCall) %>%\r\n  spread(canton, nCall) %>%\r\n  tk_xts() %>%\r\n  dygraph(main = \"Number of call, by Swiss canton and hour\") %>%\r\n  dyRangeSelector()\r\n\r\nswissData %>%\r\n  select(canton, date, nSMS) %>%\r\n  spread(canton, nSMS) %>%\r\n  tk_xts() %>%\r\n  dygraph(main = \"Number of SMS, by Swiss canton and hour\") %>%\r\n  dyRangeSelector()\r\n\r\nswissData %>%\r\n  select(canton, date, nGB) %>%\r\n  spread(canton, nGB) %>%\r\n  tk_xts() %>%\r\n  dygraph(main = \"Number of GB downloaded, by Swiss canton and hour\") %>%\r\n  dyRangeSelector(dateWindow = c(\"2017-07-01\", \"2017-07-03\"))\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nUgly but effective!\r\nWe can distinct two seasonalities in the number of phone calls and SMS: per day and per week. These two datasets look promising for building forecasting models, especially for the number of phone calls. In the contrary, it is hard to see periodicity in the number of GB downloaded per hour.\r\nFrom now, we will only study the number of phone calls per hour. The beauty of R programming is that the same code can be run on the dataset related to SMS.\r\nBefore diving into forecasting, let’s explore the relationship between the day of the month and the number of calls.\r\nlibrary(hrbrthemes)\r\n\r\nswissData_daily <- swissData %>%\r\n  mutate(day = as_date(date),\r\n         wday = wday(date),\r\n         wday = as.factor(wday),\r\n         wday = fct_recode(wday, \"Monday\" = \"1\", \"Tuesday\" = \"2\", \"Wednesday\" = \"3\", \r\n        \"Thursday\" = \"4\", \"Friday\" = \"5\", \"Saturday\" = \"6\", \"Sunday\" = \"7\")) %>%\r\n  group_by(day, wday) %>%\r\n  summarize(n = sum(nCall, na.rm = T)) \r\n\r\ncolors_seven = RColorBrewer::brewer.pal(9, \"Blues\")[c(9, 2, 3, 4, 5, 6, 8)]\r\n\r\nswissData_daily %>%\r\n  filter(day != as.Date(\"2017-06-30\")) %>%\r\n  ggplot(aes(x = day, y = n, fill = wday)) +\r\n  geom_bar(stat = \"identity\", alpha = 0.9) +\r\n  scale_y_continuous(limits = c(0, 18000000), \r\n                     breaks = c(0, 5000000, 10000000, 15000000),\r\n                     labels = scales::comma,) +\r\n  scale_x_date(breaks =c(as.Date(\"2017-07-01\"), as.Date(\"2017-07-05\"), as.Date(\"2017-07-10\"), \r\n                         as.Date(\"2017-07-15\"), as.Date(\"2017-07-20\"), as.Date(\"2017-07-25\"), \r\n                         as.Date(\"2017-07-31\")), \r\n               labels = c(\"1st\", \"5th\", \"10th\", \"15th\", \"20th\", \"25th\", \"31th\")) +\r\n  scale_fill_manual(values = colors_seven, name = \"Day of the week\") +\r\n  geom_segment(aes(x = as.Date(\"2017-07-15\"), y = 16500000, \r\n                   xend = as.Date(\"2017-07-15\"), yend = 9000000), \r\n               size = 0.3,\r\n               arrow = arrow(type = \"closed\", length = unit(0.15, \"cm\"))) +\r\n  annotate(\"text\", x = as.Date(\"2017-07-15\"), y = 17000000, label = \"Sunday\", size = 3) +\r\n  geom_segment(aes(x = as.Date(\"2017-07-16\"), y = 15500000, \r\n                   xend = as.Date(\"2017-07-16\"), yend = 6500000), \r\n               size = 0.3,\r\n               arrow = arrow(type = \"closed\", length = unit(0.15, \"cm\"))) +\r\n  annotate(\"text\", x = as.Date(\"2017-07-17\"), y = 16000000, label = \"Monday\", size = 3) +\r\n  theme_ipsum(grid = \"Y\", caption_face = \"plain\", axis_text_size = \"9\") +\r\n  #theme(legend.position = c(0.9, 0.9), legend.direction = \"horizontal\") +\r\n  #guides(fill = guide_legend(nrow = 1, label.position = \"bottom\", title.position = \"top\")) +\r\n  labs(x = \"\", y = \"\",\r\n       title = \"Swisscom Phone Calls per Day\",\r\n       subtitle = \"July 2017, Switzerland\",\r\n       caption = \"Félix Luginbühl  |  Data: Swisscom AG\")\r\n\r\nWe can oberve a lower level phone calls on Monday and on Sunday. I wouldn’t have expected such an important drop on Monday.\r\nAnd what about the number of phone calls by day and by hour?\r\nswissData_hourly <- swissData %>%\r\n  mutate(wday = wday(date),\r\n         hour = lubridate::hour(date)) %>%\r\n  group_by(hour, wday) %>%\r\n  summarize(n = sum(nCall, na.rm = T)) %>%\r\n  mutate(wday = as.factor(wday)) %>%\r\n  mutate(wday = fct_recode(wday, \"Monday\" = \"1\", \"Tuesday\" = \"2\", \"Wednesday\" = \"3\", \r\n        \"Thursday\" = \"4\", \"Friday\" = \"5\", \"Saturday\" = \"6\", \"Sunday\" = \"7\"))\r\n\r\nswissData_hourly %>%\r\n  ggplot(aes(x = hour, y = wday)) + \r\n  geom_tile(aes(fill = n), colour = \"white\") +\r\n  scale_x_continuous(breaks = c(0, 6, 12, 18, 24), \r\n                     labels = c(\"00:00\", \"06:00\", \"12:00\", \"18:00\", \"24:00\")) +\r\n  scale_fill_viridis_c(labels = scales::comma, name = \"Phone Calls\") +\r\n  theme_ipsum(grid = FALSE, caption_face = \"plain\", axis_text_size = \"9\", \r\n              axis_title_just = \"center\", axis_title_size = \"12\") +\r\n  theme(axis.text.x = element_text(hjust = 1)) +\r\n  labs(x = \"Hour of the day\", y = \"\",\r\n       title = \"Swisscom Phone Calls per Day and Hour\",\r\n       subtitle = \"July 2017, Switzerland\",\r\n       caption = \"Félix Luginbühl  |  Data: Swisscom AG\")\r\n\r\nOnce again, we can see that on Monday and Sunday less calls are made. We can also see that the highest pick of calls seems to be on Tuesday around 8am and 2pm. Now you will be less surprized to be interrupted by a phone call at that time of the day.\r\nTime to get our hands dirty trying some forecasting!\r\nBuilding Forecasting Models\r\nLet’s begin by making a nested data frame, so we can build multiple models.\r\nswissData_call_nested <- swissData %>%\r\n  select(canton, date, nCall) %>%\r\n  group_by(canton) %>%\r\n  nest(.key = \"data.tbl\")\r\n\r\nprint(swissData_call_nested)\r\n## # A tibble: 26 x 2\r\n##    canton data.tbl          \r\n##    <fct>  <list>            \r\n##  1 AI     <tibble [745 x 2]>\r\n##  2 SG     <tibble [745 x 2]>\r\n##  3 GR     <tibble [745 x 2]>\r\n##  4 SH     <tibble [745 x 2]>\r\n##  5 SO     <tibble [745 x 2]>\r\n##  6 GE     <tibble [745 x 2]>\r\n##  7 NW     <tibble [745 x 2]>\r\n##  8 LU     <tibble [745 x 2]>\r\n##  9 NE     <tibble [745 x 2]>\r\n## 10 JU     <tibble [745 x 2]>\r\n## # ... with 16 more rows\r\nThe exploratory analysis revealed that the dataset has two seasonalities. It fluctuates daily and weekly. As explained here by Rob Hyndman, creator of the {forecast} package, multi-seasonal periods can be effectively handled using a msts object, followed by a TBATS model.\r\nThe {sweep} package, implementing {broom} functions for time-serie objects, lets us easily tidying the residuals and the predictions of our TBATS models.\r\nlibrary(forecast)\r\nlibrary(sweep)\r\n\r\nswissData_call_nested <- swissData_call_nested %>%\r\n  mutate(data.ts = map(data.tbl, timetk::tk_ts, frequency = 24,\r\n                       start = as.Date(\"2017-07-01\"), \r\n                       end = as.Date(\"2017-08-01\"))) %>%\r\n  mutate(data.msts = map(data.ts, msts, seasonal.periods = c(24, 24*7))) %>%\r\n  mutate(data.tbats = map(data.msts, tbats)) %>% #take 10 minutes to run\r\n  mutate(data.fcast = map(data.tbats, forecast, h = c(24*7))) %>%\r\n  mutate(data.augm = map(data.tbats, sweep::sw_augment)) %>%\r\n  mutate(data.tidy = map(data.fcast, sweep::sw_sweep))\r\n\r\nprint(swissData_call_nested)\r\n## # A tibble: 26 x 8\r\n##    canton data.tbl    data.ts  data.msts data.tbats data.fcast data.augm  \r\n##    <fct>  <list>      <list>   <list>    <list>     <list>     <list>     \r\n##  1 NW     <tibble [7~ <S3: ts> <S3: mst~ <S3: tbat~ <S3: fore~ <tibble [7~\r\n##  2 AG     <tibble [7~ <S3: ts> <S3: mst~ <S3: tbat~ <S3: fore~ <tibble [7~\r\n##  3 VD     <tibble [7~ <S3: ts> <S3: mst~ <S3: tbat~ <S3: fore~ <tibble [7~\r\n##  4 ZH     <tibble [7~ <S3: ts> <S3: mst~ <S3: tbat~ <S3: fore~ <tibble [7~\r\n##  5 SZ     <tibble [7~ <S3: ts> <S3: mst~ <S3: tbat~ <S3: fore~ <tibble [7~\r\n##  6 OW     <tibble [7~ <S3: ts> <S3: mst~ <S3: tbat~ <S3: fore~ <tibble [7~\r\n##  7 BS     <tibble [7~ <S3: ts> <S3: mst~ <S3: tbat~ <S3: fore~ <tibble [7~\r\n##  8 AR     <tibble [7~ <S3: ts> <S3: mst~ <S3: tbat~ <S3: fore~ <tibble [7~\r\n##  9 ZG     <tibble [7~ <S3: ts> <S3: mst~ <S3: tbat~ <S3: fore~ <tibble [7~\r\n## 10 UR     <tibble [7~ <S3: ts> <S3: mst~ <S3: tbat~ <S3: fore~ <tibble [7~\r\n## # ... with 16 more rows, and 1 more variable: data.tidy <list>\r\nSadly the the timetk_idx option of the sw_sweep function, which preserves the time basis, doesn’t work. So we will create a time index using the {timetk} package.\r\nswissData_ts_index <- swissData %>%\r\n  filter(canton == \"BE\") %>%\r\n  tk_ts(frequency = 24, start = as.Date(\"2017-07-01\")) %>%\r\n  tk_index(timetk_idx = TRUE)\r\n\r\nswissData_ts_index_pred <- tk_make_future_timeseries(swissData_ts_index, n_future = 24*7)\r\nswissData_ts_index2 <- c(swissData_ts_index, swissData_ts_index_pred)\r\nNow let’s plot the residuals of our models. For the sake of readability, we will select only the nine most populated Swiss cantons.\r\n# url: https://en.wikipedia.org/wiki/Cantons_of_Switzerland#List\r\ncantons_9 <- c(\"ZH\", \"BE\", \"VD\", \"AG\", \"SG\", \"GE\", \"LU\", \"TI\", \"VS\")\r\n\r\nswissData_call_nested %>%\r\n  filter(canton %in% cantons_9) %>%\r\n  unnest(data.augm) %>%\r\n  mutate(date = rep(swissData_ts_index, times = 9)) %>% #add date index\r\n  ggplot(aes(x = date, y = .resid)) +\r\n  geom_line(color = \"red3\") +\r\n  geom_point(color = \"darkblue\") +\r\n  geom_smooth(method = \"loess\") +\r\n  scale_y_continuous(labels = scales::comma) +\r\n  facet_wrap(~canton, scales = \"free_y\") +\r\n  theme_bw() +\r\n  theme(axis.text.x = element_text(angle = 45, hjust = 1),\r\n        plot.title = element_text(face=\"bold\")) +\r\n  labs(x = NULL, y = \"residuals\",\r\n       title = \"Residuals Plot\",\r\n       caption = \"Félix Luginbühl (@lgnbhl)\\nData source: Swisscom AG\")\r\n\r\nOur nine model residuals are quite regular, at the exception of three hours on July the 24th. At what time of the day are these high residuals?\r\nswissData_call_nested %>%\r\n  filter(canton %in% cantons_9) %>%\r\n  unnest(data.augm) %>%\r\n  mutate(date = rep(swissData_ts_index, times = 9)) %>% #add date index\r\n  select(canton, date, .resid) %>%\r\n  arrange(desc(.resid))\r\n## # A tibble: 6,705 x 3\r\n##    canton date                .resid\r\n##    <fct>  <dttm>               <dbl>\r\n##  1 ZH     2017-07-24 13:00:00 84253.\r\n##  2 BE     2017-07-24 13:00:00 65969.\r\n##  3 VD     2017-07-24 13:00:00 56212.\r\n##  4 TI     2017-07-24 13:00:00 40955.\r\n##  5 GE     2017-07-24 13:00:00 38284.\r\n##  6 VS     2017-07-24 13:00:00 31739.\r\n##  7 AG     2017-07-24 13:00:00 31550.\r\n##  8 ZH     2017-07-07 08:00:00 30546.\r\n##  9 SG     2017-07-24 13:00:00 25433.\r\n## 10 VD     2017-07-17 06:00:00 23288.\r\n## # ... with 6,695 more rows\r\nWhat happened the 24th of July between 1pm and 3pm? I really have no idea.\r\nFinally, let’s visualize our 7-day predictions for nine Swiss cantons.\r\nswissData_call_nested %>%\r\n  filter(canton %in% cantons_9) %>%\r\n  unnest(data.tidy) %>%\r\n  mutate(date = rep(swissData_ts_index2, times = 9)) %>% #add date index 2\r\n  ggplot(aes(x = date, y = nCall, color = key)) +\r\n  geom_ribbon(aes(ymin = lo.95, ymax = hi.95), \r\n                fill = \"lightblue\", color = NA, size = 0) +\r\n  geom_ribbon(aes(ymin = lo.80, ymax = hi.80, fill = key), \r\n                fill = \"blue4\", color = NA, size = 0, alpha = 0.8) +\r\n  geom_line() + \r\n  geom_point(size = 0.5) +\r\n  scale_y_continuous(labels = scales::comma) +\r\n  facet_wrap(~canton, scales = \"free_y\") +\r\n  scale_color_manual(values = c(\"darkblue\", \"red3\")) +\r\n  theme_bw() +\r\n  theme(axis.text.x = element_text(angle = 45, hjust = 1),\r\n        legend.background = element_blank(),\r\n        legend.key = element_blank(),\r\n        legend.position = \"bottom\",\r\n        plot.title = element_text(face=\"bold\")) +\r\n  labs(x = NULL, y = \"Number of calls\",\r\n       title = \"Predicting the Number of Swisscom Calls\",\r\n       subtitle = \"Selected Swiss cantons, by hour\",\r\n       caption = \"Félix Luginbühl (@lgnbhl)\\nData source: Swisscom AG\")\r\n\r\nOur forecasting models did quite a good job. They got correctly the two seasonalities, i.e. per day and per week. However, they seem to overestimate the number of phone calls in August. It is not a surprise that our forecasting models are approximate. As Niel Bohr once famously said:\r\n\r\nPrediction is difficult, especially if it’s about future.\r\n\r\n\r\nThanks for reading!\r\n\r\nFor updates of recent blog posts, follow me on Twitter.\r\nFor reproducing my data analysis, go on my Github repo or my RStudio server.\r\nCurious about what I can do for your organisation? Have a look my services.\r\n\r\n\r\n\r\n",
    "preview": "posts/2018-05-09-forecasting/img/swissData_hourly-1.png",
    "last_modified": "2020-12-05T10:35:54+01:00",
    "input_file": {},
    "preview_width": 672,
    "preview_height": 480
  },
  {
    "path": "posts/2018-03-24-polyglot-pkg/",
    "title": "My Package {polyglot} Is Now on CRAN",
    "description": "A few months ago, I wrote my first package called {learner}. I finally took the time to put it on CRAN. Following the advice of a CRAN team member, I changed its name. I had to agree: it sounded like a machine learning package. So now the {learner} package is dead, long life to {polyglot}!",
    "author": [],
    "date": "2018-03-24",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nHow to use {polyglot}\r\nPost-scriptum\r\n\r\nWith {polyglot}, you can learn any two columns dataset right in the R console:\r\n\r\nHow to use {polyglot}\r\nLet’s imagine you want to know if you can remember some basic Japanese expressions1. You would search online a two columns table and save it into the {polyglot} directory.\r\nlibrary(tidyverse)\r\nlibrary(rvest)\r\nlibrary(polyglot) # install.packages(\"polyglot\")\r\n\r\nurl1 <- \"https://www.omniglot.com/language/phrases/japanese.php\" \r\n\r\njapanese <- url1 %>%\r\n  read_html() %>%\r\n  html_table() %>%\r\n  .[[1]] %>%\r\n  write_csv(path = paste0(\"\", system.file(\"extdata/\", package =\r\n  \"polyglot\"), \"Japanese_54_Basic_Expressions.csv\"))\r\n\r\nas_tibble(japanese)\r\n## # A tibble: 54 x 2\r\n##                     English\r\n##                       <chr>\r\n##  1                  Welcome\r\n##  2 Hello (General greeting)\r\n##  3         Hello (on phone)\r\n##  4             How are you?\r\n##  5  Reply to 'How are you?'\r\n##  6         Long time no see\r\n##  7        What's your name?\r\n##  8           My name is ...\r\n##  9      Where are you from?\r\n## 10             I'm from ...\r\n## # ... with 44 more rows, and 1 more variables: `日本語 (Japanese)` <chr>\r\nOr maybe you would like to see if you know most of the capitals in the world.\r\nurl2 <- \"https://en.wikipedia.org/wiki/List_of_national_capitals_in_alphabetical_order\"\r\n\r\ncapitals <- url2 %>%\r\n  read_html() %>%\r\n  html_node(\".wikitable\") %>%\r\n  html_table(fill = TRUE) %>%\r\n  select(Country, City, Notes) %>%\r\n  arrange(Country) %>%\r\n  write_csv(path = paste0(\"\", system.file(\"extdata/\", package =\r\n  \"polyglot\"), \"List_Capital_Cities.csv\"))\r\n\r\nas_tibble(capitals)\r\n## # A tibble: 243 x 3\r\n##                  Country                City\r\n##                    <chr>               <chr>\r\n##  1              Abkhazia             Sukhumi\r\n##  2           Afghanistan               Kabul\r\n##  3 Akrotiri and Dhekelia Episkopi Cantonment\r\n##  4               Albania              Tirana\r\n##  5               Algeria             Algiers\r\n##  6        American Samoa           Pago Pago\r\n##  7               Andorra    Andorra la Vella\r\n##  8                Angola              Luanda\r\n##  9              Anguilla          The Valley\r\n## 10   Antigua and Barbuda          St. John's\r\n## # ... with 233 more rows, and 1 more variables: Notes <chr>\r\nYou would just have to run the learn function to learn some Japanese vocabulary.\r\nlibrary(polyglot)\r\nlearn() # launch the interactive learning environment\r\n\r\nBefore launching the interactive learning environment, be sure to have the appropriate encoding and that your 2 or 3 columns dataset is a CSV file.\r\nIf your R console cannot read the Japanese characters, try the following:\r\n# Make R reading Japanese\r\n# Sys.setlocale(\"LC_ALL\", \"Japanese\")   # for Windows\r\n# Sys.setlocale(\"LC_ALL\", \"ja_JP\")       # for macOS \r\n# Sys.setlocale(\"LC_ALL\", \"ja_JP.utf8\")  # for Modern Linux etc. \r\nHappy learning!\r\nPost-scriptum\r\nYou can also try the development version of the package, which implements a simplified spaced repetition learning algorithm.\r\n\r\n# install.packages(\"devtools\")\r\ndevtools::install_github(\"lgnbhl/polyglot\")\r\nlibrary(polyglot)\r\nlearn()\r\n\r\nThanks for reading!\r\n\r\nFor updates of recent blog posts, follow me on Twitter.\r\nFor reproducing my data analysis, go on my Github repo or my RStudio server.\r\nCurious about what I can do for your organisation? Have a look my services.\r\n\r\nFor my part, all I know in Japanese is “arigato”, “konnichiwa” and “moshi moshi”.↩︎\r\n",
    "preview": "posts/2018-03-24-polyglot-pkg/img/screenshot_polyglot_1.png",
    "last_modified": "2020-12-04T23:25:38+01:00",
    "input_file": {},
    "preview_width": 510,
    "preview_height": 230
  },
  {
    "path": "posts/2018-03-13-olympics/",
    "title": "Do the Rich Countries Always Win?",
    "description": "Like most of us, I watched the Olympics Winter Games. But after seeing the medal table, I had the impression that the richer a country was, the more medals he got. But was it really the case? And if yes, to what extent?",
    "author": [],
    "date": "2018-03-13",
    "categories": [],
    "contents": "\r\nBefore exploring these questions with R, we firstly need to choose a metric to classify the participating nations from the richer to the poorer. As Norway, Germany and Canada are the most medaled countries of the 2018 Winter Olympics, the Human Development Index (HDI) is clearly a better choice than the GDP.\r\nIn this article, we will answer two questions:\r\nIs the number of medals won by each country during the Winter Olympics Games strongly correlated with its Human Development Index? (simple linear regression)\r\nIs the Human Development Index a good predictor to know if a country will win more than a certain amount of medals? (binary logistic regression)\r\nWe will therefore show how to use simple models for exploratory data analysis.\r\nScraping the data\r\nThe Human Development Index is an indicator developed by the United Nations Development Programme since 1990. It goes further than the GDP per capita by combining it with life expectancy and education.\r\nWe can get the data from selected years directly from the UNDP website. The indicator exists only for the years 1990, 2000, 2010 and then each year until 2015. Let’s select the closest years from each Winter Olympic Games.\r\nIf you are not interested in the scraping part, just skip this chapter.\r\nlibrary(tidyverse)\r\nlibrary(magrittr)\r\nlibrary(rvest)\r\nlibrary(readxl)\r\n\r\nurl_hdi <- \"http://hdr.undp.org/sites/default/files/composite_tables/2016_Statistical_Annex_Table_2.xls\"\r\n\r\ndownload.file(url = url_hdi, destfile = \"hdi_all.xls\")\r\nhdi <- read_excel(path = \"hdi_all.xls\", skip = 4)\r\n\r\nhdi_tidy <- hdi %>%\r\n  select(Country = 2, \"1990\", \"2000\", \"2010\", \"2014\", \"2015\") %>%\r\n  na.omit() %>% # remove only subtitles of the Excel file\r\n  gather(\"HDI_Year\", \"HDI\", 2:6) %>%\r\n  mutate(HDI = as.numeric(HDI), # \"..\" of rows converted as NA\r\n         HDI_Year = as.numeric(HDI_Year),\r\n         Country = recode(Country,\r\n                          \"Russian Federation\" = \"Russia\",\r\n                          \"Korea (Republic of)\" = \"South Korea\",\r\n                          \"United Kingdom\" = \"Great Britain\"))\r\n\r\nprint(hdi_tidy)\r\n## # A tibble: 1,050 x 3\r\n##        Country HDI_Year      HDI\r\n##          <chr>    <dbl>    <dbl>\r\n##  1      Norway     1990 0.849169\r\n##  2   Australia     1990 0.865822\r\n##  3 Switzerland     1990 0.830665\r\n##  4     Germany     1990 0.801083\r\n##  5     Denmark     1990 0.798528\r\n##  6   Singapore     1990 0.718370\r\n##  7 Netherlands     1990 0.829777\r\n##  8     Ireland     1990 0.762468\r\n##  9     Iceland     1990 0.796504\r\n## 10      Canada     1990 0.848961\r\n## # ... with 1,040 more rows\r\nNow, we will scrape the number of medals by country since the Winter Olympics of 1992 from Wikipedia.\r\ngetMedals <- function(i) {\r\n  url <- paste0(\"https://en.wikipedia.org/wiki/\", i, \"_Winter_Olympics_medal_table\")\r\n  \r\n  medals <- url %>%\r\n    read_html() %>%\r\n    html_node(\".wikitable\") %>%\r\n    html_table(fill = TRUE)\r\n  \r\n  colnames(medals)[2] <- \"Country\"\r\n  colnames(medals)[6] <- \"nMedals\"\r\n  medals$Country <- medals$Country %>%\r\n    gsub(\".{6}$\", \"\", .) # https://stackoverflow.com/questions/23413331\r\n\r\n  medals$Country <- stringr::str_trim(medals$Country) # remove space from host country\r\n  medals$WO_Year <- i\r\n  medals <- medals[-nrow(medals),] # remove last row\r\n  \r\n  return(medals)\r\n  }\r\n\r\nwo_years <- c(1992, 1994, 1998, 2002, 2006, 2010, 2014, 2018)\r\n\r\nmedals <- map_dfr(wo_years, getMedals) %>%\r\n  as_tibble() %>%\r\n  mutate(Country = recode(Country,\r\n                          \"Olympic Athletes from Russia\" = \"Russia\"))\r\n\r\nprint(medals)\r\n## # A tibble: 198 x 7\r\n##     Rank       Country  Gold Silver Bronze nMedals WO_Year\r\n##    <chr>         <chr> <int>  <int>  <int>   <int>   <dbl>\r\n##  1     1       Germany    10     10      6      26    1992\r\n##  2     2  Unified Team     9      6      8      23    1992\r\n##  3     3        Norway     9      6      5      20    1992\r\n##  4     4       Austria     6      7      8      21    1992\r\n##  5     5 United States     5      4      2      11    1992\r\n##  6     6         Italy     4      6      4      14    1992\r\n##  7     7        France     3      5      1       9    1992\r\n##  8     8       Finland     3      1      3       7    1992\r\n##  9     9        Canada     2      3      2       7    1992\r\n## 10    10   South Korea     2      1      1       4    1992\r\n## # ... with 188 more rows\r\nLastly, we will join our two datasets.\r\ndataset <- medals %>% \r\n  full_join(hdi_tidy, by = \"Country\") %>%\r\n  drop_na(nMedals) # remove country with no medals\r\n\r\nprint(dataset)\r\n## # A tibble: 978 x 9\r\n##     Rank      Country  Gold Silver Bronze nMedals WO_Year HDI_Year\r\n##    <chr>        <chr> <int>  <int>  <int>   <int>   <dbl>    <dbl>\r\n##  1     1      Germany    10     10      6      26    1992     1990\r\n##  2     1      Germany    10     10      6      26    1992     2000\r\n##  3     1      Germany    10     10      6      26    1992     2010\r\n##  4     1      Germany    10     10      6      26    1992     2014\r\n##  5     1      Germany    10     10      6      26    1992     2015\r\n##  6     2 Unified Team     9      6      8      23    1992       NA\r\n##  7     3       Norway     9      6      5      20    1992     1990\r\n##  8     3       Norway     9      6      5      20    1992     2000\r\n##  9     3       Norway     9      6      5      20    1992     2010\r\n## 10     3       Norway     9      6      5      20    1992     2014\r\n## # ... with 968 more rows, and 1 more variables: HDI <dbl>\r\nWe got a missing value from the Unified Team because no HDI is related to it. Which other countries have missing values in our dataset?\r\nna_rows <- which(is.na(dataset$HDI))\r\ndataset$Country[na_rows]\r\n##  [1] \"Unified Team\"   \"Czechoslovakia\" \"North Korea\"    \"Uzbekistan\"    \r\n##  [5] \"Belarus\"        \"Belarus\"        \"Belarus\"        \"Belarus\"       \r\n##  [9] \"Belarus\"        \"Belarus\"        \"Belarus\"        \"Liechtenstein\"\r\nOnly 13 rows have missing values! Surprisingly the United Nations don’t have a HDI for Liechtenstein in 1990.\r\nBefore working on the regression models, let’s just have a look at the medal table of 2018, by number medal for the top 10 countries.\r\ndata_medals <- dataset %>%\r\n  filter(WO_Year == 2018, \r\n         HDI_Year == 2015) %>%\r\n  filter(Rank == c(1:10)) %>%\r\n  select(Rank, Country, Gold, Silver, Bronze) %>%\r\n  reshape2::melt(id.vars = c(\"Rank\", \"Country\")) %>%\r\n  set_colnames(c(\"Rank\", \"Country\", \"Medal\", \"Number\")) %>%\r\n  mutate(Rank = as.numeric(Rank)) %>%\r\n  filter(!(Number == 0))\r\n\r\nlibrary(countrycode)\r\nlibrary(ggimage)\r\nset.seed(20)\r\n\r\ndata_medals %>%\r\n  mutate(iso2 = countrycode(data_medals$Country, \"country.name\", \"iso2c\")) %>%\r\n  ggplot(aes(x = fct_reorder(Country, Rank, .desc = T), y = Number)) +\r\n  geom_jitter(aes(fill = Medal), pch = 21, size = 5, width = 0.15, height = 0) +\r\n  ggimage::geom_flag(y = -0.5, aes(image = iso2)) +\r\n  scale_fill_manual(values = c(\"gold\", \"grey\", \"sienna\"), name = NULL) +\r\n  scale_y_continuous(breaks = c(1:14)) +\r\n  coord_flip() +\r\n  expand_limits(y = -0.5) +\r\n  ggthemes::theme_economist_white() +\r\n  theme(plot.background = element_rect(fill = \"#f8f2e4\"),\r\n        legend.background = element_blank(),\r\n        legend.key = element_blank()) +\r\n  labs(x = NULL, y = \"Number of medals\",\r\n       title = \"2018 Winter Olympics Medals Table\",\r\n       caption = \"Félix Luginbühl (@lgnbhl)\\nData source: Wikipedia\")\r\n\r\nLinear regressions\r\nLet’s begin by visualizing the relationship between the variables nMedals and HDI for the 2018 Winter Olympics Games.\r\nlibrary(ggthemes)\r\n\r\ndataset %>%\r\n  filter(WO_Year == 2018, HDI_Year == 2015) %>%\r\n  mutate(HDI = round(HDI, 2)) %>%\r\n  ggplot(aes(nMedals, HDI, label = Country)) +\r\n  geom_point() +\r\n  geom_text(data = . %>% filter(WO_Year == 2018, \r\n                                HDI_Year == 2015,\r\n                                Country %in% c(\"China\", \"Russia\", \"Australia\")), \r\n            aes(label = Country), nudge_y = 0.01) +\r\n  geom_smooth(method = lm, se = F, color = \"brown2\") +\r\n  theme_economist_white() +\r\n  theme(plot.background = element_rect(fill = \"#f8f2e4\")) +\r\n  labs(x = \"Number of medals\", y = \"Human Development Index\",\r\n       title = \"Do the Rich Countries Always Win?\",\r\n       subtitle = \"Number of medals vs. Human Development Index, 2018 Winter Olympics\",\r\n       caption = \"Félix Luginbühl (@lgnbhl)\\nData source: Wikipedia\")\r\n\r\nWe can observe that the number of medals of China and Russia are not well explained by a linear regression.\r\nIn order to complete all the assumptions required to run a linear regression, we need to make a logarithmic transformation of the number of medals variable.\r\nlibrary(gvlma)\r\n\r\nwo_2018 <- dataset %>%\r\n  filter(WO_Year == 2018, HDI_Year == 2015) %>%\r\n  mutate(nMedals_log = log(nMedals))\r\n\r\nmod_2018 <- lm(nMedals_log ~ HDI, data = wo_2018)\r\n\r\ngvmodel <- gvlma(mod_2018)\r\n\r\nsummary(gvmodel)\r\n## \r\n## Call:\r\n## lm(formula = nMedals_log ~ HDI, data = wo_2018)\r\n## \r\n## Residuals:\r\n##     Min      1Q  Median      3Q     Max \r\n## -2.0422 -1.0393  0.2034  0.8227  1.8388 \r\n## \r\n## Coefficients:\r\n##             Estimate Std. Error t value Pr(>|t|)  \r\n## (Intercept)   -6.787      3.273  -2.073   0.0475 *\r\n## HDI            9.686      3.722   2.602   0.0146 *\r\n## ---\r\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\r\n## \r\n## Residual standard error: 1.12 on 28 degrees of freedom\r\n## Multiple R-squared:  0.1947, Adjusted R-squared:  0.166 \r\n## F-statistic: 6.771 on 1 and 28 DF,  p-value: 0.01464\r\n## \r\n## \r\n## ASSESSMENT OF THE LINEAR MODEL ASSUMPTIONS\r\n## USING THE GLOBAL TEST ON 4 DEGREES-OF-FREEDOM:\r\n## Level of Significance =  0.05 \r\n## \r\n## Call:\r\n##  gvlma(x = mod_2018) \r\n## \r\n##                     Value p-value                Decision\r\n## Global Stat        6.3992 0.17125 Assumptions acceptable.\r\n## Skewness           0.1197 0.72934 Assumptions acceptable.\r\n## Kurtosis           1.4743 0.22466 Assumptions acceptable.\r\n## Link Function      3.6303 0.05674 Assumptions acceptable.\r\n## Heteroscedasticity 1.1748 0.27841 Assumptions acceptable.\r\nOur model has a coefficient of determination (or R-squared) of 0.19, with a p-value of 0.01. The R-squared means that around 20% of the variation of the nMedals can be explained by the variation of the HDI. It is quite low but not that bad given the fact that we are using only one predictor.\r\nWe only visualized the year 2018. What is the relationship between our two variables for each Winter Olympics year since 1992?\r\nlibrary(broom)\r\n\r\nwo_years <- c(1992, 1994, 1998, 2002, 2006, 2010, 2014, 2018)\r\nhdi_years <- c(1990, 1990, 2000, 2000, 2010, 2010, 2014, 2015)\r\n\r\ngetModels <- function(i, j) {\r\n  \r\n  olympic <- dataset %>%\r\n    filter(WO_Year == i, HDI_Year == j) %>%\r\n    mutate(nMedals_log = log(nMedals))\r\n  \r\n  model <- lm(nMedals_log ~ HDI, data = olympic)\r\n  model_metrics <- glance(model)\r\n  model_metrics$WO_Year <- i\r\n  model_metrics <- model_metrics %>%\r\n    select(WO_Year, r.squared, adj.r.squared, p.value)\r\n  \r\n  return(model_metrics)\r\n  }\r\n\r\nmap2_dfr(wo_years, hdi_years, getModels)\r\n## # A tibble: 8 x 4\r\n##   WO_Year r.squared adj.r.squared p.value\r\n##     <dbl>     <dbl>         <dbl>   <dbl>\r\n## 1    1992    0.0585      -0.00425  0.350 \r\n## 2    1994    0.0554       0.00295  0.318 \r\n## 3    1998    0.0530       0.00991  0.279 \r\n## 4    2002    0.0908       0.0495   0.152 \r\n## 5    2006    0.148        0.112    0.0527\r\n## 6    2010    0.122        0.0853   0.0804\r\n## 7    2014    0.238        0.206    0.0115\r\n## 8    2018    0.195        0.166    0.0146\r\nThis is a surprise!\r\nLinear regressions show that the Human Development Index is increasingly significant to explain the number of medals won by each country during the Winter Olympics Games since 1992. However, we can observe that the HDI is only statistically significant to explain the number of medals in 2014 and 2018 (p-value < 0.05).\r\nDo all our models complete the assumptions of a linear regression?\r\ngetAssumptions <- function(i, j) {\r\n  \r\n  olympic <- dataset %>%\r\n    filter(WO_Year == i, HDI_Year == j) %>%\r\n    mutate(nMedals_log = log(nMedals))\r\n  \r\n  model <- lm(nMedals_log ~ HDI, data = olympic)\r\n  gvmodel <- gvlma(model)\r\n  gvmodel <- summary(gvmodel)\r\n  \r\n  return(gvmodel)\r\n  }\r\n\r\nmodel_assumptions <- map2_df(wo_years, hdi_years, getAssumptions)\r\n\r\nmodel_assumptions %>%\r\n  count(Decision)\r\n## # A tibble: 1 x 2\r\n##   Decision                    n\r\n##   <chr>                   <int>\r\n## 1 Assumptions acceptable.    40\r\nAll our models have acceptable assumptions for running linear regressions.\r\nHowever, maybe countries having won less than 3 medals have often a HDI lower than 0.86? It is therefore time to try a binary logistic regression.\r\nLogistic regression\r\nOur previous model didn’t take into account the countries which haven’t won any medals. This is a bias we need to study now.\r\nLet’s scrape all the countries which participated to the Winter Olympics since 1992.\r\nurl_wiki2 <- \"https://en.wikipedia.org/w/index.php?title=List_of_participating_nations_at_the_Winter_Olympic_Games&oldid=827837541\"\r\n\r\nnoc_all <- url_wiki2 %>%\r\n    read_html() %>%\r\n    html_node(\".wikitable\") %>%\r\n    html_table(fill = TRUE)\r\n\r\nnoc_all2 <- noc_all %>%\r\n  select(Country = A, \"92\", \"94\", \"98\", \"02\", \"06\", \"10\", \"14\", \"18\") %>%\r\n  gather(\"WO_Year\", \"Value\", 2:9) %>%\r\n  mutate(Value = recode(Value, \r\n                        \"•\" = \"1\", \r\n                        \"EUN\" = \"1\", # Unified Team of 1992\r\n                        \"H\" = \"1\", # Host country\r\n                        \"OAR\" = \"1\")) # Olympic Athletes from Russia\r\n\r\nnoc_all2$Value[noc_all2$Value == \"\"] <- 0\r\nnoc_all2$Value <- as.numeric(noc_all2$Value) # Make NA Value which aren't 0 or 1\r\n\r\nrow_az <- which(nchar(noc_all2$Country) == 1) # get alphabetical order row\r\nnoc_all2$Country[row_az] <- NA # make alphabetical order row NA\r\nnoc_all2 <- drop_na(noc_all2, Country) # remove alphabetical order row\r\n\r\n# Additional cleaning\r\nnoc_all2$Country <- noc_all2$Country %>%\r\n  gsub(\"\\\\[|\\\\^]|\\\\›]\", \"\", .) %>%\r\n  stringr::str_trim()\r\nnoc_part <- noc_all2 %>% filter(Value == 1)\r\n\r\nnoc_part %>% filter(WO_Year == 18)\r\n## # A tibble: 94 x 3\r\n##       Country WO_Year Value\r\n##         <chr>   <chr> <dbl>\r\n##  1    Albania      18     1\r\n##  2    Andorra      18     1\r\n##  3  Argentina      18     1\r\n##  4    Armenia      18     1\r\n##  5  Australia      18     1\r\n##  6    Austria      18     1\r\n##  7 Azerbaijan      18     1\r\n##  8    Belarus      18     1\r\n##  9    Belgium      18     1\r\n## 10    Bermuda      18     1\r\n## # ... with 84 more rows\r\nFor which countries can we find missing values?\r\nna_rows2 <- which(is.na(noc_all2$Value))\r\nnoc_all2$Country[na_rows2]\r\n##  [1] \"Bosnia and Herzegovina\"   \"Czech Republic\"          \r\n##  [3] \"Kosovo\"                   \"Montenegro\"              \r\n##  [5] \"Serbia\"                   \"Serbia and MontenegroSCG\"\r\n##  [7] \"Slovakia\"                 \"Kosovo\"                  \r\n##  [9] \"Montenegro\"               \"Serbia\"                  \r\n## [11] \"Kosovo\"                   \"Montenegro\"              \r\n## [13] \"Serbia\"                   \"Costa Rica\"              \r\n## [15] \"Kosovo\"                   \"Montenegro\"              \r\n## [17] \"Serbia\"                   \"Kosovo\"                  \r\n## [19] \"Montenegro\"               \"Serbia\"                  \r\n## [21] \"Virgin Islands\"           \"Kosovo\"                  \r\n## [23] \"India\"                    \"Kosovo\"\r\nMakes sense!\r\nWe will now build a logistic regression. In other words, we will model the probability that a country has won more than 3 medals during the 2018 Winter Olympics Games according to its HDI.\r\nnoc_hdi_2018 <- noc_part %>%\r\n  full_join(hdi_tidy, by = \"Country\") %>%\r\n  filter(Value == 1) %>%\r\n  filter(WO_Year == 18) %>%\r\n  filter(HDI_Year %in% c(2015, NA))\r\n\r\n# Which countries don't have a HDI ?\r\nnoc_hdi_2018 %>% filter(HDI_Year %in% NA)\r\n## # A tibble: 13 x 5\r\n##                         Country WO_Year Value HDI_Year   HDI\r\n##                           <chr>   <chr> <dbl>    <dbl> <dbl>\r\n##  1                      Bermuda      18     1       NA    NA\r\n##  2                      Bolivia      18     1       NA    NA\r\n##  3            Chinese TaipeiTPE      18     1       NA    NA\r\n##  4                    Hong Kong      18     1       NA    NA\r\n##  5                         Iran      18     1       NA    NA\r\n##  6                        Korea      18     1       NA    NA\r\n##  7                  North Korea      18     1       NA    NA\r\n##  8                       Kosovo      18     1       NA    NA\r\n##  9                    Macedonia      18     1       NA    NA\r\n## 10                      Moldova      18     1       NA    NA\r\n## 11                  Puerto Rico      18     1       NA    NA\r\n## 12 Olympic Athletes from Russia      18     1       NA    NA\r\n## 13                   East Timor      18     1       NA    NA\r\nwo_2018$Binary <- wo_2018$nMedals > 3 # more than 3 medals\r\n\r\ndataset2 <- noc_hdi_2018 %>%\r\n  full_join(wo_2018, by = c(\"Country\", \"HDI\")) %>%\r\n  select(Country, HDI, nMedals, Binary)\r\n\r\n# Missing value means no medals\r\ndataset2$nMedals[is.na(dataset2$nMedals)] <- 0\r\ndataset2$Binary[is.na(dataset2$Binary)] <- FALSE\r\ndataset2$Binary <- dataset2$Binary*1 # from logical to numeric \r\n\r\nmodel_2 <- glm(Binary ~ HDI, data = dataset2, family = \"binomial\")\r\nglance(model_2)\r\n##   null.deviance df.null    logLik      AIC      BIC deviance df.residual\r\n## 1      82.27884      78 -29.70839 63.41678 68.15568 59.41678          77\r\n# Pseudo R-squareds for logistic regression\r\nlibrary(pscl)\r\npR2(model_2)\r\n##         llh     llhNull          G2    McFadden        r2ML        r2CU \r\n## -29.7083908 -44.4320652  29.4473488   0.3313750   0.3111634   0.4607761\r\nggplot(dataset2, aes(HDI, Binary, label = Country)) +\r\n  geom_point() +\r\n  geom_smooth(method = \"glm\", method.args = list(family = \"binomial\"),\r\n              se = FALSE, color = \"brown1\") +\r\n  annotate(\"text\", x = 0.88, y = 0.78, size = 3, label = \"McFadden's pseudo R-squared = 0.33\") +\r\n  theme_economist_white() +\r\n  theme(plot.background = element_rect(fill = \"#f8f2e4\")) +\r\n  labs(title = \"Do the Rich Countries Always Win?\",\r\n       subtitle = \"Wining more than 3 medals vs. Human Development Index, 2018 Winter Olympics\",\r\n       x = \"Human Development Index\",\r\n       y = \"Probability of wining more than 3 medals\",\r\n       caption = \"Félix Luginbühl (@lgnbhl)\\n Data source: Wikipedia\")\r\n\r\nIn our visualization, we can notice once again the two countries, i.e. China and Russia, which are classified as 1 (won more than 3 medals) while having a HDI higher than 0.87. Our binary classification reveals that some countries with a HDI higher than 0.87 have won less than 4 medals. Which are they?\r\ndataset2 %>% \r\n  filter(Binary == 0, HDI > 0.87) %>%\r\n  arrange(desc(HDI))\r\n## # A tibble: 12 x 4\r\n##          Country      HDI nMedals Binary\r\n##            <chr>    <dbl>   <dbl>  <dbl>\r\n##  1     Australia 0.938680       3      0\r\n##  2     Singapore 0.924866       0      0\r\n##  3       Denmark 0.924649       0      0\r\n##  4       Ireland 0.922746       0      0\r\n##  5       Iceland 0.921110       0      0\r\n##  6   New Zealand 0.914900       2      0\r\n##  7 Liechtenstein 0.911517       1      0\r\n##  8        Israel 0.898886       0      0\r\n##  9    Luxembourg 0.898465       0      0\r\n## 10       Belgium 0.895514       1      0\r\n## 11      Slovenia 0.890303       2      0\r\n## 12         Spain 0.884153       2      0\r\nThese twelve countries call for other predictors in order to improve our models. This won’t be done here as it goes beyond our initial questions.\r\nConclusion\r\nOur first model (a simple linear regression) showed that China and Russia are the only two countries with a Human Development Index (HDI) smaller than 0.87 which have won more than 3 medals during the 2018 Winter Olympics Games.\r\nThen we built linear regressions for each Winter Olympics Games since 1992 and saw that the HDI is increasingly significant.\r\nLastly, our logistic regression revealed that twelve countries with a HDI higher than 0.87 have won less than 4 medals and called for the use of new predictors.\r\n\r\nThanks for reading!\r\n\r\nFor updates of recent blog posts, follow me on Twitter.\r\nFor reproducing my data analysis, go on my Github repo or my RStudio server.\r\nCurious about what I can do for your organisation? Have a look my services.\r\n\r\n\r\n\r\n",
    "preview": "posts/2018-03-13-olympics/img/chart_olympics_table.png",
    "last_modified": "2020-12-04T23:19:04+01:00",
    "input_file": {},
    "preview_width": 672,
    "preview_height": 480
  },
  {
    "path": "posts/2018-01-26-network/",
    "title": "Which Marvel Characters and Movies are the Most Central?",
    "description": "To begin this year, I was looking for a quick project related to social network visualization. In this blog post, we will find out which characters and movies are the most central in the Marvel cinematic universe.",
    "author": [],
    "date": "2018-01-26",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nScraping Marvel superheros\r\nReproducing the wikitable with a heatmap\r\nCentrality metrics\r\nPlotting the network\r\nAn interactive visualization of the Marvel Universe Network\r\n\r\nAs R analyses on Game of Thrones, Star Wars or The Lord of The Rings have already been done, I decided to visualize the superhero network of the nowadays very popular Marvel movies saga.\r\nScraping Marvel superheros\r\nAs often, the data can be found on Wikipedia. But surprisingly, the data needed was not avaiable in a English article, but within this French article.\r\n\r\nLet’s scrape this wikitable with the rvest package.\r\nlibrary(tidyverse)\r\nlibrary(rvest)\r\n# permanente link for reproductibility\r\nurl <- \"https://fr.wikipedia.org/w/index.php?title=Liste_des_films_de_l%27univers_cin%C3%A9matographique_Marvel&oldid=144793972#Personnages\"\r\n\r\nmarvel_df <- url %>%\r\n  read_html() %>%\r\n  html_nodes(\".wikitable\") %>%\r\n  html_table(fill = TRUE) %>%\r\n  .[[5]]\r\nNow that we have the data, we need to clean it as well as translate some names in English. We also have to distinguish the movie names from the characters.\r\nmarvel_df[1,1] <- \"Iron Man 1\"\r\nmarvel_df[2,1] <- \"The Incredible Hulk\"\r\nmarvel_df[4,1] <- \"Thor 1\"\r\nmarvel_df[8,1] <- \"Thor: The Dark World\"\r\nmarvel_df[9,1] <- \"Captain America 2\"\r\nmarvel_df[10,1] <- \"Guardians of the Galaxy\"\r\nmarvel_df[11,1] <- \"Avengers: Age of Ultron\"\r\nmarvel_df[12,1] <- \"Ant-Man 1\"\r\nmarvel_df[14,1] <- \"Doctor Strange 1\"\r\nmarvel_df[15,1] <- \"Guardians of the Galaxy Vol. 2\"\r\nmarvel_df[18,1] <- \"Black Panther 1\"\r\nmarvel_df[20,1] <- \"Ant-Man and the Wasp\"\r\nmarvel_df[21,1] <- \"Captain Marvel 1\"\r\n\r\nmarvel_df <- marvel_df %>%\r\n  rename(\"Black Widow\" = \"Veuve noire\",\r\n         \"Hawkeye\" = \"Œil de Faucon\",\r\n         \"Scarlet Witch\" = \"Sorcière rouge\") %>%\r\n  mutate(Film = factor(Film, levels = unique(Film))) %>%\r\n  mutate_all(funs(str_replace_all(., c(\"Oui\" = \"1\", \"^$\" = \"0\")))) #^$ is for empty string\r\nReproducing the wikitable with a heatmap\r\nLet’s tidy the data in order to reproduce the Wikipedia table with ggplot2. Note that the characters and movies are in a different order.\r\nmarvel_tidy <- marvel_df %>%\r\n  reshape2::melt(id.vars = \"Film\", value.name = \"Value\") %>%\r\n  rename(\"Character\" = \"variable\")\r\n\r\nggplot(marvel_tidy, aes(x = Character, y = Film)) +\r\n  geom_tile(aes(fill = Value)) + \r\n  scale_fill_manual(values=c(\"0\"=\"grey\", \"1\"=\"lightgreen\"),\r\n                    name=\"\", labels=c(\"Out\",\"In\")) + \r\n  theme_minimal() +\r\n  theme(plot.title = element_text(face = \"bold\", hjust = 0.5),\r\n        plot.caption = element_text(colour = \"dimgrey\"),\r\n        axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +\r\n  labs(title = \"Characters appearance in the Marvel Movies\",\r\n       caption = \"Félix Luginbühl (@lgnbhl)\\nData source: Wikipedia\")\r\n\r\nCentrality metrics\r\nIn order to know which characters and movies are the most central, we can use indicators like the degree (number of ties) and the closeness (centrality based on distance to others in the graph).\r\nlibrary(tidygraph)\r\n\r\nmarvel_graph <- marvel_tidy %>%\r\n  filter(Value != \"0\") %>%\r\n  select(-Value) %>%\r\n  as_tbl_graph(directed = FALSE) %>%\r\n  mutate(degree = centrality_degree(),\r\n         closeness = centrality_closeness(),\r\n         betweenness = centrality_betweenness()) %>%\r\n  #create type variable\r\n  full_join(tibble(film = marvel_df$Film, type = \"Movie\"), by = c(\"name\" = \"film\")) %>%\r\n  mutate(type = replace_na(type, \"Character\"))\r\n\r\nmarvel_graph %>% \r\n  activate(nodes) %>% \r\n  as_tibble() %>%\r\n  arrange(desc(degree))\r\n## # A tibble: 36 x 5\r\n##    name                       degree closeness betweenness type     \r\n##    <chr>                       <dbl>     <dbl>       <dbl> <chr>    \r\n##  1 Avengers: Infinity War        14.    0.0161       237.  Movie    \r\n##  2 Captain America: Civil War    10.    0.0128        57.8 Movie    \r\n##  3 Avengers: Age of Ultron        9.    0.0135        61.6 Movie    \r\n##  4 Iron Man                       9.    0.0135        89.2 Character\r\n##  5 Captain America                9.    0.0135        69.3 Character\r\n##  6 Nick Fury                      8.    0.0111        94.0 Character\r\n##  7 Avengers                       7.    0.0128        40.7 Movie    \r\n##  8 Ant-Man                        7.    0.0123        35.3 Movie    \r\n##  9 Thor                           7.    0.0128        62.2 Character\r\n## 10 Hulk                           6.    0.0125        40.1 Character\r\n## # ... with 26 more rows\r\nThe central characters are Iron Man and Captain America (ex aequo), followed by Nick Fury, Thor and Hulk. The central movies are the two Avengers movies and as well as Captain America: Civil War (2016).\r\nWho is the most distant character from Iron Man?\r\nmarvel_graph %>%\r\n  mutate(distance = bfs_dist(name == \"Iron Man\", mode = \"all\")) %>%\r\n  filter(type == \"Character\") %>%\r\n  select(name, distance) %>%\r\n  arrange(desc(distance))\r\n## # A tbl_graph: 15 nodes and 0 edges\r\n## #\r\n## # An undirected simple graph with 15 components\r\n## #\r\n## # Node Data: 15 x 2 (active)\r\n##   name            distance\r\n##   <chr>              <int>\r\n## 1 Captain Marvel         4\r\n## 2 Captain America        2\r\n## 3 Nick Fury              2\r\n## 4 Thor                   2\r\n## 5 Hulk                   2\r\n## 6 Black Widow            2\r\n## # ... with 9 more rows\r\n## #\r\n## # Edge Data: 0 x 2\r\n## # ... with 2 variables: from <int>, to <int>\r\nCaptain Marvel is the most distant character. However, as the movie introducing Captain Marvel will only be released in 2019, other Marvel characters could be added to the movie (and therefore reducing the distance from Iron Man).\r\nPlotting the network\r\nNow let’s visualize the centrality degree of the movies and characters using {ggraph}.\r\nlibrary(ggraph)\r\nset.seed(100)\r\n\r\nggraph(marvel_graph, layout = \"nicely\") + \r\n  geom_edge_diagonal(alpha = 0.2) + \r\n  geom_node_point(aes(size = degree, color = as.factor(type)), alpha = 0.8) + \r\n  scale_color_brewer(palette = \"Set1\", name = \"Type\") +\r\n  geom_node_text(aes(label = name), size = 2.5, repel = TRUE) +\r\n  theme_graph() +\r\n  theme(plot.background = element_rect(fill = \"#f8f2e4\")) +\r\n  labs(title = \"Centrality in the Marvel Cinematic Universe\",\r\n       size = \"Degree\",\r\n       caption = \"Félix Luginbühl (@lgnbhl)\\n Data source: Wikipedia\")\r\n\r\nNow let’s try some clustering, with the Walktrap algorithm.\r\nset.seed(100)\r\n\r\nmarvel_graph %>%\r\n  activate(nodes) %>%\r\n  mutate(group_walktrap = group_walktrap()) %>%\r\n  ggraph(layout = \"nicely\") + \r\n  geom_edge_diagonal(alpha = 0.2) + \r\n  geom_node_point(aes(color = as.factor(group_walktrap), shape = as.factor(type))) + \r\n  geom_node_text(aes(label = name), size = 2.5, alpha = 0.8, repel = TRUE) +\r\n  scale_color_brewer(palette = \"Set1\", name = \"Walktrap Group\") +\r\n  theme_graph() +\r\n  theme(plot.background = element_rect(fill = \"#f8f2e4\")) +\r\n  labs(title = \"Clustering the Marvel Cinematic Universe\",\r\n       shape = \"Type\",\r\n       caption = \"Félix Luginbühl (@lgnbhl)\\n Data source: Wikipedia\")\r\n\r\nThe walktrap algorithm is doing a good job, as the characters and the movies seem correctly grouped.\r\nAn interactive visualization of the Marvel Universe Network\r\nMaking an interactive network with {visNetwork} is quite easy. Just play with the interactive network below.\r\nlibrary(visNetwork)\r\n\r\ndataVis <- marvel_graph %>%\r\n  mutate(group = type) %>%\r\n  toVisNetworkData()\r\n\r\nvisNetwork(nodes = dataVis$nodes, edges = dataVis$edges, width = \"100%\",\r\n           main = \"Social Network of the Marvel Cinematic Universe\") %>%\r\n  visLayout(randomSeed = 100) %>%\r\n  addFontAwesome() %>%\r\n  visGroups(groupname = \"Movie\", shape = \"icon\",\r\n            icon = list(code = \"f008\", color = \"darkblue\")) %>%\r\n  visGroups(groupname = \"Character\", shape = \"icon\",\r\n            icon = list(code = \"f007\", color = \"red\")) %>%\r\n  visOptions(highlightNearest = list(enabled = T, hover = T), nodesIdSelection = T) %>%\r\n  visInteraction(navigationButtons = TRUE)\r\n\r\n\r\n\r\n\r\n\r\nThanks for reading!\r\n\r\nFor updates of recent blog posts, follow me on Twitter.\r\nFor reproducing my data analysis, go on my Github repo or my RStudio server.\r\nCurious about what I can do for your organisation? Have a look my services.\r\n\r\n\r\n\r\n",
    "preview": "posts/2018-01-26-network/img/chart_MarvelNetwork_2.png",
    "last_modified": "2020-12-04T23:26:00+01:00",
    "input_file": {},
    "preview_width": 672,
    "preview_height": 480
  },
  {
    "path": "posts/2017-12-11-movies/",
    "title": "The Lack of Female Protagonists in Children’s Movies",
    "description": "Some time ago, I read a very interesting post from Giora Simchoni who used machine learning to estimate how many children's books have a central female character. Based on a Goodread list, he showed that for every book with a central female character, there are between 1.1 and 1.3 books written with a male protagonist. I couldn't help thinking that his analysis should be replicated on children's movies.",
    "author": [],
    "date": "2017-12-11",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nScraping 100 years of Children’s Movies\r\nMimicking Giora’s Code\r\nPreparing the Machine\r\nMachine Learning with {xgboost}\r\nTwo different answers\r\nFIN\r\n\r\nSo that’s what we will do in this blog post, using this Wikipedia article that listed 100 years of children’s movies. We will see that reusing someone else code cannot be done without adapting it to the specific features of our own dataset. It’s why, in addition to the multiclass classification made by Giora, we will perform a binary logistic classification. Finally, we will visualize the predictions of our models in order to know if the central character gender ratio is changing over the years1.\r\nSince we will reuse most of Giora’s code, you really should read his post first. You read it? Good, let’s move one!\r\nScraping 100 years of Children’s Movies\r\nLet’s begin by scraping all the children’s movies links of our Wikipedia article using {rvest}.\r\nlibrary(tidyverse)\r\nlibrary(rvest)\r\n\r\n# Permanent link for reproducibility\r\nbaseUrl <- \"https://en.wikipedia.org/w/index.php?title=List_of_children%27s_films&oldid=810426354\"\r\n\r\nurls <- baseUrl %>%\r\n  read_html() %>%\r\n  html_nodes(\"a\") %>%\r\n  html_attr(\"href\") %>%\r\n  keep(startsWith(., \"/wiki/\")) %>%\r\n  discard(str_detect(., \"Children%27s_film\")) %>%\r\n  discard(startsWith(., \"/wiki/Wikipedia:\")) %>%\r\n  discard(startsWith(., \"/wiki/User\")) %>%\r\n  discard(startsWith(., \"/wiki/Help:\")) %>%\r\n  discard(startsWith(., \"/wiki/Talk:\")) %>%\r\n  discard(startsWith(., \"/wiki/Special:\")) %>%\r\n  discard(startsWith(., \"/wiki/Portal:\")) %>%\r\n  discard(startsWith(., \"/wiki/Category:\")) %>%\r\n  discard(startsWith(., \"/wiki/List_of_\")) %>%\r\n  .[-c(1698:1725)] # remove infobox links\r\n\r\nas_tibble(urls)\r\n## # A tibble: 1,697 x 1\r\n##                                    value\r\n##                                    <chr>\r\n##  1       /wiki/The_Blue_Bird_(1918_film)\r\n##  2           /wiki/Pollyanna_(1920_film)\r\n##  3           /wiki/Peter_Pan_(1924_film)\r\n##  4    /wiki/A_Kiss_for_Cinderella_(film)\r\n##  5        /wiki/Wizard_of_Oz_(1925_film)\r\n##  6 /wiki/The_Adventures_of_Prince_Achmed\r\n##  7 /wiki/Alice_in_Wonderland_(1933_film)\r\n##  8    /wiki/Babes_in_Toyland_(1934_film)\r\n##  9                /wiki/Curly_Top_(film)\r\n## 10                /wiki/The_New_Gulliver\r\n## # ... with 1,687 more rows\r\nWe almost got 1700 wikilinks!\r\nNow, we want to scrape specific data from each link. To do that, we will write a function that reads a link of the urls vector and returns a list of 7 components, i.e. title, years, actors, directors, country, language and description.\r\nClick on ‘Show code’ to see this looong function.\r\nShow code\r\nmoviesData <- function(urls) {\r\n  \r\n  html <- tryCatch(read_html(str_c(\"https://en.wikipedia.org\", urls)),\r\n                   error = function(e) NULL)\r\n  \r\n  infobox <- tryCatch(\r\n    html %>%\r\n      html_node(\".infobox\") %>%\r\n      html_children() %>%\r\n      html_text(),\r\n    error = function(e) NA\r\n  )\r\n  \r\n  title <- tryCatch(\r\n    html %>%\r\n      html_nodes(\".summary\") %>%\r\n      html_text() %>%\r\n      first(), # avoid title duplication\r\n    error = function(e) NA\r\n  )\r\n  \r\n  year <- tryCatch(\r\n    html %>%\r\n      html_nodes(\".published\") %>%\r\n      html_text() %>%\r\n      str_extract(\"[0-9]{4}\") %>%\r\n      unique() %>%\r\n      first() %>% # avoid title duplication\r\n      as.numeric(),\r\n    error = function(e) NA\r\n  )\r\n  \r\n  if(is.na(year)) {\r\n    infoboxRow <- infobox %>%\r\n      str_detect(\"Release\") %>%\r\n      which()\r\n    \r\n    year <- infobox[[infoboxRow[1]]] %>%\r\n      str_extract(\"[0-9]{4}\") %>%\r\n      unique() %>%\r\n      first() %>%\r\n      as.numeric()\r\n  }\r\n  \r\n  getActors <- function() {\r\n    infoboxRow <- infobox %>%\r\n      str_detect(\"Starring\") %>%\r\n      which()\r\n    actorsNames <- infobox[[infoboxRow[1]]] %>%\r\n      gsub(\"^Starring\", \"\", .) %>%\r\n      gsub(\"\\n\", \"\", .) %>%\r\n      gsub(\"([a-z])([A-Z])\", \"\\\\1 \\\\2\", .)\r\n  }\r\n  \r\n  actors <- tryCatch(\r\n    getActors(),\r\n    error = function(e) NA\r\n  )\r\n  \r\n  if(identical(actors, \"see below\") | \r\n     identical(actors, \"See below\") | \r\n     identical(actors, \"See voices\")) {\r\n    actors <- NA\r\n  }\r\n  \r\n  getDirectors <- function() {\r\n    infoboxRow <- infobox %>%\r\n      str_detect(\"Directed by\") %>%\r\n      which()\r\n    directorNames <- infobox[[infoboxRow[1]]] %>%\r\n      gsub(\"Directed by\", \"\", .) %>%\r\n      gsub(\"\\n\", \"\", .) %>%\r\n      gsub(\"([a-z])([A-Z])\", \"\\\\1 \\\\2\", .) %>%\r\n      unlist()\r\n  }\r\n  \r\n  directors <- tryCatch(\r\n    getDirectors(),\r\n    error = function(e) NA\r\n  )\r\n  \r\n  getCountry <- function() {\r\n    infoboxRow <- infobox %>%\r\n      str_detect(\"Country\") %>%\r\n      which()\r\n    countryNames <- infobox[[infoboxRow[1]]] %>%\r\n      gsub(\"Country\", \"\", .) %>%\r\n      gsub(\"\\n\", \"\", .) %>%\r\n      gsub(\"([a-z])([A-Z])\", \"\\\\1 \\\\2\", .)\r\n  }\r\n  \r\n  country <- tryCatch(\r\n    getCountry(),\r\n    error = function(e) NA\r\n  )\r\n  \r\n  getLanguage <- function() {\r\n    infoboxRow <- infobox %>%\r\n      str_detect(\"Language\") %>%\r\n      which()\r\n    movieLangage <- infobox[[infoboxRow[1]]] %>%\r\n      gsub(\"Language\", \"\", .) %>%\r\n      gsub(\"\\n\", \"\", .) %>%\r\n      gsub(\"([a-z])([A-Z])\", \"\\\\1 \\\\2\", .) %>%\r\n      unlist()\r\n  }\r\n  \r\n  language <- tryCatch(\r\n    getLanguage(),\r\n    error = function(e) NA\r\n  )\r\n  \r\n  article <- tryCatch(\r\n    html %>%\r\n      html_nodes(\".mw-body\") %>%\r\n      html_text() %>%\r\n      str_split(\"\\n\") %>%\r\n      unlist() %>%\r\n      gsub(\"\\t\", \"\", .),\r\n    error = function(e) NA\r\n  )\r\n  \r\n  article <- tryCatch(\r\n    article <- article[article != \"\"], # remove empty lines\r\n    error = function(e) NA\r\n  )\r\n  \r\n  getDescription <- function() {\r\n    descriptionRow <<- article %>%\r\n      str_detect(\"^Plot\") %>%\r\n      which() %>%\r\n      sum(+1) # row number after plot title\r\n    movieDescription <<- article[[descriptionRow[1]]] %>%\r\n      gsub(\"Language\", \"\", .) %>%\r\n      gsub(\"\\n\", \"\", .) %>%\r\n      gsub(\"([a-z])([A-Z])\", \"\\\\1 \\\\2\", .) %>%\r\n      unlist()\r\n  }\r\n  \r\n  description <- tryCatch(\r\n    getDescription(),\r\n    error = function(e) NA\r\n  )\r\n  \r\n  # Remove Wikipedia warning about the plot\r\n  if(startsWith(description, \"This article\") | \r\n     startsWith(description, \"This section\") | \r\n     startsWith(description, \"This film's plot summary\")) {\r\n    descriptionRow <- sum(descriptionRow + 1)\r\n    description <- article[[descriptionRow[1]]]\r\n  }\r\n  \r\n  # if the description has less than 70 characters, skipping the row\r\n  if(nchar(description) < 70) {\r\n    descriptionRow <- sum(descriptionRow + 1) # skip to next row\r\n    description <- article[[descriptionRow[1]]]\r\n  }\r\n  \r\n  # Skipping row another time, just to be sure\r\n  if(nchar(description) < 70) {\r\n    descriptionRow <- sum(descriptionRow + 1) # skip to next row\r\n    description <- article[[descriptionRow[1]]]\r\n  }\r\n  \r\n  # if descriptionRow is before the 5th, it's not a plot\r\n  if(descriptionRow < 5) {\r\n    description <- NA\r\n  }\r\n  \r\n  return(list(\r\n    title = title,\r\n    year = year,\r\n    actors = actors,\r\n    directors = directors,\r\n    country = country,\r\n    language = language,\r\n    description = description\r\n  ))\r\n}\r\nAs you can see inside the function, we scraped the data from the Wikipedia body article and, when getting a missing value, we tried to get the data from its infobox (when existing). We used some “tricks” to avoid getting the warning messages or image description into the description variable.\r\nNote that the function takes only the first paragraph of the article plot section. This is not really a problem as it often describes the main character as he/she appears first or gives a general summary of the movie.\r\nOkay, let’s try our function on the first link.\r\nstr(moviesData(urls[1]))\r\n## List of 7\r\n##  $ title      : chr \"The Blue Bird\"\r\n##  $ year       : num 1918\r\n##  $ actors     : chr \"Tula Belle Robin Macdougall\"\r\n##  $ directors  : chr \"Maurice Tourneur\"\r\n##  $ country    : chr \"United States\"\r\n##  $ language   : chr \"Silent (English intertitles)\"\r\n##  $ description: chr \"When poor old widow Berlingot asks Tyltyl and Mytyl, the young son and daughter of her more prosperous neighbors, for the loan \"| __truncated__\r\nIn order to scrape the 1700 wikilinks and build a single dataset of 7 variables, we will use an elegant code written by Giora in another post of his blog.\r\nmovies <- tibble(\r\n  title = character(0),\r\n  year = integer(0),\r\n  actors = character(0),\r\n  directors = character(0),\r\n  country = character(0),\r\n  language = character(0),\r\n  description = character(0)\r\n  )\r\n\r\ngetMoviesData <- function(i) {\r\n  cat(i, \" \")\r\n  movie <- tryCatch(\r\n    read_html(str_c(\"https://en.wikipedia.org\", urls[i])) %>%\r\n      moviesData(),\r\n    error = function(e) NULL\r\n  )\r\n  movies <<- rbind.data.frame(movies, movie, stringsAsFactors = FALSE)\r\n}\r\n\r\nwalk(1:length(urls), getMoviesData)\r\n## 1  2  3  4  5  6  7  8  9  10  11  12  13  14  15  16  # etc.\r\nglimpse(movies)\r\n## Observations: 1,644\r\n## Variables: 7\r\n## $ title       <chr> \"The Blue Bird\", \"Pollyanna\", \"Peter Pan\", \"A Kiss...\r\n## $ year        <dbl> 1918, 1920, 1924, 1925, 1925, 1926, 1933, 1934, 19...\r\n## $ actors      <chr> \"Tula Belle Robin Macdougall\", \"Mary Pickford\", \"B...\r\n## $ directors   <chr> \"Maurice Tourneur\", \"Paul Powell\", \"Herbert Brenon...\r\n## $ country     <chr> \"United States\", \"United States\", \"United States\",...\r\n## $ language    <chr> \"Silent (English intertitles)\", \"Silent film Engli...\r\n## $ description <chr> \"When poor old widow Berlingot asks Tyltyl and Myt...\r\nNice! But how good our function performed?\r\nLet’s have a look on the pourcentage of missing values by variable.\r\n# movies <- read.csv(\"movies.csv\", stringsAsFactors = FALSE)\r\nround(100*colMeans(is.na(movies)), 2)\r\n##       title        year      actors   directors     country    language \r\n##        0.67        2.92        8.52        2.25        5.05       12.77 \r\n## description \r\n##       10.16\r\nAnd what about the NAs repartition into the dataset?\r\nlibrary(Amelia)\r\n\r\nmissmap(movies, main = paste0(\"Visualising missing data (n=\", nrow(movies),\")\"))\r\n\r\nWe will remove some missing values from our dataset. One hard choice is to take away all the NAs of the description variable, as we will lose 10% of our movies. However, we can think that a movie without a description of the plot probably isn’t that important or influental. And, above all, the accuracy of our predictive model will be greatly improved.\r\n# Removing some duplicated movies\r\nmovies <- movies[!duplicated(movies[,c(\"title\", \"year\")]),]\r\n# Removing NAs titles\r\nmovies <- movies[!is.na(movies$title),]\r\n# Removing NAs description\r\nmovies <- movies[!is.na(movies$description),]\r\n\r\ndim(movies)\r\n## [1] 1452    7\r\nWe now have a dataset of 1452 children’s movies.\r\nOn last thing before moving on. The Wikipedia article warns us that it “deals primarily with the United States and do not represent a worldwide view of the subject”. Let’s check that.\r\nmovies$country %>%\r\n  str_detect(\"United States|US\") %>%\r\n  sum(., na.rm = TRUE)\r\n## [1] 1115\r\nYes, 77 % of the children’s movies are US-related.\r\nMimicking Giora’s Code\r\nFollowing Giora’s post, we have to manually tag a sample of our children’s movies dataset according to the gender of the central character, where 0 is “Female”, 1 is “Male”, and 2 is “Other” (meaning it is hard to decide which gender is central). I did it for the first 140 movies, which represents 10% of the movies dataset2.\r\nclassFirst140 <- c(\r\n  0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, \r\n  0, 0, 1, 1, 1, 1, 1, 1, 2, 2, 0, 1, 1, 1, 0, 1, 1, 2, 1, 1, \r\n  1, 1, 2, 1, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, \r\n  2, 1, 1, 1, 0, 1, 1, 1, 1, 2, 0, 1, 1, 2, 1, 1, 1, 1, 0, 1, \r\n  1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 2, 1, 1, 1, 0, 1, 1, \r\n  1, 2, 1, 0, 0, 0, 1, 0, 0, 1, 2, 1, 2, 1, 1, 1, 1, 1, 1, 2, \r\n  0, 1, 2, 0, 1, 0, 1, 0, 0, 2, 2, 1, 2, 1, 1, 1, 1, 1, 1, 1\r\n)\r\nmovies$class <- c(classFirst140, rep(NA, nrow(movies) - 140))\r\nwrite.csv(movies, \"movies.csv\", row.names = FALSE)\r\n\r\npaste(\"Year of the last movie coded:\", movies$year[140])\r\n## [1] \"Year of the last movie coded: 1966\"\r\nJust as Giora, coding the first movies is problematic. Since it’s not a random sample, its representativity of the other movies is questionable. Is it even more the case in our study, as all the movies are old. The game here is code reproducibility. We will try to “compensate” that afterwards.\r\nWhat is the gender distribution of the first 140 movies according to my judgement?\r\nmovies %>%\r\n  select(class) %>%\r\n  count(class) %>%\r\n  mutate(total = sum(n), p = n / total)\r\n## # A tibble: 4 x 4\r\n##   class     n total          p\r\n##   <dbl> <int> <int>      <dbl>\r\n## 1     0    35  1452 0.02410468\r\n## 2     1    89  1452 0.06129477\r\n## 3     2    16  1452 0.01101928\r\n## 4    NA  1312  1452 0.90358127\r\nAs the “Other” class belongs both to the “Male” and “Female” classes, the ratio is (89 + 16)/(35 + 16) = 2.06. In other words, for every children’s movie with a female central character, two are centered around a male character.\r\nPreparing the Machine\r\nSince we want to make gender prediction, knowing if the first name of a character is “male” or “female” is informative. Giora scraped 1000 male and 1000 female names from the Babble website.\r\nboys <- \"https://www.babble.com/pregnancy/1000-most-popular-boy-names/\"\r\nboysNames <- read_html(boys) %>%\r\n  html_nodes(\"li\") %>%\r\n  html_text() %>%\r\n  .[22:1021]\r\n\r\ngirls <- \"https://www.babble.com/pregnancy/1000-most-popular-girl-names/\"\r\ngirlsNames <- read_html(girls) %>%\r\n  html_nodes(\"li\") %>%\r\n  html_text() %>%\r\n  .[22:1021]\r\n\r\nboysGirlsNames <- data.frame(cbind(boysNames, girlsNames))\r\nGiora used boy and girl names in order to know if the author and the title contains a “Male” or “Female” name. For our case study, it can be done for the directors and actors names. Potential predicators for the “Other” class are features like a title containing the word “the” or a high level of plural words.\r\nlibrary(magrittr)\r\n\r\ngetNBoysGirlsNames <- function(s, boys, firstToken) {\r\n  namesPattern <- if (boys) {\r\n    str_c(boysGirlsNames$boysNames, collapse = \"\\\\b|\\\\b\")\r\n  } else {\r\n    str_c(boysGirlsNames$girlsNames, collapse = \"\\\\b|\\\\b\")\r\n  }\r\n  s2 <- if (firstToken) {\r\n    str_split(s, \" \")[[1]][1]\r\n  } else {\r\n    s\r\n  }\r\n  str_count(s2, namesPattern)\r\n}\r\n\r\ngetNPluralWords <- function(s) {\r\n  sum(str_detect(str_split(s, \" \")[[1]], \"[A-Za-z]+s$\"))\r\n}\r\n\r\nisStringStartsWithThe <- function(s) {\r\n  as.numeric(startsWith(s, \"The\"))\r\n}\r\n\r\nmovies <- movies %>%\r\n  mutate(i_nBoysInBookDesc = map_dbl(description, getNBoysGirlsNames, TRUE, FALSE),\r\n         i_nGirlsInBookDesc = map_dbl(description, getNBoysGirlsNames, FALSE, FALSE),\r\n         i_nBoysInBookTitle = map_dbl(title, getNBoysGirlsNames, TRUE, FALSE),\r\n         i_nGirlsInBookTitle = map_dbl(title, getNBoysGirlsNames, FALSE, FALSE),\r\n         i_gapBoysGirlsBookDesc = i_nBoysInBookDesc - i_nGirlsInBookDesc,\r\n         i_gapBoysGirlsTitle = i_nBoysInBookTitle - i_nGirlsInBookTitle,\r\n         i_lengthTitle = map_dbl(title, nchar),\r\n         i_lengthBookDesc = map_dbl(description, nchar),\r\n         i_nPluralWordsInBookTitle = map_dbl(title, getNPluralWords),\r\n         i_titleStartsWithThe = map_dbl(title, isStringStartsWithThe))\r\nFor our case study, other predictors can be built. Since the central character is often listed first in the Wikipedia articles, let’s see if the first name is a boy or a girl name. We can also sum up the gender-related pronoms of the movie description in variables.\r\nIs the first name of the first actor listed “male” or “female”?\r\nIs the first name of the first director listed “male” or “female”?\r\nHow many “he” and “him” in the description?\r\nHow many “she” and “her” in the description?\r\nHow many “they” and “them” in the description?\r\nmovies$actorFirstName <- movies$actors %>%\r\n  sub(\" .*\", \"\",.)\r\n\r\nmovies$directorFirstName <- movies$directors %>%\r\n  sub(\" .*\", \"\",.)\r\n\r\ngetNHeHim <- function(s) {\r\n  nHe <- sum(str_detect(str_split(s, \" \")[[1]], \"\\\\bhe\\\\b\"))\r\n  nHim <- sum(str_detect(str_split(s, \" \")[[1]], \"\\\\bhim\\\\b\"))\r\n  nHeHim <- nHe + nHim\r\n}\r\n\r\ngetNSheHer <- function(s) {\r\n  nShe <- sum(str_detect(str_split(s, \" \")[[1]], \"\\\\bshe\\\\b\"))\r\n  nHer <- sum(str_detect(str_split(s, \" \")[[1]], \"\\\\bher\\\\b\"))\r\n  nSheHer <- nShe + nHer\r\n}\r\n\r\ngetNTheyTheir <- function(s) {\r\n  nThey <- sum(str_detect(str_split(s, \" \")[[1]], \"\\\\bthey\\\\b\"))\r\n  nTheir <- sum(str_detect(str_split(s, \" \")[[1]], \"\\\\btheir\\\\b\"))\r\n  nTheyTheir <- nThey + nTheir\r\n}\r\n\r\nmovies <- movies %>%\r\n  mutate(i_BoyActorFirstName = map_dbl(actors, getNBoysGirlsNames, TRUE, TRUE),\r\n         i_GirlActorFirstName = map_dbl(actors, getNBoysGirlsNames, FALSE, TRUE),\r\n         i_BoyDirectorFirstName = map_dbl(directors, getNBoysGirlsNames, TRUE, TRUE),\r\n         i_GirlDirectorFirstName = map_dbl(directors, getNBoysGirlsNames, FALSE, TRUE),\r\n         i_NHeHis = map_dbl(description, getNHeHim),\r\n         i_NSheHer = map_dbl(description, getNSheHer),\r\n         i_NTheyTheir = map_dbl(description, getNTheyTheir))\r\n\r\nmovies %<>% filter(nchar(description) > 100)\r\nLike Giora, we can create a type variable in preparation of the machine learning stage, by splitting the dataset in three categories (i.e. “train”, “test”, and “other”).\r\nnTagged <- sum(table(movies$class))\r\ntrainFrac <- 0.8 # Giora used 0.9\r\nset.seed(2) # added for reproducibility \r\ntrainSample <- sample(nTagged, floor(nTagged * trainFrac))\r\nmovies %<>%\r\n  mutate(id = row_number(),\r\n         type = ifelse(row_number() %in% trainSample, \"train\",\r\n                       ifelse(row_number() %in% 1:nTagged, \"test\", \"other\")))\r\nLastly, it is time to work on the description variable.\r\nlibrary(tidytext)\r\n\r\ndataForModeling <- movies %>%\r\n  unnest_tokens(word, description, drop = FALSE) %>%\r\n  count(id, word, sort = TRUE) %>% \r\n  #don't anti_join stop_words because 'her' and 'him' are there!\r\n  cast_dtm(id, word, n, weighting = tm::weightTf) %>%\r\n  tm::removeSparseTerms(0.997) %>% # from 0.999\r\n  as.matrix() %>%\r\n  as.data.frame() %>%\r\n  rownames_to_column(\"id\") %>%\r\n  mutate(id = as.numeric(id)) %>%\r\n  rename(class1 = class, type1 = type) %>%\r\n  inner_join(movies %>%\r\n               select(id, starts_with(\"i_\"), class, type), \"id\")\r\n\r\nnonWordColIdx <- c(1, which(str_detect(colnames(dataForModeling), \"i_\")),\r\n                   ncol(dataForModeling) - 1,\r\n                   ncol(dataForModeling))\r\nbkDescWords <- colnames(dataForModeling)[-nonWordColIdx]\r\ncolnames(dataForModeling)[-nonWordColIdx] <- str_c(\"word\", 1:length(bkDescWords))\r\n\r\ndim(dataForModeling)\r\n## [1] 1437 3417\r\nAs you saw, the description variable has been tokenized and transformed in a sparse document-term Matrix that keeps only the tokens appearing in at least 4 different movie descriptions3.\r\nUsing the type column made earlier, let’s split the data into training and testing datasets.\r\ntrain <- dataForModeling %>%\r\n  filter(type == \"train\") %>%\r\n  select(-type)\r\n\r\ntest <- dataForModeling %>%\r\n  filter(type == \"test\") %>%\r\n  select(-type)\r\nMachine Learning with {xgboost}\r\nFollowing Giora, we will use Gradient-Boosted-Trees to perform a multiclass logistic classification with {xgboost}. Then, we will see which features of the model are the most important.\r\nlibrary(xgboost)\r\n\r\ntrain_matrix <- xgb.DMatrix(data = as.matrix(train[,-c(1, ncol(train))]), label = train$class)\r\ntest_matrix <- xgb.DMatrix(data = as.matrix(test[, -c(1, ncol(test))]), label = test$class)\r\n\r\nnClasses <- 3\r\nxgb_params <- list(\"objective\" = \"multi:softprob\",\r\n                   \"eval_metric\" = \"mlogloss\",\r\n                   \"num_class\" = nClasses)\r\nnround    <- 50\r\n\r\nxgboostModel <- xgb.train(params = xgb_params, data = train_matrix, nrounds = nround)\r\n\r\nnames <-  colnames(train[,-c(1, ncol(train))])\r\nimportance_matrix <- xgb.importance(feature_names = names, model = xgboostModel)\r\nhead(importance_matrix, 10) %>%\r\n  left_join(tibble(Feature = colnames(dataForModeling)[-nonWordColIdx], word = bkDescWords), \"Feature\") %>%\r\n  select(word, Feature, Gain)\r\n##     word       Feature       Gain\r\n## 1   <NA>     i_NSheHer 0.19262235\r\n## 2    her         word4 0.12580363\r\n## 3    his         word6 0.05849402\r\n## 4     mc       word259 0.03820735\r\n## 5   <NA>      i_NHeHis 0.03196201\r\n## 6     in        word25 0.02862314\r\n## 7   <NA> i_lengthTitle 0.02562286\r\n## 8    has       word149 0.02338283\r\n## 9  queen       word172 0.02255995\r\n## 10 mills      word2510 0.02245347\r\nJust as Giora’s case study, “her” and “his” are the most important splits used to build the XGBoost trees. It is now time to make a confusion matrix in order to estimate the performance of our model.\r\ntest_pred <- predict(xgboostModel, newdata = test_matrix)\r\n\r\nlabelNumToChar <- function(n) {\r\n  ifelse(n == 1, \"Female\",\r\n         ifelse(n == 2, \"Male\", \"Other\"))\r\n}\r\n\r\ntest_prediction <- matrix(test_pred, nrow = nClasses,\r\n                          ncol=length(test_pred)/nClasses) %>%\r\n  t() %>%\r\n  data.frame() %>%\r\n  mutate(labelN = test$class + 1,\r\n         predN = max.col(., \"last\"),\r\n         maxProb = pmap_dbl(list(X1, X2, X3), max),\r\n         predN_strict = ifelse(maxProb > 0.75, predN, 3),\r\n         label = map_chr(labelN, labelNumToChar),\r\n         pred = map_chr(predN, labelNumToChar))\r\n\r\ncaret::confusionMatrix(test_prediction$pred,\r\n                       test_prediction$label)\r\n## Confusion Matrix and Statistics\r\n## \r\n##           Reference\r\n## Prediction Female Male Other\r\n##     Female      4    1     1\r\n##     Male        0   16     5\r\n##     Other       1    0     0\r\n## \r\n## Overall Statistics\r\n##                                           \r\n##                Accuracy : 0.7143          \r\n##                  95% CI : (0.5133, 0.8678)\r\n##     No Information Rate : 0.6071          \r\n##     P-Value [Acc > NIR] : 0.1670          \r\n##                                           \r\n##                   Kappa : 0.4271          \r\n##  Mcnemar's Test P-Value : 0.1116          \r\n## \r\n## Statistics by Class:\r\n## \r\n##                      Class: Female Class: Male Class: Other\r\n## Sensitivity                 0.8000      0.9412      0.00000\r\n## Specificity                 0.9130      0.5455      0.95455\r\n## Pos Pred Value              0.6667      0.7619      0.00000\r\n## Neg Pred Value              0.9545      0.8571      0.77778\r\n## Prevalence                  0.1786      0.6071      0.21429\r\n## Detection Rate              0.1429      0.5714      0.00000\r\n## Detection Prevalence        0.2143      0.7500      0.03571\r\n## Balanced Accuracy           0.8565      0.7433      0.47727\r\nThe classification model has a accuracy of 71%. Althought our model is quite good at classifying the “Female” and “Male” classes, it fails to predict the “Other” class. How can it be explained?\r\nOne can think that the first 140 movies we manually coded where strongly “genderized”, i.e. the movies up until 1960 were centered mainly on a single character. Indeed, we only tagged 16 movies as “Other”. The sample could be too small for the machine to “learn” how to recognize it.\r\nAnother explanation could be that when a man and a woman are both the main characters of a movie, the man often takes more space in the movie and therefore its description. Indeed, an recent study showed that men speak generally more than women in the movies, especially in the old ones.\r\nWe learned from the confusion matrix that most of the “Other” tend to be “Male”. A quick look at the description of the movies tagged as “Other” confirms that men are more present in the text. So let’s simply recode all the 2 as 1 and rerun all the script that led us to this stage of the analysis in order to try a binary logistic classification.\r\nShow code\r\nmovies_2 <- movies\r\n\r\n# Recoding all 2 to 1\r\nmovies_2$class[movies_2$class == 2] <- 1\r\n# then running the exact same code with the new \"movies_2\" dataset\r\nset.seed(22) # changing random sample (previously set.seed(2))\r\n\r\nmovies_2$actorFirstName <- movies_2$actors %>%\r\n  sub(\" .*\", \"\",.)\r\n\r\nmovies_2$directorFirstName <- movies_2$directors %>%\r\n  sub(\" .*\", \"\",.)\r\n\r\nmovies_2 <- movies_2 %>%\r\n  mutate(i_nBoysInBookDesc = map_dbl(description, getNBoysGirlsNames, TRUE, FALSE),\r\n         i_nGirlsInBookDesc = map_dbl(description, getNBoysGirlsNames, FALSE, FALSE),\r\n         i_nBoysInBookTitle = map_dbl(title, getNBoysGirlsNames, TRUE, FALSE),\r\n         i_nGirlsInBookTitle = map_dbl(title, getNBoysGirlsNames, FALSE, FALSE),\r\n         i_gapBoysGirlsBookDesc = i_nBoysInBookDesc - i_nGirlsInBookDesc,\r\n         i_gapBoysGirlsTitle = i_nBoysInBookTitle - i_nGirlsInBookTitle,\r\n         i_lengthTitle = map_dbl(title, nchar),\r\n         i_lengthBookDesc = map_dbl(description, nchar),\r\n         i_nPluralWordsInBookTitle = map_dbl(title, getNPluralWords),\r\n         i_titleStartsWithThe = map_dbl(title, isStringStartsWithThe))\r\n\r\nmovies_2 %<>% filter(nchar(description) > 100)\r\n\r\nnTagged <- sum(table(movies_2$class))\r\ntrainFrac <- 0.8 # Giora used 0.9\r\nset.seed(2) # added for reproducibility \r\ntrainSample <- sample(nTagged, floor(nTagged * trainFrac))\r\nmovies_2 %<>%\r\n  mutate(id = row_number(),\r\n         type = ifelse(row_number() %in% trainSample, \"train\",\r\n                       ifelse(row_number() %in% 1:nTagged, \"test\", \"other\")))\r\n\r\nlibrary(tidytext)\r\n\r\ndataForModeling_2 <- movies_2 %>%\r\n  unnest_tokens(word, description, drop = FALSE) %>%\r\n  count(id, word, sort = TRUE) %>% \r\n  #don't anti_join stop_words because 'her' and 'him' are there!\r\n  cast_dtm(id, word, n, weighting = tm::weightTf) %>%\r\n  tm::removeSparseTerms(0.997) %>% # from 0.999\r\n  as.matrix() %>%\r\n  as.data.frame() %>%\r\n  rownames_to_column(\"id\") %>%\r\n  mutate(id = as.numeric(id)) %>%\r\n  rename(class1 = class, type1 = type) %>%\r\n  inner_join(movies_2 %>%\r\n               select(id, starts_with(\"i_\"), class, type), \"id\")\r\n\r\nnonWordColIdx_2 <- c(1, which(str_detect(colnames(dataForModeling_2), \"i_\")),\r\n                   ncol(dataForModeling_2) - 1,\r\n                   ncol(dataForModeling_2))\r\nbkDescWords <- colnames(dataForModeling_2)[-nonWordColIdx_2]\r\ncolnames(dataForModeling_2)[-nonWordColIdx_2] <- str_c(\"word\", 1:length(bkDescWords))\r\n\r\ndim(dataForModeling_2)\r\n\r\ntrain_2 <- dataForModeling_2 %>%\r\n  filter(type == \"train\") %>%\r\n  select(-type)\r\n\r\ntest_2 <- dataForModeling_2 %>%\r\n  filter(type == \"test\") %>%\r\n  select(-type)\r\n\r\nlibrary(xgboost)\r\n\r\ntrain_matrix_2 <- xgb.DMatrix(data = as.matrix(train_2[,-c(1, ncol(train_2))]), label = train_2$class)\r\n\r\ntest_matrix_2 <- xgb.DMatrix(data = as.matrix(test_2[, -c(1, ncol(test_2))]), label = test_2$class)\r\n\r\nxgb_params_2 <- list(\"objective\" = \"binary:logistic\") # binary classification\r\nnround <- 50\r\n\r\nxgboostModel_2 <- xgb.train(params = xgb_params_2, data = train_matrix_2, nrounds = nround)\r\n\r\ntest_pred_2 <- predict(xgboostModel_2, newdata = test_matrix_2)\r\n\r\nnames_2 <-  colnames(train_2[,-c(1, ncol(train_2))])\r\nimportance_matrix_2 <- xgb.importance(feature_names = names_2, model = xgboostModel_2)\r\nhead(importance_matrix_2, 10) %>%\r\n  left_join(tibble(Feature = colnames(dataForModeling_2)[-nonWordColIdx], word = bkDescWords), \"Feature\") %>%\r\n  select(word, Feature, Gain)\r\n##      word              Feature       Gain\r\n## 1    <NA>            i_NSheHer 0.43346371\r\n## 2    <NA> i_GirlActorFirstName 0.13024149\r\n## 3     his                word6 0.08187319\r\n## 4    <NA>        i_lengthTitle 0.03491770\r\n## 5  temple             word1018 0.03331005\r\n## 6     war              word798 0.02801142\r\n## 7    many             word1329 0.02762914\r\n## 8    with               word57 0.02702849\r\n## 9      at              word187 0.02599865\r\n## 10    old              word144 0.02562534\r\n# Making a confusion matrix is much easier with a binary classification\r\npred_class_2 <- ifelse(test_pred_2 > 0.75, 1, 0) # 0.75 as compensation of \"Male\" overrating\r\n\r\nlabelNumToChar_2 <- function(n) {\r\n  ifelse(n == 0, \"Female\", \"Male\")\r\n}\r\n\r\ntest_prediction_2 <- matrix(test_2$class, nrow = 1, \r\n                           ncol = length(test_2$class)) %>%\r\n  t() %>%\r\n  data.frame() %>%\r\n  mutate(predN = test_pred_2,\r\n         label = map_chr(test_2$class, labelNumToChar_2),\r\n         label = factor(label),\r\n         pred = map_chr(pred_class_2, labelNumToChar_2),\r\n         pred = factor(pred))\r\n\r\ncaret::confusionMatrix(test_prediction_2$pred,\r\n                       test_prediction_2$label)\r\n## Confusion Matrix and Statistics\r\n## \r\n##           Reference\r\n## Prediction Female Male\r\n##     Female      7    2\r\n##     Male        3   16\r\n##                                           \r\n##                Accuracy : 0.8214          \r\n##                  95% CI : (0.6311, 0.9394)\r\n##     No Information Rate : 0.6429          \r\n##     P-Value [Acc > NIR] : 0.03326         \r\n##                                           \r\n##                   Kappa : 0.6023          \r\n##  Mcnemar's Test P-Value : 1.00000         \r\n##                                           \r\n##             Sensitivity : 0.7000          \r\n##             Specificity : 0.8889          \r\n##          Pos Pred Value : 0.7778          \r\n##          Neg Pred Value : 0.8421          \r\n##              Prevalence : 0.3571          \r\n##          Detection Rate : 0.2500          \r\n##    Detection Prevalence : 0.3214          \r\n##       Balanced Accuracy : 0.7944          \r\n##                                           \r\n##        'Positive' Class : Female          \r\n## \r\nOur predictive model performed much better, with an accuracy of 82%. But it tends to classify the movies more as “Male” than as “Female”. This is a direct result of our recoding decision. We need to keep that in mind for later on. We also notice that the most important features used to build the decision trees are quite similar to the ones of the previous model.\r\nTwo different answers\r\nIt’s finally time to visualize the distribution of the gender ratio over the years. We will use almost the same script for the two models and compare their predictions.\r\ntrain_matrix <- xgb.DMatrix(data = as.matrix(rbind(train, test)[,-c(1, ncol(train))]),\r\n                            label = c(train$class, test$class))\r\nxgboostModelAll <- xgb.train(params = xgb_params,\r\n                             data = train_matrix,\r\n                             nrounds = nround)\r\n\r\nunknown <- dataForModeling %>%\r\n  filter(type == \"other\") %>%\r\n  select(-type)\r\n\r\nunknown_matrix <- xgb.DMatrix(data = as.matrix(unknown[, -c(1, ncol(unknown))]))\r\n\r\nunknown_pred <- predict(xgboostModelAll, newdata = unknown_matrix)\r\n\r\nunknown_prediction <- matrix(unknown_pred, nrow = nClasses,\r\n                             ncol=length(unknown_pred)/nClasses) %>%\r\n  t() %>%\r\n  data.frame() %>%\r\n  mutate(predN = max.col(., \"last\"),\r\n         maxProb = pmap_dbl(list(X1, X2, X3), max),\r\n         predN_strict = ifelse(maxProb > 0.75, predN, 3),\r\n         pred = map_chr(predN, labelNumToChar))\r\n\r\nFirst139Labels <- movies %>%\r\n  filter(type != \"other\") %>%\r\n  select(class) %>%\r\n  transmute(label = map_chr(class, labelNumToChar)) %>%\r\n  unlist()\r\n\r\nmovieClasses <- c(unknown_prediction$pred, First139Labels)\r\ntable(movieClasses) # overall gender ratio\r\n## movieClasses\r\n## Female   Male  Other \r\n##    401    981     55\r\nmovies %<>% mutate(class = movieClasses)\r\n\r\nlibrary(hrbrthemes)\r\nmovies %>%\r\n  group_by(year, class) %>%\r\n  count(class) %>%\r\n  ggplot(aes(x = year, y = n, color = class)) +\r\n  geom_line() +\r\n  scale_color_discrete(name = \"Gender\") +\r\n  labs(x = \"\", y = \"number of movies\",\r\n       title = \"Gender centrality in children's movies\",\r\n       caption = \"Model accuracy: 0.72 | Data source: Wikipedia\") + \r\n  theme_ipsum() \r\n\r\nWhy is the number of “Female” and “Other” suddenly higher than “Male” since 2013? Are the children’s movies more feminists then they were a few years ago? Let’s see if this pattern also appears in our binary classification model.\r\ntrain_matrix_2 <- xgb.DMatrix(data = as.matrix(rbind(train_2, test_2)[,-c(1, ncol(train_2))]),\r\n                            label = c(train_2$class, test_2$class))\r\nxgboostModelAll_2 <- xgb.train(params = xgb_params_2,\r\n                             data = train_matrix_2,\r\n                             nrounds = nround)\r\n\r\nunknown_2 <- dataForModeling_2 %>%\r\n  select(-type)\r\n\r\nunknown_matrix_2 <- xgb.DMatrix(data = as.matrix(unknown_2[, -c(1, ncol(unknown_2))]))\r\n\r\nunknown_pred_2 <- predict(xgboostModelAll_2, newdata = unknown_matrix_2)\r\n\r\nmovies_2 %<>% \r\n  mutate(class = ifelse(unknown_pred_2 > 0.75, 1, 0),\r\n         class_2 = map_chr(class, labelNumToChar_2))\r\n\r\nmovies_2 %>%\r\n  group_by(year, class_2) %>%\r\n  count(class_2) %>%\r\n  ggplot(aes(x = year, y = n, color = class_2)) +\r\n  geom_line() +\r\n  scale_color_discrete(name = \"Gender\") +\r\n  labs(x = \"\", y = \"number of movies\",\r\n       title = \"Central Character Gender in Children's Movies\",\r\n       caption = \"Model accuracy: 0.82 | Data source: Wikipedia\") +\r\n  theme_ipsum()\r\n\r\nApparently no. However, as said before, our second model overclassifies the “Male” category. The reality is probably in between the two models: there are more central female characters but still far away from gender equality4.\r\nFIN\r\nPredicting the gender of central characters in children’s movie isn’t an easy task, especially when using almost 100-years old movies. The predictions could have been different if I had chosen to code the last 140 movies of our dataset.\r\nAnyway, this was without doubt the longer post I’ve published on my blog… and the first using machine learning! I’ve learned a lot and had so much fun.\r\nThank you Giora!\r\n\r\nThanks for reading!\r\n\r\nFor updates of recent blog posts, follow me on Twitter.\r\nFor reproducing my data analysis, go on my Github repo or my RStudio server.\r\nCurious about what I can do for your organisation? Have a look my services.\r\n\r\nGiora could have implemented that very easily, but chose not to because he wanted to respond to a specific question, as explained in his concluding remarks.↩︎\r\nIn his post, Giora coded 200 movies (equivalent to 5.4% of this dataset).↩︎\r\nGiora explains in more detail what his code does in his post.↩︎\r\nTo know for sure if the trend is reversing, we could simply code manually the class variable since 2013. If anyone has the motivation to do this task, I would be pleased to know your finding.↩︎\r\n",
    "preview": "posts/2017-12-11-movies/img/chart_childrensmovies_2.png",
    "last_modified": "2020-12-04T23:21:29+01:00",
    "input_file": {},
    "preview_width": 672,
    "preview_height": 480
  },
  {
    "path": "posts/2017-11-09-bfsdata/",
    "title": "Introducing My Second R Package, {bfsdata}",
    "description": "The {bfsdata} package makes the data from the Swiss Federal Statistical Office (or BFS for \"Bundesamt für Statistik\") easily accessible to R users. It lets you search, download and read BFS datasets directly from the R console.",
    "author": [],
    "date": "2017-11-09",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nHow to use {bfsdata}\r\nBonus: how {bfsdata} works\r\n\r\nHow to use {bfsdata}\r\nThe {bfsdata} package consists of three functions:\r\nbfs_search(word, word2, langage)\r\nbfs_download(row, name)\r\nbfs_dir()\r\nImagine you want to make an exploratory analysis about students in Swiss universities. You could search if a dataset title of the BFS database contains the word “student” by using the bfs_search function.\r\ndevtools::install_github(\"lgnbhl/bfsdata\")\r\nlibrary(bfsdata)\r\nbfs_search(\"student\", langage = \"en\")\r\n# or alternatively: bfs_search(\"student\", \"\", \"en\") \r\n## [1] University students by year, ISCED fields, gender and level of studies                                               \r\n## [2] University students by year, ISCED fields, nationality and level of studies                                          \r\n## [3] University of applied sciences and teacher education students by year, ISCED fields, gender and level of studies     \r\n## [4] University of applied sciences and teacher education students by year, ISCED fields, nationality and level of studies\r\nYou found that four English dataset titles contain the word “student”.\r\nNote that it could also have been done on the BFS online database with the same result, as shown in this screenshot:\r\n\r\nWhen using bfs_search, you will have in your Global Environment a CSV file called bfsMetadata. It is the Excel file from the BFS website, accessible through the “list of the cubes” link, read with the {readxl} package. You will also get a CSV dataset which contains the result of your search, named bfsMetadataSubset.\r\nLet’s have a look at it.\r\nstr(bfsMetadataSubset)\r\n## Classes 'tbl_df', 'tbl' and 'data.frame':    4 obs. of  5 variables:\r\n##  $ Title              : chr  \"University students by year, ISCED fields, gender and level of studies\" \"University students by year, ISCED fields, nationality and level of studies\" \"University of applied sciences and teacher education students by year, ISCED fields, gender and level of studies\" \"University of applied sciences and teacher education students by year, ISCED fields, nationality and level of studies\"\r\n##  $ Timespan           : chr  \"1980-2016\" \"1990-2016\" \"1997-2016\" \"1997-2016\"\r\n##  $ Last Update        : chr  \"30.03.2017\" \"30.03.2017\" \"30.03.2017\" \"30.03.2017\"\r\n##  $ Link               : chr  \"px-x-1502040100_131\" \"px-x-1502040100_132\" \"px-x-1502040400_161\" \"px-x-1502040400_162\"\r\n##  $ Languages available: chr  \"de, fr, it, en\" \"de, fr, it, en\" \"de, fr, it, en\" \"de, fr, it, en\"\r\nThe first dataset of our search seems interesting. We can download it (by typing row = 1, for the first result of the bfs_search function) and give it an optional name (the dataset is named “bfsData” by default) with the bfs_download function:\r\nbfs_download(row = 1, name = \"bfsData_student\") \r\n# or alternatively: bfs_download(1)\r\nThe bfs_download function downloads the BFS dataset, stored online in a PX format, and reads it in your R session with the {pxR} package. It also saves the dataset in both CSV and PX formats in the inst/extdata directory of the package.\r\nOkay, let’s have a glimpse of it.\r\nlibrary(tidyverse)\r\nglimpse(bfsData_student)\r\n## Observations: 15,540\r\n## Variables: 5\r\n## $ Studienstufe <fctr> First university degree or diploma, Bachelor, Ma...\r\n## $ Geschlecht   <fctr> Male, Male, Male, Male, Male, Female, Female, Fe...\r\n## $ ISCED.Field  <fctr> Education science, Education science, Education ...\r\n## $ Jahr         <fctr> 1980, 1980, 1980, 1980, 1980, 1980, 1980, 1980, ...\r\n## $ value        <dbl> 545, 0, 0, 93, 13, 946, 0, 0, 70, 52, 1380, 0, 0,...\r\nLooks promising! We could use it to explore the relations between gender and academic fields, i.e. the ISCED.Field variable.\r\nhead(levels(bfsData_student$ISCED.Field)) # of 41 ISCED fields\r\n## [1] \"Education science\"                              \r\n## [2] \"Teacher training without subject specialisation\"\r\n## [3] \"Teacher training with subject specialisation\"   \r\n## [4] \"Fine arts\"                                      \r\n## [5] \"Music and performing arts\"                      \r\n## [6] \"Religion and theology\"\r\nNote that you can have access to the metadata of your BFS dataset by reading directly the PX file in R, also saved in your Global Environnement while using the bfs_download function. Here are three examples of metadata taken from the bfsData_student_px object.\r\nprint(bfsData_student_px$TITLE.en.)\r\n## $value\r\n## [1] \"University students by Year, ISCED Field, Gender and Level of study\"\r\nprint(bfsData_student_px$CONTACT.en.)\r\n## $value\r\n## [1] \"Section Educational Processes, e-mail  <a href=mailto:sius@bfs.admin.ch>sius@bfs.admin.ch<\/a>\"\r\nprint(bfsData_student_px$DATABASE.en.)\r\n## $value\r\n## [1] \"FSO - STAT-TAB / Federal Statistical Office, 2010 Neuchâtel / Switzerland / ©  Federal Statistical Office\"\r\nWe can now make a function that plots the number of students each year since 1980, by gender and by ISCED field.\r\nbfs_plot <- function(academicField) {\r\n  library(tidyverse)\r\n  library(lubridate)\r\n  library(scales)\r\n  # Make Jahr (year in German) a Date object\r\n  bfsData_student$Jahr <- as.Date(paste0(bfsData_student$Jahr, \"-01-01\"))\r\n  df <- bfsData_student %>%\r\n    filter(ISCED.Field == academicField) %>%\r\n    mutate(year = lubridate::ymd(Jahr))\r\n  ggplot(data = df, aes(x = year, y = value, colour = Geschlecht, linetype = Studienstufe)) +\r\n    geom_line() +\r\n    scale_x_date(breaks = date_breaks(\"4 years\"),\r\n                 labels = date_format(\"%Y\"),\r\n                 # Hadley: https://github.com/tidyverse/ggplot2/issues/1090\r\n                 limits = c(df$year[[2]], NA)) +\r\n    scale_color_discrete(name = \"Gender\") +\r\n    scale_linetype_discrete(name = \"Level of studies\") +\r\n    labs(x = \"\", y = \"Number of student\",\r\n        title = \"Student Gender Gap in Swiss Universities\",\r\n        subtitle = paste0(\"Number of student in \", academicField, \", by gender and level of studies\"),\r\n        caption = \"Author: Félix Luginbühl (@lgnbhl); Data source: BFS\") +\r\n    theme_light() +\r\n    theme(plot.title = element_text(size = 16, face = \"bold\"),\r\n          plot.caption = element_text(size = 9, color = \"darkgrey\"))\r\n  }\r\nOkay, let’s try this bfs_plot function with some academic fields.\r\nbfs_plot(\"Management and administration\")\r\n\r\nbfs_plot(\"Medicine\")\r\n\r\nbfs_plot(\"Sociology and cultural studies\")\r\n\r\nbfs_plot(\"Political sciences and civics\")\r\n\r\n# etc.\r\nIn 1999, Switzerland adhered to the “Bologna Process”, which harmonized European academic qualifications in three levels: Bachelor, Master and Doctorate. In the graphics, we can see its progressive implementation by Swiss universities.\r\nThe graphics show that student gender gaps in Switzerland seem to be holding in some academic fields, while changing in others. I was surprised to discover a certain “equality” in the distribution of the number of male and female students in the field of Political sciences and civics since 1980, although female students became a majority in the new system of Bologna. Well, we will not dig further into this analysis. The objective of this article is simply to introduce the {bfsdata} package.\r\nWe got only four datasets related to the occurrence “student” in the English BFS metadata file. Obviously, the Swiss Federal Statistical Office has much more data in German and French. As explained before, the package creates a dataset in the Global Environment called bfsMetadataSubset for each search. Be warned that bfsMetadataSubset is rewritten every time bfs_search is called.\r\nLet’s have a look at dataset titles related to students in German and French.\r\nbfs_search(\"studierende\") # German is the default langage\r\ndim(bfsMetadataSubset)\r\n## [1] 33  5\r\nbfs_search(\"etudiant\", langage = \"fr\")\r\ndim(bfsMetadataSubset)\r\n## [1] 29  5\r\nIn German, we have 33 dataset titles related to the word “studierende”. We found 29 datasets in the French metadata.\r\nIf you want to open the inst/extdata directory of the package, where all downloaded datasets are stored (including the original PC-Axis file), simply type the following:\r\nbfs_dir()\r\nIn a next article, I will show how the {bfsdata} package can be used to map BFS data with {rgdal} and {ggplot2}.\r\nThanks for reading. For updates of recent blog posts, follow me on Twitter.\r\nBonus: how {bfsdata} works\r\nThe {bfsdata} package lets you scrap the BFS website in order to get Swiss datasets. But first, let’s check if we are allowed to do so with the {robotstxt} package.\r\nrobotstxt::paths_allowed(\"https://www.pxweb.bfs.admin.ch/ShowCubeList.aspx\")\r\n## [1] TRUE\r\nrobotstxt::paths_allowed(\"https://www.pxweb.bfs.admin.ch/DownloadFile.aspx\")\r\n## [1] TRUE\r\nYes, we are allowed to.\r\nNo data is stored into the package (as obviously I am not the owner of BFS datasets), but downloaded into the inst/extdata directory. Note that the datasets, downloads through bfs_download, are downloaded only one time. This makes {bfsdata} more effective as well as more respectful of the official BFS website, by decreasing the number of download requests.\r\nThe {bfsdata} package has two major limitations. Firstly, the BFS metadata Excel file, accessible through the “list of cubes” link, doesn’t give the variables names of each dataset, contrary to the BFS website search. So the bfs_search function shows only the datasets title names, while the BFS online search takes topics and variables into account while giving results. Secondly, the bfs_search function doesn’t have the autocompletion of the BFS website search, which can be quite useful. But despite theses limitations, I hope this package can be seen as a modeste contribution to the BFS objective of making Swiss data more accessible to searchers.\r\nBelow are the three functions of the {bfsdata} package.\r\nbfs_search <- function(word = NULL, word2 = NULL, langage = \"de\") {\r\n  bfsDataPath <- system.file(\"extdata\", package = \"bfsdata\")\r\n  assign(\"bfsDataPath\", bfsDataPath, envir = .GlobalEnv)\r\n  if(langage == \"de\") {\r\n    if(!file.exists(system.file(\"extdata/bfsMetadata_de.xls\", package = \"bfsdata\"))) {\r\n    download.file(url = \"https://www.pxweb.bfs.admin.ch/ShowCubeList.aspx?px_language=de\",\r\n                  destfile = paste0(\"\", bfsDataPath, \"/bfsMetadata_de.xls\"))\r\n    }\r\n    bfsMetadata <- readxl::read_excel(paste0(\"\", bfsDataPath, \"/bfsMetadata_de.xls\"))\r\n    assign(\"bfsMetadata\", bfsMetadata, envir = .GlobalEnv)\r\n  } else if(langage == \"fr\") {\r\n    if(!file.exists(system.file(\"extdata/bfsMetadata_fr.xls\", package = \"bfsdata\"))) {\r\n      download.file(url = \"https://www.pxweb.bfs.admin.ch/ShowCubeList.aspx?px_language=fr\",\r\n                    destfile = paste0(\"\", bfsDataPath, \"/bfsMetadata_fr.xls\"))\r\n    }\r\n    bfsMetadata <- readxl::read_excel(paste0(\"\", bfsDataPath, \"/bfsMetadata_fr.xls\"))\r\n    assign(\"bfsMetadata\", bfsMetadata, envir = .GlobalEnv)\r\n  } else if (langage == \"en\") {\r\n    if(!file.exists(system.file(\"extdata/bfsMetadata_en.xls\", package = \"bfsdata\"))) {\r\n      download.file(url = \"https://www.pxweb.bfs.admin.ch/ShowCubeList.aspx?px_language=en\",\r\n                    destfile = paste0(\"\", bfsDataPath, \"/bfsMetadata_en.xls\"))\r\n    }\r\n    bfsMetadata <- readxl::read_excel(paste0(\"\", bfsDataPath, \"/bfsMetadata_en.xls\"))\r\n    assign(\"bfsMetadata\", bfsMetadata, envir = .GlobalEnv)\r\n  } else if (langage == \"it\") {\r\n    if(!file.exists(system.file(\"extdata/bfsMetadata_it.xls\", package = \"bfsdata\"))) {\r\n      download.file(url = \"https://www.pxweb.bfs.admin.ch/ShowCubeList.aspx?px_language=it\",\r\n                    destfile = paste0(\"\", bfsDataPath, \"/bfsMetadata_it.xls\"))\r\n    }\r\n    bfsMetadata <- readxl::read_excel(paste0(\"\", bfsDataPath, \"/bfsMetadata_it.xls\"))\r\n    assign(\"bfsMetadata\", bfsMetadata, envir = .GlobalEnv)\r\n  } else {\r\n    message(\"WARNING: choose between German, French, English or Italien (langage = “de“, “fr“, “en“, “it“)\")\r\n  }\r\n  if(exists(\"bfsMetadata\")) {\r\n    bfsMetadata <- na.omit(bfsMetadata)\r\n    colnames(bfsMetadata)[1] <- \"Title\"\r\n    colnames(bfsMetadata)[2] <- \"Timespan\"\r\n    colnames(bfsMetadata)[3] <- \"Last Update\"\r\n    colnames(bfsMetadata)[4] <- \"Link\"\r\n    colnames(bfsMetadata)[5] <- \"Languages available\"\r\n    # bfsMetadata$ID <- seq.int(nrow(bfsMetadata)) # add an ID variable\r\n    assign(\"bfsMetadata\", bfsMetadata, envir = .GlobalEnv)\r\n    # URL: https://stackoverflow.com/questions/13187414/r-grep-is-there-an-and-operator\r\n    if(missing(word2)) {\r\n      bfsMetadataSubset <- bfsMetadata[grep(paste0(\"\", word, \"\"), bfsMetadata$Title, ignore.case = TRUE), ]\r\n      assign(\"bfsMetadataSubset\", bfsMetadataSubset, envir = .GlobalEnv)\r\n      print.table(bfsMetadataSubset$Title)\r\n    } else {\r\n      bfsMetadataSubset <- bfsMetadata[grep(paste0(\"(?=.*\", word,\")(?=.*\", word2, \")\"), bfsMetadata$Title, perl = TRUE, ignore.case = TRUE), ]\r\n      assign(\"bfsMetadataSubset\", bfsMetadataSubset, envir = .GlobalEnv)\r\n      print.table(bfsMetadataSubset$Title)\r\n    }\r\n  }\r\n}\r\nbfs_download <- function(row, name = \"bfsData\") {\r\n  bfsDataPath <- system.file(\"extdata/\", package = \"bfsdata\")\r\n  assign(\"bfsDataPath\", bfsDataPath, envir = .GlobalEnv)\r\n  if(!file.exists(system.file(paste0(\"extdata/\", bfsMetadataSubset[row, 4], \".px\"), package = \"bfsdata\"))) {\r\n    download.file(url = paste0(\"https://www.pxweb.bfs.admin.ch/DownloadFile.aspx?file=\", bfsMetadataSubset[row,4], \"\"),\r\n                  destfile = paste0(\"\", bfsDataPath, \"/\", bfsMetadataSubset[row, 4],\".px\"))\r\n  } else {\r\n    message(\"WARNING: Dataset already downloaded\")\r\n  }\r\n  bfsData <- pxR::read.px(paste0(\"\", bfsDataPath, \"/\",bfsMetadataSubset[row, 4],\".px\"))\r\n  assign(paste0(\"\", name,\"_px\"), bfsData, envir = .GlobalEnv)\r\n  bfsData <- as.data.frame(bfsData)\r\n  write.csv(bfsData, file = paste0(\"\", bfsDataPath, \"/\", name,\".csv\"), row.names = FALSE)\r\n  assign(paste0(\"\", name,\"\"), bfsData, envir = .GlobalEnv)\r\n  detach(\"package:pxR\", unload = TRUE) # pxR::as.data.frame in conflict with raster::as.data.frame\r\n}\r\n# Reference: https://stackoverflow.com/questions/12135732/\r\nbfs_dir <- function(dir = paste0(\"\", system.file(\"extdata/\", package = \"bfsdata\"), \"\")){\r\n    if (.Platform['OS.type'] == \"windows\"){\r\n      shell.exec(dir)\r\n    } else {\r\n      system(paste(Sys.getenv(\"R_BROWSER\"), dir))\r\n  }\r\n}\r\n\r\nThanks for reading!\r\n\r\nFor updates of recent blog posts, follow me on Twitter.\r\nFor reproducing my data analysis, go on my Github repo or my RStudio server.\r\nCurious about what I can do for your organisation? Have a look my services.\r\n\r\n\r\n\r\n",
    "preview": "posts/2017-11-09-bfsdata/img/chart_bfsdata_3.png",
    "last_modified": "2020-12-04T23:46:28+01:00",
    "input_file": {},
    "preview_width": 672,
    "preview_height": 480
  },
  {
    "path": "posts/2017-09-22-tennis/",
    "title": "Who's The Most Popular Tennis Player on Twitter?",
    "description": "In the world of men's tennis, only four players, known as the \"Big Four\", have dominated the main tournaments since 2004. You probably know their names: Roger Federer, Rafael Nadal, Novak Djokovic and Andy Murray. As they regularly make the headlines all over the world, I wanted to know more about their popularity on Twitter with the R packages {rtweet} and {tidytext}.",
    "author": [],
    "date": "2017-09-22",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nThe Data\r\nHow Often Do They Tweet?\r\nWhen Are the Big Four Most Liked Tweets?\r\nWhich Are the Big Four Most Popular Tweets Ever?\r\nAre Their Tweets Similar?\r\n\r\nIn this article, we will answer three questions about the Big Four:\r\nHow often do they tweet?\r\nWhich tennis player has the most popular tweets?\r\nIs the content of their tweets similar?\r\nThe Data\r\nLet’s begin with a general overview of the Big Four’s Twitter accounts.\r\nlibrary(tidyverse)\r\nlibrary(rtweet)\r\n\r\nbig4_usernames <- c(\"rogerfederer\", \"RafaelNadal\", \"DjokerNole\", \"andy_murray\")\r\nbig4_accounts <- lookup_users(big4_usernames)\r\nwrite.csv(big4_accounts, \"big4_accounts.csv\")\r\nhead(big4_accounts[, c(2:4, 7:8)])\r\n##             name  screen_name    location followers_count friends_count\r\n## 1  Roger Federer rogerfederer Switzerland         9129816            80\r\n## 2     Rafa Nadal  RafaelNadal     Manacor        14052334            87\r\n## 3 Novak Djokovic   DjokerNole        <NA>         7864231           734\r\n## 4    Andy Murray  andy_murray     London          3698757           141\r\nAs you see, “Rafa” Nadal has 14 millions of followers; while Andy Murray has “only” 3.6 millions. Can we conclude that the former is more popular than the latter on Twitter? Well, diving deeper into the social network analysis will give us a more nuanced answer.\r\nFirst, let’s download all the tweets published by the Big Four and related metadata on Twitter. This can be done very easily with the get_timeline function of the {rtweet} package.\r\n# Get Big Four tweets\r\ntweets_federer <- get_timeline(\"rogerfederer\", n = 3000)\r\ntweets_nadal <- get_timeline(\"RafaelNadal\", n = 3000)\r\ntweets_djokovic <- get_timeline(\"DjokerNole\", n = 3000)\r\ntweets_murray <- get_timeline(\"andy_murray\", n = 3000)\r\n# Join in one dataset\r\ntweets_big4 <- rbind(tweets_federer, tweets_nadal, tweets_djokovic, tweets_murray)\r\nOur dataframe is ready. How many tweets did we get?\r\ndim(tweets_big4)\r\n## [1] 9126   35\r\nHow Often Do They Tweet?\r\nIn order to know how often the Big Four tweets, we need to count the number of Tweets published online every month by each tennis player.\r\nlibrary(lubridate)\r\n\r\ntweets_big4_time <- tweets_big4 %>%\r\n  select(screen_name, created_at, favorite_count) %>%\r\n  mutate(created_at = ymd_hms(created_at)) %>%\r\n  mutate(month = round_date(created_at, \"month\")) %>%\r\n  as_tibble()\r\n\r\ntweets_big4_tidy <- tweets_big4_time %>%\r\n  group_by(screen_name, month) %>%\r\n  summarise(count = n())\r\nOkay, we are ready to run some visualisations.\r\nlibrary(scales)\r\nlibrary(ggthemes)\r\n\r\ntweets_big4_tidy %>%\r\n  ggplot(aes(x = month, y = count , colour = screen_name)) + \r\n  geom_line() +\r\n  scale_x_datetime(NULL, date_breaks(\"1 year\"), date_labels = \"%Y\") + \r\n  scale_color_brewer(name = NULL, \r\n                     labels = c(\"Andy Murray\", \"Novak Djokovic\", \"Rafael Nadal\", \"Roger Federer\"),\r\n                     palette = \"Set2\") +\r\n  theme_economist_white() +\r\n  theme(plot.background = element_rect(fill = \"#f8f2e4\"),\r\n        legend.background = element_blank(), \r\n        legend.key = element_blank()) +\r\n  labs(x = \"By month\", y = \"Number of Tweets by month\", \r\n       title = \"The Big Four Tweets\",\r\n       caption = \"Félix Luginbühl (@lgnbhl)\\nData source: Twitter\")\r\n\r\nWe can make our time serie visualization interactive with the {dygraphs} package.\r\nlibrary(xts)\r\nlibrary(dygraphs)\r\n\r\ntweets_big4_xts <- tweets_big4_tidy %>%\r\n  spread(screen_name, count) %>%\r\n  select(\"Murray\" = 2, \"Djokovic\" = 3, \"Nadal\" = 4, \"Federer\" = 5, \"Month\" = 1)\r\n\r\ntweets_big4_xts <- xts(tweets_big4_xts, order.by=(tweets_big4_xts$Month))\r\n\r\ndygraph(tweets_big4_xts, main = \"The Big Four Tweets\", ylab = \"Number of Tweets by month\") %>% \r\n  dyAxis(\"x\", drawGrid = FALSE) %>%\r\n  dyOptions(colors = RColorBrewer::brewer.pal(5, \"Set2\")) %>%\r\n  dyRangeSelector()\r\n\r\n\r\n\r\n\r\nThe number of tweets published every month is quite irregular. The tennis players are probably tweeting more during tournaments, specially when they reach high level matches. We can also see that they tweet less since the middle of 2015 and that Andy Murray totally stopped tweeting in 2016 (!).\r\nAt this point, maybe you are wondering - as I do - if the Big Four popularity on Twitter is increasing or decreasing over time. Let’s answer this question now.\r\nWhen Are the Big Four Most Liked Tweets?\r\nThe Twitter Developer Documentation explains that the favorite_count variable “indicates approximately how many times this Tweet has been liked by Twitter users”. It’s a good measure to discover which are the most popular tweets of the Big Four.\r\ntweets_big4_time %>%\r\n  ggplot(aes(x = created_at, y = favorite_count, colour = screen_name)) + \r\n  geom_point(size = 3) +\r\n  scale_x_datetime(NULL, date_breaks(\"1 year\"), date_labels = \"%Y\") + \r\n  scale_y_continuous(labels = comma) +\r\n  scale_color_brewer(name = NULL, \r\n                     labels = c(\"Andy Murray\", \"Novak Djokovic\", \"Rafael Nadal\", \"Roger Federer\"), \r\n                     palette = \"Set2\") + \r\n  ggthemes::theme_economist_white() +\r\n  theme(plot.background = element_rect(fill = \"#f8f2e4\"),\r\n        legend.background = element_blank(), \r\n        legend.key = element_blank()) +\r\n  labs(x = NULL, y = \"Number of likes\", \r\n       title = \"The Big Four Popularity on Twitter\", \r\n       caption = \"Félix Luginbühl (@lgnbhl)\\n Data source: Twitter\")\r\n\r\nSince 2016, the most liked tweets are those - sorry to say - of Roger Federer and Rafael Nadal. The most liked tweets of Novak Djokovic were in the middle of 2014 and the beginning of 2015.\r\nIf this visualization could have been balanced with the worldwide increase of Twitter accounts number over the years - which biais the comparaison of the tweets popularity during the years -, comparing the tweets of the players in a given month is still relevant.\r\nIt is now time to have a look on the content of their tweets.\r\nWhich Are the Big Four Most Popular Tweets Ever?\r\nLet’s look at the content of the 10 most ever liked tweets of the Big Four.\r\nlibrary(knitr)\r\n\r\ntweets_big4 %>%\r\n  select(screen_name, text, favorite_count, created_at) %>%\r\n  arrange(desc(favorite_count)) %>%\r\n  head(n = 10L) %>%\r\n  kable()\r\nscreen_name\r\ntext\r\nfavorite_count\r\ncreated_at\r\nrogerfederer\r\n#19 tastes great https://t.co/3Hv3lM5Rk9\r\n403819\r\n2017-07-16 15:47:03\r\nrogerfederer\r\n🎾👉🏼 💎👉🏼 🆘 https://t.co/6fYgmDFj8z\r\n265651\r\n2017-09-02 02:11:07\r\nrogerfederer\r\nJuan Martin del THORtro @delpotrojuan https://t.co/BsLeAHhULV\r\n193749\r\n2017-09-05 02:57:27\r\nrogerfederer\r\n1️⃣8️⃣🏆 https://t.co/Ap8aZGhBNf\r\n1838\r\n96 2017-01-29 16:05:13\r\nRafaelNadal\r\n#CHAMP10N https://t.co/BV0M1qE7NE\r\n171973\r\n2017-06-11 16:13:25\r\nRafaelNadal\r\n#CHAMP10N\r\n165806\r\n2017-06-11 15:31:47\r\nrogerfederer\r\nSo so happy and privileged to be in another @Wimbledon final. See you all Sunday 😀\r\n158864\r\n2017-07-14 22:02:28\r\nrogerfederer\r\nOn my way to the @Wimbledon champions dinner 🐧 https://t.co/J1CLMosSkH\r\n96439\r\n2017-07-16 21:01:41\r\nrogerfederer\r\nSimply incredible, Rafa #10 #RG17 #VamosRafa #justdoit\r\n77144\r\n2017-06-11 21:50:04\r\nDjokerNole\r\n. @NiallOfficial haha thanks bro. If you can watch tomorrow give me and your #nolefam fans a shout to cheer me on\r\n72327\r\n2015-01-30 22:19:42\r\nHumour pays off on social media. Have a look at the funny second third more liked tweets of Roger Federer:\r\n\r\n\r\n🎾👉🏼 💎👉🏼 🆘 pic.twitter.com/6fYgmDFj8z\r\n\r\n— Roger Federer (@rogerfederer) 2 septembre 2017\r\n\r\nFunction&&Function.prototype&&Function.prototype.bind&&(/(MSIE ([6789]|10|11))|Trident/.test(navigator.userAgent)||(window.__twttr&&window.__twttr.widgets&&window.__twttr.widgets.loaded&&window.twttr.widgets.load&&window.twttr.widgets.load(),window.__twttr&&window.__twttr.widgets&&window.__twttr.widgets.init||function(t){function e(e){for(var n,i,o=e[0],s=e[1],a=0,c=[];a<o.length;a++)i=o[a],r[i]&&c.push(r[i][0]),r[i]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);for(u&&u(e);c.length;)c.shift()()}var n={},r={1:0};function i(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(t){var e=[],n=r[t];if(0!==n)if(n)e.push(n[2]);else{var o=new Promise(function(e,i){n=r[t]=[e,i]});e.push(n[2]=o);var s,a=document.getElementsByTagName(\"head\")[0],u=document.createElement(\"script\");u.charset=\"utf-8\",u.timeout=120,i.nc&&u.setAttribute(\"nonce\",i.nc),u.src=function(t){return i.p+\"js/\"+({0:\"moment~timeline~tweet\",2:\"dm_button\",3:\"button\",4:\"moment\",5:\"periscope_on_air\",6:\"timeline\",7:\"horizon_tweet\",8:\"tweet\"}[t]||t)+\".\"+{0:\"ae149926685a43cb146e35371430188e\",2:\"fe973228b5a3f65e3d8a0dd10b553d17\",3:\"63c51c903061d0dbd843c41e8a00aa5a\",4:\"50cf823c7bf26ac484f84f086ebc4bff\",5:\"97b8e8f03584fdf6deeb9dfd0bf9b2d5\",6:\"687eed636a16648c9f0b1f72d7fa68bd\",7:\"716ef7f4c155526f8ec8e60dbd2fbf56\",8:\"e71d9c824fc78e1a4e43d645b66bf574\"}[t]+\".js\"}(t),s=function(e){u.onerror=u.onload=null,clearTimeout(c);var n=r[t];if(0!==n){if(n){var i=e&&(\"load\"===e.type?\"missing\":e.type),o=e&&e.target&&e.target.src,s=new Error(\"Loading chunk \"+t+\" failed.\\n(\"+i+\": \"+o+\")\");s.type=i,s.request=o,n[1](s)}r[t]=void 0}};var c=setTimeout(function(){s({type:\"timeout\",target:u})},12e4);u.onerror=u.onload=s,a.appendChild(u)}return Promise.all(e)},i.m=t,i.c=n,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p=\"https://platform.twitter.com/\",i.oe=function(t){throw console.error(t),t};var o=window.__twttrll=window.__twttrll||[],s=o.push.bind(o);o.push=e,o=o.slice();for(var a=0;a<o.length;a++)e(o[a]);var u=s;i(i.s=92)}([function(t,e,n){var r=n(1);function i(t,e){var n;for(n in t)t.hasOwnProperty&&!t.hasOwnProperty(n)||e(n,t[n]);return t}function o(t){return{}.toString.call(t).match(/\\s([a-zA-Z]+)/)[1].toLowerCase()}function s(t){return t===Object(t)}function a(t){var e;if(!s(t))return!1;if(Object.keys)return!Object.keys(t).length;for(e in t)if(t.hasOwnProperty(e))return!1;return!0}function u(t){return t?Array.prototype.slice.call(t):[]}t.exports={aug:function(t){return u(arguments).slice(1).forEach(function(e){i(e,function(e,n){t[e]=n})}),t},async:function(t,e){r.setTimeout(function(){t.call(e||null)},0)},compact:function t(e){return i(e,function(n,r){s(r)&&(t(r),a(r)&&delete e[n]),void 0!==r&&null!==r&&\"\"!==r||delete e[n]}),e},contains:function(t,e){return!(!t||!t.indexOf)&&t.indexOf(e)>-1},forIn:i,isObject:s,isEmptyObject:a,toType:o,isType:function(t,e){return t==o(e)},toRealArray:u}},function(t,e){t.exports=window},function(t,e,n){var r=n(6);t.exports=function(){var t=this;this.promise=new r(function(e,n){t.resolve=e,t.reject=n})}},function(t,e,n){var r=n(11),i=/(?:^|(?:https?:)?\\/\\/(?:www\\.)?twitter\\.com(?::\\d+)?(?:\\/intent\\/(?:follow|user)\\/?\\?screen_name=|(?:\\/#!)?\\/))@?([\\w]+)(?:\\?|&|$)/i,o=/(?:^|(?:https?:)?\\/\\/(?:www\\.)?twitter\\.com(?::\\d+)?\\/(?:#!\\/)?[\\w_]+\\/status(?:es)?\\/)(\\d+)/i,s=/^http(s?):\\/\\/(\\w+\\.)*twitter\\.com([:/]|$)/i,a=/^http(s?):\\/\\/(ton|pbs)\\.twimg\\.com/,u=/^#?([^.,<>!\\s/#\\-()'\"]+)$/,c=/twitter\\.com(?::\\d{2,4})?\\/intent\\/(\\w+)/,d=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/\\w+\\/timelines\\/(\\d+)/i,f=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/i\\/moments\\/(\\d+)/i,l=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/(\\w+)\\/(?:likes|favorites)/i,h=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/(\\w+)\\/lists\\/([\\w-%]+)/i,p=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/i\\/live\\/(\\d+)/i,m=/^https?:\\/\\/syndication\\.twitter\\.com\\/settings/i,v=/^https?:\\/\\/(localhost|platform)\\.twitter\\.com(?::\\d+)?\\/widgets\\/widget_iframe\\.(.+)/i,g=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/search\\?q=(\\w+)/i;function w(t){return\"string\"==typeof t&&i.test(t)&&RegExp.$1.length<=20}function y(t){if(w(t))return RegExp.$1}function b(t,e){var n=r.decodeURL(t);if(e=e||!1,n.screen_name=y(t),n.screen_name)return r.url(\"https://twitter.com/intent/\"+(e?\"follow\":\"user\"),n)}function _(t){return\"string\"==typeof t&&u.test(t)}function E(t){return\"string\"==typeof t&&o.test(t)}t.exports={isHashTag:_,hashTag:function(t,e){if(e=void 0===e||e,_(t))return(e?\"#\":\"\")+RegExp.$1},isScreenName:w,screenName:y,isStatus:E,status:function(t){return E(t)&&RegExp.$1},intentForProfileURL:b,intentForFollowURL:function(t){return b(t,!0)},isTwitterURL:function(t){return s.test(t)},isTwimgURL:function(t){return a.test(t)},isIntentURL:function(t){return c.test(t)},isSettingsURL:function(t){return m.test(t)},isWidgetIframeURL:function(t){return v.test(t)},isSearchUrl:function(t){return g.test(t)},regexen:{profile:i},momentId:function(t){return f.test(t)&&RegExp.$1},collectionId:function(t){return d.test(t)&&RegExp.$1},intentType:function(t){return c.test(t)&&RegExp.$1},likesScreenName:function(t){return l.test(t)&&RegExp.$1},listScreenNameAndSlug:function(t){var e,n,r;if(h.test(t)){e=RegExp.$1,n=RegExp.$2;try{r=decodeURIComponent(n)}catch(t){}return{ownerScreenName:e,slug:r||n}}return!1},eventId:function(t){return p.test(t)&&RegExp.$1}}},function(t,e){t.exports=document},function(t,e,n){var r=n(0),i=[!0,1,\"1\",\"on\",\"ON\",\"true\",\"TRUE\",\"yes\",\"YES\"],o=[!1,0,\"0\",\"off\",\"OFF\",\"false\",\"FALSE\",\"no\",\"NO\"];function s(t){return void 0!==t&&null!==t&&\"\"!==t}function a(t){return c(t)&&t%1==0}function u(t){return c(t)&&!a(t)}function c(t){return s(t)&&!isNaN(t)}function d(t){return r.contains(o,t)}function f(t){return r.contains(i,t)}t.exports={hasValue:s,isInt:a,isFloat:u,isNumber:c,isString:function(t){return\"string\"===r.toType(t)},isArray:function(t){return s(t)&&\"array\"==r.toType(t)},isTruthValue:f,isFalseValue:d,asInt:function(t){if(a(t))return parseInt(t,10)},asFloat:function(t){if(u(t))return t},asNumber:function(t){if(c(t))return t},asBoolean:function(t){return!(!s(t)||!f(t)&&(d(t)||!t))}}},function(t,e,n){var r=n(1),i=n(21),o=n(48);i.hasPromiseSupport()||(r.Promise=o),t.exports=r.Promise},function(t,e,n){var r=n(0);t.exports=function(t,e){var n=Array.prototype.slice.call(arguments,2);return function(){var i=r.toRealArray(arguments);return t.apply(e,n.concat(i))}}},function(t,e){t.exports=location},function(t,e,n){var r=n(50);t.exports=new r(\"__twttr\")},function(t,e,n){var r=n(0),i=/\\b([\\w-_]+)\\b/g;function o(t){return new RegExp(\"\\\\b\"+t+\"\\\\b\",\"g\")}function s(t,e){t.classList?t.classList.add(e):o(e).test(t.className)||(t.className+=\" \"+e)}function a(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(o(e),\" \")}function u(t,e){return t.classList?t.classList.contains(e):r.contains(c(t),e)}function c(t){return r.toRealArray(t.classList?t.classList:t.className.match(i))}t.exports={add:s,remove:a,replace:function(t,e,n){if(t.classList&&u(t,e))return a(t,e),void s(t,n);t.className=t.className.replace(o(e),n)},toggle:function(t,e,n){return void 0===n&&t.classList&&t.classList.toggle?t.classList.toggle(e,n):(n?s(t,e):a(t,e),n)},present:u,list:c}},function(t,e,n){var r=n(5),i=n(0);function o(t){return encodeURIComponent(t).replace(/\\+/g,\"%2B\").replace(/'/g,\"%27\")}function s(t){return decodeURIComponent(t)}function a(t){var e=[];return i.forIn(t,function(t,n){var s=o(t);i.isType(\"array\",n)||(n=[n]),n.forEach(function(t){r.hasValue(t)&&e.push(s+\"=\"+o(t))})}),e.sort().join(\"&\")}function u(t){var e={};return t?(t.split(\"&\").forEach(function(t){var n=t.split(\"=\"),r=s(n[0]),o=s(n[1]);if(2==n.length){if(!i.isType(\"array\",e[r]))return r in e?(e[r]=[e[r]],void e[r].push(o)):void(e[r]=o);e[r].push(o)}}),e):{}}t.exports={url:function(t,e){return a(e).length>0?i.contains(t,\"?\")?t+\"&\"+a(e):t+\"?\"+a(e):t},decodeURL:function(t){var e=t&&t.split(\"?\");return 2==e.length?u(e[1]):{}},decode:u,encode:a,encodePart:o,decodePart:s}},function(t,e,n){var r=n(8),i=n(1),o=n(0),s={},a=o.contains(r.href,\"tw_debug=true\");function u(){}function c(){}function d(){return i.performance&&+i.performance.now()||+new Date}function f(t,e){if(i.console&&i.console[t])switch(e.length){case 1:i.console[t](e[0]);break;case 2:i.console[t](e[0],e[1]);break;case 3:i.console[t](e[0],e[1],e[2]);break;case 4:i.console[t](e[0],e[1],e[2],e[3]);break;case 5:i.console[t](e[0],e[1],e[2],e[3],e[4]);break;default:0!==e.length&&i.console.warn&&i.console.warn(\"too many params passed to logger.\"+t)}}t.exports={devError:u,devInfo:c,devObject:function(t,e){},publicError:function(){f(\"error\",o.toRealArray(arguments))},publicLog:function(){f(\"info\",o.toRealArray(arguments))},time:function(t){a&&(s[t]=d())},timeEnd:function(t){a&&s[t]&&(d(),s[t])}}},function(t,e,n){var r=n(20),i=n(5),o=n(11),s=n(0),a=n(118);t.exports=function(t){var e=t.href&&t.href.split(\"?\")[1],n=e?o.decode(e):{},u={lang:a(t),width:t.getAttribute(\"data-width\")||t.getAttribute(\"width\"),height:t.getAttribute(\"data-height\")||t.getAttribute(\"height\"),related:t.getAttribute(\"data-related\"),partner:t.getAttribute(\"data-partner\")};return i.asBoolean(t.getAttribute(\"data-dnt\"))&&r.setOn(),s.forIn(u,function(t,e){var r=n[t];n[t]=i.hasValue(r)?r:e}),s.compact(n)}},function(t,e,n){var r=n(78),i=n(23);t.exports=function(){var t=\"data-twitter-extracted-\"+i.generate();return function(e,n){return r(e,n).filter(function(e){return!e.hasAttribute(t)}).map(function(e){return e.setAttribute(t,\"true\"),e})}}},function(t,e){function n(t,e,n,r,i,o,s){this.factory=t,this.Sandbox=e,this.srcEl=o,this.targetEl=i,this.parameters=r,this.className=n,this.options=s}n.prototype.destroy=function(){this.srcEl=this.targetEl=null},t.exports=n},function(t,e){t.exports={DM_BUTTON:\"twitter-dm-button\",FOLLOW_BUTTON:\"twitter-follow-button\",HASHTAG_BUTTON:\"twitter-hashtag-button\",MENTION_BUTTON:\"twitter-mention-button\",MOMENT:\"twitter-moment\",PERISCOPE:\"periscope-on-air\",SHARE_BUTTON:\"twitter-share-button\",TIMELINE:\"twitter-timeline\",TWEET:\"twitter-tweet\"}},function(t,e,n){var r=n(6),i=n(20),o=n(52),s=n(35),a=n(5),u=n(0);t.exports=function(t,e,n){var c;return t=t||[],e=e||{},c=\"ƒ(\"+t.join(\", \")+\", target, [options]);\",function(){var d,f,l,h,p=Array.prototype.slice.apply(arguments,[0,t.length]),m=Array.prototype.slice.apply(arguments,[t.length]);return m.forEach(function(t){t&&(t.nodeType!==Node.ELEMENT_NODE?u.isType(\"function\",t)?d=t:u.isType(\"object\",t)&&(f=t):l=t)}),p.length!==t.length||0===m.length?(d&&u.async(function(){d(!1)}),r.reject(new Error(\"Not enough parameters. Expected: \"+c))):l?(f=u.aug({},f||{},e),t.forEach(function(t){f[t]=p.shift()}),a.asBoolean(f.dnt)&&i.setOn(),h=s.getExperiments().then(function(t){return o.addWidget(n(f,l,void 0,t))}),d&&h.then(d,function(){d(!1)}),h):(d&&u.async(function(){d(!1)}),r.reject(new Error(\"No target element specified. Expected: \"+c)))}}},function(t,e,n){var r=n(99),i=n(2),o=n(0);function s(t,e){return function(){try{e.resolve(t.call(this))}catch(t){e.reject(t)}}}t.exports={sync:function(t,e){t.call(e)},read:function(t,e){var n=new i;return r.read(s(t,n),e),n.promise},write:function(t,e){var n=new i;return r.write(s(t,n),e),n.promise},defer:function(t,e,n){var a=new i;return o.isType(\"function\",t)&&(n=e,e=t,t=1),r.defer(t,s(e,a),n),a.promise}}},function(t,e,n){var r=n(9),i=[\"https://syndication.twitter.com\",\"https://cdn.syndication.twimg.com\",\"https://localhost.twitter.com:8444\"],o=[\"https://syndication.twitter.com\",\"https://localhost.twitter.com:8445\"],s=[\"https://platform.twitter.com/embed/index.html\",\"https://localhost.twitter.com\",/https:\\/\\/ton\\.smf1\\.twitter\\.com\\/syndication-internal\\/embed-iframe\\/[0-9A-Za-z_-]+\\/app\\/index\\.html/],a=function(t,e){return t.some(function(t){return t instanceof RegExp?t.test(e):t===e})},u=function(){var t=r.get(\"backendHost\");return t&&a(i,t)?t:\"https://cdn.syndication.twimg.com\"},c=function(){var t=r.get(\"settingsSvcHost\");return t&&a(o,t)?t:\"https://syndication.twitter.com\"},d=function(){var t=r.get(\"embedIframeURL\");return t&&a(s,t)?t:\"https://platform.twitter.com/embed/index.html\"};function f(t,e){var n=[t];return e.forEach(function(t){n.push(function(t){var e=(t||\"\").toString(),n=\"/\"===e.slice(0,1)?1:0,r=function(t){return\"/\"===t.slice(-1)}(e)?-1:void 0;return e.slice(n,r)}(t))}),n.join(\"/\")}t.exports={cookieConsent:function(t){var e=t||[];return e.unshift(\"cookie/consent\"),f(c(),e)},embedIframe:function(){return d()},eventVideo:function(t){var e=t||[];return e.unshift(\"video/event\"),f(u(),e)},grid:function(t){var e=t||[];return e.unshift(\"grid/collection\"),f(u(),e)},moment:function(t){var e=t||[];return e.unshift(\"moments\"),f(u(),e)},settings:function(t){var e=t||[];return e.unshift(\"settings\"),f(c(),e)},timeline:function(t){var e=t||[];return e.unshift(\"timeline\"),f(u(),e)},tweetBatch:function(t){var e=t||[];return e.unshift(\"tweets.json\"),f(u(),e)},video:function(t){var e=t||[];return e.unshift(\"widgets/video\"),f(u(),e)}}},function(t,e,n){var r=n(4),i=n(8),o=n(39),s=n(102),a=n(5),u=n(34),c=!1,d=/https?:\\/\\/([^/]+).*/i;t.exports={setOn:function(){c=!0},enabled:function(t,e){return!!(c||a.asBoolean(u.val(\"dnt\"))||s.isUrlSensitive(e||i.host)||o.isFramed()&&s.isUrlSensitive(o.rootDocumentLocation())||(t=d.test(t||r.referrer)&&RegExp.$1)&&s.isUrlSensitive(t))}}},function(t,e,n){var r=n(4),i=n(12),o=n(93),s=n(1),a=n(0),u=o.userAgent;function c(t){return/(Trident|MSIE|Edge[/ ]?\\d)/.test(t=t||u)}t.exports={retina:function(t){return(t=t||s).devicePixelRatio?t.devicePixelRatio>=1.5:!!t.matchMedia&&t.matchMedia(\"only screen and (min-resolution: 144dpi)\").matches},anyIE:c,ie9:function(t){return/MSIE 9/.test(t=t||u)},ie10:function(t){return/MSIE 10/.test(t=t||u)},ios:function(t){return/(iPad|iPhone|iPod)/.test(t=t||u)},android:function(t){return/^Mozilla\\/5\\.0 \\(Linux; (U; )?Android/.test(t=t||u)},canPostMessage:function(t,e){return t=t||s,e=e||u,t.postMessage&&!(c(e)&&t.opener)},touch:function(t,e,n){return t=t||s,e=e||o,n=n||u,\"ontouchstart\"in t||/Opera Mini/.test(n)||e.msMaxTouchPoints>0},cssTransitions:function(){var t=r.body.style;return void 0!==t.transition||void 0!==t.webkitTransition||void 0!==t.mozTransition||void 0!==t.oTransition||void 0!==t.msTransition},hasPromiseSupport:function(){return!!(s.Promise&&s.Promise.resolve&&s.Promise.reject&&s.Promise.all&&s.Promise.race&&(new s.Promise(function(e){t=e}),a.isType(\"function\",t)));var t},hasIntersectionObserverSupport:function(){return!!s.IntersectionObserver},hasPerformanceInformation:function(){return s.performance&&s.performance.getEntriesByType},hasLocalStorageSupport:function(){try{return s.localStorage.setItem(\"local_storage_support_test\",\"true\"),void 0!==s.localStorage}catch(t){return i.devError(\"window.localStorage is not supported:\",t),!1}}}},function(t,e,n){var r=n(6),i=n(2);function o(t,e){return t.then(e,e)}function s(t){return t instanceof r}t.exports={always:o,allResolved:function(t){var e;return void 0===t?r.reject(new Error(\"undefined is not an object\")):Array.isArray(t)?(e=t.length)?new r(function(n,r){var i=0,o=[];function a(){(i+=1)===e&&(0===o.length?r():n(o))}function u(t){o.push(t),a()}t.forEach(function(t){s(t)?t.then(u,a):u(t)})}):r.resolve([]):r.reject(new Error(\"Type error\"))},some:function(t){var e;return e=(t=t||[]).length,t=t.filter(s),e?e!==t.length?r.reject(\"non-Promise passed to .some\"):new r(function(e,n){var r=0;function i(){(r+=1)===t.length&&n()}t.forEach(function(t){t.then(e,i)})}):r.reject(\"no promises passed to .some\")},isPromise:s,allSettled:function(t){function e(){}return r.all((t||[]).map(function(t){return o(t,e)}))},timeout:function(t,e){var n=new i;return setTimeout(function(){n.reject(new Error(\"Promise timed out\"))},e),t.then(function(t){n.resolve(t)},function(t){n.reject(t)}),n.promise}}},function(t,e){var n=\"i\",r=0,i=0;t.exports={generate:function(){return n+String(+new Date)+Math.floor(1e5*Math.random())+r++},deterministic:function(){return n+String(i++)}}},function(t,e,n){var r=n(49),i=n(51),o=n(0);t.exports=o.aug(r.get(\"events\")||{},i.Emitter)},function(t,e,n){var r=n(26),i=n(108);t.exports=r.build([i])},function(t,e,n){var r=n(40),i=n(105),o=n(7);(r=Object.create(r)).build=o(r.build,null,i),t.exports=r},function(t,e,n){var r=n(40),i=n(41),o=n(7);(r=Object.create(r)).build=o(r.build,null,i),t.exports=r},function(t,e,n){var r=n(80),i=n(75),o=n(81),s=n(8),a=n(70),u=n(74),c=n(20),d=n(5),f=n(23),l=n(0);function h(t){if(!t||!t.headers)throw new Error(\"unexpected response schema\");return{html:t.body,config:t.config,pollInterval:1e3*parseInt(t.headers.xPolling,10)||null,maxCursorPosition:t.headers.maxPosition,minCursorPosition:t.headers.minPosition}}function p(t){if(t&&t.headers)throw new Error(t.headers.status);throw t instanceof Error?t:new Error(t)}t.exports=function(t){t.params({instanceId:{required:!0,fallback:f.deterministic},lang:{required:!0,transform:a.matchLanguage,fallback:\"en\"},tweetLimit:{transform:d.asInt}}),t.defineProperty(\"endpoint\",{get:function(){throw new Error(\"endpoint not specified\")}}),t.defineProperty(\"pollEndpoint\",{get:function(){return this.endpoint}}),t.define(\"cbId\",function(t){var e=t?\"_new\":\"_old\";return\"tl_\"+this.params.instanceId+\"_\"+this.id+e}),t.define(\"queryParams\",function(){return{lang:this.params.lang,tz:u.getTimezoneOffset(),t:r(),domain:s.host,tweet_limit:this.params.tweetLimit,dnt:c.enabled()}}),t.define(\"fetch\",function(){return i.fetch(this.endpoint,this.queryParams(),o,this.cbId()).then(h,p)}),t.define(\"poll\",function(t,e){var n,r;return n={since_id:(t=t||{}).sinceId,max_id:t.maxId,min_position:t.minPosition,max_position:t.maxPosition},r=l.aug(this.queryParams(),n),i.fetch(this.pollEndpoint,r,o,this.cbId(e)).then(h,p)})}},function(t,e,n){var r=n(51).makeEmitter();t.exports={emitter:r,START:\"start\",ALL_WIDGETS_RENDER_START:\"all_widgets_render_start\",ALL_WIDGETS_RENDER_END:\"all_widgets_render_end\",ALL_WIDGETS_AND_IMAGES_LOADED:\"all_widgets_and_images_loaded\"}},function(t,e,n){var r=n(47),i=n(4),o=n(20),s=n(33),a=n(71),u=n(32),c=n(9),d=n(3),f=n(0),l=1,h=r.version,p=c.get(\"clientEventEndpoint\")||\"https://syndication.twitter.com/i/jot\";function m(t){return f.aug({client:\"tfw\"},t||{})}function v(t,e,n){return e=e||{},f.aug({},e,{_category_:t,triggered_on:e.triggered_on||+new Date,dnt:o.enabled(n)})}t.exports={extractTermsFromDOM:function t(e,n){var r;return n=n||{},e&&e.nodeType===Node.ELEMENT_NODE?((r=e.getAttribute(\"data-scribe\"))&&r.split(\" \").forEach(function(t){var e=t.trim().split(\":\"),r=e[0],i=e[1];r&&i&&!n[r]&&(n[r]=i)}),t(e.parentNode,n)):n},clickEventElement:function(t){var e=s.closest(\"[data-expanded-url]\",t),n=e&&e.getAttribute(\"data-expanded-url\");return n&&d.isTwitterURL(n)?\"twitter_url\":\"url\"},flattenClientEventPayload:function(t,e){return f.aug({},e,{event_namespace:t})},formatGenericEventData:v,formatClientEventData:function(t,e,n){var r=t&&t.widget_origin||i.referrer;return(t=v(\"tfw_client_event\",t,r)).client_version=h,t.format_version=void 0!==n?n:1,e||(t.widget_origin=r),t},formatClientEventNamespace:m,formatHorizonTweetData:function(t){var e={item_ids:[],item_details:{}};return e.item_ids.push(t),e.item_details[t]={item_type:a.TWEET},e},formatTweetAssociation:function(t,e){var n={};return(e=e||{}).association_namespace=m(t),n[l]=e,n},noticeSeen:function(t){return\"notice\"===t.element&&\"seen\"===t.action},splitLogEntry:function(t){var e,n,r,i,o;return t.item_ids&&t.item_ids.length>1?(e=Math.floor(t.item_ids.length/2),n=t.item_ids.slice(0,e),r={},i=t.item_ids.slice(e),o={},n.forEach(function(e){r[e]=t.item_details[e]}),i.forEach(function(e){o[e]=t.item_details[e]}),[f.aug({},t,{item_ids:n,item_details:r}),f.aug({},t,{item_ids:i,item_details:o})]):[t]},stringify:function(t){var e,n=Array.prototype.toJSON;return delete Array.prototype.toJSON,e=u.stringify(t),n&&(Array.prototype.toJSON=n),e},CLIENT_EVENT_ENDPOINT:p,RUFOUS_REDIRECT:\"https://platform.twitter.com/jot.html\"}},function(t,e,n){var r=n(4),i=n(0);t.exports=function(t,e,n){var o;if(n=n||r,t=t||{},e=e||{},t.name){try{o=n.createElement('<iframe name=\"'+t.name+'\"><\/iframe>')}catch(e){(o=n.createElement(\"iframe\")).name=t.name}delete t.name}else o=n.createElement(\"iframe\");return t.id&&(o.id=t.id,delete t.id),o.allowtransparency=\"true\",o.scrolling=\"no\",o.setAttribute(\"frameBorder\",0),o.setAttribute(\"allowTransparency\",!0),i.forIn(t,function(t,e){o.setAttribute(t,e)}),i.forIn(e,function(t,e){o.style[t]=e}),o}},function(t,e,n){var r=n(1).JSON;t.exports={stringify:r.stringify||r.encode,parse:r.parse||r.decode}},function(t,e,n){var r=n(0),i=n(43);t.exports={closest:function t(e,n,o){var s;if(n)return o=o||n&&n.ownerDocument,s=r.isType(\"function\",e)?e:function(t){return function(e){return!!e.tagName&&i(e,t)}}(e),n===o?s(n)?n:void 0:s(n)?n:t(s,n.parentNode,o)}}},function(t,e,n){var r,i=n(4);function o(t){var e,n,o,s=0;for(r={},e=(t=t||i).getElementsByTagName(\"meta\");e[s];s++){if(n=e[s],/^twitter:/.test(n.getAttribute(\"name\")))o=n.getAttribute(\"name\").replace(/^twitter:/,\"\");else{if(!/^twitter:/.test(n.getAttribute(\"property\")))continue;o=n.getAttribute(\"property\").replace(/^twitter:/,\"\")}r[o]=n.getAttribute(\"content\")||n.getAttribute(\"value\")}}o(),t.exports={init:o,val:function(t){return r[t]}}},function(t,e,n){var r=n(112),i=n(115);function o(t){return r.settingsLoaded().then(function(e){return e[t]})}function s(){return o(\"features\")}t.exports={shouldObtainCookieConsent:function(){return o(\"shouldObtainCookieConsent\")},getExperiments:s,getExperiment:function(t){return s().then(function(e){if(!e[t])throw new Error(\"Experiment not found\");return e[t]})},getActiveExperimentDataString:function(){return s().then(function(t){var e=Object.keys(t).reduce(function(e,n){var r;return t[n].version&&(r=n.split(\"_\").slice(-1)[0],e.push(r+\";\"+t[n].bucket)),e},[]);return i(e.join(\",\"))})},getExperimentKeys:function(){return s().then(function(t){return Object.keys(t)})},load:function(){r.load()}}},function(t,e,n){var r=n(10),i={},o=-1,s={};function a(t){var e=t.getAttribute(\"data-twitter-event-id\");return e||(t.setAttribute(\"data-twitter-event-id\",++o),o)}function u(t,e,n){var r=0,i=t&&t.length||0;for(r=0;r<i;r++)if(t[r].call(e,n,e),n.ceaseImmediately)return!1}function c(t,e,n){for(var i=n||t.target||t.srcElement,o=r.list(i).map(function(t){return\".\"+t}).concat(i.tagName),s=0,a=o.length;s<a;s++)if(!1===u(e[o[s]],i,t))return;t.cease||i!==this&&c.call(this,t,e,i.parentElement||i.parentNode)}function d(t,e,n,r){function i(r){c.call(t,r,n[e])}!function(t,e,n,r){t.id&&(s[t.id]=s[t.id]||[],s[t.id].push({el:t,listener:e,type:n,rootId:r}))}(t,i,e,r),t.addEventListener(e,i,!1)}function f(t){t&&t.preventDefault?t.preventDefault():t.returnValue=!1}function l(t){t&&(t.cease=!0)&&t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}t.exports={stop:function(t){return l(t),f(t),!1},stopPropagation:l,stopImmediatePropagation:function(t){t&&(t.ceaseImmediately=!0,l(t),t.stopImmediatePropagation())},preventDefault:f,delegate:function(t,e,n,r){var o=a(t);i[o]=i[o]||{},i[o][e]||(i[o][e]={},d(t,e,i[o],o)),i[o][e][n]=i[o][e][n]||[],i[o][e][n].push(r)},simulate:function(t,e,n){var r=a(e),o=i[r]&&i[r];c.call(e,{target:n},o[t])},removeDelegatesForWidget:function(t){var e=s[t];e&&(e.forEach(function(t){t.el.removeEventListener(t.type,t.listener,!1),delete i[t.rootId]}),delete s[t])}}},function(t,e,n){var r=n(101),i=n(110),o=new(n(111))(function(t){(!function(t){return 1===t.length&&i.canFlushOneItem(t[0])}(t)?function(t){r.init(),t.forEach(function(t){var e=t.input.namespace,n=t.input.data,i=t.input.offsite,o=t.input.version;r.clientEvent(e,n,i,o)}),r.flush().then(function(){t.forEach(function(t){t.taskDoneDeferred.resolve()})},function(){t.forEach(function(t){t.taskDoneDeferred.reject()})})}:function(t){t.forEach(function(t){var e=t.input.namespace,n=t.input.data,r=t.input.offsite,o=t.input.version;i.clientEvent(e,n,r,o),t.taskDoneDeferred.resolve()})})(t)});t.exports={scribe:function(t,e,n,r){return o.add({namespace:t,data:e,offsite:n,version:r})},pause:function(){o.pause()},resume:function(){o.resume()}}},function(t,e,n){var r=n(26),i=n(124);t.exports=r.build([i])},function(t,e,n){var r=n(8),i=n(77),o=n(0),s=i.getCanonicalURL()||r.href,a=s;t.exports={isFramed:function(){return s!==a},rootDocumentLocation:function(t){return t&&o.isType(\"string\",t)&&(s=t),s},currentDocumentLocation:function(){return a}}},function(t,e,n){var r=n(103),i=n(104),o=n(0);t.exports={couple:function(){return o.toRealArray(arguments)},build:function(t,e,n){var o=new t;return(e=i(r(e||[]))).forEach(function(t){t.call(null,o)}),o.build(n)}}},function(t,e,n){var r=n(106),i=n(0),o=n(42);function s(){this.Component=this.factory(),this._adviceArgs=[],this._lastArgs=[]}i.aug(s.prototype,{factory:o,build:function(t){var e=this;return this.Component,i.aug(this.Component.prototype.boundParams,t),this._adviceArgs.concat(this._lastArgs).forEach(function(t){(function(t,e,n){var r=this[e];if(!r)throw new Error(e+\" does not exist\");this[e]=t(r,n)}).apply(e.Component.prototype,t)}),delete this._lastArgs,delete this._adviceArgs,this.Component},params:function(t){var e=this.Component.prototype.paramConfigs;t=t||{},this.Component.prototype.paramConfigs=i.aug({},t,e)},define:function(t,e){if(t in this.Component.prototype)throw new Error(t+\" has previously been defined\");this.override(t,e)},defineStatic:function(t,e){this.Component[t]=e},override:function(t,e){this.Component.prototype[t]=e},defineProperty:function(t,e){if(t in this.Component.prototype)throw new Error(t+\" has previously been defined\");this.overrideProperty(t,e)},overrideProperty:function(t,e){var n=i.aug({configurable:!0},e);Object.defineProperty(this.Component.prototype,t,n)},before:function(t,e){this._adviceArgs.push([r.before,t,e])},after:function(t,e){this._adviceArgs.push([r.after,t,e])},around:function(t,e){this._adviceArgs.push([r.around,t,e])},last:function(t,e){this._lastArgs.push([r.after,t,e])}}),t.exports=s},function(t,e,n){var r=n(0);function i(){return!0}function o(t){return t}t.exports=function(){function t(t){var e=this;t=t||{},this.params=Object.keys(this.paramConfigs).reduce(function(n,s){var a=[],u=e.boundParams,c=e.paramConfigs[s],d=c.validate||i,f=c.transform||o;if(s in u&&a.push(u[s]),s in t&&a.push(t[s]),a=\"fallback\"in c?a.concat(c.fallback):a,n[s]=function(t,e,n){var i=null;return t.some(function(t){if(t=r.isType(\"function\",t)?t():t,e(t))return i=n(t),!0}),i}(a,d,f),c.required&&null==n[s])throw new Error(s+\" is a required parameter\");return n},{}),this.initialize()}return r.aug(t.prototype,{paramConfigs:{},boundParams:{},initialize:function(){}}),t}},function(t,e,n){var r=n(1).HTMLElement,i=r.prototype.matches||r.prototype.matchesSelector||r.prototype.webkitMatchesSelector||r.prototype.mozMatchesSelector||r.prototype.msMatchesSelector||r.prototype.oMatchesSelector;t.exports=function(t,e){if(i)return i.call(t,e)}},function(t,e,n){var r,i=n(10),o=n(4),s=n(1),a=n(34),u=n(53),c=n(5),d=n(23),f=\"csptest\";t.exports={inlineStyle:function(){var t=f+d.generate(),e=o.createElement(\"div\"),n=o.createElement(\"style\"),l=\".\"+t+\" { visibility: hidden; }\";return!!o.body&&(c.asBoolean(a.val(\"widgets:csp\"))&&(r=!1),void 0!==r?r:(e.style.display=\"none\",i.add(e,t),n.type=\"text/css\",n.appendChild(o.createTextNode(l)),o.body.appendChild(n),o.body.appendChild(e),r=\"hidden\"===s.getComputedStyle(e).visibility,u(e),u(n),r))}}},function(t,e,n){var r=n(1);t.exports=function(t,e,n){var i,o=0;return n=n||null,function s(){var a=n||this,u=arguments,c=+new Date;if(r.clearTimeout(i),c-o>e)return o=c,void t.apply(a,u);i=r.setTimeout(function(){s.apply(a,u)},e)}}},function(t,e){t.exports=function(t){var e=t.getBoundingClientRect();return{width:e.width,height:e.height}}},function(t){t.exports={version:\"ed20a2b:1601588405575\"}},function(t,e,n){\r\n/*!\r\n * @overview es6-promise - a tiny implementation of Promises/A+.\r\n * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)\r\n * @license   Licensed under MIT license\r\n *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE\r\n * @version   v4.2.5+7f2b526d\r\n */var r;r=function(){\"use strict\";function t(t){return\"function\"==typeof t}var e=Array.isArray?Array.isArray:function(t){return\"[object Array]\"===Object.prototype.toString.call(t)},n=0,r=void 0,i=void 0,o=function(t,e){l[n]=t,l[n+1]=e,2===(n+=2)&&(i?i(h):w())},s=\"undefined\"!=typeof window?window:void 0,a=s||{},u=a.MutationObserver||a.WebKitMutationObserver,c=\"undefined\"==typeof self&&\"undefined\"!=typeof process&&\"[object process]\"==={}.toString.call(process),d=\"undefined\"!=typeof Uint8ClampedArray&&\"undefined\"!=typeof importScripts&&\"undefined\"!=typeof MessageChannel;function f(){var t=setTimeout;return function(){return t(h,1)}}var l=new Array(1e3);function h(){for(var t=0;t<n;t+=2)(0,l[t])(l[t+1]),l[t]=void 0,l[t+1]=void 0;n=0}var p,m,v,g,w=void 0;function y(t,e){var n=this,r=new this.constructor(E);void 0===r[_]&&k(r);var i=n._state;if(i){var s=arguments[i-1];o(function(){return D(i,r,s,n._result)})}else I(n,r,t,e);return r}function b(t){if(t&&\"object\"==typeof t&&t.constructor===this)return t;var e=new this(E);return C(e,t),e}c?w=function(){return process.nextTick(h)}:u?(m=0,v=new u(h),g=document.createTextNode(\"\"),v.observe(g,{characterData:!0}),w=function(){g.data=m=++m%2}):d?((p=new MessageChannel).port1.onmessage=h,w=function(){return p.port2.postMessage(0)}):w=void 0===s?function(){try{var t=Function(\"return this\")().require(\"vertx\");return void 0!==(r=t.runOnLoop||t.runOnContext)?function(){r(h)}:f()}catch(t){return f()}}():f();var _=Math.random().toString(36).substring(2);function E(){}var x=void 0,T=1,S=2,A={error:null};function R(t){try{return t.then}catch(t){return A.error=t,A}}function N(e,n,r){n.constructor===e.constructor&&r===y&&n.constructor.resolve===b?function(t,e){e._state===T?L(t,e._result):e._state===S?j(t,e._result):I(e,void 0,function(e){return C(t,e)},function(e){return j(t,e)})}(e,n):r===A?(j(e,A.error),A.error=null):void 0===r?L(e,n):t(r)?function(t,e,n){o(function(t){var r=!1,i=function(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}(n,e,function(n){r||(r=!0,e!==n?C(t,n):L(t,n))},function(e){r||(r=!0,j(t,e))},t._label);!r&&i&&(r=!0,j(t,i))},t)}(e,n,r):L(e,n)}function C(t,e){var n,r;t===e?j(t,new TypeError(\"You cannot resolve a promise with itself\")):(r=typeof(n=e),null===n||\"object\"!==r&&\"function\"!==r?L(t,e):N(t,e,R(e)))}function P(t){t._onerror&&t._onerror(t._result),O(t)}function L(t,e){t._state===x&&(t._result=e,t._state=T,0!==t._subscribers.length&&o(O,t))}function j(t,e){t._state===x&&(t._state=S,t._result=e,o(P,t))}function I(t,e,n,r){var i=t._subscribers,s=i.length;t._onerror=null,i[s]=e,i[s+T]=n,i[s+S]=r,0===s&&t._state&&o(O,t)}function O(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,i=void 0,o=t._result,s=0;s<e.length;s+=3)r=e[s],i=e[s+n],r?D(n,r,i,o):i(o);t._subscribers.length=0}}function D(e,n,r,i){var o=t(r),s=void 0,a=void 0,u=void 0,c=void 0;if(o){if((s=function(t,e){try{return t(e)}catch(t){return A.error=t,A}}(r,i))===A?(c=!0,a=s.error,s.error=null):u=!0,n===s)return void j(n,new TypeError(\"A promises callback cannot return that same promise.\"))}else s=i,u=!0;n._state!==x||(o&&u?C(n,s):c?j(n,a):e===T?L(n,s):e===S&&j(n,s))}var z=0;function k(t){t[_]=z++,t._state=void 0,t._result=void 0,t._subscribers=[]}var M=function(){function t(t,n){this._instanceConstructor=t,this.promise=new t(E),this.promise[_]||k(this.promise),e(n)?(this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),0===this.length?L(this.promise,this._result):(this.length=this.length||0,this._enumerate(n),0===this._remaining&&L(this.promise,this._result))):j(this.promise,new Error(\"Array Methods must be provided an Array\"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===x&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===b){var i=R(t);if(i===y&&t._state!==x)this._settledAt(t._state,e,t._result);else if(\"function\"!=typeof i)this._remaining--,this._result[e]=t;else if(n===U){var o=new n(E);N(o,t,i),this._willSettleAt(o,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===x&&(this._remaining--,t===S?j(r,n):this._result[e]=n),0===this._remaining&&L(r,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;I(t,void 0,function(t){return n._settledAt(T,e,t)},function(t){return n._settledAt(S,e,t)})},t}(),U=function(){function e(t){this[_]=z++,this._result=this._state=void 0,this._subscribers=[],E!==t&&(\"function\"!=typeof t&&function(){throw new TypeError(\"You must pass a resolver function as the first argument to the promise constructor\")}(),this instanceof e?function(t,e){try{e(function(e){C(t,e)},function(e){j(t,e)})}catch(e){j(t,e)}}(this,t):function(){throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return t(e)?this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})}):this.then(e,e)},e}();return U.prototype.then=y,U.all=function(t){return new M(this,t).promise},U.race=function(t){var n=this;return e(t)?new n(function(e,r){for(var i=t.length,o=0;o<i;o++)n.resolve(t[o]).then(e,r)}):new n(function(t,e){return e(new TypeError(\"You must pass an array to race.\"))})},U.resolve=b,U.reject=function(t){var e=new this(E);return j(e,t),e},U._setScheduler=function(t){i=t},U._setAsap=function(t){o=t},U._asap=o,U.polyfill=function(){var t=void 0;if(\"undefined\"!=typeof global)t=global;else if(\"undefined\"!=typeof self)t=self;else try{t=Function(\"return this\")()}catch(t){throw new Error(\"polyfill failed because global object is unavailable in this environment\")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if(\"[object Promise]\"===n&&!e.cast)return}t.Promise=U},U.Promise=U,U},t.exports=r()},function(t,e,n){var r=n(50);t.exports=new r(\"twttr\")},function(t,e,n){var r=n(1),i=n(0);function o(t){return i.isType(\"string\",t)?t.split(\".\"):i.isType(\"array\",t)?t:[]}function s(t,e){(e=e||r)[t]=e[t]||{},Object.defineProperty(this,\"base\",{value:e[t]}),Object.defineProperty(this,\"name\",{value:t})}i.aug(s.prototype,{get:function(t){return o(t).reduce(function(t,e){if(i.isObject(t))return t[e]},this.base)},set:function(t,e,n){var r=o(t),s=function(t,e){var n=o(e).slice(0,-1);return n.reduce(function(t,e,r){if(t[e]=t[e]||{},!i.isObject(t[e]))throw new Error(n.slice(0,r+1).join(\".\")+\" is already defined with a value.\");return t[e]},t)}(this.base,t),a=r.slice(-1);return n&&a in s?s[a]:s[a]=e},init:function(t,e){return this.set(t,e,!0)},unset:function(t){var e=o(t),n=this.get(e.slice(0,-1));n&&delete n[e.slice(-1)]},aug:function(t){var e=this.get(t),n=i.toRealArray(arguments).slice(1);if(e=void 0!==e?e:{},n.unshift(e),!n.every(i.isObject))throw new Error(\"Cannot augment non-object.\");return this.set(t,i.aug.apply(null,n))},call:function(t){var e=this.get(t),n=i.toRealArray(arguments).slice(1);if(!i.isType(\"function\",e))throw new Error(\"Function \"+t+\"does not exist.\");return e.apply(null,n)},fullPath:function(t){var e=o(t);return e.unshift(this.name),e.join(\".\")}}),t.exports=s},function(t,e,n){var r=n(0),i=n(7),o={bind:function(t,e){return this._handlers=this._handlers||{},this._handlers[t]=this._handlers[t]||[],this._handlers[t].push(e)},unbind:function(t,e){var n;this._handlers&&this._handlers[t]&&(e?(n=this._handlers[t].indexOf(e))>=0&&this._handlers[t].splice(n,1):this._handlers[t]=[])},trigger:function(t,e){var n=this._handlers&&this._handlers[t];(e=e||{}).type=t,n&&n.forEach(function(t){r.async(i(t,this,e))})}};t.exports={Emitter:o,makeEmitter:function(){return r.aug(function(){},o)}}},function(t,e,n){var r=n(98),i=n(76),o=n(6),s=n(22),a=n(7),u=n(0),c=new i(function(t){var e=function(t){return t.reduce(function(t,e){return t[e._className]=t[e._className]||[],t[e._className].push(e),t},{})}(t.map(r.fromRawTask));u.forIn(e,function(t,e){s.allSettled(e.map(function(t){return t.initialize()})).then(function(){e.forEach(function(t){o.all([t.hydrate(),t.insertIntoDom()]).then(a(t.render,t)).then(a(t.success,t),a(t.fail,t))})})})});t.exports={addWidget:function(t){return c.add(t)}}},function(t,e,n){var r=n(18);t.exports=function(t){return r.write(function(){t&&t.parentNode&&t.parentNode.removeChild(t)})}},function(t,e,n){n(12),t.exports={log:function(t,e){}}},function(t,e,n){var r=n(1);function i(t){return(t=t||r).getSelection&&t.getSelection()}t.exports={getSelection:i,getSelectedText:function(t){var e=i(t);return e?e.toString():\"\"}}},function(t,e,n){var r=n(4),i=n(1),o=n(2),s=2e4;t.exports=function(t){var e=new o,n=r.createElement(\"img\");return n.onload=n.onerror=function(){i.setTimeout(e.resolve,50)},n.src=t,i.setTimeout(e.reject,s),e.promise}},function(t,e,n){var r=n(109);t.exports=function(t){t.define(\"createElement\",r),t.define(\"createFragment\",r),t.define(\"htmlToElement\",r),t.define(\"hasSelectedText\",r),t.define(\"addRootClass\",r),t.define(\"removeRootClass\",r),t.define(\"hasRootClass\",r),t.define(\"prependStyleSheet\",r),t.define(\"appendStyleSheet\",r),t.define(\"prependCss\",r),t.define(\"appendCss\",r),t.define(\"makeVisible\",r),t.define(\"injectWidgetEl\",r),t.define(\"matchHeightToContent\",r),t.define(\"matchWidthToContent\",r)}},function(t,e){t.exports=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments))}}},function(t,e,n){var r=n(15),i=n(119),o=n(60),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.DM_BUTTON,t,e,n)}},function(t,e,n){var r=n(61),i=n(25);t.exports=r.isSupported()?r:i},function(t,e,n){var r=n(26),i=n(120);t.exports=r.build([i])},function(t,e,n){var r=n(15),i=n(123),o=n(38),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.FOLLOW_BUTTON,t,e,n)}},function(t,e,n){var r=n(15),i=n(131),o=n(25),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.MOMENT,t,e,n)}},function(t,e,n){var r=n(15),i=n(133),o=n(25),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.PERISCOPE,t,e,n)}},function(t,e,n){var r=n(79),i=n(135),o=n(139),s=n(141),a=n(143),u=n(145),c={collection:i,event:o,likes:s,list:a,profile:u,url:f},d=[u,s,i,a,o];function f(t){return r(d,function(e){try{return new e(t)}catch(t){}})}t.exports=function(t){return t?function(t){var e,n;return e=(t.sourceType+\"\").toLowerCase(),(n=c[e])?new n(t):null}(t)||f(t):null}},function(t,e,n){var r=n(15),i=n(147),o=n(25),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.TIMELINE,t,e,n)}},function(t,e,n){var r=n(4),i=n(149),o=n(150),s=n(15),a=n(38),u=n(151),c=n(60),d=n(152),f=n(16);t.exports=function(t,e,n,l){var h,p=i.isHorizonTweetEnabled(l,t);return o(l,t.tweetId),p?(h=r.createElement(\"div\"),new s(u,a,f.TWEET,t,e,n,{sandboxWrapperEl:h})):new s(d,c,f.TWEET,t,e,n)}},function(t,e,n){var r=n(15),i=n(154),o=n(38),s=n(16);t.exports=function(t,e,n){var a=t&&t.type||\"share\",u=\"hashtag\"==a?s.HASHTAG_BUTTON:\"mention\"==a?s.MENTION_BUTTON:s.SHARE_BUTTON;return new r(i,o,u,t,e,n)}},function(t,e,n){var r=n(37),i=n(39),o=n(0);t.exports=function(t){var e={widget_origin:i.rootDocumentLocation(),widget_frame:i.isFramed()?i.currentDocumentLocation():null,duration_ms:t.duration,item_ids:t.widgetIds||[]},n=o.aug(t.namespace,{page:\"page\",component:\"performance\"});r.scribe(n,e)}},function(t,e,n){var r=n(0),i=n(136),o=[\"ar\",\"fa\",\"he\",\"ur\"];t.exports={isRtlLang:function(t){return t=String(t).toLowerCase(),r.contains(o,t)},matchLanguage:function(t){return t=(t=(t||\"\").toLowerCase()).replace(\"_\",\"-\"),i(t)?t:(t=t.replace(/-.*/,\"\"),i(t)?t:\"en\")}}},function(t){t.exports={TWEET:0,RETWEET:10,CUSTOM_TIMELINE:17,LIVE_VIDEO_EVENT:28,QUOTE_TWEET:23}},function(t){t.exports={tweetButtonHtmlPath:\"/widgets/tweet_button.96fd96193cc66c3e11d4c5e4c7c7ec97.{{lang}}.html\",followButtonHtmlPath:\"/widgets/follow_button.96fd96193cc66c3e11d4c5e4c7c7ec97.{{lang}}.html\",hubHtmlPath:\"/widgets/hub.html\",widgetIframeHtmlPath:\"/widgets/widget_iframe.96fd96193cc66c3e11d4c5e4c7c7ec97.html\",resourceBaseUrl:\"https://platform.twitter.com\"}},function(t,e,n){var r=n(3),i=n(96),o=n(24),s=n(11),a={favorite:[\"favorite\",\"like\"],follow:[\"follow\"],like:[\"favorite\",\"like\"],retweet:[\"retweet\"],tweet:[\"tweet\"]};function u(t){this.srcEl=[],this.element=t}u.open=function(t,e,n){var u=(r.intentType(t)||\"\").toLowerCase();r.isTwitterURL(t)&&(function(t,e){i.open(t,e)}(t,n),e&&o.trigger(\"click\",{target:e,region:\"intent\",type:\"click\",data:{}}),e&&a[u]&&a[u].forEach(function(n){o.trigger(n,{target:e,region:\"intent\",type:n,data:function(t,e){var n=s.decodeURL(e);switch(t){case\"favorite\":case\"like\":return{tweet_id:n.tweet_id};case\"follow\":return{screen_name:n.screen_name,user_id:n.user_id};case\"retweet\":return{source_tweet_id:n.tweet_id};default:return{}}}(u,t)})}))},t.exports=u},function(t,e){t.exports={getTimezoneOffset:function(){var t=(new Date).toString().match(/(GMT[+-]?\\d+)/);return t&&t[0]||\"GMT\"}}},function(t,e,n){var r=n(4),i=n(9),o=n(2),s=n(0),a=n(11),u=\"cb\",c=0;t.exports={fetch:function(t,e,n,d){var f,l,h;return d=function(t){if(t)return t.replace(/[^\\w$]/g,\"_\")}(d||u+c++),f=i.fullPath([\"callbacks\",d]),l=r.createElement(\"script\"),h=new o,e=s.aug({},e,{callback:f,suppress_response_codes:!0}),i.set([\"callbacks\",d],function(t){var e;t=(e=n(t||!1)).resp,e.success?h.resolve(t):h.reject(t),l.onload=l.onreadystatechange=null,l.parentNode&&l.parentNode.removeChild(l),i.unset([\"callbacks\",d])}),l.onerror=function(){h.reject(new Error(\"failed to fetch \"+l.src))},l.src=a.url(t,e),l.async=\"async\",r.body.appendChild(l),h.promise}}},function(t,e,n){var r=n(2),i=n(100),o=n(7);function s(t){this._inputsQueue=[],this._task=t,this._hasFlushBeenScheduled=!1}s.prototype.add=function(t){var e=new r;return this._inputsQueue.push({input:t,taskDoneDeferred:e}),this._hasFlushBeenScheduled||(this._hasFlushBeenScheduled=!0,i(o(this._flush,this))),e.promise},s.prototype._flush=function(){try{this._task.call(null,this._inputsQueue)}catch(t){this._inputsQueue.forEach(function(e){e.taskDoneDeferred.reject(t)})}this._inputsQueue=[],this._hasFlushBeenScheduled=!1},t.exports=s},function(t,e,n){var r=n(4),i=n(8),o=n(3);function s(t,e){var n,r;return e=e||i,/^https?:\\/\\//.test(t)?t:/^\\/\\//.test(t)?e.protocol+t:(n=e.host+(e.port.length?\":\"+e.port:\"\"),0!==t.indexOf(\"/\")&&((r=e.pathname.split(\"/\")).pop(),r.push(t),t=\"/\"+r.join(\"/\")),[e.protocol,\"//\",n,t].join(\"\"))}t.exports={absolutize:s,getCanonicalURL:function(){for(var t,e=r.getElementsByTagName(\"link\"),n=0;e[n];n++)if(\"canonical\"==(t=e[n]).rel)return s(t.href)},getScreenNameFromPage:function(){for(var t,e,n,i=[r.getElementsByTagName(\"a\"),r.getElementsByTagName(\"link\")],s=0,a=0,u=/\\bme\\b/;t=i[s];s++)for(a=0;e=t[a];a++)if(u.test(e.rel)&&(n=o.screenName(e.href)))return n}}},function(t,e,n){var r=n(0),i=n(43);t.exports=function(t,e){return i(t,e)?[t]:r.toRealArray(t.querySelectorAll(e))}},function(t,e){t.exports=function(t,e,n){for(var r,i=0;i<t.length;i++)if(r=e.call(n,t[i],i,t))return r}},function(t,e){t.exports=function(){return Math.floor(+new Date/9e5)}},function(t,e,n){var r=n(12);t.exports=function(t){var e,n;return e=t.headers&&t.headers.status,!(n=t&&!t.error&&200===e)&&t.headers&&t.headers.message&&r.publicError(t.headers.message),{success:n,resp:t}}},function(t,e,n){var r=n(37),i=n(30);t.exports=function(t,e,n,o){r.scribe(i.formatClientEventNamespace({client:\"tfw\",page:\"ddg\",section:t,action:\"experiment\"}),{experiment_key:t,bucket:e,version:n,data:o},!0)}},function(t,e,n){var r,i=n(29),o=0;function s(){r&&r.length===o&&(i.emitter.trigger(i.ALL_WIDGETS_AND_IMAGES_LOADED,r),r=null)}i.emitter.bind(i.ALL_WIDGETS_RENDER_END,function(t){r=t.widgets,s()}),t.exports={reportImagesLoadForAWidget:function(){o++,s()}}},,,,,,,,,function(t,e,n){var r,i=n(2),o=n(4),s=n(94),a=n(49),u=n(9),c=n(95),d=n(24),f=n(97),l=n(155),h=n(163),p=n(164),m=n(29),v=n(35);n(165),m.emitter.trigger(m.START),u.set(\"widgets.init\",!0),a.set(\"init\",!0),p(),r=new i,s.exposeReadyPromise(r.promise,a.base,\"_e\"),a.set(\"widgets\",l),a.set(\"widgets.load\",f.load),a.set(\"events\",d),h(function(){v.load(),r.resolve(a.base),c.attachTo(o),f.loadPage()})},function(t,e){t.exports=navigator},function(t,e,n){var r=n(7);t.exports={exposeReadyPromise:function(t,e,n){e.ready=r(t.then,t),n&&Array.isArray(e[n])&&(e[n].forEach(r(t.then,t)),delete e[n])}}},function(t,e,n){var r=n(8),i=n(36),o=n(33),s=n(73),a=n(3);function u(t){var e,n,u;t.altKey||t.metaKey||t.shiftKey||(e=o.closest(function(t){return\"A\"===t.tagName||\"AREA\"===t.tagName},t.target))&&a.isIntentURL(e.href)&&(n=(n=(n=[u=e.href,\"original_referer=\"+r.href].join(-1==u.indexOf(\"?\")?\"?\":\"&\")).replace(/^http[:]/,\"https:\")).replace(/^\\/\\//,\"https://\"),s.open(n,e),i.preventDefault(t))}t.exports={attachTo:function(t){t.addEventListener(\"click\",u,!1)}}},function(t,e,n){var r=n(1),i=n(36),o=n(33),s=n(21),a=n(3),u=n(23),c=\"intent_\";function d(t){this.win=t}d.prototype.open=function(t,e){var n=e&&\"click\"==e.type&&o.closest(\"a\",e.target),r=e&&(e.altKey||e.metaKey||e.shiftKey),d=n&&(s.ios()||s.android());if(a.isTwitterURL(t))return r||d?this:(this.name=c+u.generate(),this.popup=this.win.open(t,this.name),e&&i.preventDefault(e),this)},d.open=function(t,e){return new d(r).open(t,e)},t.exports=d},function(t,e,n){var r=n(4),i=n(6),o=n(22),s=n(52),a=n(34),u=n(9),c=n(37),d=n(24),f=n(5),l=n(0),h=n(35),p=n(116),m=n(29);function v(){var t=a.val(\"widgets:autoload\")||!0;return!f.isFalseValue(t)&&(f.isTruthValue(t)?r.body:r.querySelectorAll(t))}function g(t,e){var n,i;return t=(t=t||r.body).length?l.toRealArray(t):[t],c.pause(),i=function(t,e){return t.reduce(function(t,n){return t.concat(p.reduce(function(t,r){return t.concat(r(n,e))},[]))},[])}(t,e),m.emitter.trigger(m.ALL_WIDGETS_RENDER_START,{widgets:i}),n=o.allResolved(i.map(function(t){return s.addWidget(t)})).then(function(t){d.trigger(\"loaded\",{widgets:t}),t&&t.length&&m.emitter.trigger(m.ALL_WIDGETS_RENDER_END,{widgets:t})}),o.always(n,function(){c.resume()}),n}function w(t){return h.getExperiments().then(function(e){return g(t,e)})}t.exports={load:w,loadPage:function(){var t=v();return!1===t?i.resolve():(u.set(\"widgets.loaded\",!0),w(t))},_getPageLoadTarget:v}},function(t,e,n){var r=n(10),i=n(18),o=n(24),s=n(53),a=n(6),u=n(22);function c(t,e){this._widget=null,this._sandbox=null,this._hydrated=!1,this._insertedIntoDom=!1,this._Sandbox=t.Sandbox,this._factory=t.factory,this._widgetParams=t.parameters,this._resolve=e,this._className=t.className,this._renderedClassName=t.className+\"-rendered\",this._errorClassName=t.className+\"-error\",this._srcEl=t.srcEl,this._targetGlobal=function(t){return(t.srcEl||t.targetEl).ownerDocument.defaultView}(t),this._sandboxWrapperEl=t.options?t.options.sandboxWrapperEl:null,this._insertionStrategy=function(e){var n,r=t.srcEl,i=t.targetEl,o=t.className,s=t.className+\"-rendered\",a=t.options?t.options.sandboxWrapperEl:null;a?(a.appendChild(e),a.classList.add(o,s),n=a):n=e,r?i.insertBefore(n,r):i.appendChild(n)}}c.fromRawTask=function(t){return new c(t.input,t.taskDoneDeferred.resolve)},c.prototype.initialize=function(){var t=this,e=new this._Sandbox(this._targetGlobal);return this._factory(this._widgetParams,e).then(function(n){return t._widget=n,t._sandbox=e,n._sandboxWrapperEl=t._sandboxWrapperEl,n})},c.prototype.insertIntoDom=function(){var t=this,e=this._sandboxWrapperEl?\"\":[this._className,this._renderedClassName].join(\" \");return this._widget?this._sandbox.insert(this._widget.id,{class:e},null,this._insertionStrategy).then(function(){t._insertedIntoDom=!0}):a.reject(new Error(\"cannot insert widget into DOM before it is initialized\"))},c.prototype.hydrate=function(){var t=this;return this._widget?this._widget.hydrate().then(function(){t._hydrated=!0}):a.reject(new Error(\"cannot hydrate widget before it is initialized\"))},c.prototype.render=function(){var t=this;function e(e){var n=t._sandboxWrapperEl?t._sandboxWrapperEl:t._sandbox.sandboxEl;return s(n).then(function(){return a.reject(e)})}return this._hydrated?this._insertedIntoDom?t._widget.render(t._sandbox).then(function(){return t._sandbox.onResize(function(){return t._widget.resize().then(function(){var e=t._sandboxWrapperEl?t._sandboxWrapperEl:t._sandbox.sandboxEl;o.trigger(\"resize\",{target:e})})}),t._widget.show()}).then(function(){return s(t._srcEl).then(function(){return t._sandbox.sandboxEl})},e):e(new Error(\"cannot render widget before DOM insertion\")):e(new Error(\"cannot render widget before hydration\"))},c.prototype.fail=function(){var t=this,e=t._errorClassName,n=t._sandboxWrapperEl?t._sandboxWrapperEl:t._srcEl;return this._srcEl?u.always(i.write(function(){r.add(n,e)}),function(){o.trigger(\"rendered\",{target:n}),t._resolve(n)}):(t._resolve(),a.resolve())},c.prototype.success=function(){var t=this._sandboxWrapperEl?this._sandboxWrapperEl:this._sandbox.sandboxEl;o.trigger(\"rendered\",{target:t}),this._resolve(t)},t.exports=c},function(t,e,n){var r;!function(){\"use strict\";var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)};function o(){this.frames=[],this.lastId=0,this.raf=i,this.batch={hash:{},read:[],write:[],mode:null}}o.prototype.read=function(t,e){var n=this.add(\"read\",t,e),r=n.id;return this.batch.read.push(n.id),\"reading\"===this.batch.mode||this.batch.scheduled?r:(this.scheduleBatch(),r)},o.prototype.write=function(t,e){var n=this.add(\"write\",t,e),r=this.batch.mode,i=n.id;return this.batch.write.push(n.id),\"writing\"===r||\"reading\"===r||this.batch.scheduled?i:(this.scheduleBatch(),i)},o.prototype.defer=function(t,e,n){\"function\"==typeof t&&(n=e,e=t,t=1);var r=this,i=t-1;return this.schedule(i,function(){r.run({fn:e,ctx:n})})},o.prototype.clear=function(t){if(\"function\"==typeof t)return this.clearFrame(t);t=Number(t);var e=this.batch.hash[t];if(e){var n=this.batch[e.type],r=n.indexOf(t);delete this.batch.hash[t],~r&&n.splice(r,1)}},o.prototype.clearFrame=function(t){var e=this.frames.indexOf(t);~e&&this.frames.splice(e,1)},o.prototype.scheduleBatch=function(){var t=this;this.schedule(0,function(){t.batch.scheduled=!1,t.runBatch()}),this.batch.scheduled=!0},o.prototype.uniqueId=function(){return++this.lastId},o.prototype.flush=function(t){for(var e;e=t.shift();)this.run(this.batch.hash[e])},o.prototype.runBatch=function(){try{this.batch.mode=\"reading\",this.flush(this.batch.read),this.batch.mode=\"writing\",this.flush(this.batch.write),this.batch.mode=null}catch(t){throw this.runBatch(),t}},o.prototype.add=function(t,e,n){var r=this.uniqueId();return this.batch.hash[r]={id:r,fn:e,ctx:n,type:t}},o.prototype.run=function(t){var e=t.ctx||this,n=t.fn;if(delete this.batch.hash[t.id],!this.onError)return n.call(e);try{n.call(e)}catch(t){this.onError(t)}},o.prototype.loop=function(){var t,e=this,n=this.raf,r=!1;function i(){var t=e.frames.shift();e.frames.length?n(i):e.looping=!1,t&&t()}this.looping||(t=setTimeout(function(){r=!0,i()},500),n(function(){r||(clearTimeout(t),i())}),this.looping=!0)},o.prototype.schedule=function(t,e){return this.frames[t]?this.schedule(t+1,e):(this.loop(),this.frames[t]=e)};var s=new o;void 0!==t&&t.exports?t.exports=s:void 0===(r=function(){return s}.call(e,n,e,t))||(t.exports=r)}()},function(t,e,n){var r=n(48).Promise;t.exports=r._asap},function(t,e,n){var r,i,o,s=n(4),a=n(1),u=n(31),c=n(20),d=n(2),f=n(6),l=n(54),h=n(30),p=n(0),m=n(25),v=n(9).get(\"scribeCallback\"),g=Math.floor(1e3*Math.random())+\"_\",w=\"rufous-frame-\"+g+\"-\",y=\"rufous-form-\"+g+\"-\",b=0,_=!1,E=new d;function x(){var t=o.createElement(\"form\"),e=o.createElement(\"input\"),n=o.createElement(\"input\");return b++,t.action=h.CLIENT_EVENT_ENDPOINT,t.method=\"POST\",t.target=w+b,t.id=y+b,e.type=\"hidden\",e.name=\"dnt\",e.value=c.enabled(),n.type=\"hidden\",n.name=\"tfw_redirect\",n.value=h.RUFOUS_REDIRECT,t.appendChild(e),t.appendChild(n),t}function T(){var t=w+b;return u({id:t,name:t,width:0,height:0,border:0},{display:\"none\"},o.doc)}t.exports={clientEvent:function(t,e,n,i){(function(t,e){var n=!p.isObject(t),r=!!e&&!p.isObject(e),i=n||r;return i})(t,e)||(v&&v(arguments),E.promise.then(function(){!function(t,e){var n,i,s;p.isObject(t)&&p.isObject(e)&&(l.log(t,e),s=h.flattenClientEventPayload(t,e),(n=r.firstChild).value=+(+n.value||s.dnt||0),(i=o.createElement(\"input\")).type=\"hidden\",i.name=\"l\",i.value=h.stringify(s),r.appendChild(i))}(h.formatClientEventNamespace(t),h.formatClientEventData(e,n,i))}))},flush:function(){return E.promise.then(function(){var t;return r.children.length<=2?f.reject():(t=f.all([o.doc.body.appendChild(r),o.doc.body.appendChild(i)]).then(function(t){var e=t[0],n=t[1];return n.addEventListener(\"load\",function(){!function(t,e){return function(){var n=t.parentNode;n&&(n.removeChild(t),n.removeChild(e))}}(e,n)()}),e.submit(),t}),r=x(),i=T(),t)})},init:function(){return _?E.promise:((o=new m(a)).insert(\"rufous-sandbox\",null,{display:\"none\"},function(t){s.body.appendChild(t)}).then(function(){o.setTitle(\"Twitter analytics iframe\"),r=x(),i=T(),E.resolve([r,i])}),_=!0,E.promise)}}},function(t,e,n){var r=n(8),i=/^[^#?]*\\.(gov|mil)(:\\d+)?([#?].*)?$/i,o={};function s(t){return t in o?o[t]:o[t]=i.test(t)}t.exports={isUrlSensitive:s,isHostPageSensitive:function(){return s(r.host)}}},function(t,e,n){var r=n(0);t.exports=function t(e){var n=[];return e.forEach(function(e){var i=r.isType(\"array\",e)?t(e):[e];n=n.concat(i)}),n}},function(t,e){t.exports=function(t){return t.filter(function(e,n){return t.indexOf(e)===n})}},function(t,e,n){var r=n(41),i=n(0),o=n(107);function s(){r.apply(this,arguments)}s.prototype=Object.create(r.prototype),i.aug(s.prototype,{factory:o}),t.exports=s},function(t,e,n){var r=n(22),i=n(0),o=n(7);t.exports={before:function(t,e){return function(){var n,i=this,o=arguments;return n=e.apply(this,arguments),r.isPromise(n)?n.then(function(){return t.apply(i,o)}):t.apply(this,arguments)}},after:function(t,e){return function(){var n,i=this,o=arguments;function s(t,e){return r.isPromise(e)?e.then(function(){return t}):t}return n=t.apply(this,arguments),r.isPromise(n)?n.then(function(t){return s(t,e.apply(i,o))}):s(n,e.apply(this,arguments))}},around:function(t,e){return function(){var n=i.toRealArray(arguments);return n.unshift(o(t,this)),e.apply(this,n)}}}},function(t,e,n){var r=n(10),i=n(18),o=n(42),s=n(6),a=n(0);t.exports=function(){var t=o();function e(e){t.apply(this,arguments),Object.defineProperty(this,\"targetGlobal\",{value:e})}return e.prototype=Object.create(t.prototype),a.aug(e.prototype,{id:null,initialized:!1,width:0,height:0,sandboxEl:null,insert:function(){return s.reject()},onResize:function(){},addClass:function(t){var e=this.sandboxEl;return t=Array.isArray(t)?t:[t],i.write(function(){t.forEach(function(t){r.add(e,t)})})},removeClass:function(t){var e=this.sandboxEl;return t=Array.isArray(t)?t:[t],i.write(function(){t.forEach(function(t){r.remove(e,t)})})},styleSelf:function(t){var e=this;return i.write(function(){a.forIn(t,function(t,n){e.sandboxEl.style[t]=n})})}}),e}},function(t,e,n){var r=n(4),i=n(10),o=n(18),s=n(55),a=n(26),u=n(56),c=n(44),d=n(45),f=n(31),l=n(12),h=n(46),p=n(2),m=n(6),v=n(0),g=n(9),w=n(23),y=n(7),b={allowfullscreen:\"true\"},_={position:\"absolute\",visibility:\"hidden\",display:\"block\",width:\"0px\",height:\"0px\",padding:\"0\",border:\"none\"},E={position:\"static\",visibility:\"visible\"},x=\"SandboxRoot\",T=\".SandboxRoot { display: none; }\",S=50;function A(t,e,n,r){return e=v.aug({id:t},b,e),n=v.aug({},_,n),f(e,n,r)}function R(t,e,n,i,s){var a=new p,u=w.generate(),c=A(t,e,n,s);return g.set([\"sandbox\",u],function(){var t=c.contentWindow.document;o.write(function(){t.write(\"<!DOCTYPE html><html><head><\/head><body><\/body><\/html>\")}).then(function(){t.close(),a.resolve(c)})}),c.src=[\"javascript:\",'document.write(\"\");',\"try { window.parent.document; }\",'catch (e) { document.domain=\"'+r.domain+'\"; }',\"window.parent.\"+g.fullPath([\"sandbox\",u])+\"();\"].join(\"\"),c.addEventListener(\"error\",a.reject,!1),o.write(function(){i.parentNode.replaceChild(c,i)}),a.promise}t.exports=a.couple(n(57),function(t){t.overrideProperty(\"id\",{get:function(){return this.sandboxEl&&this.sandboxEl.id}}),t.overrideProperty(\"initialized\",{get:function(){return!!this.win}}),t.overrideProperty(\"width\",{get:function(){return this._width}}),t.overrideProperty(\"height\",{get:function(){return this._height}}),t.overrideProperty(\"sandboxEl\",{get:function(){return this.iframeEl}}),t.defineProperty(\"iframeEl\",{get:function(){return this._iframe}}),t.defineProperty(\"rootEl\",{get:function(){return this.doc&&this.doc.documentElement}}),t.defineProperty(\"widgetEl\",{get:function(){return this.doc&&this.doc.body.firstElementChild}}),t.defineProperty(\"win\",{get:function(){return this.iframeEl&&this.iframeEl.contentWindow}}),t.defineProperty(\"doc\",{get:function(){return this.win&&this.win.document}}),t.define(\"_updateCachedDimensions\",function(){var t=this;return o.read(function(){var e,n=h(t.sandboxEl);\"visible\"==t.sandboxEl.style.visibility?t._width=n.width:(e=h(t.sandboxEl.parentElement).width,t._width=Math.min(n.width,e)),t._height=n.height})}),t.define(\"_setTargetToBlank\",function(){var t=this.createElement(\"base\");t.target=\"_blank\",this.doc.head.appendChild(t)}),t.define(\"_didResize\",function(){var t=this,e=this._resizeHandlers.slice(0);return this._updateCachedDimensions().then(function(){e.forEach(function(e){e(t)})})}),t.define(\"setTitle\",function(t){this.iframeEl.title=t}),t.override(\"createElement\",function(t){return this.doc.createElement(t)}),t.override(\"createFragment\",function(){return this.doc.createDocumentFragment()}),t.override(\"htmlToElement\",function(t){var e;return(e=this.createElement(\"div\")).innerHTML=t,e.firstElementChild}),t.override(\"hasSelectedText\",function(){return!!s.getSelectedText(this.win)}),t.override(\"addRootClass\",function(t){var e=this.rootEl;return t=Array.isArray(t)?t:[t],this.initialized?o.write(function(){t.forEach(function(t){i.add(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"removeRootClass\",function(t){var e=this.rootEl;return t=Array.isArray(t)?t:[t],this.initialized?o.write(function(){t.forEach(function(t){i.remove(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"hasRootClass\",function(t){return i.present(this.rootEl,t)}),t.define(\"addStyleSheet\",function(t,e){var n,r=new p;return this.initialized?((n=this.createElement(\"link\")).type=\"text/css\",n.rel=\"stylesheet\",n.href=t,n.addEventListener(\"load\",r.resolve,!1),n.addEventListener(\"error\",r.reject,!1),o.write(y(e,null,n)).then(function(){return u(t).then(r.resolve,r.reject),r.promise})):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"prependStyleSheet\",function(t){var e=this.doc;return this.addStyleSheet(t,function(t){var n=e.head.firstElementChild;return n?e.head.insertBefore(t,n):e.head.appendChild(t)})}),t.override(\"appendStyleSheet\",function(t){var e=this.doc;return this.addStyleSheet(t,function(t){return e.head.appendChild(t)})}),t.define(\"addCss\",function(t,e){var n;return c.inlineStyle()?((n=this.createElement(\"style\")).type=\"text/css\",n.appendChild(this.doc.createTextNode(t)),o.write(y(e,null,n))):(l.devError(\"CSP enabled; cannot embed inline styles\"),m.resolve())}),t.override(\"prependCss\",function(t){var e=this.doc;return this.addCss(t,function(t){var n=e.head.firstElementChild;return n?e.head.insertBefore(t,n):e.head.appendChild(t)})}),t.override(\"appendCss\",function(t){var e=this.doc;return this.addCss(t,function(t){return e.head.appendChild(t)})}),t.override(\"makeVisible\",function(){var t=this;return this.styleSelf(E).then(function(){t._updateCachedDimensions()})}),t.override(\"injectWidgetEl\",function(t){var e=this;return this.initialized?this.widgetEl?m.reject(new Error(\"widget already injected\")):o.write(function(){e.doc.body.appendChild(t)}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"matchHeightToContent\",function(){var t,e=this;return o.read(function(){t=e.widgetEl?h(e.widgetEl).height:0}),o.write(function(){e.sandboxEl.style.height=t+\"px\"}).then(function(){return e._updateCachedDimensions()})}),t.override(\"matchWidthToContent\",function(){var t,e=this;return o.read(function(){t=e.widgetEl?h(e.widgetEl).width:0}),o.write(function(){e.sandboxEl.style.width=t+\"px\"}).then(function(){return e._updateCachedDimensions()})}),t.after(\"initialize\",function(){this._iframe=null,this._width=this._height=0,this._resizeHandlers=[]}),t.override(\"insert\",function(t,e,n,r){var i=this,s=new p,a=this.targetGlobal.document,u=A(t,e,n,a);return o.write(y(r,null,u)),u.addEventListener(\"load\",function(){(function(t){try{t.contentWindow.document}catch(t){return m.reject(t)}return m.resolve(t)})(u).then(null,y(R,null,t,e,n,u,a)).then(s.resolve,s.reject)},!1),u.addEventListener(\"error\",s.reject,!1),s.promise.then(function(t){var e=d(i._didResize,S,i);return i._iframe=t,i.win.addEventListener(\"resize\",e,!1),m.all([i._setTargetToBlank(),i.addRootClass(x),i.prependCss(T)])})}),t.override(\"onResize\",function(t){this._resizeHandlers.push(t)}),t.after(\"styleSelf\",function(){return this._updateCachedDimensions()})})},function(t,e){t.exports=function(){throw new Error(\"unimplemented method\")}},function(t,e,n){var r=n(20),i=n(54),o=n(11),s=n(30),a=n(0),u=n(9).get(\"scribeCallback\"),c=2083,d=[],f=o.url(s.CLIENT_EVENT_ENDPOINT,{dnt:0,l:\"\"}),l=encodeURIComponent(f).length;function h(t,e,n,r){var i=!a.isObject(t),o=!!e&&!a.isObject(e);i||o||(u&&u(arguments),p(s.formatClientEventNamespace(t),s.formatClientEventData(e,n,r),s.CLIENT_EVENT_ENDPOINT))}function p(t,e,n){var r,u;n&&a.isObject(t)&&a.isObject(e)&&(i.log(t,e),r=s.flattenClientEventPayload(t,e),u={l:s.stringify(r)},r.dnt&&(u.dnt=1),w(o.url(n,u)))}function m(t,e,n,r){var i=!a.isObject(t),o=!!e&&!a.isObject(e);if(!i&&!o)return v(s.flattenClientEventPayload(s.formatClientEventNamespace(t),s.formatClientEventData(e,n,r)))}function v(t){return d.push(t),d}function g(t){return encodeURIComponent(t).length+3}function w(t){return(new Image).src=t}t.exports={canFlushOneItem:function(t){var e=g(s.stringify(t));return l+e<c},_enqueueRawObject:v,scribe:p,clientEvent:h,clientEvent2:function(t,e,n){return h(t,e,n,2)},enqueueClientEvent:m,flushClientEvents:function(){var t;return d.length>1&&m({page:\"widgets_js\",component:\"scribe_pixel\",action:\"batch_log\"},{}),t=d,d=[],t.reduce(function(e,n,r){var i=e.length,o=i&&e[i-1];return r+1==t.length&&n.event_namespace&&\"batch_log\"==n.event_namespace.action&&(n.message=[\"entries:\"+r,\"requests:\"+i].join(\"/\")),function t(e){return Array.isArray(e)||(e=[e]),e.reduce(function(e,n){var r,i=s.stringify(n),o=g(i);return l+o<c?e=e.concat(i):(r=s.splitLogEntry(n)).length>1&&(e=e.concat(t(r))),e},[])}(n).forEach(function(t){var n=g(t);(!o||o.urlLength+n>c)&&(o={urlLength:l,items:[]},e.push(o)),o.urlLength+=n,o.items.push(t)}),e},[]).map(function(t){var e={l:t.items};return r.enabled()&&(e.dnt=1),w(o.url(s.CLIENT_EVENT_ENDPOINT,e))})},interaction:function(t,e,n,r){var i=s.extractTermsFromDOM(t.target||t.srcElement);i.action=r||\"click\",h(i,e,n)}}},function(t,e,n){var r=n(2),i=n(7),o=100,s=3e3;function a(t,e){this._inputsQueue=[],this._task=t,this._isPaused=!1,this._flushDelay=e&&e.flushDelay||o,this._pauseLength=e&&e.pauseLength||s,this._flushTimeout=void 0}a.prototype.add=function(t){var e=new r;return this._inputsQueue.push({input:t,taskDoneDeferred:e}),this._scheduleFlush(),e.promise},a.prototype._scheduleFlush=function(){this._isPaused||(clearTimeout(this._flushTimeout),this._flushTimeout=setTimeout(i(this._flush,this),this._flushDelay))},a.prototype._flush=function(){try{this._task.call(null,this._inputsQueue)}catch(t){this._inputsQueue.forEach(function(e){e.taskDoneDeferred.reject(t)})}this._inputsQueue=[],this._flushTimeout=void 0},a.prototype.pause=function(t){clearTimeout(this._flushTimeout),this._isPaused=!0,!t&&this._pauseLength&&setTimeout(i(this.resume,this),this._pauseLength)},a.prototype.resume=function(){this._isPaused=!1,this._scheduleFlush()},t.exports=a},function(t,e,n){var r,i=n(72),o=n(31),s=n(2),a=n(4),u=n(19),c=n(21),d=n(32),f=n(8),l=n(12),h=n(113),p=n(58),m=n(9),v=n(11),g=n(114),w=n(3),y=n(0),b=n(1),_=p(function(){return new s});function E(t){var e=t||{should_obtain_cookie_consent:!0,features:{}},n=e.features?e.features:e.experiments;return new g(e.should_obtain_cookie_consent,n)}t.exports={load:function(){var t,e,n,s;if(c.ie9()||c.ie10()||\"http:\"!==f.protocol&&\"https:\"!==f.protocol)return l.devError(\"Using default settings due to unsupported browser or protocol.\"),r=E(),void _().resolve();t={origin:f.origin},u.settings().indexOf(\"localhost\")>-1&&(t.localSettings=!0),e=v.url(i.resourceBaseUrl+i.widgetIframeHtmlPath,t),n=function(t){var n,i,o,s;if(i=w.isTwitterURL(t.origin),o=e.substr(0,t.origin.length)===t.origin,s=w.isTwimgURL(t.origin),o&&i||s)try{(n=\"string\"==typeof t.data?d.parse(t.data):t.data).namespace===h.settings&&(r=E(n.settings),_().resolve())}catch(t){l.devError(t)}},b.addEventListener(\"message\",n),s=o({src:e,title:\"Twitter settings iframe\"},{display:\"none\"}),a.body.appendChild(s)},settingsLoaded:function(){var t,e,n;return t=new s,e=m.get(\"experimentOverride\"),_().promise.then(function(){e&&e.name&&e.assignment&&((n={})[e.name]={bucket:e.assignment},r.features=y.aug(r.features,n)),t.resolve(r)}).catch(function(e){t.reject(e)}),t.promise}}},function(t,e){t.exports={settings:\"twttr.settings\"}},function(t,e){t.exports=function(t,e){this.shouldObtainCookieConsent=t,this.features=e||{}}},function(t,e){t.exports=function(t){return t.split(\"\").map(function(t){return t.charCodeAt(0).toString(16)}).join(\"\")}},function(t,e,n){t.exports=[n(117),n(122),n(130),n(132),n(134),n(148),n(153)]},function(t,e,n){var r=n(11),i=n(5),o=n(0),s=n(13),a=n(14)(),u=n(59),c=\"a.twitter-dm-button\";t.exports=function(t){return a(t,c).map(function(t){return u(function(t){var e=t.getAttribute(\"data-show-screen-name\"),n=s(t),a=t.getAttribute(\"href\"),u=t.getAttribute(\"data-screen-name\"),c=e?i.asBoolean(e):null,d=t.getAttribute(\"data-size\"),f=r.decodeURL(a),l=f.recipient_id,h=t.getAttribute(\"data-text\")||f.text,p=t.getAttribute(\"data-welcome-message-id\")||f.welcomeMessageId;return o.aug(n,{screenName:u,showScreenName:c,size:d,text:h,userId:l,welcomeMessageId:p})}(t),t.parentNode,t)})}},function(t,e,n){var r=n(0);t.exports=function t(e){var n;if(e)return n=e.lang||e.getAttribute(\"data-lang\"),r.isType(\"string\",n)?n:t(e.parentElement)}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(2).then(function(r){var o;try{o=n(84),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(121),i=n(1),o=n(10),s=n(36),a=n(18),u=n(55),c=n(26),d=n(56),f=n(44),l=n(46),h=n(7),p=n(45),m=n(6),v=n(0),g=50,w={position:\"absolute\",visibility:\"hidden\",display:\"block\",transform:\"rotate(0deg)\"},y={position:\"static\",visibility:\"visible\"},b=\"twitter-widget\",_=\"open\",E=\"SandboxRoot\",x=\".SandboxRoot { display: none; max-height: 10000px; }\";t.exports=c.couple(n(57),function(t){t.defineStatic(\"isSupported\",function(){return!!i.HTMLElement.prototype.attachShadow&&f.inlineStyle()}),t.overrideProperty(\"id\",{get:function(){return this.sandboxEl&&this.sandboxEl.id}}),t.overrideProperty(\"initialized\",{get:function(){return!!this._shadowHost}}),t.overrideProperty(\"width\",{get:function(){return this._width}}),t.overrideProperty(\"height\",{get:function(){return this._height}}),t.overrideProperty(\"sandboxEl\",{get:function(){return this._shadowHost}}),t.define(\"_updateCachedDimensions\",function(){var t=this;return a.read(function(){var e,n=l(t.sandboxEl);\"visible\"==t.sandboxEl.style.visibility?t._width=n.width:(e=l(t.sandboxEl.parentElement).width,t._width=Math.min(n.width,e)),t._height=n.height})}),t.define(\"_didResize\",function(){var t=this,e=this._resizeHandlers.slice(0);return this._updateCachedDimensions().then(function(){e.forEach(function(e){e(t)})})}),t.override(\"createElement\",function(t){return this.targetGlobal.document.createElement(t)}),t.override(\"createFragment\",function(){return this.targetGlobal.document.createDocumentFragment()}),t.override(\"htmlToElement\",function(t){var e;return(e=this.createElement(\"div\")).innerHTML=t,e.firstElementChild}),t.override(\"hasSelectedText\",function(){return!!u.getSelectedText(this.targetGlobal)}),t.override(\"addRootClass\",function(t){var e=this._shadowRootBody;return t=Array.isArray(t)?t:[t],this.initialized?a.write(function(){t.forEach(function(t){o.add(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"removeRootClass\",function(t){var e=this._shadowRootBody;return t=Array.isArray(t)?t:[t],this.initialized?a.write(function(){t.forEach(function(t){o.remove(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"hasRootClass\",function(t){return o.present(this._shadowRootBody,t)}),t.override(\"addStyleSheet\",function(t,e){return this.addCss('@import url(\"'+t+'\");',e).then(function(){return d(t)})}),t.override(\"prependStyleSheet\",function(t){var e=this._shadowRoot;return this.addStyleSheet(t,function(t){var n=e.firstElementChild;return n?e.insertBefore(t,n):e.appendChild(t)})}),t.override(\"appendStyleSheet\",function(t){var e=this._shadowRoot;return this.addStyleSheet(t,function(t){return e.appendChild(t)})}),t.override(\"addCss\",function(t,e){var n;return this.initialized?f.inlineStyle()?((n=this.createElement(\"style\")).type=\"text/css\",n.appendChild(this.targetGlobal.document.createTextNode(t)),a.write(h(e,null,n))):m.resolve():m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"prependCss\",function(t){var e=this._shadowRoot;return this.addCss(t,function(t){var n=e.firstElementChild;return n?e.insertBefore(t,n):e.appendChild(t)})}),t.override(\"appendCss\",function(t){var e=this._shadowRoot;return this.addCss(t,function(t){return e.appendChild(t)})}),t.override(\"makeVisible\",function(){return this.styleSelf(y)}),t.override(\"injectWidgetEl\",function(t){var e=this;return this.initialized?this._shadowRootBody.firstElementChild?m.reject(new Error(\"widget already injected\")):a.write(function(){e._shadowRootBody.appendChild(t)}).then(function(){return e._updateCachedDimensions()}).then(function(){var t=p(e._didResize,g,e);new r(e._shadowRootBody,t)}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"matchHeightToContent\",function(){return m.resolve()}),t.override(\"matchWidthToContent\",function(){return m.resolve()}),t.override(\"insert\",function(t,e,n,r){var i=this.targetGlobal.document,o=this._shadowHost=i.createElement(b),u=this._shadowRoot=o.attachShadow({mode:_}),c=this._shadowRootBody=i.createElement(\"div\");return v.forIn(e||{},function(t,e){o.setAttribute(t,e)}),o.id=t,u.appendChild(c),s.delegate(c,\"click\",\"A\",function(t,e){e.hasAttribute(\"target\")||e.setAttribute(\"target\",\"_blank\")}),m.all([this.styleSelf(w),this.addRootClass(E),this.prependCss(x),a.write(r.bind(null,o))])}),t.override(\"onResize\",function(t){this._resizeHandlers.push(t)}),t.after(\"initialize\",function(){this._shadowHost=this._shadowRoot=this._shadowRootBody=null,this._width=this._height=0,this._resizeHandlers=[]}),t.after(\"styleSelf\",function(){return this._updateCachedDimensions()})})},function(t,e){var n;(n=function(t,e){function r(t,e){if(t.resizedAttached){if(t.resizedAttached)return void t.resizedAttached.add(e)}else t.resizedAttached=new function(){var t,e;this.q=[],this.add=function(t){this.q.push(t)},this.call=function(){for(t=0,e=this.q.length;t<e;t++)this.q[t].call()}},t.resizedAttached.add(e);t.resizeSensor=document.createElement(\"div\"),t.resizeSensor.className=\"resize-sensor\";var n=\"position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;\",r=\"position: absolute; left: 0; top: 0; transition: 0s;\";t.resizeSensor.style.cssText=n,t.resizeSensor.innerHTML='<div class=\"resize-sensor-expand\" style=\"'+n+'\"><div style=\"'+r+'\"><\/div><\/div><div class=\"resize-sensor-shrink\" style=\"'+n+'\"><div style=\"'+r+' width: 200%; height: 200%\"><\/div><\/div>',t.appendChild(t.resizeSensor),{fixed:1,absolute:1}[function(t,e){return t.currentStyle?t.currentStyle[e]:window.getComputedStyle?window.getComputedStyle(t,null).getPropertyValue(e):t.style[e]}(t,\"position\")]||(t.style.position=\"relative\");var i,o,s=t.resizeSensor.childNodes[0],a=s.childNodes[0],u=t.resizeSensor.childNodes[1],c=(u.childNodes[0],function(){a.style.width=s.offsetWidth+10+\"px\",a.style.height=s.offsetHeight+10+\"px\",s.scrollLeft=s.scrollWidth,s.scrollTop=s.scrollHeight,u.scrollLeft=u.scrollWidth,u.scrollTop=u.scrollHeight,i=t.offsetWidth,o=t.offsetHeight});c();var d=function(t,e,n){t.attachEvent?t.attachEvent(\"on\"+e,n):t.addEventListener(e,n)},f=function(){t.offsetWidth==i&&t.offsetHeight==o||t.resizedAttached&&t.resizedAttached.call(),c()};d(s,\"scroll\",f),d(u,\"scroll\",f)}var i=Object.prototype.toString.call(t),o=\"[object Array]\"===i||\"[object NodeList]\"===i||\"[object HTMLCollection]\"===i||\"undefined\"!=typeof jQuery&&t instanceof jQuery||\"undefined\"!=typeof Elements&&t instanceof Elements;if(o)for(var s=0,a=t.length;s<a;s++)r(t[s],e);else r(t,e);this.detach=function(){if(o)for(var e=0,r=t.length;e<r;e++)n.detach(t[e]);else n.detach(t)}}).detach=function(t){t.resizeSensor&&(t.removeChild(t.resizeSensor),delete t.resizeSensor,delete t.resizedAttached)},void 0!==t&&void 0!==t.exports?t.exports=n:window.ResizeSensor=n},function(t,e,n){var r=n(3),i=n(0),o=n(13),s=n(14)(),a=n(62),u=n(5),c=\"a.twitter-follow-button\";t.exports=function(t){return s(t,c).map(function(t){return a(function(t){var e=o(t),n={screenName:r.screenName(t.href),showScreenName:\"false\"!==t.getAttribute(\"data-show-screen-name\"),showCount:\"false\"!==t.getAttribute(\"data-show-count\"),size:t.getAttribute(\"data-size\"),count:t.getAttribute(\"data-count\"),preview:t.getAttribute(\"data-preview\")};return i.forIn(n,function(t,n){var r=e[t];e[t]=u.hasValue(r)?r:n}),e.screenName=e.screenName||e.screen_name,e}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(3).then(function(r){var o;try{o=n(85),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(18),i=n(125),o=n(58),s=n(31),a=n(2),u=n(6),c=n(7),d=n(0),f={allowfullscreen:\"true\"},l={position:\"absolute\",visibility:\"hidden\",width:\"0px\",height:\"0px\"},h={position:\"static\",visibility:\"visible\"},p={};i(function(t,e,n){var r=p[t];if(r)return e=e||1,n=n||1,r.styleSelf({width:e+\"px\",height:n+\"px\"}).then(function(){r.didResize()})},function(t){var e=p[t];if(e)return e._results.resolve()},function(t){var e=p[t];if(e)return e._rendered.resolve()},function(t,e){var n=p[t];n&&e&&n.setIframeVersion(e)},function(t){var e=p[t];if(e)return e._results.reject()}),t.exports=function(t){t.overrideProperty(\"id\",{get:function(){return this.sandboxEl&&this.sandboxEl.id}}),t.overrideProperty(\"initialized\",{get:function(){return!!this.iframeEl}}),t.overrideProperty(\"width\",{get:function(){return this._width}}),t.overrideProperty(\"height\",{get:function(){return this._height}}),t.overrideProperty(\"sandboxEl\",{get:function(){return this.iframeEl}}),t.defineProperty(\"iframeEl\",{get:function(){return this._iframe}}),t.defineProperty(\"iframeVersion\",{get:function(){return this._iframeVersion}}),t.define(\"updateCachedDimensions\",function(){var t=this;return this.initialized?r.read(function(){t._width=t.sandboxEl.offsetWidth,t._height=t.sandboxEl.offsetHeight}):u.resolve()}),t.define(\"setTitle\",function(t){this.iframeEl.title=t}),t.define(\"setWaitToSwapUntilRendered\",function(t){this._waitToSwapUntilRendered=t}),t.define(\"setIframeVersion\",function(t){this._iframeVersion=t}),t.define(\"getResultsPromise\",function(){return this._results.promise}),t.define(\"getRenderedPromise\",function(){return this._rendered.promise}),t.define(\"makeVisible\",function(){return this.styleSelf(h)}),t.define(\"didResize\",function(){var t=this,e=t._resizeHandlers.length>0;return this.updateCachedDimensions().then(function(){e&&t._resizeHandlers.forEach(function(e){e(t)})})}),t.define(\"loadDocument\",function(t){var e=new a;return this.initialized?this.iframeEl.src?u.reject(new Error(\"widget already loaded\")):(this.iframeEl.addEventListener(\"load\",e.resolve,!1),this.iframeEl.addEventListener(\"error\",e.reject,!1),this.iframeEl.src=t,e.promise):u.reject(new Error(\"sandbox not initialized\"))}),t.after(\"initialize\",function(){var t=new a,e=new a;this._iframe=null,this._iframeVersion=null,this._width=this._height=0,this._resizeHandlers=[],this._rendered=t,this._results=e,this._waitToSwapUntilRendered=!1}),t.override(\"insert\",function(t,e,n,i){var a=this;return e=d.aug({id:t},f,e),n=d.aug({},l,n),this._iframe=s(e,n),p[t]=this,a._waitToSwapUntilRendered||this.onResize(o(function(){a.makeVisible()})),r.write(c(i,null,this._iframe))}),t.override(\"onResize\",function(t){this._resizeHandlers.push(t)}),t.after(\"styleSelf\",function(){return this.updateCachedDimensions()})}},function(t,e,n){var r=n(1),i=n(126),o=n(128),s=n(24),a=n(5),u=n(129);t.exports=function(t,e,n,c,d){function f(t){var e=u(this);s.trigger(t.type,{target:e,region:t.region,type:t.type,data:t.data||{}})}function l(e){var n=u(this),r=n&&n.id,i=a.asInt(e.width),o=a.asInt(e.height);r&&void 0!==i&&void 0!==o&&t(r,i,o)}(new i).attachReceiver(new o.Receiver(r,\"twttr.button\")).bind(\"twttr.private.trigger\",f).bind(\"twttr.private.resizeButton\",l),(new i).attachReceiver(new o.Receiver(r,\"twttr.embed\")).bind(\"twttr.private.initialized\",function(t){var e=u(this),n=e&&e.id,r=t.iframe_version;n&&r&&c&&c(n,r)}).bind(\"twttr.private.trigger\",f).bind(\"twttr.private.results\",function(){var t=u(this),n=t&&t.id;n&&e&&e(n)}).bind(\"twttr.private.rendered\",function(){var t=u(this),e=t&&t.id;e&&n&&n(e)}).bind(\"twttr.private.no_results\",function(){var t=u(this),e=t&&t.id;e&&d&&d(e)}).bind(\"twttr.private.resize\",l)}},function(t,e,n){var r=n(32),i=n(127),o=n(0),s=n(6),a=n(22),u=\"2.0\";function c(t){this.registry=t||{}}function d(t){var e,n;return e=o.isType(\"string\",t),n=o.isType(\"number\",t),e||n||null===t}function f(t,e){return{jsonrpc:u,id:d(t)?t:null,error:e}}c.prototype._invoke=function(t,e){var n,r,i;n=this.registry[t.method],r=t.params||[],r=o.isType(\"array\",r)?r:[r];try{i=n.apply(e.source||null,r)}catch(t){i=s.reject(t.message)}return a.isPromise(i)?i:s.resolve(i)},c.prototype._processRequest=function(t,e){var n,r;return function(t){var e,n,r;return!!o.isObject(t)&&(e=t.jsonrpc===u,n=o.isType(\"string\",t.method),r=!(\"id\"in t)||d(t.id),e&&n&&r)}(t)?(n=\"params\"in t&&(r=t.params,!o.isObject(r)||o.isType(\"function\",r))?s.resolve(f(t.id,i.INVALID_PARAMS)):this.registry[t.method]?this._invoke(t,{source:e}).then(function(e){return n=t.id,{jsonrpc:u,id:n,result:e};var n},function(){return f(t.id,i.INTERNAL_ERROR)}):s.resolve(f(t.id,i.METHOD_NOT_FOUND)),null!=t.id?n:s.resolve()):s.resolve(f(t.id,i.INVALID_REQUEST))},c.prototype.attachReceiver=function(t){return t.attachTo(this),this},c.prototype.bind=function(t,e){return this.registry[t]=e,this},c.prototype.receive=function(t,e){var n,a,u,c=this;try{u=t,t=o.isType(\"string\",u)?r.parse(u):u}catch(t){return s.resolve(f(null,i.PARSE_ERROR))}return e=e||null,a=((n=o.isType(\"array\",t))?t:[t]).map(function(t){return c._processRequest(t,e)}),n?function(t){return s.all(t).then(function(t){return(t=t.filter(function(t){return void 0!==t})).length?t:void 0})}(a):a[0]},t.exports=c},function(t){t.exports={PARSE_ERROR:{code:-32700,message:\"Parse error\"},INVALID_REQUEST:{code:-32600,message:\"Invalid Request\"},INVALID_PARAMS:{code:-32602,message:\"Invalid params\"},METHOD_NOT_FOUND:{code:-32601,message:\"Method not found\"},INTERNAL_ERROR:{code:-32603,message:\"Internal error\"}}},function(t,e,n){var r=n(8),i=n(1),o=n(32),s=n(2),a=n(21),u=n(0),c=n(3),d=n(7),f=a.ie9();function l(t,e,n){var r;t&&t.postMessage&&(f?r=(n||\"\")+o.stringify(e):n?(r={})[n]=e:r=e,t.postMessage(r,\"*\"))}function h(t){return u.isType(\"string\",t)?t:\"JSONRPC\"}function p(t,e){return e?u.isType(\"string\",t)&&0===t.indexOf(e)?t.substring(e.length):t&&t[e]?t[e]:void 0:t}function m(t,e){var n=t.document;this.filter=h(e),this.server=null,this.isTwitterFrame=c.isTwitterURL(n.location.href),t.addEventListener(\"message\",d(this._onMessage,this),!1)}function v(t,e){this.pending={},this.target=t,this.isTwitterHost=c.isTwitterURL(r.href),this.filter=h(e),i.addEventListener(\"message\",d(this._onMessage,this),!1)}u.aug(m.prototype,{_onMessage:function(t){var e,n=this;this.server&&(this.isTwitterFrame&&!c.isTwitterURL(t.origin)||(e=p(t.data,this.filter))&&this.server.receive(e,t.source).then(function(e){e&&l(t.source,e,n.filter)}))},attachTo:function(t){this.server=t},detach:function(){this.server=null}}),u.aug(v.prototype,{_processResponse:function(t){var e=this.pending[t.id];e&&(e.resolve(t),delete this.pending[t.id])},_onMessage:function(t){var e;if((!this.isTwitterHost||c.isTwitterURL(t.origin))&&(e=p(t.data,this.filter))){if(u.isType(\"string\",e))try{e=o.parse(e)}catch(t){return}(e=u.isType(\"array\",e)?e:[e]).forEach(d(this._processResponse,this))}},send:function(t){var e=new s;return t.id?this.pending[t.id]=e:e.resolve(),l(this.target,t,this.filter),e.promise}}),t.exports={Receiver:m,Dispatcher:v,_stringifyPayload:function(t){return arguments.length>0&&(f=!!t),f}}},function(t,e,n){var r=n(4);t.exports=function(t){for(var e,n=r.getElementsByTagName(\"iframe\"),i=0;n[i];i++)if((e=n[i]).contentWindow===t)return e}},function(t,e,n){var r=n(5),i=n(0),o=n(3),s=n(13),a=n(14)(),u=n(63),c=\"a.twitter-moment\";t.exports=function(t){return a(t,c).map(function(t){return u(function(t){var e=s(t),n={momentId:o.momentId(t.href),chrome:t.getAttribute(\"data-chrome\"),limit:t.getAttribute(\"data-limit\")};return i.forIn(n,function(t,n){var i=e[t];e[t]=r.hasValue(i)?i:n}),e}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return Promise.all([n.e(0),n.e(4)]).then(function(r){var o;try{o=n(86),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(0),i=n(13),o=n(14)(),s=n(64),a=\"a.periscope-on-air\",u=/^https?:\\/\\/(?:www\\.)?(?:periscope|pscp)\\.tv\\/@?([a-zA-Z0-9_]+)\\/?$/i;t.exports=function(t){return o(t,a).map(function(t){return s(function(t){var e=i(t),n=t.getAttribute(\"href\"),o=t.getAttribute(\"data-size\"),s=u.exec(n)[1];return r.aug(e,{username:s,size:o})}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(5).then(function(r){var o;try{o=n(87),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(5),i=n(0),o=n(65),s=n(13),a=n(14)(),u=n(66),c=n(3),d=n(12),f=\"a.twitter-timeline,div.twitter-timeline,a.twitter-grid\",l=\"Embedded Search timelines have been deprecated. See https://twittercommunity.com/t/deprecating-widget-settings/102295.\",h=\"You may have been affected by an update to settings in embedded timelines. See https://twittercommunity.com/t/deprecating-widget-settings/102295.\",p=\"Embedded grids have been deprecated and will now render as timelines. Please update your embed code to use the twitter-timeline class. More info: https://twittercommunity.com/t/update-on-the-embedded-grid-display-type/119564.\";t.exports=function(t){return a(t,f).map(function(t){return u(function(t){var e=s(t),n=t.getAttribute(\"data-show-replies\"),a={isPreconfigured:!!t.getAttribute(\"data-widget-id\"),chrome:t.getAttribute(\"data-chrome\"),tweetLimit:t.getAttribute(\"data-tweet-limit\")||t.getAttribute(\"data-limit\"),ariaLive:t.getAttribute(\"data-aria-polite\"),theme:t.getAttribute(\"data-theme\"),borderColor:t.getAttribute(\"data-border-color\"),showReplies:n?r.asBoolean(n):null,profileScreenName:t.getAttribute(\"data-screen-name\"),profileUserId:t.getAttribute(\"data-user-id\"),favoritesScreenName:t.getAttribute(\"data-favorites-screen-name\"),favoritesUserId:t.getAttribute(\"data-favorites-user-id\"),likesScreenName:t.getAttribute(\"data-likes-screen-name\"),likesUserId:t.getAttribute(\"data-likes-user-id\"),listOwnerScreenName:t.getAttribute(\"data-list-owner-screen-name\"),listOwnerUserId:t.getAttribute(\"data-list-owner-id\"),listId:t.getAttribute(\"data-list-id\"),listSlug:t.getAttribute(\"data-list-slug\"),customTimelineId:t.getAttribute(\"data-custom-timeline-id\"),staticContent:t.getAttribute(\"data-static-content\"),url:t.href};return a.isPreconfigured&&(c.isSearchUrl(a.url)?d.publicError(l,t):d.publicLog(h,t)),\"twitter-grid\"===t.className&&d.publicLog(p,t),(a=i.aug(a,e)).dataSource=o(a),a.id=a.dataSource&&a.dataSource.id,a}(t),t.parentNode,t)})}},function(t,e,n){var r=n(27);t.exports=r.build([n(28),n(138)])},function(t,e,n){var r=n(0),i=n(137);t.exports=function(t){return\"en\"===t||r.contains(i,t)}},function(t,e){t.exports=[\"hi\",\"zh-cn\",\"fr\",\"zh-tw\",\"msa\",\"fil\",\"fi\",\"sv\",\"pl\",\"ja\",\"ko\",\"de\",\"it\",\"pt\",\"es\",\"ru\",\"id\",\"tr\",\"da\",\"no\",\"nl\",\"hu\",\"fa\",\"ar\",\"ur\",\"he\",\"th\",\"cs\",\"uk\",\"vi\",\"ro\",\"bn\",\"el\",\"en-gb\",\"gu\",\"kn\",\"mr\",\"ta\",\"bg\",\"ca\",\"hr\",\"sr\",\"sk\"]},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"collection:\";function a(t,e){return r.collectionId(t)||e}t.exports=function(t){t.params({id:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=a(this.params.url,this.params.id);return s+t}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"collection\"])}}),t.around(\"queryParams\",function(t){return i.aug(t(),{collection_id:a(this.params.url,this.params.id)})}),t.before(\"initialize\",function(){if(!a(this.params.url,this.params.id))throw new Error(\"one of url or id is required\")})}},function(t,e,n){var r=n(27);t.exports=r.build([n(28),n(140)])},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"event:\";function a(t,e){return r.eventId(t)||e}t.exports=function(t){t.params({id:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=a(this.params.url,this.params.id);return s+t}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"event\"])}}),t.around(\"queryParams\",function(t){return i.aug(t(),{event_id:a(this.params.url,this.params.id)})}),t.before(\"initialize\",function(){if(!a(this.params.url,this.params.id))throw new Error(\"one of url or id is required\")})}},function(t,e,n){var r=n(27);t.exports=r.build([n(28),n(142)])},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"likes:\";function a(t){return r.likesScreenName(t.url)||t.screenName}t.exports=function(t){t.params({screenName:{},userId:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=a(this.params)||this.params.userId;return s+t}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"likes\"])}}),t.define(\"_getLikesQueryParam\",function(){var t=a(this.params);return t?{screen_name:t}:{user_id:this.params.userId}}),t.around(\"queryParams\",function(t){return i.aug(t(),this._getLikesQueryParam())}),t.before(\"initialize\",function(){if(!a(this.params)&&!this.params.userId)throw new Error(\"screen name or user id is required\")})}},function(t,e,n){var r=n(27);t.exports=r.build([n(28),n(144)])},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"list:\";function a(t){var e=r.listScreenNameAndSlug(t.url)||t;return i.compact({screen_name:e.ownerScreenName,user_id:e.ownerUserId,list_slug:e.slug})}t.exports=function(t){t.params({id:{},ownerScreenName:{},ownerUserId:{},slug:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t,e,n;return this.params.id?s+this.params.id:(e=(t=a(this.params))&&t.list_slug.replace(/-/g,\"_\"),n=t&&(t.screen_name||t.user_id),s+(n+\":\")+e)}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"list\"])}}),t.define(\"_getListQueryParam\",function(){return this.params.id?{list_id:this.params.id}:a(this.params)}),t.around(\"queryParams\",function(t){return i.aug(t(),this._getListQueryParam())}),t.before(\"initialize\",function(){var t=a(this.params);if(i.isEmptyObject(t)&&!this.params.id)throw new Error(\"qualified slug or list id required\")})}},function(t,e,n){var r=n(27);t.exports=r.build([n(28),n(146)])},function(t,e,n){var r=n(3),i=n(5),o=n(0),s=n(19),a=\"profile:\";function u(t,e){return r.screenName(t)||e}t.exports=function(t){t.params({showReplies:{fallback:!1,transform:i.asBoolean},screenName:{},userId:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=u(this.params.url,this.params.screenName);return a+(t||this.params.userId)}}),t.overrideProperty(\"endpoint\",{get:function(){return s.timeline([\"profile\"])}}),t.define(\"_getProfileQueryParam\",function(){var t=u(this.params.url,this.params.screenName),e=t?{screen_name:t}:{user_id:this.params.userId};return o.aug(e,{with_replies:this.params.showReplies?\"true\":\"false\"})}),t.around(\"queryParams\",function(t){return o.aug(t(),this._getProfileQueryParam())}),t.before(\"initialize\",function(){if(!u(this.params.url,this.params.screenName)&&!this.params.userId)throw new Error(\"screen name or user id is required\")})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return Promise.all([n.e(0),n.e(6)]).then(function(r){var o;try{o=n(88),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(10),i=n(3),o=n(0),s=n(13),a=n(14)(),u=n(67),c=\"blockquote.twitter-tweet, blockquote.twitter-video\",d=/\\btw-align-(left|right|center)\\b/;t.exports=function(t,e){return a(t,c).map(function(t){return u(function(t){var e=s(t),n=t.getElementsByTagName(\"A\"),a=n&&n[n.length-1],u=a&&i.status(a.href),c=t.getAttribute(\"data-conversation\"),f=\"none\"==c||\"hidden\"==c||r.present(t,\"tw-hide-thread\"),l=t.getAttribute(\"data-cards\"),h=\"none\"==l||\"hidden\"==l||r.present(t,\"tw-hide-media\"),p=t.getAttribute(\"data-align\")||t.getAttribute(\"align\"),m=t.getAttribute(\"data-theme\");return!p&&d.test(t.className)&&(p=RegExp.$1),o.aug(e,{tweetId:u,hideThread:f,hideCard:h,align:p,theme:m,id:u})}(t),t.parentNode,t,e)})}},function(t,e){var n=\"tfw_horizon_tweet_embed_9555\";t.exports={isHorizonTweetEnabled:function(t){return!(t&&t[n]&&\"control\"===t[n].bucket)}}},function(t,e,n){var r=n(82),i=n(30),o=\"tfw_horizon_tweet_embed_9555\";t.exports=function(t,e){var n;t&&(n=t[o])&&n.bucket&&r(o,n.bucket,n.version,i.formatHorizonTweetData(e))}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(7).then(function(r){var o;try{o=n(89),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return Promise.all([n.e(0),n.e(8)]).then(function(r){var o;try{o=n(90),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(10),i=n(0),o=n(13),s=n(14)(),a=n(68),u=n(5),c=\"a.twitter-share-button, a.twitter-mention-button, a.twitter-hashtag-button\",d=\"twitter-hashtag-button\",f=\"twitter-mention-button\";t.exports=function(t){return s(t,c).map(function(t){return a(function(t){var e=o(t),n={screenName:t.getAttribute(\"data-button-screen-name\"),text:t.getAttribute(\"data-text\"),type:t.getAttribute(\"data-type\"),size:t.getAttribute(\"data-size\"),url:t.getAttribute(\"data-url\"),hashtags:t.getAttribute(\"data-hashtags\"),via:t.getAttribute(\"data-via\"),buttonHashtag:t.getAttribute(\"data-button-hashtag\")};return i.forIn(n,function(t,n){var r=e[t];e[t]=u.hasValue(r)?r:n}),e.screenName=e.screenName||e.screen_name,e.buttonHashtag=e.buttonHashtag||e.button_hashtag||e.hashtag,r.present(t,d)&&(e.type=\"hashtag\"),r.present(t,f)&&(e.type=\"mention\"),e}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(3).then(function(r){var o;try{o=n(91),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(0);t.exports=r.aug({},n(156),n(157),n(158),n(159),n(160),n(161),n(162))},function(t,e,n){var r=n(59),i=n(17)([\"userId\"],{},r);t.exports={createDMButton:i}},function(t,e,n){var r=n(62),i=n(17)([\"screenName\"],{},r);t.exports={createFollowButton:i}},function(t,e,n){var r=n(63),i=n(17)([\"momentId\"],{},r);t.exports={createMoment:i}},function(t,e,n){var r=n(64),i=n(17)([\"username\"],{},r);t.exports={createPeriscopeOnAirButton:i}},function(t,e,n){var r=n(8),i=n(12),o=n(3),s=n(0),a=n(5),u=n(65),c=n(66),d=n(17)([],{},c),f=n(6),l=\"Embedded grids have been deprecated. Please use twttr.widgets.createTimeline instead. More info: https://twittercommunity.com/t/update-on-the-embedded-grid-display-type/119564.\",h={createTimeline:p,createGridFromCollection:function(t){var e=s.toRealArray(arguments).slice(1),n={sourceType:\"collection\",id:t};return e.unshift(n),i.publicLog(l),p.apply(this,e)}};function p(t){var e,n=s.toRealArray(arguments).slice(1);return a.isString(t)||a.isNumber(t)?f.reject(\"Embedded timelines with widget settings have been deprecated. See https://twittercommunity.com/t/deprecating-widget-settings/102295.\"):s.isObject(t)?(t=t||{},n.forEach(function(t){s.isType(\"object\",t)&&function(t){t.ariaLive=t.ariaPolite}(e=t)}),e||(e={},n.push(e)),t.lang=e.lang,t.tweetLimit=e.tweetLimit,t.showReplies=e.showReplies,e.dataSource=u(t),d.apply(this,n)):f.reject(\"data source must be an object.\")}o.isTwitterURL(r.href)&&(h.createTimelinePreview=function(t,e,n){var r={previewParams:t,useLegacyDefaults:!0,isPreviewTimeline:!0};return r.dataSource=u(r),d(e,r,n)}),t.exports=h},function(t,e,n){var r,i=n(0),o=n(67),s=n(17),a=(r=s([\"tweetId\"],{},o),function(){return i.toRealArray(arguments).slice(1).forEach(function(t){i.isType(\"object\",t)&&(t.hideCard=\"none\"==t.cards||\"hidden\"==t.cards,t.hideThread=\"none\"==t.conversation||\"hidden\"==t.conversation)}),r.apply(this,arguments)});t.exports={createTweet:a,createTweetEmbed:a,createVideo:a}},function(t,e,n){var r=n(0),i=n(68),o=n(17),s=o([\"url\"],{type:\"share\"},i),a=o([\"buttonHashtag\"],{type:\"hashtag\"},i),u=o([\"screenName\"],{type:\"mention\"},i);function c(t){return function(){return r.toRealArray(arguments).slice(1).forEach(function(t){r.isType(\"object\",t)&&(t.screenName=t.screenName||t.screen_name,t.buttonHashtag=t.buttonHashtag||t.button_hashtag||t.hashtag)}),t.apply(this,arguments)}}t.exports={createShareButton:c(s),createHashtagButton:c(a),createMentionButton:c(u)}},function(t,e,n){var r,i,o,s=n(4),a=n(1),u=0,c=[],d=s.createElement(\"a\");function f(){var t,e;for(u=1,t=0,e=c.length;t<e;t++)c[t]()}/^loade|c/.test(s.readyState)&&(u=1),s.addEventListener&&s.addEventListener(\"DOMContentLoaded\",i=function(){s.removeEventListener(\"DOMContentLoaded\",i,!1),f()},!1),d.doScroll&&s.attachEvent(\"onreadystatechange\",r=function(){/^c/.test(s.readyState)&&(s.detachEvent(\"onreadystatechange\",r),f())}),o=d.doScroll?function(t){a.self!=a.top?u?t():c.push(t):function(){try{d.doScroll(\"left\")}catch(e){return setTimeout(function(){o(t)},50)}t()}()}:function(t){u?t():c.push(t)},t.exports=o},function(t,e,n){var r=n(47),i=n(9);t.exports=function(){i.set(\"buildVersion\",r.version)}},function(t,e,n){n(166),n(83),n(169)},function(t,e,n){var r=n(167),i=n(29),o=n(69),s=new r,a=function(t){t.widgets&&1===t.widgets.length&&(s.start(),i.emitter.unbind(i.ALL_WIDGETS_RENDER_START,a))},u=function(t){var e;t.widgets&&1===t.widgets.length&&(e=t.widgets[0],s.end(),e.dataset&&e.dataset.tweetId&&o({duration:s.duration(),namespace:{element:\"tweet\",action:\"render\"},widgetIds:[e.dataset.tweetId]})),i.emitter.unbind(i.ALL_WIDGETS_RENDER_END,u)};i.emitter.bind(i.ALL_WIDGETS_RENDER_START,a),i.emitter.bind(i.ALL_WIDGETS_RENDER_END,u)},function(t,e,n){var r=n(168);function i(){}i.prototype.start=function(){this._startTime=r()},i.prototype.end=function(){this._duration=r()-this._startTime},i.prototype.duration=function(){return this._duration},t.exports=i},function(t,e,n){var r=n(1);t.exports=function(){return r.performance&&r.performance.now?r.performance.now():Date.now()}},function(t,e,n){var r=n(29),i=n(69),o=n(170),s=n(3),a=n(1),u=n(0),c=n(21),d=n(61);function f(t){return t.performance.getEntriesByType(\"resource\").filter(function(t){return s.isTwimgURL(t.name)||s.isTwitterURL(t.name)}).reduce(function(t,e){return t[e.name]=e.duration,t},{})}r.emitter.bind(r.ALL_WIDGETS_AND_IMAGES_LOADED,function(t){var e,n,r=[];c.hasPerformanceInformation()&&(e=f(a),d.isSupported()||(r=function(t){return t.reduce(function(t,e){return u.aug(t,f(e.contentDocument.defaultView))},{})}(t)),n=u.aug({},e,r),Object.keys(o).forEach(function(t){!function(t,e,n){var r=Object.keys(t).reduce(function(e,r){return n(r)?e+t[r]:e},0);i({duration:r,namespace:{element:e,action:\"resource\"}})}(n,t,o[t])}))})},function(t,e,n){var r=n(3),i={all:function(){return!0},image:function(t){return r.isTwimgURL(t)},settings:function(t){return r.isSettingsURL(t)},widget_iframe:function(t){return r.isWidgetIframeURL(t)}};t.exports=i}])));\r\n\r\nJuan Martin del THORtro @delpotrojuan pic.twitter.com/BsLeAHhULV\r\n\r\n— Roger Federer (@rogerfederer) 5 septembre 2017\r\n\r\nFunction&&Function.prototype&&Function.prototype.bind&&(/(MSIE ([6789]|10|11))|Trident/.test(navigator.userAgent)||(window.__twttr&&window.__twttr.widgets&&window.__twttr.widgets.loaded&&window.twttr.widgets.load&&window.twttr.widgets.load(),window.__twttr&&window.__twttr.widgets&&window.__twttr.widgets.init||function(t){function e(e){for(var n,i,o=e[0],s=e[1],a=0,c=[];a<o.length;a++)i=o[a],r[i]&&c.push(r[i][0]),r[i]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);for(u&&u(e);c.length;)c.shift()()}var n={},r={1:0};function i(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(t){var e=[],n=r[t];if(0!==n)if(n)e.push(n[2]);else{var o=new Promise(function(e,i){n=r[t]=[e,i]});e.push(n[2]=o);var s,a=document.getElementsByTagName(\"head\")[0],u=document.createElement(\"script\");u.charset=\"utf-8\",u.timeout=120,i.nc&&u.setAttribute(\"nonce\",i.nc),u.src=function(t){return i.p+\"js/\"+({0:\"moment~timeline~tweet\",2:\"dm_button\",3:\"button\",4:\"moment\",5:\"periscope_on_air\",6:\"timeline\",7:\"horizon_tweet\",8:\"tweet\"}[t]||t)+\".\"+{0:\"ae149926685a43cb146e35371430188e\",2:\"fe973228b5a3f65e3d8a0dd10b553d17\",3:\"63c51c903061d0dbd843c41e8a00aa5a\",4:\"50cf823c7bf26ac484f84f086ebc4bff\",5:\"97b8e8f03584fdf6deeb9dfd0bf9b2d5\",6:\"687eed636a16648c9f0b1f72d7fa68bd\",7:\"716ef7f4c155526f8ec8e60dbd2fbf56\",8:\"e71d9c824fc78e1a4e43d645b66bf574\"}[t]+\".js\"}(t),s=function(e){u.onerror=u.onload=null,clearTimeout(c);var n=r[t];if(0!==n){if(n){var i=e&&(\"load\"===e.type?\"missing\":e.type),o=e&&e.target&&e.target.src,s=new Error(\"Loading chunk \"+t+\" failed.\\n(\"+i+\": \"+o+\")\");s.type=i,s.request=o,n[1](s)}r[t]=void 0}};var c=setTimeout(function(){s({type:\"timeout\",target:u})},12e4);u.onerror=u.onload=s,a.appendChild(u)}return Promise.all(e)},i.m=t,i.c=n,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p=\"https://platform.twitter.com/\",i.oe=function(t){throw console.error(t),t};var o=window.__twttrll=window.__twttrll||[],s=o.push.bind(o);o.push=e,o=o.slice();for(var a=0;a<o.length;a++)e(o[a]);var u=s;i(i.s=92)}([function(t,e,n){var r=n(1);function i(t,e){var n;for(n in t)t.hasOwnProperty&&!t.hasOwnProperty(n)||e(n,t[n]);return t}function o(t){return{}.toString.call(t).match(/\\s([a-zA-Z]+)/)[1].toLowerCase()}function s(t){return t===Object(t)}function a(t){var e;if(!s(t))return!1;if(Object.keys)return!Object.keys(t).length;for(e in t)if(t.hasOwnProperty(e))return!1;return!0}function u(t){return t?Array.prototype.slice.call(t):[]}t.exports={aug:function(t){return u(arguments).slice(1).forEach(function(e){i(e,function(e,n){t[e]=n})}),t},async:function(t,e){r.setTimeout(function(){t.call(e||null)},0)},compact:function t(e){return i(e,function(n,r){s(r)&&(t(r),a(r)&&delete e[n]),void 0!==r&&null!==r&&\"\"!==r||delete e[n]}),e},contains:function(t,e){return!(!t||!t.indexOf)&&t.indexOf(e)>-1},forIn:i,isObject:s,isEmptyObject:a,toType:o,isType:function(t,e){return t==o(e)},toRealArray:u}},function(t,e){t.exports=window},function(t,e,n){var r=n(6);t.exports=function(){var t=this;this.promise=new r(function(e,n){t.resolve=e,t.reject=n})}},function(t,e,n){var r=n(11),i=/(?:^|(?:https?:)?\\/\\/(?:www\\.)?twitter\\.com(?::\\d+)?(?:\\/intent\\/(?:follow|user)\\/?\\?screen_name=|(?:\\/#!)?\\/))@?([\\w]+)(?:\\?|&|$)/i,o=/(?:^|(?:https?:)?\\/\\/(?:www\\.)?twitter\\.com(?::\\d+)?\\/(?:#!\\/)?[\\w_]+\\/status(?:es)?\\/)(\\d+)/i,s=/^http(s?):\\/\\/(\\w+\\.)*twitter\\.com([:/]|$)/i,a=/^http(s?):\\/\\/(ton|pbs)\\.twimg\\.com/,u=/^#?([^.,<>!\\s/#\\-()'\"]+)$/,c=/twitter\\.com(?::\\d{2,4})?\\/intent\\/(\\w+)/,d=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/\\w+\\/timelines\\/(\\d+)/i,f=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/i\\/moments\\/(\\d+)/i,l=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/(\\w+)\\/(?:likes|favorites)/i,h=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/(\\w+)\\/lists\\/([\\w-%]+)/i,p=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/i\\/live\\/(\\d+)/i,m=/^https?:\\/\\/syndication\\.twitter\\.com\\/settings/i,v=/^https?:\\/\\/(localhost|platform)\\.twitter\\.com(?::\\d+)?\\/widgets\\/widget_iframe\\.(.+)/i,g=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/search\\?q=(\\w+)/i;function w(t){return\"string\"==typeof t&&i.test(t)&&RegExp.$1.length<=20}function y(t){if(w(t))return RegExp.$1}function b(t,e){var n=r.decodeURL(t);if(e=e||!1,n.screen_name=y(t),n.screen_name)return r.url(\"https://twitter.com/intent/\"+(e?\"follow\":\"user\"),n)}function _(t){return\"string\"==typeof t&&u.test(t)}function E(t){return\"string\"==typeof t&&o.test(t)}t.exports={isHashTag:_,hashTag:function(t,e){if(e=void 0===e||e,_(t))return(e?\"#\":\"\")+RegExp.$1},isScreenName:w,screenName:y,isStatus:E,status:function(t){return E(t)&&RegExp.$1},intentForProfileURL:b,intentForFollowURL:function(t){return b(t,!0)},isTwitterURL:function(t){return s.test(t)},isTwimgURL:function(t){return a.test(t)},isIntentURL:function(t){return c.test(t)},isSettingsURL:function(t){return m.test(t)},isWidgetIframeURL:function(t){return v.test(t)},isSearchUrl:function(t){return g.test(t)},regexen:{profile:i},momentId:function(t){return f.test(t)&&RegExp.$1},collectionId:function(t){return d.test(t)&&RegExp.$1},intentType:function(t){return c.test(t)&&RegExp.$1},likesScreenName:function(t){return l.test(t)&&RegExp.$1},listScreenNameAndSlug:function(t){var e,n,r;if(h.test(t)){e=RegExp.$1,n=RegExp.$2;try{r=decodeURIComponent(n)}catch(t){}return{ownerScreenName:e,slug:r||n}}return!1},eventId:function(t){return p.test(t)&&RegExp.$1}}},function(t,e){t.exports=document},function(t,e,n){var r=n(0),i=[!0,1,\"1\",\"on\",\"ON\",\"true\",\"TRUE\",\"yes\",\"YES\"],o=[!1,0,\"0\",\"off\",\"OFF\",\"false\",\"FALSE\",\"no\",\"NO\"];function s(t){return void 0!==t&&null!==t&&\"\"!==t}function a(t){return c(t)&&t%1==0}function u(t){return c(t)&&!a(t)}function c(t){return s(t)&&!isNaN(t)}function d(t){return r.contains(o,t)}function f(t){return r.contains(i,t)}t.exports={hasValue:s,isInt:a,isFloat:u,isNumber:c,isString:function(t){return\"string\"===r.toType(t)},isArray:function(t){return s(t)&&\"array\"==r.toType(t)},isTruthValue:f,isFalseValue:d,asInt:function(t){if(a(t))return parseInt(t,10)},asFloat:function(t){if(u(t))return t},asNumber:function(t){if(c(t))return t},asBoolean:function(t){return!(!s(t)||!f(t)&&(d(t)||!t))}}},function(t,e,n){var r=n(1),i=n(21),o=n(48);i.hasPromiseSupport()||(r.Promise=o),t.exports=r.Promise},function(t,e,n){var r=n(0);t.exports=function(t,e){var n=Array.prototype.slice.call(arguments,2);return function(){var i=r.toRealArray(arguments);return t.apply(e,n.concat(i))}}},function(t,e){t.exports=location},function(t,e,n){var r=n(50);t.exports=new r(\"__twttr\")},function(t,e,n){var r=n(0),i=/\\b([\\w-_]+)\\b/g;function o(t){return new RegExp(\"\\\\b\"+t+\"\\\\b\",\"g\")}function s(t,e){t.classList?t.classList.add(e):o(e).test(t.className)||(t.className+=\" \"+e)}function a(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(o(e),\" \")}function u(t,e){return t.classList?t.classList.contains(e):r.contains(c(t),e)}function c(t){return r.toRealArray(t.classList?t.classList:t.className.match(i))}t.exports={add:s,remove:a,replace:function(t,e,n){if(t.classList&&u(t,e))return a(t,e),void s(t,n);t.className=t.className.replace(o(e),n)},toggle:function(t,e,n){return void 0===n&&t.classList&&t.classList.toggle?t.classList.toggle(e,n):(n?s(t,e):a(t,e),n)},present:u,list:c}},function(t,e,n){var r=n(5),i=n(0);function o(t){return encodeURIComponent(t).replace(/\\+/g,\"%2B\").replace(/'/g,\"%27\")}function s(t){return decodeURIComponent(t)}function a(t){var e=[];return i.forIn(t,function(t,n){var s=o(t);i.isType(\"array\",n)||(n=[n]),n.forEach(function(t){r.hasValue(t)&&e.push(s+\"=\"+o(t))})}),e.sort().join(\"&\")}function u(t){var e={};return t?(t.split(\"&\").forEach(function(t){var n=t.split(\"=\"),r=s(n[0]),o=s(n[1]);if(2==n.length){if(!i.isType(\"array\",e[r]))return r in e?(e[r]=[e[r]],void e[r].push(o)):void(e[r]=o);e[r].push(o)}}),e):{}}t.exports={url:function(t,e){return a(e).length>0?i.contains(t,\"?\")?t+\"&\"+a(e):t+\"?\"+a(e):t},decodeURL:function(t){var e=t&&t.split(\"?\");return 2==e.length?u(e[1]):{}},decode:u,encode:a,encodePart:o,decodePart:s}},function(t,e,n){var r=n(8),i=n(1),o=n(0),s={},a=o.contains(r.href,\"tw_debug=true\");function u(){}function c(){}function d(){return i.performance&&+i.performance.now()||+new Date}function f(t,e){if(i.console&&i.console[t])switch(e.length){case 1:i.console[t](e[0]);break;case 2:i.console[t](e[0],e[1]);break;case 3:i.console[t](e[0],e[1],e[2]);break;case 4:i.console[t](e[0],e[1],e[2],e[3]);break;case 5:i.console[t](e[0],e[1],e[2],e[3],e[4]);break;default:0!==e.length&&i.console.warn&&i.console.warn(\"too many params passed to logger.\"+t)}}t.exports={devError:u,devInfo:c,devObject:function(t,e){},publicError:function(){f(\"error\",o.toRealArray(arguments))},publicLog:function(){f(\"info\",o.toRealArray(arguments))},time:function(t){a&&(s[t]=d())},timeEnd:function(t){a&&s[t]&&(d(),s[t])}}},function(t,e,n){var r=n(20),i=n(5),o=n(11),s=n(0),a=n(118);t.exports=function(t){var e=t.href&&t.href.split(\"?\")[1],n=e?o.decode(e):{},u={lang:a(t),width:t.getAttribute(\"data-width\")||t.getAttribute(\"width\"),height:t.getAttribute(\"data-height\")||t.getAttribute(\"height\"),related:t.getAttribute(\"data-related\"),partner:t.getAttribute(\"data-partner\")};return i.asBoolean(t.getAttribute(\"data-dnt\"))&&r.setOn(),s.forIn(u,function(t,e){var r=n[t];n[t]=i.hasValue(r)?r:e}),s.compact(n)}},function(t,e,n){var r=n(78),i=n(23);t.exports=function(){var t=\"data-twitter-extracted-\"+i.generate();return function(e,n){return r(e,n).filter(function(e){return!e.hasAttribute(t)}).map(function(e){return e.setAttribute(t,\"true\"),e})}}},function(t,e){function n(t,e,n,r,i,o,s){this.factory=t,this.Sandbox=e,this.srcEl=o,this.targetEl=i,this.parameters=r,this.className=n,this.options=s}n.prototype.destroy=function(){this.srcEl=this.targetEl=null},t.exports=n},function(t,e){t.exports={DM_BUTTON:\"twitter-dm-button\",FOLLOW_BUTTON:\"twitter-follow-button\",HASHTAG_BUTTON:\"twitter-hashtag-button\",MENTION_BUTTON:\"twitter-mention-button\",MOMENT:\"twitter-moment\",PERISCOPE:\"periscope-on-air\",SHARE_BUTTON:\"twitter-share-button\",TIMELINE:\"twitter-timeline\",TWEET:\"twitter-tweet\"}},function(t,e,n){var r=n(6),i=n(20),o=n(52),s=n(35),a=n(5),u=n(0);t.exports=function(t,e,n){var c;return t=t||[],e=e||{},c=\"ƒ(\"+t.join(\", \")+\", target, [options]);\",function(){var d,f,l,h,p=Array.prototype.slice.apply(arguments,[0,t.length]),m=Array.prototype.slice.apply(arguments,[t.length]);return m.forEach(function(t){t&&(t.nodeType!==Node.ELEMENT_NODE?u.isType(\"function\",t)?d=t:u.isType(\"object\",t)&&(f=t):l=t)}),p.length!==t.length||0===m.length?(d&&u.async(function(){d(!1)}),r.reject(new Error(\"Not enough parameters. Expected: \"+c))):l?(f=u.aug({},f||{},e),t.forEach(function(t){f[t]=p.shift()}),a.asBoolean(f.dnt)&&i.setOn(),h=s.getExperiments().then(function(t){return o.addWidget(n(f,l,void 0,t))}),d&&h.then(d,function(){d(!1)}),h):(d&&u.async(function(){d(!1)}),r.reject(new Error(\"No target element specified. Expected: \"+c)))}}},function(t,e,n){var r=n(99),i=n(2),o=n(0);function s(t,e){return function(){try{e.resolve(t.call(this))}catch(t){e.reject(t)}}}t.exports={sync:function(t,e){t.call(e)},read:function(t,e){var n=new i;return r.read(s(t,n),e),n.promise},write:function(t,e){var n=new i;return r.write(s(t,n),e),n.promise},defer:function(t,e,n){var a=new i;return o.isType(\"function\",t)&&(n=e,e=t,t=1),r.defer(t,s(e,a),n),a.promise}}},function(t,e,n){var r=n(9),i=[\"https://syndication.twitter.com\",\"https://cdn.syndication.twimg.com\",\"https://localhost.twitter.com:8444\"],o=[\"https://syndication.twitter.com\",\"https://localhost.twitter.com:8445\"],s=[\"https://platform.twitter.com/embed/index.html\",\"https://localhost.twitter.com\",/https:\\/\\/ton\\.smf1\\.twitter\\.com\\/syndication-internal\\/embed-iframe\\/[0-9A-Za-z_-]+\\/app\\/index\\.html/],a=function(t,e){return t.some(function(t){return t instanceof RegExp?t.test(e):t===e})},u=function(){var t=r.get(\"backendHost\");return t&&a(i,t)?t:\"https://cdn.syndication.twimg.com\"},c=function(){var t=r.get(\"settingsSvcHost\");return t&&a(o,t)?t:\"https://syndication.twitter.com\"},d=function(){var t=r.get(\"embedIframeURL\");return t&&a(s,t)?t:\"https://platform.twitter.com/embed/index.html\"};function f(t,e){var n=[t];return e.forEach(function(t){n.push(function(t){var e=(t||\"\").toString(),n=\"/\"===e.slice(0,1)?1:0,r=function(t){return\"/\"===t.slice(-1)}(e)?-1:void 0;return e.slice(n,r)}(t))}),n.join(\"/\")}t.exports={cookieConsent:function(t){var e=t||[];return e.unshift(\"cookie/consent\"),f(c(),e)},embedIframe:function(){return d()},eventVideo:function(t){var e=t||[];return e.unshift(\"video/event\"),f(u(),e)},grid:function(t){var e=t||[];return e.unshift(\"grid/collection\"),f(u(),e)},moment:function(t){var e=t||[];return e.unshift(\"moments\"),f(u(),e)},settings:function(t){var e=t||[];return e.unshift(\"settings\"),f(c(),e)},timeline:function(t){var e=t||[];return e.unshift(\"timeline\"),f(u(),e)},tweetBatch:function(t){var e=t||[];return e.unshift(\"tweets.json\"),f(u(),e)},video:function(t){var e=t||[];return e.unshift(\"widgets/video\"),f(u(),e)}}},function(t,e,n){var r=n(4),i=n(8),o=n(39),s=n(102),a=n(5),u=n(34),c=!1,d=/https?:\\/\\/([^/]+).*/i;t.exports={setOn:function(){c=!0},enabled:function(t,e){return!!(c||a.asBoolean(u.val(\"dnt\"))||s.isUrlSensitive(e||i.host)||o.isFramed()&&s.isUrlSensitive(o.rootDocumentLocation())||(t=d.test(t||r.referrer)&&RegExp.$1)&&s.isUrlSensitive(t))}}},function(t,e,n){var r=n(4),i=n(12),o=n(93),s=n(1),a=n(0),u=o.userAgent;function c(t){return/(Trident|MSIE|Edge[/ ]?\\d)/.test(t=t||u)}t.exports={retina:function(t){return(t=t||s).devicePixelRatio?t.devicePixelRatio>=1.5:!!t.matchMedia&&t.matchMedia(\"only screen and (min-resolution: 144dpi)\").matches},anyIE:c,ie9:function(t){return/MSIE 9/.test(t=t||u)},ie10:function(t){return/MSIE 10/.test(t=t||u)},ios:function(t){return/(iPad|iPhone|iPod)/.test(t=t||u)},android:function(t){return/^Mozilla\\/5\\.0 \\(Linux; (U; )?Android/.test(t=t||u)},canPostMessage:function(t,e){return t=t||s,e=e||u,t.postMessage&&!(c(e)&&t.opener)},touch:function(t,e,n){return t=t||s,e=e||o,n=n||u,\"ontouchstart\"in t||/Opera Mini/.test(n)||e.msMaxTouchPoints>0},cssTransitions:function(){var t=r.body.style;return void 0!==t.transition||void 0!==t.webkitTransition||void 0!==t.mozTransition||void 0!==t.oTransition||void 0!==t.msTransition},hasPromiseSupport:function(){return!!(s.Promise&&s.Promise.resolve&&s.Promise.reject&&s.Promise.all&&s.Promise.race&&(new s.Promise(function(e){t=e}),a.isType(\"function\",t)));var t},hasIntersectionObserverSupport:function(){return!!s.IntersectionObserver},hasPerformanceInformation:function(){return s.performance&&s.performance.getEntriesByType},hasLocalStorageSupport:function(){try{return s.localStorage.setItem(\"local_storage_support_test\",\"true\"),void 0!==s.localStorage}catch(t){return i.devError(\"window.localStorage is not supported:\",t),!1}}}},function(t,e,n){var r=n(6),i=n(2);function o(t,e){return t.then(e,e)}function s(t){return t instanceof r}t.exports={always:o,allResolved:function(t){var e;return void 0===t?r.reject(new Error(\"undefined is not an object\")):Array.isArray(t)?(e=t.length)?new r(function(n,r){var i=0,o=[];function a(){(i+=1)===e&&(0===o.length?r():n(o))}function u(t){o.push(t),a()}t.forEach(function(t){s(t)?t.then(u,a):u(t)})}):r.resolve([]):r.reject(new Error(\"Type error\"))},some:function(t){var e;return e=(t=t||[]).length,t=t.filter(s),e?e!==t.length?r.reject(\"non-Promise passed to .some\"):new r(function(e,n){var r=0;function i(){(r+=1)===t.length&&n()}t.forEach(function(t){t.then(e,i)})}):r.reject(\"no promises passed to .some\")},isPromise:s,allSettled:function(t){function e(){}return r.all((t||[]).map(function(t){return o(t,e)}))},timeout:function(t,e){var n=new i;return setTimeout(function(){n.reject(new Error(\"Promise timed out\"))},e),t.then(function(t){n.resolve(t)},function(t){n.reject(t)}),n.promise}}},function(t,e){var n=\"i\",r=0,i=0;t.exports={generate:function(){return n+String(+new Date)+Math.floor(1e5*Math.random())+r++},deterministic:function(){return n+String(i++)}}},function(t,e,n){var r=n(49),i=n(51),o=n(0);t.exports=o.aug(r.get(\"events\")||{},i.Emitter)},function(t,e,n){var r=n(26),i=n(108);t.exports=r.build([i])},function(t,e,n){var r=n(40),i=n(105),o=n(7);(r=Object.create(r)).build=o(r.build,null,i),t.exports=r},function(t,e,n){var r=n(40),i=n(41),o=n(7);(r=Object.create(r)).build=o(r.build,null,i),t.exports=r},function(t,e,n){var r=n(80),i=n(75),o=n(81),s=n(8),a=n(70),u=n(74),c=n(20),d=n(5),f=n(23),l=n(0);function h(t){if(!t||!t.headers)throw new Error(\"unexpected response schema\");return{html:t.body,config:t.config,pollInterval:1e3*parseInt(t.headers.xPolling,10)||null,maxCursorPosition:t.headers.maxPosition,minCursorPosition:t.headers.minPosition}}function p(t){if(t&&t.headers)throw new Error(t.headers.status);throw t instanceof Error?t:new Error(t)}t.exports=function(t){t.params({instanceId:{required:!0,fallback:f.deterministic},lang:{required:!0,transform:a.matchLanguage,fallback:\"en\"},tweetLimit:{transform:d.asInt}}),t.defineProperty(\"endpoint\",{get:function(){throw new Error(\"endpoint not specified\")}}),t.defineProperty(\"pollEndpoint\",{get:function(){return this.endpoint}}),t.define(\"cbId\",function(t){var e=t?\"_new\":\"_old\";return\"tl_\"+this.params.instanceId+\"_\"+this.id+e}),t.define(\"queryParams\",function(){return{lang:this.params.lang,tz:u.getTimezoneOffset(),t:r(),domain:s.host,tweet_limit:this.params.tweetLimit,dnt:c.enabled()}}),t.define(\"fetch\",function(){return i.fetch(this.endpoint,this.queryParams(),o,this.cbId()).then(h,p)}),t.define(\"poll\",function(t,e){var n,r;return n={since_id:(t=t||{}).sinceId,max_id:t.maxId,min_position:t.minPosition,max_position:t.maxPosition},r=l.aug(this.queryParams(),n),i.fetch(this.pollEndpoint,r,o,this.cbId(e)).then(h,p)})}},function(t,e,n){var r=n(51).makeEmitter();t.exports={emitter:r,START:\"start\",ALL_WIDGETS_RENDER_START:\"all_widgets_render_start\",ALL_WIDGETS_RENDER_END:\"all_widgets_render_end\",ALL_WIDGETS_AND_IMAGES_LOADED:\"all_widgets_and_images_loaded\"}},function(t,e,n){var r=n(47),i=n(4),o=n(20),s=n(33),a=n(71),u=n(32),c=n(9),d=n(3),f=n(0),l=1,h=r.version,p=c.get(\"clientEventEndpoint\")||\"https://syndication.twitter.com/i/jot\";function m(t){return f.aug({client:\"tfw\"},t||{})}function v(t,e,n){return e=e||{},f.aug({},e,{_category_:t,triggered_on:e.triggered_on||+new Date,dnt:o.enabled(n)})}t.exports={extractTermsFromDOM:function t(e,n){var r;return n=n||{},e&&e.nodeType===Node.ELEMENT_NODE?((r=e.getAttribute(\"data-scribe\"))&&r.split(\" \").forEach(function(t){var e=t.trim().split(\":\"),r=e[0],i=e[1];r&&i&&!n[r]&&(n[r]=i)}),t(e.parentNode,n)):n},clickEventElement:function(t){var e=s.closest(\"[data-expanded-url]\",t),n=e&&e.getAttribute(\"data-expanded-url\");return n&&d.isTwitterURL(n)?\"twitter_url\":\"url\"},flattenClientEventPayload:function(t,e){return f.aug({},e,{event_namespace:t})},formatGenericEventData:v,formatClientEventData:function(t,e,n){var r=t&&t.widget_origin||i.referrer;return(t=v(\"tfw_client_event\",t,r)).client_version=h,t.format_version=void 0!==n?n:1,e||(t.widget_origin=r),t},formatClientEventNamespace:m,formatHorizonTweetData:function(t){var e={item_ids:[],item_details:{}};return e.item_ids.push(t),e.item_details[t]={item_type:a.TWEET},e},formatTweetAssociation:function(t,e){var n={};return(e=e||{}).association_namespace=m(t),n[l]=e,n},noticeSeen:function(t){return\"notice\"===t.element&&\"seen\"===t.action},splitLogEntry:function(t){var e,n,r,i,o;return t.item_ids&&t.item_ids.length>1?(e=Math.floor(t.item_ids.length/2),n=t.item_ids.slice(0,e),r={},i=t.item_ids.slice(e),o={},n.forEach(function(e){r[e]=t.item_details[e]}),i.forEach(function(e){o[e]=t.item_details[e]}),[f.aug({},t,{item_ids:n,item_details:r}),f.aug({},t,{item_ids:i,item_details:o})]):[t]},stringify:function(t){var e,n=Array.prototype.toJSON;return delete Array.prototype.toJSON,e=u.stringify(t),n&&(Array.prototype.toJSON=n),e},CLIENT_EVENT_ENDPOINT:p,RUFOUS_REDIRECT:\"https://platform.twitter.com/jot.html\"}},function(t,e,n){var r=n(4),i=n(0);t.exports=function(t,e,n){var o;if(n=n||r,t=t||{},e=e||{},t.name){try{o=n.createElement('<iframe name=\"'+t.name+'\"><\/iframe>')}catch(e){(o=n.createElement(\"iframe\")).name=t.name}delete t.name}else o=n.createElement(\"iframe\");return t.id&&(o.id=t.id,delete t.id),o.allowtransparency=\"true\",o.scrolling=\"no\",o.setAttribute(\"frameBorder\",0),o.setAttribute(\"allowTransparency\",!0),i.forIn(t,function(t,e){o.setAttribute(t,e)}),i.forIn(e,function(t,e){o.style[t]=e}),o}},function(t,e,n){var r=n(1).JSON;t.exports={stringify:r.stringify||r.encode,parse:r.parse||r.decode}},function(t,e,n){var r=n(0),i=n(43);t.exports={closest:function t(e,n,o){var s;if(n)return o=o||n&&n.ownerDocument,s=r.isType(\"function\",e)?e:function(t){return function(e){return!!e.tagName&&i(e,t)}}(e),n===o?s(n)?n:void 0:s(n)?n:t(s,n.parentNode,o)}}},function(t,e,n){var r,i=n(4);function o(t){var e,n,o,s=0;for(r={},e=(t=t||i).getElementsByTagName(\"meta\");e[s];s++){if(n=e[s],/^twitter:/.test(n.getAttribute(\"name\")))o=n.getAttribute(\"name\").replace(/^twitter:/,\"\");else{if(!/^twitter:/.test(n.getAttribute(\"property\")))continue;o=n.getAttribute(\"property\").replace(/^twitter:/,\"\")}r[o]=n.getAttribute(\"content\")||n.getAttribute(\"value\")}}o(),t.exports={init:o,val:function(t){return r[t]}}},function(t,e,n){var r=n(112),i=n(115);function o(t){return r.settingsLoaded().then(function(e){return e[t]})}function s(){return o(\"features\")}t.exports={shouldObtainCookieConsent:function(){return o(\"shouldObtainCookieConsent\")},getExperiments:s,getExperiment:function(t){return s().then(function(e){if(!e[t])throw new Error(\"Experiment not found\");return e[t]})},getActiveExperimentDataString:function(){return s().then(function(t){var e=Object.keys(t).reduce(function(e,n){var r;return t[n].version&&(r=n.split(\"_\").slice(-1)[0],e.push(r+\";\"+t[n].bucket)),e},[]);return i(e.join(\",\"))})},getExperimentKeys:function(){return s().then(function(t){return Object.keys(t)})},load:function(){r.load()}}},function(t,e,n){var r=n(10),i={},o=-1,s={};function a(t){var e=t.getAttribute(\"data-twitter-event-id\");return e||(t.setAttribute(\"data-twitter-event-id\",++o),o)}function u(t,e,n){var r=0,i=t&&t.length||0;for(r=0;r<i;r++)if(t[r].call(e,n,e),n.ceaseImmediately)return!1}function c(t,e,n){for(var i=n||t.target||t.srcElement,o=r.list(i).map(function(t){return\".\"+t}).concat(i.tagName),s=0,a=o.length;s<a;s++)if(!1===u(e[o[s]],i,t))return;t.cease||i!==this&&c.call(this,t,e,i.parentElement||i.parentNode)}function d(t,e,n,r){function i(r){c.call(t,r,n[e])}!function(t,e,n,r){t.id&&(s[t.id]=s[t.id]||[],s[t.id].push({el:t,listener:e,type:n,rootId:r}))}(t,i,e,r),t.addEventListener(e,i,!1)}function f(t){t&&t.preventDefault?t.preventDefault():t.returnValue=!1}function l(t){t&&(t.cease=!0)&&t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}t.exports={stop:function(t){return l(t),f(t),!1},stopPropagation:l,stopImmediatePropagation:function(t){t&&(t.ceaseImmediately=!0,l(t),t.stopImmediatePropagation())},preventDefault:f,delegate:function(t,e,n,r){var o=a(t);i[o]=i[o]||{},i[o][e]||(i[o][e]={},d(t,e,i[o],o)),i[o][e][n]=i[o][e][n]||[],i[o][e][n].push(r)},simulate:function(t,e,n){var r=a(e),o=i[r]&&i[r];c.call(e,{target:n},o[t])},removeDelegatesForWidget:function(t){var e=s[t];e&&(e.forEach(function(t){t.el.removeEventListener(t.type,t.listener,!1),delete i[t.rootId]}),delete s[t])}}},function(t,e,n){var r=n(101),i=n(110),o=new(n(111))(function(t){(!function(t){return 1===t.length&&i.canFlushOneItem(t[0])}(t)?function(t){r.init(),t.forEach(function(t){var e=t.input.namespace,n=t.input.data,i=t.input.offsite,o=t.input.version;r.clientEvent(e,n,i,o)}),r.flush().then(function(){t.forEach(function(t){t.taskDoneDeferred.resolve()})},function(){t.forEach(function(t){t.taskDoneDeferred.reject()})})}:function(t){t.forEach(function(t){var e=t.input.namespace,n=t.input.data,r=t.input.offsite,o=t.input.version;i.clientEvent(e,n,r,o),t.taskDoneDeferred.resolve()})})(t)});t.exports={scribe:function(t,e,n,r){return o.add({namespace:t,data:e,offsite:n,version:r})},pause:function(){o.pause()},resume:function(){o.resume()}}},function(t,e,n){var r=n(26),i=n(124);t.exports=r.build([i])},function(t,e,n){var r=n(8),i=n(77),o=n(0),s=i.getCanonicalURL()||r.href,a=s;t.exports={isFramed:function(){return s!==a},rootDocumentLocation:function(t){return t&&o.isType(\"string\",t)&&(s=t),s},currentDocumentLocation:function(){return a}}},function(t,e,n){var r=n(103),i=n(104),o=n(0);t.exports={couple:function(){return o.toRealArray(arguments)},build:function(t,e,n){var o=new t;return(e=i(r(e||[]))).forEach(function(t){t.call(null,o)}),o.build(n)}}},function(t,e,n){var r=n(106),i=n(0),o=n(42);function s(){this.Component=this.factory(),this._adviceArgs=[],this._lastArgs=[]}i.aug(s.prototype,{factory:o,build:function(t){var e=this;return this.Component,i.aug(this.Component.prototype.boundParams,t),this._adviceArgs.concat(this._lastArgs).forEach(function(t){(function(t,e,n){var r=this[e];if(!r)throw new Error(e+\" does not exist\");this[e]=t(r,n)}).apply(e.Component.prototype,t)}),delete this._lastArgs,delete this._adviceArgs,this.Component},params:function(t){var e=this.Component.prototype.paramConfigs;t=t||{},this.Component.prototype.paramConfigs=i.aug({},t,e)},define:function(t,e){if(t in this.Component.prototype)throw new Error(t+\" has previously been defined\");this.override(t,e)},defineStatic:function(t,e){this.Component[t]=e},override:function(t,e){this.Component.prototype[t]=e},defineProperty:function(t,e){if(t in this.Component.prototype)throw new Error(t+\" has previously been defined\");this.overrideProperty(t,e)},overrideProperty:function(t,e){var n=i.aug({configurable:!0},e);Object.defineProperty(this.Component.prototype,t,n)},before:function(t,e){this._adviceArgs.push([r.before,t,e])},after:function(t,e){this._adviceArgs.push([r.after,t,e])},around:function(t,e){this._adviceArgs.push([r.around,t,e])},last:function(t,e){this._lastArgs.push([r.after,t,e])}}),t.exports=s},function(t,e,n){var r=n(0);function i(){return!0}function o(t){return t}t.exports=function(){function t(t){var e=this;t=t||{},this.params=Object.keys(this.paramConfigs).reduce(function(n,s){var a=[],u=e.boundParams,c=e.paramConfigs[s],d=c.validate||i,f=c.transform||o;if(s in u&&a.push(u[s]),s in t&&a.push(t[s]),a=\"fallback\"in c?a.concat(c.fallback):a,n[s]=function(t,e,n){var i=null;return t.some(function(t){if(t=r.isType(\"function\",t)?t():t,e(t))return i=n(t),!0}),i}(a,d,f),c.required&&null==n[s])throw new Error(s+\" is a required parameter\");return n},{}),this.initialize()}return r.aug(t.prototype,{paramConfigs:{},boundParams:{},initialize:function(){}}),t}},function(t,e,n){var r=n(1).HTMLElement,i=r.prototype.matches||r.prototype.matchesSelector||r.prototype.webkitMatchesSelector||r.prototype.mozMatchesSelector||r.prototype.msMatchesSelector||r.prototype.oMatchesSelector;t.exports=function(t,e){if(i)return i.call(t,e)}},function(t,e,n){var r,i=n(10),o=n(4),s=n(1),a=n(34),u=n(53),c=n(5),d=n(23),f=\"csptest\";t.exports={inlineStyle:function(){var t=f+d.generate(),e=o.createElement(\"div\"),n=o.createElement(\"style\"),l=\".\"+t+\" { visibility: hidden; }\";return!!o.body&&(c.asBoolean(a.val(\"widgets:csp\"))&&(r=!1),void 0!==r?r:(e.style.display=\"none\",i.add(e,t),n.type=\"text/css\",n.appendChild(o.createTextNode(l)),o.body.appendChild(n),o.body.appendChild(e),r=\"hidden\"===s.getComputedStyle(e).visibility,u(e),u(n),r))}}},function(t,e,n){var r=n(1);t.exports=function(t,e,n){var i,o=0;return n=n||null,function s(){var a=n||this,u=arguments,c=+new Date;if(r.clearTimeout(i),c-o>e)return o=c,void t.apply(a,u);i=r.setTimeout(function(){s.apply(a,u)},e)}}},function(t,e){t.exports=function(t){var e=t.getBoundingClientRect();return{width:e.width,height:e.height}}},function(t){t.exports={version:\"ed20a2b:1601588405575\"}},function(t,e,n){\r\n/*!\r\n * @overview es6-promise - a tiny implementation of Promises/A+.\r\n * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)\r\n * @license   Licensed under MIT license\r\n *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE\r\n * @version   v4.2.5+7f2b526d\r\n */var r;r=function(){\"use strict\";function t(t){return\"function\"==typeof t}var e=Array.isArray?Array.isArray:function(t){return\"[object Array]\"===Object.prototype.toString.call(t)},n=0,r=void 0,i=void 0,o=function(t,e){l[n]=t,l[n+1]=e,2===(n+=2)&&(i?i(h):w())},s=\"undefined\"!=typeof window?window:void 0,a=s||{},u=a.MutationObserver||a.WebKitMutationObserver,c=\"undefined\"==typeof self&&\"undefined\"!=typeof process&&\"[object process]\"==={}.toString.call(process),d=\"undefined\"!=typeof Uint8ClampedArray&&\"undefined\"!=typeof importScripts&&\"undefined\"!=typeof MessageChannel;function f(){var t=setTimeout;return function(){return t(h,1)}}var l=new Array(1e3);function h(){for(var t=0;t<n;t+=2)(0,l[t])(l[t+1]),l[t]=void 0,l[t+1]=void 0;n=0}var p,m,v,g,w=void 0;function y(t,e){var n=this,r=new this.constructor(E);void 0===r[_]&&k(r);var i=n._state;if(i){var s=arguments[i-1];o(function(){return D(i,r,s,n._result)})}else I(n,r,t,e);return r}function b(t){if(t&&\"object\"==typeof t&&t.constructor===this)return t;var e=new this(E);return C(e,t),e}c?w=function(){return process.nextTick(h)}:u?(m=0,v=new u(h),g=document.createTextNode(\"\"),v.observe(g,{characterData:!0}),w=function(){g.data=m=++m%2}):d?((p=new MessageChannel).port1.onmessage=h,w=function(){return p.port2.postMessage(0)}):w=void 0===s?function(){try{var t=Function(\"return this\")().require(\"vertx\");return void 0!==(r=t.runOnLoop||t.runOnContext)?function(){r(h)}:f()}catch(t){return f()}}():f();var _=Math.random().toString(36).substring(2);function E(){}var x=void 0,T=1,S=2,A={error:null};function R(t){try{return t.then}catch(t){return A.error=t,A}}function N(e,n,r){n.constructor===e.constructor&&r===y&&n.constructor.resolve===b?function(t,e){e._state===T?L(t,e._result):e._state===S?j(t,e._result):I(e,void 0,function(e){return C(t,e)},function(e){return j(t,e)})}(e,n):r===A?(j(e,A.error),A.error=null):void 0===r?L(e,n):t(r)?function(t,e,n){o(function(t){var r=!1,i=function(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}(n,e,function(n){r||(r=!0,e!==n?C(t,n):L(t,n))},function(e){r||(r=!0,j(t,e))},t._label);!r&&i&&(r=!0,j(t,i))},t)}(e,n,r):L(e,n)}function C(t,e){var n,r;t===e?j(t,new TypeError(\"You cannot resolve a promise with itself\")):(r=typeof(n=e),null===n||\"object\"!==r&&\"function\"!==r?L(t,e):N(t,e,R(e)))}function P(t){t._onerror&&t._onerror(t._result),O(t)}function L(t,e){t._state===x&&(t._result=e,t._state=T,0!==t._subscribers.length&&o(O,t))}function j(t,e){t._state===x&&(t._state=S,t._result=e,o(P,t))}function I(t,e,n,r){var i=t._subscribers,s=i.length;t._onerror=null,i[s]=e,i[s+T]=n,i[s+S]=r,0===s&&t._state&&o(O,t)}function O(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,i=void 0,o=t._result,s=0;s<e.length;s+=3)r=e[s],i=e[s+n],r?D(n,r,i,o):i(o);t._subscribers.length=0}}function D(e,n,r,i){var o=t(r),s=void 0,a=void 0,u=void 0,c=void 0;if(o){if((s=function(t,e){try{return t(e)}catch(t){return A.error=t,A}}(r,i))===A?(c=!0,a=s.error,s.error=null):u=!0,n===s)return void j(n,new TypeError(\"A promises callback cannot return that same promise.\"))}else s=i,u=!0;n._state!==x||(o&&u?C(n,s):c?j(n,a):e===T?L(n,s):e===S&&j(n,s))}var z=0;function k(t){t[_]=z++,t._state=void 0,t._result=void 0,t._subscribers=[]}var M=function(){function t(t,n){this._instanceConstructor=t,this.promise=new t(E),this.promise[_]||k(this.promise),e(n)?(this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),0===this.length?L(this.promise,this._result):(this.length=this.length||0,this._enumerate(n),0===this._remaining&&L(this.promise,this._result))):j(this.promise,new Error(\"Array Methods must be provided an Array\"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===x&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===b){var i=R(t);if(i===y&&t._state!==x)this._settledAt(t._state,e,t._result);else if(\"function\"!=typeof i)this._remaining--,this._result[e]=t;else if(n===U){var o=new n(E);N(o,t,i),this._willSettleAt(o,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===x&&(this._remaining--,t===S?j(r,n):this._result[e]=n),0===this._remaining&&L(r,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;I(t,void 0,function(t){return n._settledAt(T,e,t)},function(t){return n._settledAt(S,e,t)})},t}(),U=function(){function e(t){this[_]=z++,this._result=this._state=void 0,this._subscribers=[],E!==t&&(\"function\"!=typeof t&&function(){throw new TypeError(\"You must pass a resolver function as the first argument to the promise constructor\")}(),this instanceof e?function(t,e){try{e(function(e){C(t,e)},function(e){j(t,e)})}catch(e){j(t,e)}}(this,t):function(){throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return t(e)?this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})}):this.then(e,e)},e}();return U.prototype.then=y,U.all=function(t){return new M(this,t).promise},U.race=function(t){var n=this;return e(t)?new n(function(e,r){for(var i=t.length,o=0;o<i;o++)n.resolve(t[o]).then(e,r)}):new n(function(t,e){return e(new TypeError(\"You must pass an array to race.\"))})},U.resolve=b,U.reject=function(t){var e=new this(E);return j(e,t),e},U._setScheduler=function(t){i=t},U._setAsap=function(t){o=t},U._asap=o,U.polyfill=function(){var t=void 0;if(\"undefined\"!=typeof global)t=global;else if(\"undefined\"!=typeof self)t=self;else try{t=Function(\"return this\")()}catch(t){throw new Error(\"polyfill failed because global object is unavailable in this environment\")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if(\"[object Promise]\"===n&&!e.cast)return}t.Promise=U},U.Promise=U,U},t.exports=r()},function(t,e,n){var r=n(50);t.exports=new r(\"twttr\")},function(t,e,n){var r=n(1),i=n(0);function o(t){return i.isType(\"string\",t)?t.split(\".\"):i.isType(\"array\",t)?t:[]}function s(t,e){(e=e||r)[t]=e[t]||{},Object.defineProperty(this,\"base\",{value:e[t]}),Object.defineProperty(this,\"name\",{value:t})}i.aug(s.prototype,{get:function(t){return o(t).reduce(function(t,e){if(i.isObject(t))return t[e]},this.base)},set:function(t,e,n){var r=o(t),s=function(t,e){var n=o(e).slice(0,-1);return n.reduce(function(t,e,r){if(t[e]=t[e]||{},!i.isObject(t[e]))throw new Error(n.slice(0,r+1).join(\".\")+\" is already defined with a value.\");return t[e]},t)}(this.base,t),a=r.slice(-1);return n&&a in s?s[a]:s[a]=e},init:function(t,e){return this.set(t,e,!0)},unset:function(t){var e=o(t),n=this.get(e.slice(0,-1));n&&delete n[e.slice(-1)]},aug:function(t){var e=this.get(t),n=i.toRealArray(arguments).slice(1);if(e=void 0!==e?e:{},n.unshift(e),!n.every(i.isObject))throw new Error(\"Cannot augment non-object.\");return this.set(t,i.aug.apply(null,n))},call:function(t){var e=this.get(t),n=i.toRealArray(arguments).slice(1);if(!i.isType(\"function\",e))throw new Error(\"Function \"+t+\"does not exist.\");return e.apply(null,n)},fullPath:function(t){var e=o(t);return e.unshift(this.name),e.join(\".\")}}),t.exports=s},function(t,e,n){var r=n(0),i=n(7),o={bind:function(t,e){return this._handlers=this._handlers||{},this._handlers[t]=this._handlers[t]||[],this._handlers[t].push(e)},unbind:function(t,e){var n;this._handlers&&this._handlers[t]&&(e?(n=this._handlers[t].indexOf(e))>=0&&this._handlers[t].splice(n,1):this._handlers[t]=[])},trigger:function(t,e){var n=this._handlers&&this._handlers[t];(e=e||{}).type=t,n&&n.forEach(function(t){r.async(i(t,this,e))})}};t.exports={Emitter:o,makeEmitter:function(){return r.aug(function(){},o)}}},function(t,e,n){var r=n(98),i=n(76),o=n(6),s=n(22),a=n(7),u=n(0),c=new i(function(t){var e=function(t){return t.reduce(function(t,e){return t[e._className]=t[e._className]||[],t[e._className].push(e),t},{})}(t.map(r.fromRawTask));u.forIn(e,function(t,e){s.allSettled(e.map(function(t){return t.initialize()})).then(function(){e.forEach(function(t){o.all([t.hydrate(),t.insertIntoDom()]).then(a(t.render,t)).then(a(t.success,t),a(t.fail,t))})})})});t.exports={addWidget:function(t){return c.add(t)}}},function(t,e,n){var r=n(18);t.exports=function(t){return r.write(function(){t&&t.parentNode&&t.parentNode.removeChild(t)})}},function(t,e,n){n(12),t.exports={log:function(t,e){}}},function(t,e,n){var r=n(1);function i(t){return(t=t||r).getSelection&&t.getSelection()}t.exports={getSelection:i,getSelectedText:function(t){var e=i(t);return e?e.toString():\"\"}}},function(t,e,n){var r=n(4),i=n(1),o=n(2),s=2e4;t.exports=function(t){var e=new o,n=r.createElement(\"img\");return n.onload=n.onerror=function(){i.setTimeout(e.resolve,50)},n.src=t,i.setTimeout(e.reject,s),e.promise}},function(t,e,n){var r=n(109);t.exports=function(t){t.define(\"createElement\",r),t.define(\"createFragment\",r),t.define(\"htmlToElement\",r),t.define(\"hasSelectedText\",r),t.define(\"addRootClass\",r),t.define(\"removeRootClass\",r),t.define(\"hasRootClass\",r),t.define(\"prependStyleSheet\",r),t.define(\"appendStyleSheet\",r),t.define(\"prependCss\",r),t.define(\"appendCss\",r),t.define(\"makeVisible\",r),t.define(\"injectWidgetEl\",r),t.define(\"matchHeightToContent\",r),t.define(\"matchWidthToContent\",r)}},function(t,e){t.exports=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments))}}},function(t,e,n){var r=n(15),i=n(119),o=n(60),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.DM_BUTTON,t,e,n)}},function(t,e,n){var r=n(61),i=n(25);t.exports=r.isSupported()?r:i},function(t,e,n){var r=n(26),i=n(120);t.exports=r.build([i])},function(t,e,n){var r=n(15),i=n(123),o=n(38),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.FOLLOW_BUTTON,t,e,n)}},function(t,e,n){var r=n(15),i=n(131),o=n(25),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.MOMENT,t,e,n)}},function(t,e,n){var r=n(15),i=n(133),o=n(25),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.PERISCOPE,t,e,n)}},function(t,e,n){var r=n(79),i=n(135),o=n(139),s=n(141),a=n(143),u=n(145),c={collection:i,event:o,likes:s,list:a,profile:u,url:f},d=[u,s,i,a,o];function f(t){return r(d,function(e){try{return new e(t)}catch(t){}})}t.exports=function(t){return t?function(t){var e,n;return e=(t.sourceType+\"\").toLowerCase(),(n=c[e])?new n(t):null}(t)||f(t):null}},function(t,e,n){var r=n(15),i=n(147),o=n(25),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.TIMELINE,t,e,n)}},function(t,e,n){var r=n(4),i=n(149),o=n(150),s=n(15),a=n(38),u=n(151),c=n(60),d=n(152),f=n(16);t.exports=function(t,e,n,l){var h,p=i.isHorizonTweetEnabled(l,t);return o(l,t.tweetId),p?(h=r.createElement(\"div\"),new s(u,a,f.TWEET,t,e,n,{sandboxWrapperEl:h})):new s(d,c,f.TWEET,t,e,n)}},function(t,e,n){var r=n(15),i=n(154),o=n(38),s=n(16);t.exports=function(t,e,n){var a=t&&t.type||\"share\",u=\"hashtag\"==a?s.HASHTAG_BUTTON:\"mention\"==a?s.MENTION_BUTTON:s.SHARE_BUTTON;return new r(i,o,u,t,e,n)}},function(t,e,n){var r=n(37),i=n(39),o=n(0);t.exports=function(t){var e={widget_origin:i.rootDocumentLocation(),widget_frame:i.isFramed()?i.currentDocumentLocation():null,duration_ms:t.duration,item_ids:t.widgetIds||[]},n=o.aug(t.namespace,{page:\"page\",component:\"performance\"});r.scribe(n,e)}},function(t,e,n){var r=n(0),i=n(136),o=[\"ar\",\"fa\",\"he\",\"ur\"];t.exports={isRtlLang:function(t){return t=String(t).toLowerCase(),r.contains(o,t)},matchLanguage:function(t){return t=(t=(t||\"\").toLowerCase()).replace(\"_\",\"-\"),i(t)?t:(t=t.replace(/-.*/,\"\"),i(t)?t:\"en\")}}},function(t){t.exports={TWEET:0,RETWEET:10,CUSTOM_TIMELINE:17,LIVE_VIDEO_EVENT:28,QUOTE_TWEET:23}},function(t){t.exports={tweetButtonHtmlPath:\"/widgets/tweet_button.96fd96193cc66c3e11d4c5e4c7c7ec97.{{lang}}.html\",followButtonHtmlPath:\"/widgets/follow_button.96fd96193cc66c3e11d4c5e4c7c7ec97.{{lang}}.html\",hubHtmlPath:\"/widgets/hub.html\",widgetIframeHtmlPath:\"/widgets/widget_iframe.96fd96193cc66c3e11d4c5e4c7c7ec97.html\",resourceBaseUrl:\"https://platform.twitter.com\"}},function(t,e,n){var r=n(3),i=n(96),o=n(24),s=n(11),a={favorite:[\"favorite\",\"like\"],follow:[\"follow\"],like:[\"favorite\",\"like\"],retweet:[\"retweet\"],tweet:[\"tweet\"]};function u(t){this.srcEl=[],this.element=t}u.open=function(t,e,n){var u=(r.intentType(t)||\"\").toLowerCase();r.isTwitterURL(t)&&(function(t,e){i.open(t,e)}(t,n),e&&o.trigger(\"click\",{target:e,region:\"intent\",type:\"click\",data:{}}),e&&a[u]&&a[u].forEach(function(n){o.trigger(n,{target:e,region:\"intent\",type:n,data:function(t,e){var n=s.decodeURL(e);switch(t){case\"favorite\":case\"like\":return{tweet_id:n.tweet_id};case\"follow\":return{screen_name:n.screen_name,user_id:n.user_id};case\"retweet\":return{source_tweet_id:n.tweet_id};default:return{}}}(u,t)})}))},t.exports=u},function(t,e){t.exports={getTimezoneOffset:function(){var t=(new Date).toString().match(/(GMT[+-]?\\d+)/);return t&&t[0]||\"GMT\"}}},function(t,e,n){var r=n(4),i=n(9),o=n(2),s=n(0),a=n(11),u=\"cb\",c=0;t.exports={fetch:function(t,e,n,d){var f,l,h;return d=function(t){if(t)return t.replace(/[^\\w$]/g,\"_\")}(d||u+c++),f=i.fullPath([\"callbacks\",d]),l=r.createElement(\"script\"),h=new o,e=s.aug({},e,{callback:f,suppress_response_codes:!0}),i.set([\"callbacks\",d],function(t){var e;t=(e=n(t||!1)).resp,e.success?h.resolve(t):h.reject(t),l.onload=l.onreadystatechange=null,l.parentNode&&l.parentNode.removeChild(l),i.unset([\"callbacks\",d])}),l.onerror=function(){h.reject(new Error(\"failed to fetch \"+l.src))},l.src=a.url(t,e),l.async=\"async\",r.body.appendChild(l),h.promise}}},function(t,e,n){var r=n(2),i=n(100),o=n(7);function s(t){this._inputsQueue=[],this._task=t,this._hasFlushBeenScheduled=!1}s.prototype.add=function(t){var e=new r;return this._inputsQueue.push({input:t,taskDoneDeferred:e}),this._hasFlushBeenScheduled||(this._hasFlushBeenScheduled=!0,i(o(this._flush,this))),e.promise},s.prototype._flush=function(){try{this._task.call(null,this._inputsQueue)}catch(t){this._inputsQueue.forEach(function(e){e.taskDoneDeferred.reject(t)})}this._inputsQueue=[],this._hasFlushBeenScheduled=!1},t.exports=s},function(t,e,n){var r=n(4),i=n(8),o=n(3);function s(t,e){var n,r;return e=e||i,/^https?:\\/\\//.test(t)?t:/^\\/\\//.test(t)?e.protocol+t:(n=e.host+(e.port.length?\":\"+e.port:\"\"),0!==t.indexOf(\"/\")&&((r=e.pathname.split(\"/\")).pop(),r.push(t),t=\"/\"+r.join(\"/\")),[e.protocol,\"//\",n,t].join(\"\"))}t.exports={absolutize:s,getCanonicalURL:function(){for(var t,e=r.getElementsByTagName(\"link\"),n=0;e[n];n++)if(\"canonical\"==(t=e[n]).rel)return s(t.href)},getScreenNameFromPage:function(){for(var t,e,n,i=[r.getElementsByTagName(\"a\"),r.getElementsByTagName(\"link\")],s=0,a=0,u=/\\bme\\b/;t=i[s];s++)for(a=0;e=t[a];a++)if(u.test(e.rel)&&(n=o.screenName(e.href)))return n}}},function(t,e,n){var r=n(0),i=n(43);t.exports=function(t,e){return i(t,e)?[t]:r.toRealArray(t.querySelectorAll(e))}},function(t,e){t.exports=function(t,e,n){for(var r,i=0;i<t.length;i++)if(r=e.call(n,t[i],i,t))return r}},function(t,e){t.exports=function(){return Math.floor(+new Date/9e5)}},function(t,e,n){var r=n(12);t.exports=function(t){var e,n;return e=t.headers&&t.headers.status,!(n=t&&!t.error&&200===e)&&t.headers&&t.headers.message&&r.publicError(t.headers.message),{success:n,resp:t}}},function(t,e,n){var r=n(37),i=n(30);t.exports=function(t,e,n,o){r.scribe(i.formatClientEventNamespace({client:\"tfw\",page:\"ddg\",section:t,action:\"experiment\"}),{experiment_key:t,bucket:e,version:n,data:o},!0)}},function(t,e,n){var r,i=n(29),o=0;function s(){r&&r.length===o&&(i.emitter.trigger(i.ALL_WIDGETS_AND_IMAGES_LOADED,r),r=null)}i.emitter.bind(i.ALL_WIDGETS_RENDER_END,function(t){r=t.widgets,s()}),t.exports={reportImagesLoadForAWidget:function(){o++,s()}}},,,,,,,,,function(t,e,n){var r,i=n(2),o=n(4),s=n(94),a=n(49),u=n(9),c=n(95),d=n(24),f=n(97),l=n(155),h=n(163),p=n(164),m=n(29),v=n(35);n(165),m.emitter.trigger(m.START),u.set(\"widgets.init\",!0),a.set(\"init\",!0),p(),r=new i,s.exposeReadyPromise(r.promise,a.base,\"_e\"),a.set(\"widgets\",l),a.set(\"widgets.load\",f.load),a.set(\"events\",d),h(function(){v.load(),r.resolve(a.base),c.attachTo(o),f.loadPage()})},function(t,e){t.exports=navigator},function(t,e,n){var r=n(7);t.exports={exposeReadyPromise:function(t,e,n){e.ready=r(t.then,t),n&&Array.isArray(e[n])&&(e[n].forEach(r(t.then,t)),delete e[n])}}},function(t,e,n){var r=n(8),i=n(36),o=n(33),s=n(73),a=n(3);function u(t){var e,n,u;t.altKey||t.metaKey||t.shiftKey||(e=o.closest(function(t){return\"A\"===t.tagName||\"AREA\"===t.tagName},t.target))&&a.isIntentURL(e.href)&&(n=(n=(n=[u=e.href,\"original_referer=\"+r.href].join(-1==u.indexOf(\"?\")?\"?\":\"&\")).replace(/^http[:]/,\"https:\")).replace(/^\\/\\//,\"https://\"),s.open(n,e),i.preventDefault(t))}t.exports={attachTo:function(t){t.addEventListener(\"click\",u,!1)}}},function(t,e,n){var r=n(1),i=n(36),o=n(33),s=n(21),a=n(3),u=n(23),c=\"intent_\";function d(t){this.win=t}d.prototype.open=function(t,e){var n=e&&\"click\"==e.type&&o.closest(\"a\",e.target),r=e&&(e.altKey||e.metaKey||e.shiftKey),d=n&&(s.ios()||s.android());if(a.isTwitterURL(t))return r||d?this:(this.name=c+u.generate(),this.popup=this.win.open(t,this.name),e&&i.preventDefault(e),this)},d.open=function(t,e){return new d(r).open(t,e)},t.exports=d},function(t,e,n){var r=n(4),i=n(6),o=n(22),s=n(52),a=n(34),u=n(9),c=n(37),d=n(24),f=n(5),l=n(0),h=n(35),p=n(116),m=n(29);function v(){var t=a.val(\"widgets:autoload\")||!0;return!f.isFalseValue(t)&&(f.isTruthValue(t)?r.body:r.querySelectorAll(t))}function g(t,e){var n,i;return t=(t=t||r.body).length?l.toRealArray(t):[t],c.pause(),i=function(t,e){return t.reduce(function(t,n){return t.concat(p.reduce(function(t,r){return t.concat(r(n,e))},[]))},[])}(t,e),m.emitter.trigger(m.ALL_WIDGETS_RENDER_START,{widgets:i}),n=o.allResolved(i.map(function(t){return s.addWidget(t)})).then(function(t){d.trigger(\"loaded\",{widgets:t}),t&&t.length&&m.emitter.trigger(m.ALL_WIDGETS_RENDER_END,{widgets:t})}),o.always(n,function(){c.resume()}),n}function w(t){return h.getExperiments().then(function(e){return g(t,e)})}t.exports={load:w,loadPage:function(){var t=v();return!1===t?i.resolve():(u.set(\"widgets.loaded\",!0),w(t))},_getPageLoadTarget:v}},function(t,e,n){var r=n(10),i=n(18),o=n(24),s=n(53),a=n(6),u=n(22);function c(t,e){this._widget=null,this._sandbox=null,this._hydrated=!1,this._insertedIntoDom=!1,this._Sandbox=t.Sandbox,this._factory=t.factory,this._widgetParams=t.parameters,this._resolve=e,this._className=t.className,this._renderedClassName=t.className+\"-rendered\",this._errorClassName=t.className+\"-error\",this._srcEl=t.srcEl,this._targetGlobal=function(t){return(t.srcEl||t.targetEl).ownerDocument.defaultView}(t),this._sandboxWrapperEl=t.options?t.options.sandboxWrapperEl:null,this._insertionStrategy=function(e){var n,r=t.srcEl,i=t.targetEl,o=t.className,s=t.className+\"-rendered\",a=t.options?t.options.sandboxWrapperEl:null;a?(a.appendChild(e),a.classList.add(o,s),n=a):n=e,r?i.insertBefore(n,r):i.appendChild(n)}}c.fromRawTask=function(t){return new c(t.input,t.taskDoneDeferred.resolve)},c.prototype.initialize=function(){var t=this,e=new this._Sandbox(this._targetGlobal);return this._factory(this._widgetParams,e).then(function(n){return t._widget=n,t._sandbox=e,n._sandboxWrapperEl=t._sandboxWrapperEl,n})},c.prototype.insertIntoDom=function(){var t=this,e=this._sandboxWrapperEl?\"\":[this._className,this._renderedClassName].join(\" \");return this._widget?this._sandbox.insert(this._widget.id,{class:e},null,this._insertionStrategy).then(function(){t._insertedIntoDom=!0}):a.reject(new Error(\"cannot insert widget into DOM before it is initialized\"))},c.prototype.hydrate=function(){var t=this;return this._widget?this._widget.hydrate().then(function(){t._hydrated=!0}):a.reject(new Error(\"cannot hydrate widget before it is initialized\"))},c.prototype.render=function(){var t=this;function e(e){var n=t._sandboxWrapperEl?t._sandboxWrapperEl:t._sandbox.sandboxEl;return s(n).then(function(){return a.reject(e)})}return this._hydrated?this._insertedIntoDom?t._widget.render(t._sandbox).then(function(){return t._sandbox.onResize(function(){return t._widget.resize().then(function(){var e=t._sandboxWrapperEl?t._sandboxWrapperEl:t._sandbox.sandboxEl;o.trigger(\"resize\",{target:e})})}),t._widget.show()}).then(function(){return s(t._srcEl).then(function(){return t._sandbox.sandboxEl})},e):e(new Error(\"cannot render widget before DOM insertion\")):e(new Error(\"cannot render widget before hydration\"))},c.prototype.fail=function(){var t=this,e=t._errorClassName,n=t._sandboxWrapperEl?t._sandboxWrapperEl:t._srcEl;return this._srcEl?u.always(i.write(function(){r.add(n,e)}),function(){o.trigger(\"rendered\",{target:n}),t._resolve(n)}):(t._resolve(),a.resolve())},c.prototype.success=function(){var t=this._sandboxWrapperEl?this._sandboxWrapperEl:this._sandbox.sandboxEl;o.trigger(\"rendered\",{target:t}),this._resolve(t)},t.exports=c},function(t,e,n){var r;!function(){\"use strict\";var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)};function o(){this.frames=[],this.lastId=0,this.raf=i,this.batch={hash:{},read:[],write:[],mode:null}}o.prototype.read=function(t,e){var n=this.add(\"read\",t,e),r=n.id;return this.batch.read.push(n.id),\"reading\"===this.batch.mode||this.batch.scheduled?r:(this.scheduleBatch(),r)},o.prototype.write=function(t,e){var n=this.add(\"write\",t,e),r=this.batch.mode,i=n.id;return this.batch.write.push(n.id),\"writing\"===r||\"reading\"===r||this.batch.scheduled?i:(this.scheduleBatch(),i)},o.prototype.defer=function(t,e,n){\"function\"==typeof t&&(n=e,e=t,t=1);var r=this,i=t-1;return this.schedule(i,function(){r.run({fn:e,ctx:n})})},o.prototype.clear=function(t){if(\"function\"==typeof t)return this.clearFrame(t);t=Number(t);var e=this.batch.hash[t];if(e){var n=this.batch[e.type],r=n.indexOf(t);delete this.batch.hash[t],~r&&n.splice(r,1)}},o.prototype.clearFrame=function(t){var e=this.frames.indexOf(t);~e&&this.frames.splice(e,1)},o.prototype.scheduleBatch=function(){var t=this;this.schedule(0,function(){t.batch.scheduled=!1,t.runBatch()}),this.batch.scheduled=!0},o.prototype.uniqueId=function(){return++this.lastId},o.prototype.flush=function(t){for(var e;e=t.shift();)this.run(this.batch.hash[e])},o.prototype.runBatch=function(){try{this.batch.mode=\"reading\",this.flush(this.batch.read),this.batch.mode=\"writing\",this.flush(this.batch.write),this.batch.mode=null}catch(t){throw this.runBatch(),t}},o.prototype.add=function(t,e,n){var r=this.uniqueId();return this.batch.hash[r]={id:r,fn:e,ctx:n,type:t}},o.prototype.run=function(t){var e=t.ctx||this,n=t.fn;if(delete this.batch.hash[t.id],!this.onError)return n.call(e);try{n.call(e)}catch(t){this.onError(t)}},o.prototype.loop=function(){var t,e=this,n=this.raf,r=!1;function i(){var t=e.frames.shift();e.frames.length?n(i):e.looping=!1,t&&t()}this.looping||(t=setTimeout(function(){r=!0,i()},500),n(function(){r||(clearTimeout(t),i())}),this.looping=!0)},o.prototype.schedule=function(t,e){return this.frames[t]?this.schedule(t+1,e):(this.loop(),this.frames[t]=e)};var s=new o;void 0!==t&&t.exports?t.exports=s:void 0===(r=function(){return s}.call(e,n,e,t))||(t.exports=r)}()},function(t,e,n){var r=n(48).Promise;t.exports=r._asap},function(t,e,n){var r,i,o,s=n(4),a=n(1),u=n(31),c=n(20),d=n(2),f=n(6),l=n(54),h=n(30),p=n(0),m=n(25),v=n(9).get(\"scribeCallback\"),g=Math.floor(1e3*Math.random())+\"_\",w=\"rufous-frame-\"+g+\"-\",y=\"rufous-form-\"+g+\"-\",b=0,_=!1,E=new d;function x(){var t=o.createElement(\"form\"),e=o.createElement(\"input\"),n=o.createElement(\"input\");return b++,t.action=h.CLIENT_EVENT_ENDPOINT,t.method=\"POST\",t.target=w+b,t.id=y+b,e.type=\"hidden\",e.name=\"dnt\",e.value=c.enabled(),n.type=\"hidden\",n.name=\"tfw_redirect\",n.value=h.RUFOUS_REDIRECT,t.appendChild(e),t.appendChild(n),t}function T(){var t=w+b;return u({id:t,name:t,width:0,height:0,border:0},{display:\"none\"},o.doc)}t.exports={clientEvent:function(t,e,n,i){(function(t,e){var n=!p.isObject(t),r=!!e&&!p.isObject(e),i=n||r;return i})(t,e)||(v&&v(arguments),E.promise.then(function(){!function(t,e){var n,i,s;p.isObject(t)&&p.isObject(e)&&(l.log(t,e),s=h.flattenClientEventPayload(t,e),(n=r.firstChild).value=+(+n.value||s.dnt||0),(i=o.createElement(\"input\")).type=\"hidden\",i.name=\"l\",i.value=h.stringify(s),r.appendChild(i))}(h.formatClientEventNamespace(t),h.formatClientEventData(e,n,i))}))},flush:function(){return E.promise.then(function(){var t;return r.children.length<=2?f.reject():(t=f.all([o.doc.body.appendChild(r),o.doc.body.appendChild(i)]).then(function(t){var e=t[0],n=t[1];return n.addEventListener(\"load\",function(){!function(t,e){return function(){var n=t.parentNode;n&&(n.removeChild(t),n.removeChild(e))}}(e,n)()}),e.submit(),t}),r=x(),i=T(),t)})},init:function(){return _?E.promise:((o=new m(a)).insert(\"rufous-sandbox\",null,{display:\"none\"},function(t){s.body.appendChild(t)}).then(function(){o.setTitle(\"Twitter analytics iframe\"),r=x(),i=T(),E.resolve([r,i])}),_=!0,E.promise)}}},function(t,e,n){var r=n(8),i=/^[^#?]*\\.(gov|mil)(:\\d+)?([#?].*)?$/i,o={};function s(t){return t in o?o[t]:o[t]=i.test(t)}t.exports={isUrlSensitive:s,isHostPageSensitive:function(){return s(r.host)}}},function(t,e,n){var r=n(0);t.exports=function t(e){var n=[];return e.forEach(function(e){var i=r.isType(\"array\",e)?t(e):[e];n=n.concat(i)}),n}},function(t,e){t.exports=function(t){return t.filter(function(e,n){return t.indexOf(e)===n})}},function(t,e,n){var r=n(41),i=n(0),o=n(107);function s(){r.apply(this,arguments)}s.prototype=Object.create(r.prototype),i.aug(s.prototype,{factory:o}),t.exports=s},function(t,e,n){var r=n(22),i=n(0),o=n(7);t.exports={before:function(t,e){return function(){var n,i=this,o=arguments;return n=e.apply(this,arguments),r.isPromise(n)?n.then(function(){return t.apply(i,o)}):t.apply(this,arguments)}},after:function(t,e){return function(){var n,i=this,o=arguments;function s(t,e){return r.isPromise(e)?e.then(function(){return t}):t}return n=t.apply(this,arguments),r.isPromise(n)?n.then(function(t){return s(t,e.apply(i,o))}):s(n,e.apply(this,arguments))}},around:function(t,e){return function(){var n=i.toRealArray(arguments);return n.unshift(o(t,this)),e.apply(this,n)}}}},function(t,e,n){var r=n(10),i=n(18),o=n(42),s=n(6),a=n(0);t.exports=function(){var t=o();function e(e){t.apply(this,arguments),Object.defineProperty(this,\"targetGlobal\",{value:e})}return e.prototype=Object.create(t.prototype),a.aug(e.prototype,{id:null,initialized:!1,width:0,height:0,sandboxEl:null,insert:function(){return s.reject()},onResize:function(){},addClass:function(t){var e=this.sandboxEl;return t=Array.isArray(t)?t:[t],i.write(function(){t.forEach(function(t){r.add(e,t)})})},removeClass:function(t){var e=this.sandboxEl;return t=Array.isArray(t)?t:[t],i.write(function(){t.forEach(function(t){r.remove(e,t)})})},styleSelf:function(t){var e=this;return i.write(function(){a.forIn(t,function(t,n){e.sandboxEl.style[t]=n})})}}),e}},function(t,e,n){var r=n(4),i=n(10),o=n(18),s=n(55),a=n(26),u=n(56),c=n(44),d=n(45),f=n(31),l=n(12),h=n(46),p=n(2),m=n(6),v=n(0),g=n(9),w=n(23),y=n(7),b={allowfullscreen:\"true\"},_={position:\"absolute\",visibility:\"hidden\",display:\"block\",width:\"0px\",height:\"0px\",padding:\"0\",border:\"none\"},E={position:\"static\",visibility:\"visible\"},x=\"SandboxRoot\",T=\".SandboxRoot { display: none; }\",S=50;function A(t,e,n,r){return e=v.aug({id:t},b,e),n=v.aug({},_,n),f(e,n,r)}function R(t,e,n,i,s){var a=new p,u=w.generate(),c=A(t,e,n,s);return g.set([\"sandbox\",u],function(){var t=c.contentWindow.document;o.write(function(){t.write(\"<!DOCTYPE html><html><head><\/head><body><\/body><\/html>\")}).then(function(){t.close(),a.resolve(c)})}),c.src=[\"javascript:\",'document.write(\"\");',\"try { window.parent.document; }\",'catch (e) { document.domain=\"'+r.domain+'\"; }',\"window.parent.\"+g.fullPath([\"sandbox\",u])+\"();\"].join(\"\"),c.addEventListener(\"error\",a.reject,!1),o.write(function(){i.parentNode.replaceChild(c,i)}),a.promise}t.exports=a.couple(n(57),function(t){t.overrideProperty(\"id\",{get:function(){return this.sandboxEl&&this.sandboxEl.id}}),t.overrideProperty(\"initialized\",{get:function(){return!!this.win}}),t.overrideProperty(\"width\",{get:function(){return this._width}}),t.overrideProperty(\"height\",{get:function(){return this._height}}),t.overrideProperty(\"sandboxEl\",{get:function(){return this.iframeEl}}),t.defineProperty(\"iframeEl\",{get:function(){return this._iframe}}),t.defineProperty(\"rootEl\",{get:function(){return this.doc&&this.doc.documentElement}}),t.defineProperty(\"widgetEl\",{get:function(){return this.doc&&this.doc.body.firstElementChild}}),t.defineProperty(\"win\",{get:function(){return this.iframeEl&&this.iframeEl.contentWindow}}),t.defineProperty(\"doc\",{get:function(){return this.win&&this.win.document}}),t.define(\"_updateCachedDimensions\",function(){var t=this;return o.read(function(){var e,n=h(t.sandboxEl);\"visible\"==t.sandboxEl.style.visibility?t._width=n.width:(e=h(t.sandboxEl.parentElement).width,t._width=Math.min(n.width,e)),t._height=n.height})}),t.define(\"_setTargetToBlank\",function(){var t=this.createElement(\"base\");t.target=\"_blank\",this.doc.head.appendChild(t)}),t.define(\"_didResize\",function(){var t=this,e=this._resizeHandlers.slice(0);return this._updateCachedDimensions().then(function(){e.forEach(function(e){e(t)})})}),t.define(\"setTitle\",function(t){this.iframeEl.title=t}),t.override(\"createElement\",function(t){return this.doc.createElement(t)}),t.override(\"createFragment\",function(){return this.doc.createDocumentFragment()}),t.override(\"htmlToElement\",function(t){var e;return(e=this.createElement(\"div\")).innerHTML=t,e.firstElementChild}),t.override(\"hasSelectedText\",function(){return!!s.getSelectedText(this.win)}),t.override(\"addRootClass\",function(t){var e=this.rootEl;return t=Array.isArray(t)?t:[t],this.initialized?o.write(function(){t.forEach(function(t){i.add(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"removeRootClass\",function(t){var e=this.rootEl;return t=Array.isArray(t)?t:[t],this.initialized?o.write(function(){t.forEach(function(t){i.remove(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"hasRootClass\",function(t){return i.present(this.rootEl,t)}),t.define(\"addStyleSheet\",function(t,e){var n,r=new p;return this.initialized?((n=this.createElement(\"link\")).type=\"text/css\",n.rel=\"stylesheet\",n.href=t,n.addEventListener(\"load\",r.resolve,!1),n.addEventListener(\"error\",r.reject,!1),o.write(y(e,null,n)).then(function(){return u(t).then(r.resolve,r.reject),r.promise})):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"prependStyleSheet\",function(t){var e=this.doc;return this.addStyleSheet(t,function(t){var n=e.head.firstElementChild;return n?e.head.insertBefore(t,n):e.head.appendChild(t)})}),t.override(\"appendStyleSheet\",function(t){var e=this.doc;return this.addStyleSheet(t,function(t){return e.head.appendChild(t)})}),t.define(\"addCss\",function(t,e){var n;return c.inlineStyle()?((n=this.createElement(\"style\")).type=\"text/css\",n.appendChild(this.doc.createTextNode(t)),o.write(y(e,null,n))):(l.devError(\"CSP enabled; cannot embed inline styles\"),m.resolve())}),t.override(\"prependCss\",function(t){var e=this.doc;return this.addCss(t,function(t){var n=e.head.firstElementChild;return n?e.head.insertBefore(t,n):e.head.appendChild(t)})}),t.override(\"appendCss\",function(t){var e=this.doc;return this.addCss(t,function(t){return e.head.appendChild(t)})}),t.override(\"makeVisible\",function(){var t=this;return this.styleSelf(E).then(function(){t._updateCachedDimensions()})}),t.override(\"injectWidgetEl\",function(t){var e=this;return this.initialized?this.widgetEl?m.reject(new Error(\"widget already injected\")):o.write(function(){e.doc.body.appendChild(t)}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"matchHeightToContent\",function(){var t,e=this;return o.read(function(){t=e.widgetEl?h(e.widgetEl).height:0}),o.write(function(){e.sandboxEl.style.height=t+\"px\"}).then(function(){return e._updateCachedDimensions()})}),t.override(\"matchWidthToContent\",function(){var t,e=this;return o.read(function(){t=e.widgetEl?h(e.widgetEl).width:0}),o.write(function(){e.sandboxEl.style.width=t+\"px\"}).then(function(){return e._updateCachedDimensions()})}),t.after(\"initialize\",function(){this._iframe=null,this._width=this._height=0,this._resizeHandlers=[]}),t.override(\"insert\",function(t,e,n,r){var i=this,s=new p,a=this.targetGlobal.document,u=A(t,e,n,a);return o.write(y(r,null,u)),u.addEventListener(\"load\",function(){(function(t){try{t.contentWindow.document}catch(t){return m.reject(t)}return m.resolve(t)})(u).then(null,y(R,null,t,e,n,u,a)).then(s.resolve,s.reject)},!1),u.addEventListener(\"error\",s.reject,!1),s.promise.then(function(t){var e=d(i._didResize,S,i);return i._iframe=t,i.win.addEventListener(\"resize\",e,!1),m.all([i._setTargetToBlank(),i.addRootClass(x),i.prependCss(T)])})}),t.override(\"onResize\",function(t){this._resizeHandlers.push(t)}),t.after(\"styleSelf\",function(){return this._updateCachedDimensions()})})},function(t,e){t.exports=function(){throw new Error(\"unimplemented method\")}},function(t,e,n){var r=n(20),i=n(54),o=n(11),s=n(30),a=n(0),u=n(9).get(\"scribeCallback\"),c=2083,d=[],f=o.url(s.CLIENT_EVENT_ENDPOINT,{dnt:0,l:\"\"}),l=encodeURIComponent(f).length;function h(t,e,n,r){var i=!a.isObject(t),o=!!e&&!a.isObject(e);i||o||(u&&u(arguments),p(s.formatClientEventNamespace(t),s.formatClientEventData(e,n,r),s.CLIENT_EVENT_ENDPOINT))}function p(t,e,n){var r,u;n&&a.isObject(t)&&a.isObject(e)&&(i.log(t,e),r=s.flattenClientEventPayload(t,e),u={l:s.stringify(r)},r.dnt&&(u.dnt=1),w(o.url(n,u)))}function m(t,e,n,r){var i=!a.isObject(t),o=!!e&&!a.isObject(e);if(!i&&!o)return v(s.flattenClientEventPayload(s.formatClientEventNamespace(t),s.formatClientEventData(e,n,r)))}function v(t){return d.push(t),d}function g(t){return encodeURIComponent(t).length+3}function w(t){return(new Image).src=t}t.exports={canFlushOneItem:function(t){var e=g(s.stringify(t));return l+e<c},_enqueueRawObject:v,scribe:p,clientEvent:h,clientEvent2:function(t,e,n){return h(t,e,n,2)},enqueueClientEvent:m,flushClientEvents:function(){var t;return d.length>1&&m({page:\"widgets_js\",component:\"scribe_pixel\",action:\"batch_log\"},{}),t=d,d=[],t.reduce(function(e,n,r){var i=e.length,o=i&&e[i-1];return r+1==t.length&&n.event_namespace&&\"batch_log\"==n.event_namespace.action&&(n.message=[\"entries:\"+r,\"requests:\"+i].join(\"/\")),function t(e){return Array.isArray(e)||(e=[e]),e.reduce(function(e,n){var r,i=s.stringify(n),o=g(i);return l+o<c?e=e.concat(i):(r=s.splitLogEntry(n)).length>1&&(e=e.concat(t(r))),e},[])}(n).forEach(function(t){var n=g(t);(!o||o.urlLength+n>c)&&(o={urlLength:l,items:[]},e.push(o)),o.urlLength+=n,o.items.push(t)}),e},[]).map(function(t){var e={l:t.items};return r.enabled()&&(e.dnt=1),w(o.url(s.CLIENT_EVENT_ENDPOINT,e))})},interaction:function(t,e,n,r){var i=s.extractTermsFromDOM(t.target||t.srcElement);i.action=r||\"click\",h(i,e,n)}}},function(t,e,n){var r=n(2),i=n(7),o=100,s=3e3;function a(t,e){this._inputsQueue=[],this._task=t,this._isPaused=!1,this._flushDelay=e&&e.flushDelay||o,this._pauseLength=e&&e.pauseLength||s,this._flushTimeout=void 0}a.prototype.add=function(t){var e=new r;return this._inputsQueue.push({input:t,taskDoneDeferred:e}),this._scheduleFlush(),e.promise},a.prototype._scheduleFlush=function(){this._isPaused||(clearTimeout(this._flushTimeout),this._flushTimeout=setTimeout(i(this._flush,this),this._flushDelay))},a.prototype._flush=function(){try{this._task.call(null,this._inputsQueue)}catch(t){this._inputsQueue.forEach(function(e){e.taskDoneDeferred.reject(t)})}this._inputsQueue=[],this._flushTimeout=void 0},a.prototype.pause=function(t){clearTimeout(this._flushTimeout),this._isPaused=!0,!t&&this._pauseLength&&setTimeout(i(this.resume,this),this._pauseLength)},a.prototype.resume=function(){this._isPaused=!1,this._scheduleFlush()},t.exports=a},function(t,e,n){var r,i=n(72),o=n(31),s=n(2),a=n(4),u=n(19),c=n(21),d=n(32),f=n(8),l=n(12),h=n(113),p=n(58),m=n(9),v=n(11),g=n(114),w=n(3),y=n(0),b=n(1),_=p(function(){return new s});function E(t){var e=t||{should_obtain_cookie_consent:!0,features:{}},n=e.features?e.features:e.experiments;return new g(e.should_obtain_cookie_consent,n)}t.exports={load:function(){var t,e,n,s;if(c.ie9()||c.ie10()||\"http:\"!==f.protocol&&\"https:\"!==f.protocol)return l.devError(\"Using default settings due to unsupported browser or protocol.\"),r=E(),void _().resolve();t={origin:f.origin},u.settings().indexOf(\"localhost\")>-1&&(t.localSettings=!0),e=v.url(i.resourceBaseUrl+i.widgetIframeHtmlPath,t),n=function(t){var n,i,o,s;if(i=w.isTwitterURL(t.origin),o=e.substr(0,t.origin.length)===t.origin,s=w.isTwimgURL(t.origin),o&&i||s)try{(n=\"string\"==typeof t.data?d.parse(t.data):t.data).namespace===h.settings&&(r=E(n.settings),_().resolve())}catch(t){l.devError(t)}},b.addEventListener(\"message\",n),s=o({src:e,title:\"Twitter settings iframe\"},{display:\"none\"}),a.body.appendChild(s)},settingsLoaded:function(){var t,e,n;return t=new s,e=m.get(\"experimentOverride\"),_().promise.then(function(){e&&e.name&&e.assignment&&((n={})[e.name]={bucket:e.assignment},r.features=y.aug(r.features,n)),t.resolve(r)}).catch(function(e){t.reject(e)}),t.promise}}},function(t,e){t.exports={settings:\"twttr.settings\"}},function(t,e){t.exports=function(t,e){this.shouldObtainCookieConsent=t,this.features=e||{}}},function(t,e){t.exports=function(t){return t.split(\"\").map(function(t){return t.charCodeAt(0).toString(16)}).join(\"\")}},function(t,e,n){t.exports=[n(117),n(122),n(130),n(132),n(134),n(148),n(153)]},function(t,e,n){var r=n(11),i=n(5),o=n(0),s=n(13),a=n(14)(),u=n(59),c=\"a.twitter-dm-button\";t.exports=function(t){return a(t,c).map(function(t){return u(function(t){var e=t.getAttribute(\"data-show-screen-name\"),n=s(t),a=t.getAttribute(\"href\"),u=t.getAttribute(\"data-screen-name\"),c=e?i.asBoolean(e):null,d=t.getAttribute(\"data-size\"),f=r.decodeURL(a),l=f.recipient_id,h=t.getAttribute(\"data-text\")||f.text,p=t.getAttribute(\"data-welcome-message-id\")||f.welcomeMessageId;return o.aug(n,{screenName:u,showScreenName:c,size:d,text:h,userId:l,welcomeMessageId:p})}(t),t.parentNode,t)})}},function(t,e,n){var r=n(0);t.exports=function t(e){var n;if(e)return n=e.lang||e.getAttribute(\"data-lang\"),r.isType(\"string\",n)?n:t(e.parentElement)}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(2).then(function(r){var o;try{o=n(84),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(121),i=n(1),o=n(10),s=n(36),a=n(18),u=n(55),c=n(26),d=n(56),f=n(44),l=n(46),h=n(7),p=n(45),m=n(6),v=n(0),g=50,w={position:\"absolute\",visibility:\"hidden\",display:\"block\",transform:\"rotate(0deg)\"},y={position:\"static\",visibility:\"visible\"},b=\"twitter-widget\",_=\"open\",E=\"SandboxRoot\",x=\".SandboxRoot { display: none; max-height: 10000px; }\";t.exports=c.couple(n(57),function(t){t.defineStatic(\"isSupported\",function(){return!!i.HTMLElement.prototype.attachShadow&&f.inlineStyle()}),t.overrideProperty(\"id\",{get:function(){return this.sandboxEl&&this.sandboxEl.id}}),t.overrideProperty(\"initialized\",{get:function(){return!!this._shadowHost}}),t.overrideProperty(\"width\",{get:function(){return this._width}}),t.overrideProperty(\"height\",{get:function(){return this._height}}),t.overrideProperty(\"sandboxEl\",{get:function(){return this._shadowHost}}),t.define(\"_updateCachedDimensions\",function(){var t=this;return a.read(function(){var e,n=l(t.sandboxEl);\"visible\"==t.sandboxEl.style.visibility?t._width=n.width:(e=l(t.sandboxEl.parentElement).width,t._width=Math.min(n.width,e)),t._height=n.height})}),t.define(\"_didResize\",function(){var t=this,e=this._resizeHandlers.slice(0);return this._updateCachedDimensions().then(function(){e.forEach(function(e){e(t)})})}),t.override(\"createElement\",function(t){return this.targetGlobal.document.createElement(t)}),t.override(\"createFragment\",function(){return this.targetGlobal.document.createDocumentFragment()}),t.override(\"htmlToElement\",function(t){var e;return(e=this.createElement(\"div\")).innerHTML=t,e.firstElementChild}),t.override(\"hasSelectedText\",function(){return!!u.getSelectedText(this.targetGlobal)}),t.override(\"addRootClass\",function(t){var e=this._shadowRootBody;return t=Array.isArray(t)?t:[t],this.initialized?a.write(function(){t.forEach(function(t){o.add(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"removeRootClass\",function(t){var e=this._shadowRootBody;return t=Array.isArray(t)?t:[t],this.initialized?a.write(function(){t.forEach(function(t){o.remove(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"hasRootClass\",function(t){return o.present(this._shadowRootBody,t)}),t.override(\"addStyleSheet\",function(t,e){return this.addCss('@import url(\"'+t+'\");',e).then(function(){return d(t)})}),t.override(\"prependStyleSheet\",function(t){var e=this._shadowRoot;return this.addStyleSheet(t,function(t){var n=e.firstElementChild;return n?e.insertBefore(t,n):e.appendChild(t)})}),t.override(\"appendStyleSheet\",function(t){var e=this._shadowRoot;return this.addStyleSheet(t,function(t){return e.appendChild(t)})}),t.override(\"addCss\",function(t,e){var n;return this.initialized?f.inlineStyle()?((n=this.createElement(\"style\")).type=\"text/css\",n.appendChild(this.targetGlobal.document.createTextNode(t)),a.write(h(e,null,n))):m.resolve():m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"prependCss\",function(t){var e=this._shadowRoot;return this.addCss(t,function(t){var n=e.firstElementChild;return n?e.insertBefore(t,n):e.appendChild(t)})}),t.override(\"appendCss\",function(t){var e=this._shadowRoot;return this.addCss(t,function(t){return e.appendChild(t)})}),t.override(\"makeVisible\",function(){return this.styleSelf(y)}),t.override(\"injectWidgetEl\",function(t){var e=this;return this.initialized?this._shadowRootBody.firstElementChild?m.reject(new Error(\"widget already injected\")):a.write(function(){e._shadowRootBody.appendChild(t)}).then(function(){return e._updateCachedDimensions()}).then(function(){var t=p(e._didResize,g,e);new r(e._shadowRootBody,t)}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"matchHeightToContent\",function(){return m.resolve()}),t.override(\"matchWidthToContent\",function(){return m.resolve()}),t.override(\"insert\",function(t,e,n,r){var i=this.targetGlobal.document,o=this._shadowHost=i.createElement(b),u=this._shadowRoot=o.attachShadow({mode:_}),c=this._shadowRootBody=i.createElement(\"div\");return v.forIn(e||{},function(t,e){o.setAttribute(t,e)}),o.id=t,u.appendChild(c),s.delegate(c,\"click\",\"A\",function(t,e){e.hasAttribute(\"target\")||e.setAttribute(\"target\",\"_blank\")}),m.all([this.styleSelf(w),this.addRootClass(E),this.prependCss(x),a.write(r.bind(null,o))])}),t.override(\"onResize\",function(t){this._resizeHandlers.push(t)}),t.after(\"initialize\",function(){this._shadowHost=this._shadowRoot=this._shadowRootBody=null,this._width=this._height=0,this._resizeHandlers=[]}),t.after(\"styleSelf\",function(){return this._updateCachedDimensions()})})},function(t,e){var n;(n=function(t,e){function r(t,e){if(t.resizedAttached){if(t.resizedAttached)return void t.resizedAttached.add(e)}else t.resizedAttached=new function(){var t,e;this.q=[],this.add=function(t){this.q.push(t)},this.call=function(){for(t=0,e=this.q.length;t<e;t++)this.q[t].call()}},t.resizedAttached.add(e);t.resizeSensor=document.createElement(\"div\"),t.resizeSensor.className=\"resize-sensor\";var n=\"position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;\",r=\"position: absolute; left: 0; top: 0; transition: 0s;\";t.resizeSensor.style.cssText=n,t.resizeSensor.innerHTML='<div class=\"resize-sensor-expand\" style=\"'+n+'\"><div style=\"'+r+'\"><\/div><\/div><div class=\"resize-sensor-shrink\" style=\"'+n+'\"><div style=\"'+r+' width: 200%; height: 200%\"><\/div><\/div>',t.appendChild(t.resizeSensor),{fixed:1,absolute:1}[function(t,e){return t.currentStyle?t.currentStyle[e]:window.getComputedStyle?window.getComputedStyle(t,null).getPropertyValue(e):t.style[e]}(t,\"position\")]||(t.style.position=\"relative\");var i,o,s=t.resizeSensor.childNodes[0],a=s.childNodes[0],u=t.resizeSensor.childNodes[1],c=(u.childNodes[0],function(){a.style.width=s.offsetWidth+10+\"px\",a.style.height=s.offsetHeight+10+\"px\",s.scrollLeft=s.scrollWidth,s.scrollTop=s.scrollHeight,u.scrollLeft=u.scrollWidth,u.scrollTop=u.scrollHeight,i=t.offsetWidth,o=t.offsetHeight});c();var d=function(t,e,n){t.attachEvent?t.attachEvent(\"on\"+e,n):t.addEventListener(e,n)},f=function(){t.offsetWidth==i&&t.offsetHeight==o||t.resizedAttached&&t.resizedAttached.call(),c()};d(s,\"scroll\",f),d(u,\"scroll\",f)}var i=Object.prototype.toString.call(t),o=\"[object Array]\"===i||\"[object NodeList]\"===i||\"[object HTMLCollection]\"===i||\"undefined\"!=typeof jQuery&&t instanceof jQuery||\"undefined\"!=typeof Elements&&t instanceof Elements;if(o)for(var s=0,a=t.length;s<a;s++)r(t[s],e);else r(t,e);this.detach=function(){if(o)for(var e=0,r=t.length;e<r;e++)n.detach(t[e]);else n.detach(t)}}).detach=function(t){t.resizeSensor&&(t.removeChild(t.resizeSensor),delete t.resizeSensor,delete t.resizedAttached)},void 0!==t&&void 0!==t.exports?t.exports=n:window.ResizeSensor=n},function(t,e,n){var r=n(3),i=n(0),o=n(13),s=n(14)(),a=n(62),u=n(5),c=\"a.twitter-follow-button\";t.exports=function(t){return s(t,c).map(function(t){return a(function(t){var e=o(t),n={screenName:r.screenName(t.href),showScreenName:\"false\"!==t.getAttribute(\"data-show-screen-name\"),showCount:\"false\"!==t.getAttribute(\"data-show-count\"),size:t.getAttribute(\"data-size\"),count:t.getAttribute(\"data-count\"),preview:t.getAttribute(\"data-preview\")};return i.forIn(n,function(t,n){var r=e[t];e[t]=u.hasValue(r)?r:n}),e.screenName=e.screenName||e.screen_name,e}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(3).then(function(r){var o;try{o=n(85),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(18),i=n(125),o=n(58),s=n(31),a=n(2),u=n(6),c=n(7),d=n(0),f={allowfullscreen:\"true\"},l={position:\"absolute\",visibility:\"hidden\",width:\"0px\",height:\"0px\"},h={position:\"static\",visibility:\"visible\"},p={};i(function(t,e,n){var r=p[t];if(r)return e=e||1,n=n||1,r.styleSelf({width:e+\"px\",height:n+\"px\"}).then(function(){r.didResize()})},function(t){var e=p[t];if(e)return e._results.resolve()},function(t){var e=p[t];if(e)return e._rendered.resolve()},function(t,e){var n=p[t];n&&e&&n.setIframeVersion(e)},function(t){var e=p[t];if(e)return e._results.reject()}),t.exports=function(t){t.overrideProperty(\"id\",{get:function(){return this.sandboxEl&&this.sandboxEl.id}}),t.overrideProperty(\"initialized\",{get:function(){return!!this.iframeEl}}),t.overrideProperty(\"width\",{get:function(){return this._width}}),t.overrideProperty(\"height\",{get:function(){return this._height}}),t.overrideProperty(\"sandboxEl\",{get:function(){return this.iframeEl}}),t.defineProperty(\"iframeEl\",{get:function(){return this._iframe}}),t.defineProperty(\"iframeVersion\",{get:function(){return this._iframeVersion}}),t.define(\"updateCachedDimensions\",function(){var t=this;return this.initialized?r.read(function(){t._width=t.sandboxEl.offsetWidth,t._height=t.sandboxEl.offsetHeight}):u.resolve()}),t.define(\"setTitle\",function(t){this.iframeEl.title=t}),t.define(\"setWaitToSwapUntilRendered\",function(t){this._waitToSwapUntilRendered=t}),t.define(\"setIframeVersion\",function(t){this._iframeVersion=t}),t.define(\"getResultsPromise\",function(){return this._results.promise}),t.define(\"getRenderedPromise\",function(){return this._rendered.promise}),t.define(\"makeVisible\",function(){return this.styleSelf(h)}),t.define(\"didResize\",function(){var t=this,e=t._resizeHandlers.length>0;return this.updateCachedDimensions().then(function(){e&&t._resizeHandlers.forEach(function(e){e(t)})})}),t.define(\"loadDocument\",function(t){var e=new a;return this.initialized?this.iframeEl.src?u.reject(new Error(\"widget already loaded\")):(this.iframeEl.addEventListener(\"load\",e.resolve,!1),this.iframeEl.addEventListener(\"error\",e.reject,!1),this.iframeEl.src=t,e.promise):u.reject(new Error(\"sandbox not initialized\"))}),t.after(\"initialize\",function(){var t=new a,e=new a;this._iframe=null,this._iframeVersion=null,this._width=this._height=0,this._resizeHandlers=[],this._rendered=t,this._results=e,this._waitToSwapUntilRendered=!1}),t.override(\"insert\",function(t,e,n,i){var a=this;return e=d.aug({id:t},f,e),n=d.aug({},l,n),this._iframe=s(e,n),p[t]=this,a._waitToSwapUntilRendered||this.onResize(o(function(){a.makeVisible()})),r.write(c(i,null,this._iframe))}),t.override(\"onResize\",function(t){this._resizeHandlers.push(t)}),t.after(\"styleSelf\",function(){return this.updateCachedDimensions()})}},function(t,e,n){var r=n(1),i=n(126),o=n(128),s=n(24),a=n(5),u=n(129);t.exports=function(t,e,n,c,d){function f(t){var e=u(this);s.trigger(t.type,{target:e,region:t.region,type:t.type,data:t.data||{}})}function l(e){var n=u(this),r=n&&n.id,i=a.asInt(e.width),o=a.asInt(e.height);r&&void 0!==i&&void 0!==o&&t(r,i,o)}(new i).attachReceiver(new o.Receiver(r,\"twttr.button\")).bind(\"twttr.private.trigger\",f).bind(\"twttr.private.resizeButton\",l),(new i).attachReceiver(new o.Receiver(r,\"twttr.embed\")).bind(\"twttr.private.initialized\",function(t){var e=u(this),n=e&&e.id,r=t.iframe_version;n&&r&&c&&c(n,r)}).bind(\"twttr.private.trigger\",f).bind(\"twttr.private.results\",function(){var t=u(this),n=t&&t.id;n&&e&&e(n)}).bind(\"twttr.private.rendered\",function(){var t=u(this),e=t&&t.id;e&&n&&n(e)}).bind(\"twttr.private.no_results\",function(){var t=u(this),e=t&&t.id;e&&d&&d(e)}).bind(\"twttr.private.resize\",l)}},function(t,e,n){var r=n(32),i=n(127),o=n(0),s=n(6),a=n(22),u=\"2.0\";function c(t){this.registry=t||{}}function d(t){var e,n;return e=o.isType(\"string\",t),n=o.isType(\"number\",t),e||n||null===t}function f(t,e){return{jsonrpc:u,id:d(t)?t:null,error:e}}c.prototype._invoke=function(t,e){var n,r,i;n=this.registry[t.method],r=t.params||[],r=o.isType(\"array\",r)?r:[r];try{i=n.apply(e.source||null,r)}catch(t){i=s.reject(t.message)}return a.isPromise(i)?i:s.resolve(i)},c.prototype._processRequest=function(t,e){var n,r;return function(t){var e,n,r;return!!o.isObject(t)&&(e=t.jsonrpc===u,n=o.isType(\"string\",t.method),r=!(\"id\"in t)||d(t.id),e&&n&&r)}(t)?(n=\"params\"in t&&(r=t.params,!o.isObject(r)||o.isType(\"function\",r))?s.resolve(f(t.id,i.INVALID_PARAMS)):this.registry[t.method]?this._invoke(t,{source:e}).then(function(e){return n=t.id,{jsonrpc:u,id:n,result:e};var n},function(){return f(t.id,i.INTERNAL_ERROR)}):s.resolve(f(t.id,i.METHOD_NOT_FOUND)),null!=t.id?n:s.resolve()):s.resolve(f(t.id,i.INVALID_REQUEST))},c.prototype.attachReceiver=function(t){return t.attachTo(this),this},c.prototype.bind=function(t,e){return this.registry[t]=e,this},c.prototype.receive=function(t,e){var n,a,u,c=this;try{u=t,t=o.isType(\"string\",u)?r.parse(u):u}catch(t){return s.resolve(f(null,i.PARSE_ERROR))}return e=e||null,a=((n=o.isType(\"array\",t))?t:[t]).map(function(t){return c._processRequest(t,e)}),n?function(t){return s.all(t).then(function(t){return(t=t.filter(function(t){return void 0!==t})).length?t:void 0})}(a):a[0]},t.exports=c},function(t){t.exports={PARSE_ERROR:{code:-32700,message:\"Parse error\"},INVALID_REQUEST:{code:-32600,message:\"Invalid Request\"},INVALID_PARAMS:{code:-32602,message:\"Invalid params\"},METHOD_NOT_FOUND:{code:-32601,message:\"Method not found\"},INTERNAL_ERROR:{code:-32603,message:\"Internal error\"}}},function(t,e,n){var r=n(8),i=n(1),o=n(32),s=n(2),a=n(21),u=n(0),c=n(3),d=n(7),f=a.ie9();function l(t,e,n){var r;t&&t.postMessage&&(f?r=(n||\"\")+o.stringify(e):n?(r={})[n]=e:r=e,t.postMessage(r,\"*\"))}function h(t){return u.isType(\"string\",t)?t:\"JSONRPC\"}function p(t,e){return e?u.isType(\"string\",t)&&0===t.indexOf(e)?t.substring(e.length):t&&t[e]?t[e]:void 0:t}function m(t,e){var n=t.document;this.filter=h(e),this.server=null,this.isTwitterFrame=c.isTwitterURL(n.location.href),t.addEventListener(\"message\",d(this._onMessage,this),!1)}function v(t,e){this.pending={},this.target=t,this.isTwitterHost=c.isTwitterURL(r.href),this.filter=h(e),i.addEventListener(\"message\",d(this._onMessage,this),!1)}u.aug(m.prototype,{_onMessage:function(t){var e,n=this;this.server&&(this.isTwitterFrame&&!c.isTwitterURL(t.origin)||(e=p(t.data,this.filter))&&this.server.receive(e,t.source).then(function(e){e&&l(t.source,e,n.filter)}))},attachTo:function(t){this.server=t},detach:function(){this.server=null}}),u.aug(v.prototype,{_processResponse:function(t){var e=this.pending[t.id];e&&(e.resolve(t),delete this.pending[t.id])},_onMessage:function(t){var e;if((!this.isTwitterHost||c.isTwitterURL(t.origin))&&(e=p(t.data,this.filter))){if(u.isType(\"string\",e))try{e=o.parse(e)}catch(t){return}(e=u.isType(\"array\",e)?e:[e]).forEach(d(this._processResponse,this))}},send:function(t){var e=new s;return t.id?this.pending[t.id]=e:e.resolve(),l(this.target,t,this.filter),e.promise}}),t.exports={Receiver:m,Dispatcher:v,_stringifyPayload:function(t){return arguments.length>0&&(f=!!t),f}}},function(t,e,n){var r=n(4);t.exports=function(t){for(var e,n=r.getElementsByTagName(\"iframe\"),i=0;n[i];i++)if((e=n[i]).contentWindow===t)return e}},function(t,e,n){var r=n(5),i=n(0),o=n(3),s=n(13),a=n(14)(),u=n(63),c=\"a.twitter-moment\";t.exports=function(t){return a(t,c).map(function(t){return u(function(t){var e=s(t),n={momentId:o.momentId(t.href),chrome:t.getAttribute(\"data-chrome\"),limit:t.getAttribute(\"data-limit\")};return i.forIn(n,function(t,n){var i=e[t];e[t]=r.hasValue(i)?i:n}),e}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return Promise.all([n.e(0),n.e(4)]).then(function(r){var o;try{o=n(86),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(0),i=n(13),o=n(14)(),s=n(64),a=\"a.periscope-on-air\",u=/^https?:\\/\\/(?:www\\.)?(?:periscope|pscp)\\.tv\\/@?([a-zA-Z0-9_]+)\\/?$/i;t.exports=function(t){return o(t,a).map(function(t){return s(function(t){var e=i(t),n=t.getAttribute(\"href\"),o=t.getAttribute(\"data-size\"),s=u.exec(n)[1];return r.aug(e,{username:s,size:o})}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(5).then(function(r){var o;try{o=n(87),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(5),i=n(0),o=n(65),s=n(13),a=n(14)(),u=n(66),c=n(3),d=n(12),f=\"a.twitter-timeline,div.twitter-timeline,a.twitter-grid\",l=\"Embedded Search timelines have been deprecated. See https://twittercommunity.com/t/deprecating-widget-settings/102295.\",h=\"You may have been affected by an update to settings in embedded timelines. See https://twittercommunity.com/t/deprecating-widget-settings/102295.\",p=\"Embedded grids have been deprecated and will now render as timelines. Please update your embed code to use the twitter-timeline class. More info: https://twittercommunity.com/t/update-on-the-embedded-grid-display-type/119564.\";t.exports=function(t){return a(t,f).map(function(t){return u(function(t){var e=s(t),n=t.getAttribute(\"data-show-replies\"),a={isPreconfigured:!!t.getAttribute(\"data-widget-id\"),chrome:t.getAttribute(\"data-chrome\"),tweetLimit:t.getAttribute(\"data-tweet-limit\")||t.getAttribute(\"data-limit\"),ariaLive:t.getAttribute(\"data-aria-polite\"),theme:t.getAttribute(\"data-theme\"),borderColor:t.getAttribute(\"data-border-color\"),showReplies:n?r.asBoolean(n):null,profileScreenName:t.getAttribute(\"data-screen-name\"),profileUserId:t.getAttribute(\"data-user-id\"),favoritesScreenName:t.getAttribute(\"data-favorites-screen-name\"),favoritesUserId:t.getAttribute(\"data-favorites-user-id\"),likesScreenName:t.getAttribute(\"data-likes-screen-name\"),likesUserId:t.getAttribute(\"data-likes-user-id\"),listOwnerScreenName:t.getAttribute(\"data-list-owner-screen-name\"),listOwnerUserId:t.getAttribute(\"data-list-owner-id\"),listId:t.getAttribute(\"data-list-id\"),listSlug:t.getAttribute(\"data-list-slug\"),customTimelineId:t.getAttribute(\"data-custom-timeline-id\"),staticContent:t.getAttribute(\"data-static-content\"),url:t.href};return a.isPreconfigured&&(c.isSearchUrl(a.url)?d.publicError(l,t):d.publicLog(h,t)),\"twitter-grid\"===t.className&&d.publicLog(p,t),(a=i.aug(a,e)).dataSource=o(a),a.id=a.dataSource&&a.dataSource.id,a}(t),t.parentNode,t)})}},function(t,e,n){var r=n(27);t.exports=r.build([n(28),n(138)])},function(t,e,n){var r=n(0),i=n(137);t.exports=function(t){return\"en\"===t||r.contains(i,t)}},function(t,e){t.exports=[\"hi\",\"zh-cn\",\"fr\",\"zh-tw\",\"msa\",\"fil\",\"fi\",\"sv\",\"pl\",\"ja\",\"ko\",\"de\",\"it\",\"pt\",\"es\",\"ru\",\"id\",\"tr\",\"da\",\"no\",\"nl\",\"hu\",\"fa\",\"ar\",\"ur\",\"he\",\"th\",\"cs\",\"uk\",\"vi\",\"ro\",\"bn\",\"el\",\"en-gb\",\"gu\",\"kn\",\"mr\",\"ta\",\"bg\",\"ca\",\"hr\",\"sr\",\"sk\"]},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"collection:\";function a(t,e){return r.collectionId(t)||e}t.exports=function(t){t.params({id:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=a(this.params.url,this.params.id);return s+t}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"collection\"])}}),t.around(\"queryParams\",function(t){return i.aug(t(),{collection_id:a(this.params.url,this.params.id)})}),t.before(\"initialize\",function(){if(!a(this.params.url,this.params.id))throw new Error(\"one of url or id is required\")})}},function(t,e,n){var r=n(27);t.exports=r.build([n(28),n(140)])},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"event:\";function a(t,e){return r.eventId(t)||e}t.exports=function(t){t.params({id:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=a(this.params.url,this.params.id);return s+t}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"event\"])}}),t.around(\"queryParams\",function(t){return i.aug(t(),{event_id:a(this.params.url,this.params.id)})}),t.before(\"initialize\",function(){if(!a(this.params.url,this.params.id))throw new Error(\"one of url or id is required\")})}},function(t,e,n){var r=n(27);t.exports=r.build([n(28),n(142)])},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"likes:\";function a(t){return r.likesScreenName(t.url)||t.screenName}t.exports=function(t){t.params({screenName:{},userId:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=a(this.params)||this.params.userId;return s+t}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"likes\"])}}),t.define(\"_getLikesQueryParam\",function(){var t=a(this.params);return t?{screen_name:t}:{user_id:this.params.userId}}),t.around(\"queryParams\",function(t){return i.aug(t(),this._getLikesQueryParam())}),t.before(\"initialize\",function(){if(!a(this.params)&&!this.params.userId)throw new Error(\"screen name or user id is required\")})}},function(t,e,n){var r=n(27);t.exports=r.build([n(28),n(144)])},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"list:\";function a(t){var e=r.listScreenNameAndSlug(t.url)||t;return i.compact({screen_name:e.ownerScreenName,user_id:e.ownerUserId,list_slug:e.slug})}t.exports=function(t){t.params({id:{},ownerScreenName:{},ownerUserId:{},slug:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t,e,n;return this.params.id?s+this.params.id:(e=(t=a(this.params))&&t.list_slug.replace(/-/g,\"_\"),n=t&&(t.screen_name||t.user_id),s+(n+\":\")+e)}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"list\"])}}),t.define(\"_getListQueryParam\",function(){return this.params.id?{list_id:this.params.id}:a(this.params)}),t.around(\"queryParams\",function(t){return i.aug(t(),this._getListQueryParam())}),t.before(\"initialize\",function(){var t=a(this.params);if(i.isEmptyObject(t)&&!this.params.id)throw new Error(\"qualified slug or list id required\")})}},function(t,e,n){var r=n(27);t.exports=r.build([n(28),n(146)])},function(t,e,n){var r=n(3),i=n(5),o=n(0),s=n(19),a=\"profile:\";function u(t,e){return r.screenName(t)||e}t.exports=function(t){t.params({showReplies:{fallback:!1,transform:i.asBoolean},screenName:{},userId:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=u(this.params.url,this.params.screenName);return a+(t||this.params.userId)}}),t.overrideProperty(\"endpoint\",{get:function(){return s.timeline([\"profile\"])}}),t.define(\"_getProfileQueryParam\",function(){var t=u(this.params.url,this.params.screenName),e=t?{screen_name:t}:{user_id:this.params.userId};return o.aug(e,{with_replies:this.params.showReplies?\"true\":\"false\"})}),t.around(\"queryParams\",function(t){return o.aug(t(),this._getProfileQueryParam())}),t.before(\"initialize\",function(){if(!u(this.params.url,this.params.screenName)&&!this.params.userId)throw new Error(\"screen name or user id is required\")})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return Promise.all([n.e(0),n.e(6)]).then(function(r){var o;try{o=n(88),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(10),i=n(3),o=n(0),s=n(13),a=n(14)(),u=n(67),c=\"blockquote.twitter-tweet, blockquote.twitter-video\",d=/\\btw-align-(left|right|center)\\b/;t.exports=function(t,e){return a(t,c).map(function(t){return u(function(t){var e=s(t),n=t.getElementsByTagName(\"A\"),a=n&&n[n.length-1],u=a&&i.status(a.href),c=t.getAttribute(\"data-conversation\"),f=\"none\"==c||\"hidden\"==c||r.present(t,\"tw-hide-thread\"),l=t.getAttribute(\"data-cards\"),h=\"none\"==l||\"hidden\"==l||r.present(t,\"tw-hide-media\"),p=t.getAttribute(\"data-align\")||t.getAttribute(\"align\"),m=t.getAttribute(\"data-theme\");return!p&&d.test(t.className)&&(p=RegExp.$1),o.aug(e,{tweetId:u,hideThread:f,hideCard:h,align:p,theme:m,id:u})}(t),t.parentNode,t,e)})}},function(t,e){var n=\"tfw_horizon_tweet_embed_9555\";t.exports={isHorizonTweetEnabled:function(t){return!(t&&t[n]&&\"control\"===t[n].bucket)}}},function(t,e,n){var r=n(82),i=n(30),o=\"tfw_horizon_tweet_embed_9555\";t.exports=function(t,e){var n;t&&(n=t[o])&&n.bucket&&r(o,n.bucket,n.version,i.formatHorizonTweetData(e))}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(7).then(function(r){var o;try{o=n(89),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return Promise.all([n.e(0),n.e(8)]).then(function(r){var o;try{o=n(90),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(10),i=n(0),o=n(13),s=n(14)(),a=n(68),u=n(5),c=\"a.twitter-share-button, a.twitter-mention-button, a.twitter-hashtag-button\",d=\"twitter-hashtag-button\",f=\"twitter-mention-button\";t.exports=function(t){return s(t,c).map(function(t){return a(function(t){var e=o(t),n={screenName:t.getAttribute(\"data-button-screen-name\"),text:t.getAttribute(\"data-text\"),type:t.getAttribute(\"data-type\"),size:t.getAttribute(\"data-size\"),url:t.getAttribute(\"data-url\"),hashtags:t.getAttribute(\"data-hashtags\"),via:t.getAttribute(\"data-via\"),buttonHashtag:t.getAttribute(\"data-button-hashtag\")};return i.forIn(n,function(t,n){var r=e[t];e[t]=u.hasValue(r)?r:n}),e.screenName=e.screenName||e.screen_name,e.buttonHashtag=e.buttonHashtag||e.button_hashtag||e.hashtag,r.present(t,d)&&(e.type=\"hashtag\"),r.present(t,f)&&(e.type=\"mention\"),e}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(3).then(function(r){var o;try{o=n(91),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(0);t.exports=r.aug({},n(156),n(157),n(158),n(159),n(160),n(161),n(162))},function(t,e,n){var r=n(59),i=n(17)([\"userId\"],{},r);t.exports={createDMButton:i}},function(t,e,n){var r=n(62),i=n(17)([\"screenName\"],{},r);t.exports={createFollowButton:i}},function(t,e,n){var r=n(63),i=n(17)([\"momentId\"],{},r);t.exports={createMoment:i}},function(t,e,n){var r=n(64),i=n(17)([\"username\"],{},r);t.exports={createPeriscopeOnAirButton:i}},function(t,e,n){var r=n(8),i=n(12),o=n(3),s=n(0),a=n(5),u=n(65),c=n(66),d=n(17)([],{},c),f=n(6),l=\"Embedded grids have been deprecated. Please use twttr.widgets.createTimeline instead. More info: https://twittercommunity.com/t/update-on-the-embedded-grid-display-type/119564.\",h={createTimeline:p,createGridFromCollection:function(t){var e=s.toRealArray(arguments).slice(1),n={sourceType:\"collection\",id:t};return e.unshift(n),i.publicLog(l),p.apply(this,e)}};function p(t){var e,n=s.toRealArray(arguments).slice(1);return a.isString(t)||a.isNumber(t)?f.reject(\"Embedded timelines with widget settings have been deprecated. See https://twittercommunity.com/t/deprecating-widget-settings/102295.\"):s.isObject(t)?(t=t||{},n.forEach(function(t){s.isType(\"object\",t)&&function(t){t.ariaLive=t.ariaPolite}(e=t)}),e||(e={},n.push(e)),t.lang=e.lang,t.tweetLimit=e.tweetLimit,t.showReplies=e.showReplies,e.dataSource=u(t),d.apply(this,n)):f.reject(\"data source must be an object.\")}o.isTwitterURL(r.href)&&(h.createTimelinePreview=function(t,e,n){var r={previewParams:t,useLegacyDefaults:!0,isPreviewTimeline:!0};return r.dataSource=u(r),d(e,r,n)}),t.exports=h},function(t,e,n){var r,i=n(0),o=n(67),s=n(17),a=(r=s([\"tweetId\"],{},o),function(){return i.toRealArray(arguments).slice(1).forEach(function(t){i.isType(\"object\",t)&&(t.hideCard=\"none\"==t.cards||\"hidden\"==t.cards,t.hideThread=\"none\"==t.conversation||\"hidden\"==t.conversation)}),r.apply(this,arguments)});t.exports={createTweet:a,createTweetEmbed:a,createVideo:a}},function(t,e,n){var r=n(0),i=n(68),o=n(17),s=o([\"url\"],{type:\"share\"},i),a=o([\"buttonHashtag\"],{type:\"hashtag\"},i),u=o([\"screenName\"],{type:\"mention\"},i);function c(t){return function(){return r.toRealArray(arguments).slice(1).forEach(function(t){r.isType(\"object\",t)&&(t.screenName=t.screenName||t.screen_name,t.buttonHashtag=t.buttonHashtag||t.button_hashtag||t.hashtag)}),t.apply(this,arguments)}}t.exports={createShareButton:c(s),createHashtagButton:c(a),createMentionButton:c(u)}},function(t,e,n){var r,i,o,s=n(4),a=n(1),u=0,c=[],d=s.createElement(\"a\");function f(){var t,e;for(u=1,t=0,e=c.length;t<e;t++)c[t]()}/^loade|c/.test(s.readyState)&&(u=1),s.addEventListener&&s.addEventListener(\"DOMContentLoaded\",i=function(){s.removeEventListener(\"DOMContentLoaded\",i,!1),f()},!1),d.doScroll&&s.attachEvent(\"onreadystatechange\",r=function(){/^c/.test(s.readyState)&&(s.detachEvent(\"onreadystatechange\",r),f())}),o=d.doScroll?function(t){a.self!=a.top?u?t():c.push(t):function(){try{d.doScroll(\"left\")}catch(e){return setTimeout(function(){o(t)},50)}t()}()}:function(t){u?t():c.push(t)},t.exports=o},function(t,e,n){var r=n(47),i=n(9);t.exports=function(){i.set(\"buildVersion\",r.version)}},function(t,e,n){n(166),n(83),n(169)},function(t,e,n){var r=n(167),i=n(29),o=n(69),s=new r,a=function(t){t.widgets&&1===t.widgets.length&&(s.start(),i.emitter.unbind(i.ALL_WIDGETS_RENDER_START,a))},u=function(t){var e;t.widgets&&1===t.widgets.length&&(e=t.widgets[0],s.end(),e.dataset&&e.dataset.tweetId&&o({duration:s.duration(),namespace:{element:\"tweet\",action:\"render\"},widgetIds:[e.dataset.tweetId]})),i.emitter.unbind(i.ALL_WIDGETS_RENDER_END,u)};i.emitter.bind(i.ALL_WIDGETS_RENDER_START,a),i.emitter.bind(i.ALL_WIDGETS_RENDER_END,u)},function(t,e,n){var r=n(168);function i(){}i.prototype.start=function(){this._startTime=r()},i.prototype.end=function(){this._duration=r()-this._startTime},i.prototype.duration=function(){return this._duration},t.exports=i},function(t,e,n){var r=n(1);t.exports=function(){return r.performance&&r.performance.now?r.performance.now():Date.now()}},function(t,e,n){var r=n(29),i=n(69),o=n(170),s=n(3),a=n(1),u=n(0),c=n(21),d=n(61);function f(t){return t.performance.getEntriesByType(\"resource\").filter(function(t){return s.isTwimgURL(t.name)||s.isTwitterURL(t.name)}).reduce(function(t,e){return t[e.name]=e.duration,t},{})}r.emitter.bind(r.ALL_WIDGETS_AND_IMAGES_LOADED,function(t){var e,n,r=[];c.hasPerformanceInformation()&&(e=f(a),d.isSupported()||(r=function(t){return t.reduce(function(t,e){return u.aug(t,f(e.contentDocument.defaultView))},{})}(t)),n=u.aug({},e,r),Object.keys(o).forEach(function(t){!function(t,e,n){var r=Object.keys(t).reduce(function(e,r){return n(r)?e+t[r]:e},0);i({duration:r,namespace:{element:e,action:\"resource\"}})}(n,t,o[t])}))})},function(t,e,n){var r=n(3),i={all:function(){return!0},image:function(t){return r.isTwimgURL(t)},settings:function(t){return r.isSettingsURL(t)},widget_iframe:function(t){return r.isWidgetIframeURL(t)}};t.exports=i}])));Once again, the fact that the ninth most liked tweets are published in 2017 can be explained by the increasing number of people using Twitter - and not only by the increasing popularity of the tennis players.\r\nIs our top 10 different if we look at the most retweeted tweets?\r\ntweets_big4 %>%\r\n  select(screen_name, text, retweet_count, created_at) %>%\r\n  arrange(desc(retweet_count)) %>%\r\n  head(n = 10L) %>%\r\n  kable()\r\nscreen_name\r\ntext\r\nretweet_count\r\ncreated_at\r\nandy_murray\r\nRT @AHMalcolm: For every retweet this gets, Pedigree will donate one bowl of dog food to dogs in need! 😊 #tweetforbowls http://t.co/z4rmc2H…\r\n795958\r\n2015-05-24 20:12:51\r\nrogerfederer\r\n#19 tastes great https://t.co/3Hv3lM5Rk9\r\n146819\r\n2017-07-16 15:47:03\r\nrogerfederer\r\n🎾👉🏼 💎👉🏼 🆘 https://t.co/6fYgmDFj8z\r\n137589\r\n2017-09-02 02:11:07\r\nRafaelNadal\r\n#CHAMP10N\r\n84193\r\n2017-06-11 15:31:47\r\nandy_murray\r\nCan’t believe what’s just happened!!!!!!!\r\n82529\r\n2013-07-07 17:45:01\r\nrogerfederer\r\nJuan Martin del THORtro @delpotrojuan https://t.co/BsLeAHhULV\r\n80927\r\n2017-09-05 02:57:27\r\nRafaelNadal\r\n#CHAMP10N https://t.co/BV0M1qE7NE\r\n80710\r\n2017-06-11 16:13:25\r\nrogerfederer\r\n1️⃣8️⃣🏆 https://t.co/Ap8aZGhBNf\r\n783\r\n55 2017-01-29 16:05:13\r\nDjokerNole\r\nRT @NiallOfficial: Different league of tennis tonight ! Jesus Christ ! @DjokerNole and @stanwawrinka were incredible ! Congrats nole ! Fina…\r\n73005\r\n2015-01-30 22:13:53\r\nDjokerNole\r\nRT @NiallOfficial: Great to watch my brother @DjokerNole win at the O2 arena tonight ! What an athlete ! http://t.co/anrPmTxPEG\r\n61559\r\n2014-11-18 18:06:19\r\nThe 10 most retweeted tweets are quite similar to the most liked ones. With the exception of the most retweeted tweet of all the Big Four history on Twitter: a 2015 retweet by Andy Murray about a dog food donation that has been retweeted almost 800’000 times.\r\nBut what about the content of the other tweets?\r\nAre Their Tweets Similar?\r\nFollowing the ebook Text mining with R from Julia Silge and David Robinson, let’s compare the relative frequency of the words usage of two tennis players. As Rafael Nadal and Novak Djokovic sometimes write in their own mother tongue, let’s have a look at the word usage made by Roger Federer and Andy Murray online.\r\nWe firstly need to prepare the data.\r\nlibrary(tidytext)\r\n\r\nreplace_reg <- \"https://t.co/[A-Za-z\\\\d]+|http://[A-Za-z\\\\d]+|&amp;|&lt;|&gt;|RT|https\"\r\nunnest_reg <- \"([^A-Za-z_\\\\d#@']|'(?![A-Za-z_\\\\d#@]))\"\r\ntweets_tidy <- tweets_big4 %>% \r\n  filter(!str_detect(text, \"^RT\")) %>%\r\n  mutate(text = str_replace_all(text, replace_reg, \"\")) %>%\r\n  unnest_tokens(word, text, token = \"regex\", pattern = unnest_reg) %>%\r\n  filter(!word %in% stop_words$word,\r\n         str_detect(word, \"[a-z]\"))\r\n\r\ntweets_frequency1 <- tweets_tidy %>% \r\n  group_by(screen_name) %>% \r\n  count(word, sort = TRUE) %>% \r\n  left_join(tweets_tidy %>% \r\n              group_by(screen_name) %>% \r\n              summarise(total = n())) %>%\r\n  mutate(freq = n/total)\r\n\r\nlibrary(tidyr)\r\n\r\ntweets_frequency2 <- tweets_frequency1 %>% \r\n  select(screen_name, word, freq) %>% \r\n  spread(screen_name, freq) %>%\r\n  arrange(rogerfederer, DjokerNole, RafaelNadal, andy_murray)\r\nFor readability, we will transform the word frequency in “Log Ratio”. It means, as explained in an article of Andrew Hardie, that “every extra point of Log Ratio score represents a doubling in size of the difference between the two corpora”.\r\nlibrary(magick)\r\nlibrary(grid)\r\n\r\nmurray <- image_read(\"http://www.atpworldtour.com/-/media/tennis/players/gladiator/2017/murray_a_fullao17.png\")\r\nfederer <- image_read(\"http://www.atpworldtour.com/-/media/tennis/players/gladiator/2018/federer_full_ao18.png\")\r\n\r\ntweets_frequency2 %>%\r\n  ggplot(aes(x = rogerfederer, y = andy_murray)) +\r\n  geom_jitter(alpha = 0.1, size = 2.5, width = 0.25, height = 0.25) +\r\n  geom_text(aes(label = word), check_overlap = TRUE, vjust = 1.5) +\r\n  scale_x_log10(labels = percent_format()) +\r\n  scale_y_log10(labels = percent_format()) +\r\n  geom_abline(color = \"darkblue\") +\r\n  theme_economist_white() +\r\n  theme(plot.background = element_rect(fill = \"#f8f2e4\")) +\r\n  labs(x = \"Roger Federer\", y = \"Andy Murray\",\r\n       title = \"Word Frequency of The Big Four on Twitter\",\r\n       caption = \"Félix Luginbühl (@lgnbhl)\\nData source: Twitter\")\r\n\r\ngrid.raster(federer, x = 0.9, y = 0.3, width = 0.1)\r\ngrid.raster(murray, x = 0.16, y = 0.8, width = 0.1)\r\n\r\nThe closer the words are from the read line, the more they are used with equal frequencies by Roger Federer and Andy Murray. This visualisation let us know which words are often used by the two players, and which words are more “typical” from one or the other.\r\nFinally, we can select some highly frequently words used by the Big Four on Twitter and see which one are more used by whom.\r\nplotTwitterWords <- function(w) {\r\n  tweets_big4 %>%\r\n    filter(is_retweet == FALSE) %>%\r\n    unnest_tokens(words, text) %>%\r\n    select(words, screen_name) %>%\r\n    group_by(screen_name) %>%\r\n    count(words) %>%\r\n    filter(words %in% c(w)) %>%\r\n    ggplot(aes(words, n, color = screen_name)) +\r\n    geom_point(size = 4, alpha = 0.8) +\r\n    coord_flip() +\r\n    scale_color_brewer(name = NULL, \r\n                       labels = c(\"Andy Murray\", \"Novak Djokovic\", \"Rafael Nadal\", \"Roger Federer\"),\r\n                       palette = \"Set2\") +\r\n    ggthemes::theme_economist_white() +\r\n    theme(plot.background = element_rect(fill = \"#f8f2e4\"),\r\n          legend.background = element_blank(), \r\n          legend.key = element_blank()) +\r\n    labs(x = \"Words\", y = \"Number of occurrences\",\r\n         title = \"The Big Four Words on Twitter\",\r\n         caption = \"Félix Luginbühl (@lgnbhl)\\n Data source: Twitter\")\r\n  }\r\n\r\n# Selecting of words to plot\r\nw <- c(\"tennis\", \"support\", \"guys\", \"fun\", \"win\", \"match\")\r\n\r\nplotTwitterWords(w)\r\n\r\nAndy Murray often uses the words “win” and “tennis”, while Novak Djokovic prefers the words “match”, “guys” and “fun”. The function plotTwitterWords gives the possibility to easily play with the words to plot.\r\nFor updates of recent blog posts, follow me on Twitter.\r\nFor reproducing my data analysis, go on my Github repo or my RStudio server.\r\nCurious about what I can do for your organisation? Have a look my services.\r\n\r\n\r\n\r\n",
    "preview": "posts/2017-09-22-tennis/img/chart_big4_2.png",
    "last_modified": "2020-12-04T23:45:17+01:00",
    "input_file": {},
    "preview_width": 672,
    "preview_height": 480
  },
  {
    "path": "posts/2017-08-24-bond/",
    "title": "James Bond Tourism",
    "description": "James Bond must be the most well-travelled man in the history of movies. As it is summer time, let's have a look at the 007 travel locations in the 24 films of the spy franchise with the R packages {maps}, {ggplot2} and {ggmap}.",
    "author": [],
    "date": "2017-08-24",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nThe Data\r\nMapping Bond’s worldwide missions\r\nLocating 007 missions\r\n\r\nIn this article, we will answer three questions:\r\nWhat are the countries that James Bond has visited?\r\nWhich countries has James Bond visited the most?\r\nHave mission’s locations of James Bond changed over time?\r\nThe Data\r\nWe can find on Wikipedia a full list of James Bond film locations. I copied the list on LibreOffice Calc and made some quick cleaning. For reproducibility, the data can be downloaded on my Github repository.\r\nlibrary(tidyverse)\r\n\r\nbond <- read_csv(\"https://raw.githubusercontent.com/lgnbhl/lgnbhl.github.io/masterimg/data_bond.csv\")\r\n\r\nprint(bond)\r\n## # A tibble: 143 x 3\r\n##                     Film                           Location         region\r\n##                    <chr>                              <chr>          <chr>\r\n##  1                Dr. No MI6 headquarters in central London        England\r\n##  2                Dr. No                           Kingston        Jamaica\r\n##  3                Dr. No                           Crab Key        Jamaica\r\n##  4 From Russia with Love                      Unnamed river United Kingdom\r\n##  5 From Russia with Love                             Zagreb        Croatia\r\n##  6 From Russia with Love                           Belgrade         Serbia\r\n##  7 From Russia with Love                           Istanbul         Turkey\r\n##  8 From Russia with Love                             Venice          Italy\r\n##  9            Goldfinger                         Stoke Park        England\r\n## 10            Goldfinger                             Geneva    Switzerland\r\n## # ... with 133 more rows\r\nMapping Bond’s worldwide missions\r\nWe can count and map all the countries visited by James Bond in the film series. The package {ggalt} gives the possibility to choose between different map projections. We selected the Winkel Tripel projection for mapping.\r\nlibrary(maps)\r\n\r\nworld <- map_data(\"world\") %>% \r\n  filter(region != \"Antarctica\")\r\n\r\n# Renaming regions for mapping\r\nbond <- bond %>%\r\n  mutate(region = recode(region,\r\n    \"United Kingdom\" = \"UK\",\r\n    \"England\" = \"UK\",\r\n    \"United States\" = \"USA\"\r\n  )) \r\n\r\nbond_number <- bond %>%\r\n  count(region, sort = TRUE)\r\n\r\nlibrary(ggalt)\r\nlibrary(ggthemes)\r\n\r\nggplot() +\r\n  geom_map(data = world, map = world,\r\n           aes(x = long, y = lat, map_id = region),\r\n           fill=\"lightgrey\", col=\"white\", size = 0.2) +\r\n  geom_map(data = bond_number, map = world,\r\n           aes(map_id = region, fill = n)) +\r\n  scale_fill_distiller(breaks = c(1, 2, 4, 6, 8, 10, 12, 14),\r\n                       labels = c( \"1\", \"2\", \"3-4\", \"5-6\", \"7-8\", \"9-10\", \"11-12\", \"13-14\"),\r\n                       name = \"Number of visits\",\r\n                       palette = \"OrRd\", direction = 1,\r\n                       guide = guide_legend(title.position = \"top\")) +\r\n  ggalt::coord_proj(\"+proj=wintri\") +\r\n  ggthemes::theme_map() +\r\n  theme(plot.title = element_text(size = 20, face = \"bold\"),\r\n        plot.subtitle = element_text(size = 11),\r\n        legend.position = \"right\",\r\n        legend.justification = \"center\") +\r\n  labs(title = \"James Bond Tourism\",\r\n       subtitle = \"007 locations in the movie franchise\",\r\n       caption = \"Félix Luginbühl (@lgnbhl)\\n Data source: Wikipedia\")\r\n\r\nJames Bond has been to the United States 13 times. But in which movies did these visits happen?\r\nbond %>%\r\n  select(Film, region) %>%\r\n  filter(region == \"USA\") %>%\r\n  count(Film, sort = TRUE) %>%\r\n  rename(US_visits_by_film = n)\r\n## # A tibble: 9 x 2\r\n##                   Film US_visits_by_film\r\n##                  <chr>             <int>\r\n## 1           Goldfinger                 3\r\n## 2 Diamonds Are Forever                 2\r\n## 3     Live and Let Die                 2\r\n## 4     A View to a Kill                 1\r\n## 5        Casino Royale                 1\r\n## 6      Licence to Kill                 1\r\n## 7            Moonraker                 1\r\n## 8          Thunderball                 1\r\n## 9  You Only Live Twice                 1\r\nLocating 007 missions\r\nIn order to locate the places in the films where James Bond has been, we need to get their geolocations (latitude and longitude). The geocoding function of the package {ggmap} does the job well with the Google Maps API. We will use the loop described in the blog article of Mitchell Craver.\r\nHowever, we face a problem. There are plenty of imaginary locations in the James Bond movies that Google Maps cannot geolocate. So for each imaginary place, we will just replace it by the name of the country. As this work has to be done manually, we selected only the movies starring the first and last actors playing James Bond: Sean Connery and Daniel Craig.\r\nLet’s begin by locating Bond’s missions in movies starring Sean Connery.\r\n# Identify locations by country, otherwise imprecisions\r\nbond_2 <- tidyr::unite(bond, loc, c(Location, region), sep = \", \", remove = FALSE)\r\n\r\n# Selecting movies starring Sean Connery\r\nconnery <- c(\"Dr. No\", \"From Russia with Love\", \"Goldfinger\", \"Thunderball\", \"You Only Live Twice\", \"Diamonds Are Forever\")\r\nbond_connery <- filter(bond_2, Film %in% connery)\r\n\r\n# Change imaginary locations in country names\r\nbond_connery[18,2] <- \"England\" # \"Shrublands Health Retreat\" in \"Thunderball\"\r\nbond_connery[24,2] <- \"Japan\" # \"SPECTRE's hideout\" in \"You Only Live Twice\"\r\nbond_connery[25,2] <- \"Norway\" # \"Secret CIA base\" in \"You Only Live Twice\"\r\nbond_connery <- bond_connery[-29,] # remove unknown country in Latin America\r\nbond_connery[29,2] <- \"South Africa\" # \"Unnamed location\" in \"Diamonds Are Forever\"\r\nbond_connery[33,2] <- \"Mexico\" # \"Oil rig in Baja California\" in \"Diamonds Are Forever\"\r\n\r\n# Google Maps API\r\n# Loop from Mitchell Craver: http://whatdothedatasay.com/2016/03/16/geocoding-addresses-in-r-with-ggmap/\r\nlibrary(ggmap)\r\n\r\n# ?register_google()\r\n# register_google(key = \"KEY_HERE\")\r\n\r\nfor(i in 1:nrow(bond_connery)){\r\n    result <- ggmap::geocode(bond_connery$loc[i], output = \"latlona\", source = \"google\")\r\n    bond_connery$lon[i] <- as.numeric(result[1])\r\n    bond_connery$lat[i] <- as.numeric(result[2])\r\n    bond_connery$geoAddress[i] <- as.character(result[3])\r\n    Sys.sleep(1) #slow down the requests speed\r\n    }\r\n\r\nwrite_csv(bond_connery, \"output/bond_connery.csv\")\r\nbond_connery <- read.csv(\"output/bond_connery.csv\", header = T) # keep factor\r\n\r\nlevels(bond_connery$Film) <- c(\"Dr. No\", \"From Russia with Love\", \"Goldfinger\", \"Thunderball\", \"You Only Live Twice\", \"Diamonds Are Forever\")\r\n\r\nlibrary(ggiraph)\r\n\r\ng1 <- ggplot() +\r\n  geom_map(data = world, map = world, aes(x = long, y = lat, map_id = region),\r\n           fill = \"lightgrey\", col = \"white\", size = 0.2) +\r\n  geom_point_interactive(data = bond_connery, aes(lon, lat, tooltip = loc), \r\n           color = \"white\", size = 3, fill= \"brown1\", pch = 21) +\r\n  coord_proj(\"+proj=wintri\") +\r\n  theme_map() +\r\n  labs(labs(title = \"James Bond locations in movies starring Sean Connery\",\r\n            caption = \"Félix Luginbühl (@lgnbhl)\\n Data source: Wikipedia\")) +\r\n  theme(plot.title = element_text(size = 14, hjust = 0.5, face = \"bold\"),\r\n               plot.caption = element_text(size = 8, color = \"dimkgrey\"))\r\n\r\nggiraph(print(g1))\r\n\r\n\r\nA nice interactive map!\r\nAnd what about the locations by movie?\r\ng1 + facet_wrap(~ Film)\r\n\r\nLet’s do the same work for the James Bond movies starring Daniel Craig.\r\ncraig <- c(\"Casino Royale\", \"Quantum of Solace\", \"Skyfall\", \"Spectre\")\r\nbond_craig <- filter(bond_2, Film %in% craig)\r\n\r\nbond_craig[3,2] <- \"Madagascar\"\r\nbond_craig[22,2] <- \"Scotland\"\r\n\r\nfor(i in 1:nrow(bond_craig)){\r\n  result <- geocode(bond_craig$loc[i], output = \"latlona\", source = \"google\")\r\n  bond_craig$lon[i] <- as.numeric(result[1])\r\n  bond_craig$lat[i] <- as.numeric(result[2])\r\n  bond_craig$geoAddress[i] <- as.character(result[3])\r\n  }\r\n\r\n# write.csv(bond_craig, \"output/bond_craig.csv\")\r\nbond_craig <- read.csv(\"output/bond_craig.csv\", header = T) # keep factor\r\n\r\nlevels(bond_craig$Film) <- c(\"Casino Royale\", \"Quantum of Solace\", \"Skyfall\", \"Spectre\")\r\n\r\ng2 <- ggplot() +\r\n  geom_map(data = world, map = world, aes(x = long, y = lat, map_id = region),\r\n           fill = \"lightgrey\", col = \"white\", size = 0.2) +\r\n  geom_point_interactive(data = bond_craig, aes(lon, lat, tooltip = loc), \r\n           color = \"white\", size = 3, fill = \"brown1\", pch = 21) +\r\n  coord_proj(\"+proj=wintri\") +\r\n  theme_map() +\r\n  labs(labs(title = \"James Bond locations in movies starring Daniel Craig\",\r\n            caption = \"Félix Luginbühl (@lgnbhl)\\n Data source: Wikipedia\")) +\r\n  theme(plot.title = element_text(size = 14, hjust = 0.5, face = \"bold\"),\r\n        plot.caption = element_text(size = 8, color = \"dimkgrey\"))\r\n\r\nggiraph(print(g2))\r\n\r\n\r\nAnd the locations by movie:\r\ng3 + facet_wrap(~ Film)\r\n\r\nComparing James Bond’s locations in the first and last movies of the franchise, we can see that those starring Sean Connery are mostly in Europe and USA when those starring Daniel Craig are mostly in Latin America and Asia.\r\n\r\nThanks for reading!\r\n\r\nFor updates of recent blog posts, follow me on Twitter.\r\nFor reproducing my data analysis, go on my Github repo or my RStudio server.\r\nCurious about what I can do for your organisation? Have a look my services.\r\n\r\n\r\n\r\n",
    "preview": "posts/2017-08-24-bond/img/map_bond_1.png",
    "last_modified": "2020-12-04T23:44:48+01:00",
    "input_file": {},
    "preview_width": 672,
    "preview_height": 480
  },
  {
    "path": "posts/2017-10-19-learner/",
    "title": "Introducing {learner}, My First Package!",
    "description": "The {learner} package lets you use the R console as an interactive learning environment in order to memorize any dataset you want. Its main goal is to put foreign language vocabulary learning in the R workflow, so R can also be used to study languages or anything related to flashcards.",
    "author": [],
    "date": "2017-07-19",
    "categories": [],
    "contents": "\r\n\r\nContents\r\n** Update, March 24th, 2018 **\r\nMy inspirations\r\nHow {learner} works\r\n\r\nThe gif below shows how to use {learner} in the R console.\r\n\r\n** Update, March 24th, 2018 **\r\nThe {learner} package is now called {polyglot}. See this blog post for more information.\r\nMy inspirations\r\nI am a big fan of Anki, a spaced repetition program which priorities the flashcards you need to study. It’s a very effective application to memorize foreign vocabulary or anything you want to. And it’s free and open source.\r\nAs Anki is written in Python, I wondered if a similar program exists in the R community. The closer I could find was the impressive {swirl} package, which teaches you R programming and data science interactively in the R console. Sadly, {swirl} is not built to study flashcards. So to fill this gap, I decided to develop the {learner} package (my first package!).\r\nHow {learner} works\r\nThe {learner} package is built in only 3 functions. I will present them now one by one.\r\nLet’s begin by looking at the first and longer function, called learn, which launches the interactive learning environment.\r\nlearn <- function() {\r\n  message(\"| Welcome to learner!\")\r\n  message(\"| Please choose a dataset to study, or type 0 to exit.\")\r\n  if(!exists(\"learnerStartTime\")) {\r\n    learnerStartTime <- Sys.time()\r\n    assign(\"learnerStartTime\", learnerStartTime, envir = .GlobalEnv)\r\n  }\r\n  learnerDatasetPath <- system.file(\"extdata/\", package = \"learner\")\r\n  learnerDatasetName <- select.list(list.files(path = paste0(\"\", learnerDatasetPath, \"\")))\r\n  learnerDatasetAbsolutePath <- paste0(\"\",learnerDatasetPath,\"\", learnerDatasetName,\"\")\r\n  assign(\"learnerDatasetAbsolutePath\", learnerDatasetAbsolutePath, envir = .GlobalEnv)\r\n  if (learnerDatasetName == \"\") {\r\n    learnerExit() # 0 selected, exit the learning session\r\n  } else {\r\n    learnerDataset <- read.csv(paste0(\"\",learnerDatasetAbsolutePath,\"\"), stringsAsFactors = FALSE)\r\n    assign(\"learnerDataset\", learnerDataset, envir = .GlobalEnv)\r\n    # Check if the dataset has at least two colomns\r\n    if (ncol(learnerDataset) < 2) {\r\n      message(\"| WARNING: Your dataset doesn't have two colomns.\")\r\n      message(\"| Learner needs two-colomns datasets to work correctly.\\n\")\r\n      return(learn())\r\n    } else {\r\n      learnerDataset[,1] <- as.character(learnerDataset[,1])\r\n      learnerDataset[,2] <- as.character(learnerDataset[,2])\r\n      assign(\"learnerDataset\", learnerDataset, envir = .GlobalEnv)\r\n    }\r\n    # Add numerical Score variable if not exists\r\n    if (any(names(learnerDataset) == \"Score\")) {\r\n      message(paste(\"|\", learnerDatasetName,\"selected, with\", nrow(learnerDataset),\"rows.\"))\r\n      message(\"| Continuing learning session...\\n\")\r\n    } else {\r\n      learnerDataset$Score <- rep(as.numeric(0), nrow(learnerDataset))\r\n      assign(\"learnerDataset\", learnerDataset, envir = .GlobalEnv)\r\n      write.csv(learnerDataset, file = paste0(\"\", learnerDatasetAbsolutePath, \"\"), row.names = FALSE)\r\n      message(paste(\"|\", learnerDatasetName,\"selected, with\", nrow(learnerDataset),\"rows.\"))\r\n      message(\"| New learning session launched...\\n\")\r\n    }\r\n    # If NAs exist in the Score variable, replace by 0\r\n    learnerDataset$Score[is.na(learnerDataset$Score)] <- 0\r\n    assign(\"learnerDataset\", learnerDataset, envir = .GlobalEnv)\r\n    write.csv(learnerDataset, file = paste0(\"\", learnerDatasetAbsolutePath, \"\"), row.names = FALSE)\r\n    return(learnerQuestion())\r\n  }\r\n  invisible()\r\n}\r\nThis function initializes the interactive environment by proposing to select a CSV file from the inst/extdata/ directory. The function reads the selected dataset and adds a numeric variable, named Score, if not already existing. It also replaces any existing missing values by 0 from the Score variable. It means that you can add new rows in the CSV file at any time you want. Finally the function returns to the learnerQuestion function, or to the learnerExit function if 0 is typed.\r\nWhen the dataset is chosen, you will have a data.frame named learnerDataset in your Global Environment. If it was for instance the “French_30_Basic_expressions.csv” dataset that has been selected, the data will look like a three-sided flashcards with a question, an answer and an hint/example (here pronunciation):\r\ncenterNow, let’s look at the second function, named learnerQuestion.\r\nlearnerQuestion <- function() {\r\n  learnerDataset <- read.csv(paste0(\"\",learnerDatasetAbsolutePath,\"\"), stringsAsFactors = FALSE)\r\n  message(paste(\"| Question:\", learnerDataset[1,1],\"\"))\r\n  switch(menu(c(\"Show answer\", \"Hard\", \"Good\", \"Easy\", \"Hint/Example\", \"Back to menu\")) + 1,\r\n         return(learnerExit()),\r\n         message(paste0(\"| Answer: \", learnerDataset[1,2], \"\\n\")),\r\n         learnerDataset$Score[1] <- learnerDataset$Score[1] + 1,\r\n         learnerDataset$Score[1] <- learnerDataset$Score[1] + 2,\r\n         learnerDataset$Score[1] <- learnerDataset$Score[1] + 4,\r\n         if (names(learnerDataset[3]) != \"Score\") {\r\n           message(paste(\"| Hint/Example:\", learnerDataset[1,3],\"\\n\"))\r\n         } else {\r\n           message(paste(\"| No Hint/Example in this dataset.\\n\"))\r\n         },\r\n         return(learn()))\r\n  learnerDataset <- learnerDataset[order(learnerDataset$Score), ]\r\n  assign(\"learnerDataset\", learnerDataset, envir = .GlobalEnv)\r\n  write.csv(learnerDataset, file = paste0(\"\", learnerDatasetAbsolutePath, \"\"), row.names = FALSE)\r\n  invisible()\r\n  return(learnerQuestion()) # create loop\r\n}\r\nThis function reads the selected dataset and print the first row of its first column, i.e. the question. Then it presents to the user a menu, which gives him multiple choices. According to the choice made by the user, the function gives a score point, i.e. Hard = +4 points, Good = +2 points, Easy = +1 point. The menu also proposes to show the answer (to print the 2nd column of the row), to give a hint/example (to print the 3rd column of the row), or to go back to the main menu. Finally, the function reorders the dataset in order to get the lower points score in its first row and returns the function once again.\r\nYes, I agree, the score algorithm is very basic. I will probably improve it in the next versions of the package. If you want to contribute or suggest any improvements, don’t hesitate to make a Pull request or to contact me.\r\nFinally, let’s look at the learnerExit function.\r\nlearnerExit <- function() {\r\n  learnerEndTime <- Sys.time()\r\n  learnerTimer <- as.numeric(learnerEndTime - learnerStartTime, units = \"mins\")\r\n  if(round(learnerTimer) <= 1) {\r\n    message(paste(\"| Learning session time:\", round(learnerTimer),\"minute.\"))\r\n    } else {\r\n    message(paste(\"| Learning session time:\", round(learnerTimer),\"minutes.\"))\r\n  }\r\n  message(\"| Learning score saved. Cleaning Global Environment...\")\r\n  if(exists(\"learnerDataset\")) {\r\n    rm(learnerDataset, envir = globalenv())\r\n  }\r\n  if(exists(\"learnerDatasetAbsolutePath\")) {\r\n    rm(learnerDatasetAbsolutePath, envir = globalenv())\r\n  }\r\n  if(exists(\"learnerStartTime\")) {\r\n    rm(learnerStartTime, envir = globalenv())\r\n  }\r\n  message(\"| Leaving learner now. Type learn() to resume.\")\r\n  invisible()\r\n}\r\nThis function calculates the learning session time and print it. Then, it cleans the Global Environment if needed and displays a farewell message.\r\nHappy learning!\r\n\r\nThanks for reading!\r\n\r\nFor updates of recent blog posts, follow me on Twitter.\r\nFor reproducing my data analysis, go on my Github repo or my RStudio server.\r\nCurious about what I can do for your organisation? Have a look my services.\r\n\r\n\r\n\r\n",
    "preview": "posts/2017-10-19-learner/img/screenshot_learner_2.png",
    "last_modified": "2020-12-04T23:46:06+01:00",
    "input_file": {},
    "preview_width": 901,
    "preview_height": 300
  },
  {
    "path": "posts/2017-07-10-orwell/",
    "title": "Orwell’s 1984, An (Un)Sentimental Analysis",
    "description": "Dystopian books are trendy. After Donald Trump's election, George Orwell novel 1984 hit the No. 1 spot in Amazon’s book sales chart. Also because I love this book, let's make a text analysis using the R package {tidytext}.",
    "author": [],
    "date": "2017-07-10",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nThe Data\r\nThe Words of Orwell’s 1984\r\nTop Negative and Positive Words\r\nA Sentiment Analysis by Chapter\r\n\r\nIn this article, we will answer three questions:\r\nWhat are the words most frequently used?\r\nWhat are the top negative and positive words?\r\nIs a sentiment analysis informative?\r\nThe Data\r\nThe novel 1984 is in the public domain in Canada and Australia (but neither Europe nor the US). We can find a text version of the book from the Projet Gutenberg Australia website here.\r\nFollowing the ebook Text Mining with R from Julia Silge and David Robinson, let’s begin by tidying the text dataset.\r\nlibrary(tidyverse)\r\nlibrary(tidytext)\r\n\r\ntext_1984 <- read_lines(file = \"http://gutenberg.net.au/ebooks01/0100021.txt\", \r\n                        skip_empty_rows = TRUE, \r\n                        skip = 38, # remove metadata\r\n                        n_max = 8500) %>% # remove appendix\r\n  data_frame(text = .) %>%\r\n  write_csv(path = \"input/text_1984.csv\")\r\n\r\nbigBro <- text_1984 %>%\r\n  unnest_tokens(word, text, format = \"text\") %>%\r\n  anti_join(stop_words)\r\nThe Words of Orwell’s 1984\r\nWhat are the 10 most frequent words used in 1984?\r\nlibrary(ggthemes)\r\n\r\nbigBro %>% \r\n  count(word, sort = TRUE) %>% \r\n  filter(n > 100) %>% \r\n  mutate(word = reorder(word, n)) %>%\r\n  ggplot(aes(word, n)) + \r\n  geom_col() + coord_flip() +\r\n  theme_economist_white(gray_bg = F) +\r\n  theme(plot.background = element_rect(fill = \"#f8f2e4\")) +\r\n  labs(x = NULL, y = NULL,\r\n       title = \"10 Most Common Words in Orwell's 1984\",\r\n       caption = \"Félix Luginbühl (@lgnbhl)\\nData source: gutenberg.net.au\")\r\n\r\nThe two main characters “Winston” and “O’Brien” appear. We also get the main topics of Orwell’s totalitarian society with the words “party”, “time”, “war”, “eyes” and “people”.\r\nThe word “time” is the third most common word in 1984. Working at the Ministry of Truth, Winston rewrites the records of the past. His duty is to follow the party’s ever-changing version of history.\r\nWhat about the other frequently used words in the book? A wordcloud can do the job nicely.\r\nlibrary(wordcloud)\r\n\r\nbigBro %>%\r\n  count(word) %>%\r\n  with(wordcloud(word, n, max.words = 150, rot.per=0.35, \r\n                 random.order = FALSE, \r\n                 colors=brewer.pal(8, \"Dark2\")))\r\n\r\nIn the wordcloud, we see the words “brother” (for Big Brother) and “Julia”, Winston’s love interest and other main characters of the novel. Other important words, like “telescreen”, “oceania”, “pain” or “human”, also appear.\r\nTop Negative and Positive Words\r\nIn order to identify positive and negative words, we need to use a sentiment dictionary. The package {tidytext} gives us access to three of them. Let’s apply the Bing sentiment lexicon from Bing Liu and collaborators to our text and visualize the top 10 negative/positive words in 1984.\r\nbigBro %>%\r\n  inner_join(get_sentiments(\"bing\")) %>%\r\n  count(word, sentiment, sort = TRUE) %>%\r\n  group_by(sentiment) %>%\r\n  top_n(10) %>%\r\n  ungroup() %>%\r\n  mutate(word = reorder(word, n)) %>%\r\n  ggplot(aes(word, n, fill = sentiment)) +\r\n  geom_col(show.legend = FALSE) +\r\n  facet_wrap(~sentiment, scales = \"free_y\") +\r\n  coord_flip() +\r\n  theme_economist_white() +\r\n  theme(plot.background = element_rect(fill = \"#f8f2e4\")) +\r\n  labs(x = NULL, y = NULL,\r\n       title = \"Top 10 Positive and Negative Words in 1984\",\r\n       caption = \"Félix Luginbühl (@lgnbhl)\\nData source: gutenberg.net.au\")\r\n\r\nAlthough the word “love” appears 51 times, it is rarely linked with a positive sentiment. Indeed, the “Ministry of Love” is in charge of torturing political prisoners. We touch here the limits of the use of a sentiment lexicon.\r\nA Sentiment Analysis by Chapter\r\nSentiment words used in 1984 are mostly describing Winston’s emotions. So it makes sense to try a sentiment analysis. Let’s take the Text Mining with R’s sentiment analysis approach, defining a sentiment score for each chapter i of the book:\r\nscorei = positivei - negativei\r\nwhere positivei is the number of “positive” words in a chapter, and negativei the number of “negative” words in a chapter. For instance, if we have 100 positive words and 60 negative words in chapter 1, we get a score of 40.\r\nFirst, we need to add a chapter variable in our dataset.\r\nbigBro_2 <- read_csv(\"input/text_1984.csv\") %>%\r\n  mutate(chapter = cumsum(str_detect(text, regex(\"^chapter [\\\\digit]\", \r\n                                                 ignore_case = TRUE)))) %>%\r\n  unnest_tokens(word, text, format = \"text\")\r\nNow, let’s prepare our dataset for the sentiment analysis.\r\nlibrary(tidyr)\r\n\r\nbigBro_sent <- bigBro_2 %>%\r\n  inner_join(get_sentiments(\"bing\")) %>%\r\n  anti_join(stop_words) %>%\r\n  count(chapter, sentiment) %>%\r\n  spread(key = sentiment, value = n) %>%\r\n  mutate(sentiment = positive - negative)\r\n  \r\nprint(bigBro_sent)\r\n## Source: local data frame [23 x 4]\r\n## Groups: chapter [23]\r\n## \r\n## # A tibble: 23 x 4\r\n##    chapter negative positive sentiment\r\n##      <int>    <int>    <int>     <int>\r\n##  1       1      261       94      -167\r\n##  2       2      118       40       -78\r\n##  3       3       93       52       -41\r\n##  4       4       80       48       -32\r\n##  5       5      189       88      -101\r\n##  6       6       80       30       -50\r\n##  7       7      173       55      -118\r\n##  8       8      264      108      -156\r\n##  9       9      125       46       -79\r\n## 10      10      105       68       -37\r\n## # ... with 13 more rows\r\nWe are ready to run our final visualisation.\r\nlibrary(scales)\r\n\r\nggplot(bigBro_sent, aes(chapter, sentiment)) +\r\n  geom_col() +\r\n  scale_x_continuous(breaks = c(1:23)) +\r\n  geom_smooth(method = \"loess\", se = FALSE) +\r\n  theme_economist_white() +\r\n  theme(plot.background = element_rect(fill = \"#f8f2e4\"),\r\n        plot.caption = element_text(color = \"dimgrey\")) +\r\n  labs(title = \"Orwell's 1984: A Sentiment Analysis\",\r\n       caption = \"Félix Luginbühl (@lgnbhl)\\nData source: gutenberg.net.au\")\r\n\r\nWe see that the sentiment score of each chapter is negative. Our sentiment analysis reflects plainly the dark and pessimistic tone of the novel.\r\nLet’s look at chapters 1, 8 and 17, which are the first chapters of the three parts dividing 1984. We notice that these first chapters get the worst score.\r\nOur sentiment analysis also shows that the sentiment score of each chapter is generally improving until chapter 17. Those who read the novel know what happens to Winston in this final part of the book.\r\n\r\nThanks for reading!\r\n\r\nFor updates of recent blog posts, follow me on Twitter.\r\nFor reproducing my data analysis, go on my Github repo or my RStudio server.\r\nCurious about what I can do for your organisation? Have a look my services.\r\n\r\n\r\n\r\n",
    "preview": "posts/2017-07-10-orwell/img/chart_orwell_4.png",
    "last_modified": "2020-12-12T13:50:13+01:00",
    "input_file": {},
    "preview_width": 672,
    "preview_height": 480
  },
  {
    "path": "posts/2017-06-09-marvel/",
    "title": "Marvel vs DC Comics",
    "description": "Les adaptations de superhéros brillent aux Box Office. Les films Marvel's The Avengers et Avengers: Age of Ultron sont ainsi les 5ème et 7ème plus gros succès au Box Office international. L'envie m'a prise de comparer les succès commerciaux des deux sociétés qui se partagent un quasi monopole des superhéros: Marvel Studios et DC Entertainment.",
    "author": [],
    "date": "2017-06-09",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nLes données\r\nNombre de films adaptés par franchise\r\nRevenu total et médian par franchise\r\nTop 10 des films les plus rentables\r\nVisualisation de l’ensemble des adaptations\r\nVisualisation interactive\r\nConclusion\r\nRéférences\r\n\r\nDans cet article, nous répondrons à trois questions:\r\nQuelle franchise a le plus d’adaptations au cinéma?\r\nQuelle franchise a engendré les films les plus rentables?\r\nComment se répartissent les adaptations des franchises depuis 40 ans?\r\nLes données\r\nLe site Box Office Mojo (filiale du site IMDb, lui-même propriété d´Amazon) propose deux tableaux des recettes des adaptations cinématographiques des franchises DC Comics (ici) et de Marvel Comics (là).\r\nCes données nous intéressent car Box Office Mojo calcule aussi les recettes en ajustant le prix du billet à l’inflation. Sans cet ajustement à l’inflation, il ne serait pas pertinent de comparer les revenus commerciaux des films des années 1980 à ceux des années 2010. Malheureusement, les données ajustées n’existent que pour le Box Office américain. Nous nous en contenterons.\r\nUn simple copier-coller dans LibreOffice Calc permet de sauvegarder rapidement le tableau “Adjusted for Ticket Price Inflation” au format CSV. D’autres bloggeurs se sont amusés à importer les données directement depuis la console R (ici) ou à partir d’un article de Wikipédia qui reprend les données du site Box Office Mojo (là).\r\nNombre de films adaptés par franchise\r\nAvec le package {waffle}, comparons le nombre de films adaptés par franchise.\r\nlibrary(tidyverse)\r\nlibrary(waffle)\r\n\r\ndc_comics <- read_csv(\"input/dc_comics.csv\") %>%\r\n  mutate(Franchise = \"DC Comics\")\r\n\r\nmarvel <- read_csv(\"input/marvel.csv\") %>%\r\n  mutate(Franchise = \"Marvel\")\r\n\r\nnb_films <- c(\"Marvel Comics (45)\" = nrow(marvel), \"DC Comics (29)\" = nrow(dc_comics))\r\n\r\nwaffle(nb_films, row = 5, legend_pos = \"bottom\",\r\n       title = \"Nombre d'adaptations par franchise\",\r\n       colors = c(\"red3\", \"blue3\"))\r\n\r\nLe nombre d´adaptations de la franchise Marvel (45 films) est 1.5 fois supérieur à celle de DC Comics (29 films).\r\nRevenu total et médian par franchise\r\nVoyons maintenant les recettes totales par franchise. Commençons par joindre les deux bases de données et faire un peu de nettoyage.\r\nlibrary(lubridate)\r\n\r\ndf <- full_join(dc_comics, marvel) %>%\r\n  mutate(Release = lubridate::mdy(Release)) %>%\r\n  rename(\"Title\" = \"Title (click to view)\",\r\n         \"AdjGross\" = \"Adjusted Gross\",\r\n         \"UnadjGross\" = \"Unadjusted Gross\") %>%\r\n  mutate(AdjGross = str_remove_all(AdjGross, \"[\\\\$|\\\\,]\"), #enlever $ and ,\r\n         UnadjGross = str_remove_all(UnadjGross, \"[\\\\$|\\\\,]\"),\r\n         AdjGross = as.numeric(AdjGross)/1000000, # en millions de dollars\r\n         UnadjGross = as.numeric(UnadjGross)/1000000) %>%\r\n  select(-Rank)\r\n\r\nprint(df)\r\n## # A tibble: 74 x 6\r\n##    Title                   Studio AdjGross UnadjGross Release    Franchise\r\n##    <chr>                   <chr>     <dbl>      <dbl> <date>     <chr>    \r\n##  1 The Dark Knight         WB         657.       533. 2008-07-18 DC Comics\r\n##  2 Batman                  WB         557.       251. 1989-06-23 DC Comics\r\n##  3 The Dark Knight Rises   WB         509.       448. 2012-07-20 DC Comics\r\n##  4 Superman                WB         507.       134. 1978-12-15 DC Comics\r\n##  5 Batman Forever          WB         374.       184. 1995-06-16 DC Comics\r\n##  6 Batman Returns          WB         347.       163. 1992-06-19 DC Comics\r\n##  7 Superman II             WB         344.       108. 1981-06-19 DC Comics\r\n##  8 Batman v Superman: Daw… WB         338.       330. 2016-03-25 DC Comics\r\n##  9 Suicide Squad           WB         338.       325. 2016-08-05 DC Comics\r\n## 10 Man of Steel            WB         307.       291. 2013-06-14 DC Comics\r\n## # ... with 64 more rows\r\nA présent, calculons les recettes totales et médianes par franchise\r\nlibrary(knitr)\r\n\r\ndf %>%\r\n  group_by(Franchise) %>%\r\n  summarise(sumGross = round(sum(AdjGross), 2)) %>%\r\n  knitr::kable()\r\nFranchise\r\nsumGross\r\nDC Comics\r\n6400.78\r\nMarvel\r\n11155.90\r\ndf %>%\r\n  group_by(Franchise) %>%\r\n  summarise(medianGross = round(median(AdjGross), 2)) %>%\r\n  knitr::kable()\r\nFranchise\r\nmedianGross\r\nDC Comics\r\n175.75\r\nMarvel\r\n215.37\r\nLe revenu total du Box Office américain des adaptations de Marvel (11.15 milliards de dollars) est supérieur à celui de DC Comics (6.4 milliards). Il en est de même pour ses recettes médianes (215.3 millions contre 175.7 millions de dollars).\r\nTop 10 des films les plus rentables\r\nCréons un tableau des dix adaptations de superhéros de bande dessinées les plus rentables aux États-Unis.\r\ndf %>%\r\n  select(Title, AdjGross, Franchise, Release) %>%\r\n  arrange(desc(AdjGross)) %>%\r\n  head(n = 10L) %>%\r\n  knitr::kable()\r\nTitle\r\nAdjGross\r\nFranchise\r\nRelease\r\nMarvel’s The Avengers\r\n679.6299\r\nMarvel\r\n2012-05-04\r\nThe Dark Knight\r\n656.5381\r\nDC Comics\r\n2008-07-18\r\nSpider-Man\r\n614.2452\r\nMarvel\r\n2002-05-03\r\nBatman\r\n556.5188\r\nDC Comics\r\n1989-06-23\r\nSpider-Man 2\r\n531.8033\r\nMarvel\r\n2004-06-30\r\nThe Dark Knight Rises\r\n509.0232\r\nDC Comics\r\n2012-07-20\r\nSuperman\r\n507.0458\r\nDC Comics\r\n1978-12-15\r\nAvengers: Age of Ultron\r\n473.1779\r\nMarvel\r\n2015-05-01\r\nSpider-Man 3\r\n432.4023\r\nMarvel\r\n2007-05-04\r\nIron Man 3\r\n431.4658\r\nMarvel\r\n2013-05-03\r\nSix des dix films les plus rentables proviennent de la franchise Marvel. L’ajustement du prix du ticket à l’inflation révèle que les films Batman (1989) et Superman (1978) ont généré plus de recettes que Avengers: Age of Ultron (2015) sur le marché américain.\r\nVisualisation de l’ensemble des adaptations\r\nMais qu’en est-il des autres films? Et qu’en est-il de la répartition des films au cours des années? Une simple fonction nous aidera a visualiser la prise en compte ou l’absence de l’ajustement des recettes à l’inflation.\r\nlibrary(scales)\r\n\r\nplot <- function(data, gross){\r\n  data %>%\r\n    ggplot(aes(x = Release, y = gross)) +\r\n    geom_label(aes(label = Title, color = Franchise), \r\n               size = 2.5, alpha = 0.6) +\r\n    scale_x_date(breaks = date_breaks(\"5 years\"),\r\n                 labels = date_format(\"%Y\")) +\r\n    scale_y_continuous(labels = dollar) +\r\n    scale_color_manual(values = c(\"blue3\", \"red3\")) +\r\n    theme_bw() +\r\n    theme(plot.title = element_text(face = \"bold\"),\r\n          legend.position = \"none\") +\r\n    labs(x = \"\", y = \"millions de dollars\",\r\n         caption = \"@lgnbhl | Source: boxofficemojo.com\" )\r\n  }\r\n\r\nplot(data = df, gross = df$AdjGross) +\r\n  labs(title = \"Marvel vs. DC Comics\",\r\n       subtitle = \"Box Office américain (revenu ajusté à l'inflation)\")\r\n\r\nLa franchise Marvel semble avoir pris le dessus sur DC Comics depuis les années 2000. Le revenu ajusté à l’inflation révèle combien les sagas Superman et Batman ont été rentables durant les années 1980-90. C’est une surprise.\r\nFinalement, voyons comment l’absence d’ajustement du prix du ticket à l’inflation fausse l’interprétation des données.\r\nplot(df, df$UnadjGross) +\r\n  labs(title = \"Marvel vs. DC Comics\",\r\n       subtitle = \"Box Office américain (revenu non-ajusté à l'inflation)\")\r\ncenterLa visualisation est fortement modifiée. Le succès commercial des sagas Superman et Batman de DC Comics des années 1980-90 est masquée.\r\nIl suffit de modifier légèrement le script pour comparer d’autres franchises comme Star Wars et Star Treck ou James Bond et Jason Bourne.\r\nCliquez sur l’image pour l’agrandir.\r\n \r\nVisualisation interactive\r\nTableau public permet de créer des visualisations interactives. Je me suis amusé à l’utiliser avec les données créées dans cet article (en anglais).\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n            <script type='text/javascript'>                    var divElement = document.getElementById('viz1522829883428');                    var vizElement = divElement.getElementsByTagName('object')[0];                    vizElement.style.width='100%';vizElement.style.height=(divElement.offsetWidth*0.75)+'px';                    var scriptElement = document.createElement('script');                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                <\/script><\/p>\r\nConclusion\r\nNotre analyse a montré que la franchise Marvel fait mieux que sa rivale DC Comics au Box Office américain à tous les niveaux: ses recettes individuelles, totales et médianes sont plus élevées, tout comme son nombre d’adaptations.\r\nMais dans le 7ème art, comme ailleurs, popularité ne rime pas toujours avec qualité.\r\nRéférences\r\nD’autres bloggeurs ont étudié la base de donnée de Box Office Mojo:\r\nJoshua Kunst (2016, mars). Visualizing Movies Gross Income.\r\nChristoph Safferling (2015, 14 novembre). James Bond movies.\r\n\r\nThanks for reading!\r\n\r\nFor updates of recent blog posts, follow me on Twitter.\r\nFor reproducing my data analysis, go on my Github repo or my RStudio server.\r\nCurious about what I can do for your organisation? Have a look my services.\r\n\r\n\r\n\r\n",
    "preview": "posts/2017-06-09-marvel/img/chart_marvel_2.png",
    "last_modified": "2020-12-04T23:43:41+01:00",
    "input_file": {},
    "preview_width": 672,
    "preview_height": 480
  }
]
